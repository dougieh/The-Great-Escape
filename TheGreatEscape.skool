@start
@writer=~/.skoolkit:TheGreatEscape.TheGreatEscapeAsmWriter
@set-line-width=240
@set-warnings=1
;
; SkoolKit disassembly of The Great Escape by Denton Designs.
; https://github.com/dpt/The-Great-Escape
;
; Copyright 1986 Ocean Software Ltd. (The Great Escape)
; Copyright 2012-2017 David Thomas <dave@davespace.co.uk> (this disassembly)
;
@ofix+begin
; This disassembly contains ofix changes (operand fixes):
;
@ofix+end
@bfix+begin
; This disassembly contains bfix changes (bug fixes):
;   * Fix the $A2C6 incorrect iteration count resulting in a ROM write to $1A42.
;   * Makes unconditional a needless conditional return at $7CAF.
;   * Corrects the exterior_mask_data iteration count in render_mask_buffer/$B935.
;
@bfix+end
@rfix+begin
; This disassembly contains rfix changes (code movement):
;   * Removes the redundant self-modifying code at $6B19.
;   * Removes a redundant jump at $7AFB.
;   * Removes a redundant jump at $A0B8.
;   * Inserts the missing RET at the end of render_mask_buffer/$B916.
;   * $CCED potential bug fix for is_item_discoverable.
;
@rfix+end
; //////////////////////////////////////////////////////////////////////////////
; THE DISASSEMBLY
; //////////////////////////////////////////////////////////////////////////////
;
; * This is a disassembly of the game when it has been loaded and relocated,
;   but not yet invoked: every byte is in its pristine state.
;
; * Any terminology used herein such as 'super tiles' or 'vischars' is my own
;   and has been invented for the purposes of the disassembly. I have seen none
;   of the original source, nor know anything of how it was built.
;
;   When I contacted the author he informed me that the original source is
;   probably now lost forever. :-(
;
; * The md5sum of the original tape image this disassembly was taken from is
;   a6e5d50ab065accb017ecc957a954b53 and was sourced from
;   http://www.worldofspectrum.org/pub/sinclair/games/g/GreatEscapeThe.tzx.zip
;   but you may see slight differences towards the end of the file if you
;   attempt to recreate the disassembly yourself.
;
; //////////////////////////////////////////////////////////////////////////////
; STYLE
; //////////////////////////////////////////////////////////////////////////////
;
; The disassembly is (presently) not written as a plain English explanation but
; instead in a C style of pseudocode.
;
; Using C style braces { } conflict with SkoolKit's own use of braces, so we
; use the C99 digraphs <% and %> instead.
;
; Braces, 'do' keywords and the like are syntactic sugar and have no
; corresponding assembly instruction so must share a line with another op. For
; this reason the C style pseudocode is formatted in an uneven way to best fit
; the lines to which it is assigned.
; e.g.
;     if (condition) <%
;         statement; %>
;     else <% statement;
;     %>
;
; A single dash '-' indicates a statement has been omitted (though I'm trying
; to remove all that as it was useful in the .ctl file version, but not so much
; in the .skool version).
;
; I replace registers with constants when the value is used only once (e.g. for
; strides when walking through arrays).
;
; //////////////////////////////////////////////////////////////////////////////
; ASSEMBLY PATTERNS
; //////////////////////////////////////////////////////////////////////////////
;
; Here are a selection of Z80 assembly language patterns which occur throughout
; the code.
;
; Multiply A by 2^N:
;   ADD A,A ; A += A (N times)
; Note that this disposes of the topmost bit of A. Some routines discard of
; flag bits this way.
;
; Increment HL by an 8-bit delta:
;   A = L
;   A += delta
;   L = A
;   JR NC,skip
;   H++
;   skip:
; Q: Does this only work for HL?
;
; if-else:
;   CP <value>
;   JR <cond>,elsepart;
;   <ifwork>
;   JR endifpart;
;   elsepart: <elsework>
;   endifpart:
;
; Jump if less than or equal:
;   CP $0F
;   JP Z,$C8F1
;   JP C,$C8F1
;
; Transfer between awkward registers:
;   PUSH reg
;   POP anotherreg
;
; Increment (HL) by -1 or +1:
;   BIT 7,A
;   JR Z,inc
;   DEC (HL)
;   DEC (HL)
;   inc: INC (HL)
;
; //////////////////////////////////////////////////////////////////////////////
; ZX SPECTRUM BASIC DEFINITIONS
; //////////////////////////////////////////////////////////////////////////////
;
; These are here for information only and are not used by any of the
; directives.
;
; attribute_BLUE_OVER_BLACK                     = 1,
; attribute_RED_OVER_BLACK                      = 2,
; attribute_PURPLE_OVER_BLACK                   = 3,
; attribute_GREEN_OVER_BLACK                    = 4,
; attribute_CYAN_OVER_BLACK                     = 5,
; attribute_YELLOW_OVER_BLACK                   = 6,
; attribute_WHITE_OVER_BLACK                    = 7,
; attribute_BRIGHT_BLUE_OVER_BLACK              = 65,
; attribute_BRIGHT_RED_OVER_BLACK               = 66,
; attribute_BRIGHT_PURPLE_OVER_BLACK            = 67,
; attribute_BRIGHT_GREEN_OVER_BLACK             = 68,
; attribute_BRIGHT_CYAN_OVER_BLACK              = 69,
; attribute_BRIGHT_YELLOW_OVER_BLACK            = 70,
; attribute_BRIGHT_WHITE_OVER_BLACK             = 71,
;
; port_KEYBOARD_SHIFTZXCV                       = $FEFE,
; port_KEYBOARD_ASDFG                           = $FDFE,
; port_KEYBOARD_QWERT                           = $FBFE,
; port_KEYBOARD_12345                           = $F7FE,
; port_KEYBOARD_09876                           = $EFFE,
; port_KEYBOARD_POIUY                           = $DFFE,
; port_KEYBOARD_ENTERLKJH                       = $BFFE,
; port_KEYBOARD_SPACESYMSHFTMNB                 = $7FFE,
;
; //////////////////////////////////////////////////////////////////////////////
; ENUMERATIONS
; //////////////////////////////////////////////////////////////////////////////
;
; These are here for information only and are not used by any of the
; directives.
;
; character_0_COMMANDANT                        = 0,
; character_1_GUARD_1                           = 1,
; character_2_GUARD_2                           = 2,
; character_3_GUARD_3                           = 3,
; character_4_GUARD_4                           = 4,
; character_5_GUARD_5                           = 5,
; character_6_GUARD_6                           = 6,
; character_7_GUARD_7                           = 7,
; character_8_GUARD_8                           = 8,
; character_9_GUARD_9                           = 9,
; character_10_GUARD_10                         = 10,
; character_11_GUARD_11                         = 11,
; character_12_GUARD_12                         = 12,
; character_13_GUARD_13                         = 13,
; character_14_GUARD_14                         = 14,
; character_15_GUARD_15                         = 15,
; character_16_GUARD_DOG_1                      = 16,
; character_17_GUARD_DOG_2                      = 17,
; character_18_GUARD_DOG_3                      = 18,
; character_19_GUARD_DOG_4                      = 19,
; character_20_PRISONER_1                       = 20,
; character_21_PRISONER_2                       = 21,
; character_22_PRISONER_3                       = 22,
; character_23_PRISONER_4                       = 23,
; character_24_PRISONER_5                       = 24,
; character_25_PRISONER_6                       = 25,
; character_26_STOVE_1                          = 26,   ; movable item
; character_27_STOVE_2                          = 27,   ; movable item
; character_28_CRATE                            = 28,   ; movable item
; character_NONE                                = 255,
;
; room_0_OUTDOORS                               = 0,
; room_1_HUT1RIGHT                              = 1,
; room_2_HUT2LEFT                               = 2,
; room_3_HUT2RIGHT                              = 3,
; room_4_HUT3LEFT                               = 4,
; room_5_HUT3RIGHT                              = 5,
; room_6                                        = 6,    ; unused room
; room_7_CORRIDOR                               = 7,
; room_8_CORRIDOR                               = 8,
; room_9_CRATE                                  = 9,
; room_10_LOCKPICK                              = 10,
; room_11_PAPERS                                = 11,
; room_12_CORRIDOR                              = 12,
; room_13_CORRIDOR                              = 13,
; room_14_TORCH                                 = 14,
; room_15_UNIFORM                               = 15,
; room_16_CORRIDOR                              = 16,
; room_17_CORRIDOR                              = 17,
; room_18_RADIO                                 = 18,
; room_19_FOOD                                  = 19,
; room_20_REDCROSS                              = 20,
; room_21_CORRIDOR                              = 21,
; room_22_REDKEY                                = 22,
; room_23_BREAKFAST                             = 23,
; room_24_SOLITARY                              = 24,
; room_25_BREAKFAST                             = 25,
; room_26                                       = 26,   ; unused room
; room_27                                       = 27,   ; unused room
; room_28_HUT1LEFT                              = 28,
; room_29_SECOND_TUNNEL_START                   = 29,
; many of the tunnels are displayed duplicated
; room_30                                       = 30,
; room_31                                       = 31,
; room_32                                       = 32,
; room_33                                       = 33,
; room_34                                       = 34,
; room_35                                       = 35,
; room_36                                       = 36,
; room_37                                       = 37,
; room_38                                       = 38,
; room_39                                       = 39,
; room_40                                       = 40,
; room_41                                       = 41,
; room_42                                       = 42,
; room_43                                       = 43,
; room_44                                       = 44,
; room_45                                       = 45,
; room_46                                       = 46,
; room_47                                       = 47,
; room_48                                       = 48,
; room_49                                       = 49,
; room_50_BLOCKED_TUNNEL                        = 50,
; room_51                                       = 51,
; room_52                                       = 52,
; room_NONE                                     = 255,
;
; item_WIRESNIPS                                = 0,
; item_SHOVEL                                   = 1,
; item_LOCKPICK                                 = 2,
; item_PAPERS                                   = 3,
; item_TORCH                                    = 4,
; item_BRIBE                                    = 5,
; item_UNIFORM                                  = 6,
; item_FOOD                                     = 7,
; item_POISON                                   = 8,
; item_RED_KEY                                  = 9,
; item_YELLOW_KEY                               = 10,
; item_GREEN_KEY                                = 11,
; item_RED_CROSS_PARCEL                         = 12,
; item_RADIO                                    = 13,
; item_PURSE                                    = 14,
; item_COMPASS                                  = 15,
; item__LIMIT                                   = 16,
; item_NONE                                     = 255,
;
; zoombox_tile_TL                               = 0,    ; top left
; zoombox_tile_HZ                               = 1,    ; horizontal
; zoombox_tile_TR                               = 2,    ; top right
; zoombox_tile_VT                               = 3,    ; vertical
; zoombox_tile_BR                               = 4,    ; bottom right
; zoombox_tile_BL                               = 5,    ; bottom left
;
; message_MISSED_ROLL_CALL                      = 0,
; message_TIME_TO_WAKE_UP                       = 1,
; message_BREAKFAST_TIME                        = 2,
; message_EXERCISE_TIME                         = 3,
; message_TIME_FOR_BED                          = 4,
; message_THE_DOOR_IS_LOCKED                    = 5,
; message_IT_IS_OPEN                            = 6,
; message_INCORRECT_KEY                         = 7,
; message_ROLL_CALL                             = 8,
; message_RED_CROSS_PARCEL                      = 9,
; message_PICKING_THE_LOCK                      = 10,
; message_CUTTING_THE_WIRE                      = 11,
; message_YOU_OPEN_THE_BOX                      = 12,
; message_YOU_ARE_IN_SOLITARY                   = 13,
; message_WAIT_FOR_RELEASE                      = 14,
; message_MORALE_IS_ZERO                        = 15,
; message_ITEM_DISCOVERED                       = 16,
; message_HE_TAKES_THE_BRIBE                    = 17,
; message_AND_ACTS_AS_DECOY                     = 18,
; message_ANOTHER_DAY_DAWNS                     = 19,
; message_QUEUE_END                             = 255,
;
; interiorobject_STRAIGHT_TUNNEL_SW_NE          = 0,
; interiorobject_SMALL_TUNNEL_ENTRANCE          = 1,
; interiorobject_ROOM_OUTLINE_22x12_A           = 2,
; interiorobject_STRAIGHT_TUNNEL_NW_SE          = 3,
; interiorobject_TUNNEL_T_JOIN_NW_SE            = 4,
; interiorobject_PRISONER_SAT_MID_TABLE         = 5,
; interiorobject_TUNNEL_T_JOIN_SW_NE            = 6,
; interiorobject_TUNNEL_CORNER_SW_SE            = 7,
; interiorobject_WIDE_WINDOW_FACING_SE          = 8,
; interiorobject_EMPTY_BED_FACING_SE            = 9,
; interiorobject_SHORT_WARDROBE_FACING_SW       = 10,
; interiorobject_CHEST_OF_DRAWERS_FACING_SW     = 11,
; interiorobject_TUNNEL_CORNER_NW_NE            = 12,
; interiorobject_EMPTY_BENCH                    = 13,
; interiorobject_TUNNEL_CORNER_NE_SE            = 14,
; interiorobject_DOOR_FRAME_SE                  = 15,
; interiorobject_DOOR_FRAME_SW                  = 16,
; interiorobject_TUNNEL_CORNER_NW_SW            = 17,
; interiorobject_TUNNEL_ENTRANCE                = 18,
; interiorobject_PRISONER_SAT_END_TABLE         = 19,
; interiorobject_COLLAPSED_TUNNEL_SW_NE         = 20,
; interiorobject_UNUSED_21                      = 21,   ; object unused by game, draws as interiorobject_ROOM_OUTLINE_22x12_A
; interiorobject_CHAIR_FACING_SE                = 22,
; interiorobject_OCCUPIED_BED                   = 23,
; interiorobject_ORNATE_WARDROBE_FACING_SW      = 24,
; interiorobject_CHAIR_FACING_SW                = 25,
; interiorobject_CUPBOARD_FACING_SE             = 26,
; interiorobject_ROOM_OUTLINE_18x10_A           = 27,
; interiorobject_UNUSED_28                      = 28,   ; object unused by game, draws as interiorobject_TABLE
; interiorobject_TABLE                          = 29,
; interiorobject_STOVE_PIPE                     = 30,
; interiorobject_PAPERS_ON_FLOOR                = 31,
; interiorobject_TALL_WARDROBE_FACING_SW        = 32,
; interiorobject_SMALL_SHELF_FACING_SE          = 33,
; interiorobject_SMALL_CRATE                    = 34,
; interiorobject_SMALL_WINDOW_WITH_BARS_FACING_SE = 35
; interiorobject_TINY_DOOR_FRAME_NE             = 36,   ; tunnel entrance
; interiorobject_NOTICEBOARD_FACING_SE          = 37,
; interiorobject_DOOR_FRAME_NW                  = 38,
; interiorobject_UNUSED_39                      = 39,   ; object unused by game, draws as interiorobject_END_DOOR_FRAME_NW_SE
; interiorobject_DOOR_FRAME_NE                  = 40,
; interiorobject_ROOM_OUTLINE_15x8              = 41,
; interiorobject_CUPBOARD_FACING_SW             = 42,
; interiorobject_MESS_BENCH                     = 43,
; interiorobject_MESS_TABLE                     = 44,
; interiorobject_MESS_BENCH_SHORT               = 45,
; interiorobject_ROOM_OUTLINE_18x10_B           = 46,
; interiorobject_ROOM_OUTLINE_22x12_B           = 47,
; interiorobject_TINY_TABLE                     = 48,
; interiorobject_TINY_DRAWERS_FACING_SE         = 49,
; interiorobject_TALL_DRAWERS_FACING_SW         = 50,
; interiorobject_DESK_FACING_SW                 = 51,
; interiorobject_SINK_FACING_SE                 = 52,
; interiorobject_KEY_RACK_FACING_SE             = 53,
; interiorobject__LIMIT                         = 54
;
; interiorobjecttile_MAX                        = 194,  ; number of tiles at $9768 interior_tiles
; interiorobjecttile_ESCAPE                     = 255,  ; escape character

; location_000E                                 = $000E,
; location_0010                                 = $0010,
; location_002A                                 = $002A,
; location_002B                                 = $002B,
; location_002C                                 = $002C,
; location_002D                                 = $002D,
; location_012C                                 = $012C,
; location_0285                                 = $0285,
; location_0390                                 = $0390,
; location_048E                                 = $048E,
;
; sound_CHARACTER_ENTERS_1                      = $2030,
; sound_CHARACTER_ENTERS_2                      = $2040,
; sound_BELL_RINGER                             = $2530,
; sound_PICK_UP_ITEM                            = $3030,
; sound_DROP_ITEM                               = $3040,
;
; morale_MIN                                    = 0,
; morale_MAX                                    = 112,
;
; //////////////////////////////////////////////////////////////////////////////
; FLAGS
; //////////////////////////////////////////////////////////////////////////////
;
; These are here for information only and are not used by any of the
; directives.
;
; input_NONE                                    = 0,
; input_UP                                      = 1,
; input_DOWN                                    = 2,
; input_LEFT                                    = 3,
; input_RIGHT                                   = 6,
; input_FIRE                                    = 9,
; input_UP_FIRE                                 = input_UP    + input_FIRE,
; input_DOWN_FIRE                               = input_DOWN  + input_FIRE,
; input_LEFT_FIRE                               = input_LEFT  + input_FIRE,
; input_RIGHT_FIRE                              = input_RIGHT + input_FIRE,
;
; ; $8000, $8020, $8040, ...
; vischar_CHARACTER_MASK                        = $1F,          ; character index mask. this is used in a couple of places but it's not consistently applied. i've not spotted anything else sharing the this field.
;
; ; $8001, $8021, $8041, ...
; vischar_FLAGS_EMPTY_SLOT                      = $FF,
; vischar_FLAGS_MASK                            = $3F,
; vischar_FLAGS_PICKING_LOCK                    = 1 << 0,       ; hero only
; vischar_FLAGS_CUTTING_WIRE                    = 1 << 1,       ; hero only
; vischar_FLAGS_BRIBE_PENDING                   = 1 << 0,       ; non-hero only
; vischar_FLAGS_BIT1                            = 1 << 1,       ; non-hero only (dog + food flag)
; vischar_FLAGS_SAW_BRIBE                       = 1 << 2,       ; set when a hostile 'saw' a bribe being used (was nearby) or perhaps distracted
; vischar_FLAGS_DOOR_THING                      = 1 << 6,       ; affects scaling
; vischar_FLAGS_NO_COLLIDE                      = 1 << 7,       ; don't do collision() for this vischar
;
; ; $8002, $8022, $8042, ...
; vischar_BYTE2_BIT7                            = 1 << 7,       ; target mask
;
; ; $8007, $8027, $8047, ...
; vischar_BYTE7_MASK_LO                         = $0F,
; vischar_BYTE7_MASK_HI                         = $F0,
; vischar_BYTE7_IMPEDED                         = 1 << 5,       ; set when hero hits an obstacle
; vischar_BYTE7_TOUCHING                            = 1 << 6,       ; set while touch() entered
; vischar_BYTE7_LOCATABLE                       = 1 << 7,       ; stops locate_vischar_or_itemstruct considering a vischar
;
; ; $800C, $802C, $804C, ...
; vischar_ANIMINDEX_BIT7                        = 1 << 7,       ; is this a kick flag?
;
; ; $800E, $802E, $804E, ...
; vischar_DIRECTION_MASK                        = $03,
; vischar_DIRECTION_CRAWL                       = 1 << 2,
;
; itemstruct_ITEM_MASK                          = $0F,
; itemstruct_ITEM_FLAG_POISONED                 = 1 << 5,
; itemstruct_ITEM_FLAG_HELD                     = 1 << 7,       ; set when the item is picked up (maybe)
; itemstruct_ROOM_MASK                          = $3F,
; itemstruct_ROOM_FLAG_NEARBY_6                 = 1 << 6,       ; unknown
; itemstruct_ROOM_FLAG_NEARBY_7                 = 1 << 7,       ; set when the item is nearby
;
; door_REVERSE                                  = 1 << 7,       ; used to reverse door transitions
; door_LOCKED                                   = 1 << 7,       ; used to lock doors in locked_doors[]
; door_NONE                                     = $FF
;
; characterstruct_FLAG_DISABLED                 = 1 << 6,       ; this disables the character
; characterstruct_BYTE0_MASK                    = $1F,
; characterstruct_BYTE5_MASK                    = $7F,
; characterstruct_BYTE6_MASK_LO                 = $07,
;
; doorpos_FLAGS_MASK_DIRECTION                  = $03,          ; up/down or direction field?
;
; searchlight_STATE_CAUGHT                      = $1F,
; searchlight_STATE_SEARCHING                   = $FF,          ; hunting for hero
;
; bell_RING_PERPETUAL                           = $00,
; bell_RING_40_TIMES                            = $28,
; bell_STOP                                     = $FF,
;
; escapeitem_COMPASS                            = 1,
; escapeitem_PAPERS                             = 2,
; escapeitem_PURSE                              = 4,
; escapeitem_UNIFORM                            = 8,
;
; statictiles_COUNT_MASK                        = $7F,
; statictiles_VERTICAL                          = 1 << 7,       ; otherwise horizontal
;
; map_MAIN_GATE_X                               = $696D,        ; coords: $69..$6D
; map_MAIN_GATE_Y                               = $494B,
; map_ROLL_CALL_X                               = $727C,
; map_ROLL_CALL_Y                               = $6A72,
;
; inputdevice_KEYBOARD                          = 0,
;
; //////////////////////////////////////////////////////////////////////////////
; ROOMS
; //////////////////////////////////////////////////////////////////////////////
;
; Key
;
;   '' => door (up/down)
;   =  => door (left/right)
;   in => entrance
;   [] => exit
;   ~  => void / ground
;
; Map of rooms' indices
;
;   +--------+--------+----+----+----+
;   |   25   =   23   = 19 = 18 = 12 |
;   +--------+-+-''-+-+----+    +-''-+
;    | 24 = 22 = 21 | | 20 +    + 17 |
;    +----+----+-''-+ +-''-+----+-''-+
;                          = 15 |  7 |
;       +----+------+      +-''-+-''-+
;       = 28 =   1  |      | 14 = 16 |
;       +----+--''--+      +----+-''-+
;                               = 13 |
;       +----+------+           +-''-+
;       =  2 =   3  |           | 11 |
;       +----+--''--+           |    |
;                          +----+----+
;       +----+------+      | 10 |  9 |
;       =  4 =   5  |      |    |    |
;       +----+--''--+      +-''-+-''-+
;                          =    8    |
;                          +----+----+
;
; Map of tunnels' indices 1
;
;   ~~~~~~~~~~~~~~~~~~~~+---------+----+
;   ~~~~~~~~~~~~~~~~~~~~|    49   = 50 |
;   ~~~~~~~~~~~~~~~~~~~~+-''-+----+-''-+
;   ~~~~~~~~~~~~~~~~~~~~| 48 |~~~~| 47 |
;   ~~~~~~~~~~~~~~~~~~~~+-[]-+~~~~|    |
;   +------+-------+----+----+----+    |
;   |  45  =   41  =    40   | 46 =    |
;   +-''-+-+--+-''-+------''-+-''-+----+
;   | 44 = 43 = 42 |~~~~| 38 = 39 |~~~~~
;   +----+----+----+~~~~+-''-+----+~~~~~
;   ~~~~~~~~~~~~~~~~~~~~| 37 |~~~~~~~~~~
;   ~~~~~~~~~~~~~~~~~~~~+-in-+~~~~~~~~~~
;
; Map of tunnels' indices 2
;
;   +----------+--------+--------+
;   |    36    =   30   =   52   |
;   +-''-+-----+--''----+---+-''-+
;   | 35 |~~~~~~| 31 |~~~~~~| 51 |
;   |    +------+-''-+~~~~~~|    |
;   |    =  33  = 32 |~~~~~~|    |
;   |    +------+----+~~~~~~|    |
;   |    |~~~~~~~~~~~~~+----+    |
;   +-''-+~~~~~~~~~~~~in 29 =    |
;   | 34 |~~~~~~~~~~~~~+----+----+
;   +-[]-+~~~~~~~~~~~~~~~~~~~~~~~~
;
; I'm fairly sure that the visual of the above layout is actually topologically
; impossible. e.g. if you take screenshots of every room and attempt to combine
; them in an image editor it won't join up.
;
; Unused room indices: 6, 26, 27
;
;
; //////////////////////////////////////////////////////////////////////////////
; GAME STATE
; //////////////////////////////////////////////////////////////////////////////
;
; There are eight visible character (vischar) structures living at $8000
; onwards. The game therefore supports up to eight characters on-screen at
; once. The stove and crate items count as characters too.
;
; These structures occupy the same addresses as some of the static tiles. This
; is fine as the static tiles are never referenced once they're plotted to the
; screen at startup.
;
; The structures are 32 bytes long. Each structure is laid out as follows:
;
; +-----+---------+-------------------------------------------------------------------------------+
; | off | size    | purpose                                                                       |
; +-----+---------+-------------------------------------------------------------------------------+
; | $00 | byte    | character index, or $FF for none                                              |
; | $01 | byte    | flags                                                                         |
; | $02 | byte[2] | target location                                                               |
; | $04 | byte[3] | position                                                                      |
; | $07 | byte    | top nibble = flags, bottom nibble = counter used by character_behaviour only  |
; | $08 | pointer | pointer to animations                                                         |
; | $0A | pointer | pointer to value in animations                                                |
; | $0C | byte    | bit 7 is up/down flag, other bits are a counter                               |
; | $0D | byte    | input .. previous direction?                                                  |
; | $0E | byte    | direction and walk/crawl flag                                                 |
; | $0F | movitem | movable item struct (pos, cur sprite, sprite index)                           |
; | $18 | word[2] | screen x, y coord                                                             |
; | $1C | byte    | current room index                                                            |
; | $1D | byte    | (unused)                                                                      |
; | $1E | byte    | copy of sprite width in bytes + 1                                             |
; | $1F | byte    | copt of sprite height in rows                                                 |
; +-----+---------+-------------------------------------------------------------------------------+
;
; The first entry in the array is the hero.
;
; Further notes:
;
; b $8000 character index? ($FF if no visible character)
; b $8001 flags: bit 6 gets toggled in set_hero_target_location /  bit 0: picking lock /  bit 1: cutting wire  ($FF when reset)
; w $8002 could be a target location (set in set_hero_target_location, process_player_input)
; w $8004 (<- process_player_input) a coordinate? (i see it getting scaled in #R$CA11)
; ? $8006
; b $8007 bits 5/6/7: flags  (suspect bit 4 is a flag too) ($00 when reset)
; w $8008 (read by called_from_main_loop_9)
; w $800A (read/written by called_from_main_loop_9)
; b $800C (read/written by called_from_main_loop_9)
; b $800D tunnel related (<- process_player_input, cutting_wire, process_player_input) assigned from cutting_wire_new_inputs table.  causes movement when set. but not when in solitary.
;            $81 -> move toward top left,
;            $82 -> move toward bottom right,
;            $83 -> move toward bottom left,
;            $84 -> TL (again)
;            $85 ->
; b $800E tunnel related, direction (bottom 2 bits index cutting_wire_new_inputs) bit 2 is walk/crawl flag
; set to - $00 -> character faces top left
;          $01 -> character faces top right
;          $02 -> character faces bottom right
;          $03 -> character faces bottom left
;          $04 -> character faces top left     (crawling)
;          $05 -> character faces top right    (crawling)
;          $06 -> character faces bottom right (crawling)
;          $07 -> character faces bottom left  (crawling)
; w $800F position on X axis (along the line of - bottom right to top left of screen) (set by process_player_input)
; w $8011 position on Y axis (along the line of - bottom left to top right of screen) (set by process_player_input)  i think this might be relative to the current size of the map. each step seems to be two pixels.
; w $8013 character's height // set to 24 in process_player_input, cutting_wire,  set to 12 in action_wiresnips,  reset in calc_vischar_screenpos_from_mi_pos,  read by called_from_main_loop_9 ($B68C) (via IY), locate_vischar_or_itemstruct ($B8DE), setup_vischar_plotting ($E433), in_permitted_area ($9F4F)  written by touch ($AFD5)  often written as a byte, but suspect it's a word-sized value
; w $8015 pointer to current character sprite set (gets pointed to the 'tl_4' sprite)
; b $8017 touch sets this to touch_stashed_A
; w $8018 points to something (gets $06C8 subtracted from it) (<- in_permitted_area)
; w $801A points to something (gets $0448 subtracted from it) (<- in_permitted_area)
; b $801C room index: cleared to zero by action_papers, set to room_24_SOLITARY by solitary, copied to room_index by transition
; ? $801D
; ? $801E
; ? $801F (written by setup_vischar_plotting)
;
; $8020 visible character blocks. 7 sets of 32 bytes, one per visible character. can there be >7 characters on-screen/visible at once? or is it prisoners only?
;
;   $8020 byte -- bit 6 means something here, likely merged with a character index
;   $8021 likely a room index
;   $8022 likely a position
;   $8023 likely a position
;   $8024 likely a position
;   $803C room index within struct at $8020
;
; Other things:
;
; b $8100 mask buffer (0xA0 bytes - 4 * 8 * 5)
; w $81A0 mask buffer pointer
; w $81A2 screen buffer pointer

@org=$4000

; Loading screen.
;
; #UDGTABLE
; { #SCR(loading) | This is the loading screen. }
; TABLE#
@label=screen
b$4000 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 ; {Pixels.
 $4020 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$CC,$67,$18,$D9,$9C,$1B,$31,$B6,$E6,$CE,$D8
 $4040 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0D,$B5,$B6,$36,$DB,$60
 $4060 DEFB $FF,$00,$00,$04,$10,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4080 DEFB $00,$00,$00,$00,$1C,$00,$00,$00,$FF,$D0,$00,$00,$00,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $40A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$04,$20,$00,$FF,$00,$04,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $40C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$08,$00,$00,$00,$0F,$FF,$00,$00,$00,$10,$00,$00,$00
 $40E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$FF,$E2,$78,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$08,$00,$00
 $4100 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4120 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$8F,$63,$18,$71,$8C,$1E,$3C,$E6,$7E,$C6,$70
 $4140 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0C,$B1,$F3,$3E,$DB,$30
 $4160 DEFB $00,$FF,$00,$04,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4180 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$0F,$FF,$00,$00,$00,$10,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $41A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$40,$00,$00,$FF,$07,$54,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $41C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$08,$00,$00,$00,$05,$F0,$FF,$00,$00,$08,$00,$00,$00
 $41E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0F,$FF,$F3,$78,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$04,$08,$00,$00
 $4200 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4220 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4240 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0D,$B1,$81,$B0,$DB,$18
 $4260 DEFB $00,$00,$FF,$0D,$A0,$00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4280 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$09,$F0,$FF,$00,$00,$08,$18,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $42A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$00,$00,$00,$FF,$F8,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $42C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$18,$A0,$00,$FF,$00,$04,$06,$00,$00
 $42E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0F,$FF,$FF,$78,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4300 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$8F,$63,$7E,$71,$8C,$1E,$3C,$E6,$7C,$C6,$70
 $4320 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4340 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0F,$30,$F7,$1E,$DB,$70
 $4360 DEFB $00,$00,$00,$FF,$D0,$00,$00,$00,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4380 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$04,$A0,$00,$FF,$00,$1A,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $43A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$FF,$00,$00,$00,$00,$08,$00,$00,$00,$00,$00,$00,$00
 $43C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$20,$40,$00,$00,$FF,$0F,$58,$00,$00
 $43E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1E,$0F,$FF,$78,$40,$30,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4400 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$CC,$73,$18,$D9,$CC,$1B,$31,$B6,$E6,$E6,$D8
 $4420 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4440 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0C,$00,$00,$00,$00,$00
 $4460 DEFB $00,$00,$00,$0F,$FF,$00,$00,$00,$04,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4480 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$04,$18,$00,$00,$FF,$1F,$40,$00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $44A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$05,$68,$FF,$00,$00,$30,$08,$00,$00,$00,$00,$00,$00,$00
 $44C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$00,$00,$00,$FF,$A0,$00,$00
 $44E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$18,$1F,$FF,$79,$C0,$F0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4500 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$6C,$7B,$19,$8D,$EC,$19,$B1,$86,$C0,$F6,$C0
 $4520 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$03,$00
 $4540 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0C,$00,$00,$00,$00,$00
 $4560 DEFB $00,$00,$00,$16,$F0,$FF,$00,$00,$08,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4580 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$04,$06,$00,$00,$00,$FF,$E0,$00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $45A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$48,$00,$FF,$00,$08,$10,$00,$00,$00,$00,$00,$00,$00
 $45C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$3C,$00,$07,$00,$00,$00,$00,$00,$00,$00,$20,$00,$00,$00,$05,$FF,$00,$00
 $45E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$10,$1F,$7E,$7F,$E3,$F8,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4600 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$6F,$6B,$19,$8D,$AC,$19,$BC,$E6,$CE,$D6,$70
 $4620 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$80
 $4640 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4660 DEFB $00,$00,$00,$20,$50,$00,$FF,$00,$04,$08,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4680 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$04,$00,$00,$00,$00,$17,$FF,$00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $46A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$04,$10,$00,$00,$FE,$0D,$10,$00,$00,$00,$00,$00,$00,$00
 $46C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$00,$1C,$00,$00,$00,$00,$00,$00,$00,$10,$00,$00,$00,$02,$B0,$FF,$00
 $46E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$10,$3F,$98,$7D,$E7,$B8,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4700 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$6C,$6F,$19,$8D,$BC,$19,$B0,$36,$C6,$DE,$18
 $4720 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0B,$2C,$E3,$9C,$F3,$38
 $4740 DEFB $00,$00,$00,$18,$0C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4760 DEFB $00,$00,$00,$40,$20,$00,$00,$FF,$0D,$50,$00,$00,$00,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4780 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$09,$60,$FF,$00,$00,$02,$03,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $47A0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$08,$10,$00,$00,$00,$FF,$A0,$00,$00,$00,$20,$00,$00,$00
 $47C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$03,$FF,$C4,$B8,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$10,$00,$FF
 $47E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$08,$3F,$C0,$79,$F7,$9C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4800 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$3F,$C0,$78,$F7,$9C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4820 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$10,$7F,$F8,$F8,$E1,$F8,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4840 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$08,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4860 DEFB $40,$00,$00,$00,$00,$00,$0F,$3C,$7F,$08,$20,$18,$01,$00,$60,$03,$C3,$38,$0C,$10,$0C,$01,$03,$02,$00,$C0,$00,$00,$00,$00,$00,$08
 $4880 DEFB $00,$18,$40,$00,$00,$00,$1E,$0F,$CF,$9E,$03,$C8,$78,$F1,$E0,$07,$C8,$F8,$7C,$FD,$E0,$78,$F1,$E3,$DE,$40,$00,$00,$00,$07,$00,$04
 $48A0 DEFB $00,$00,$22,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$E0,$00,$00,$CF,$00,$00,$00,$00,$00
 $48C0 DEFB $00,$00,$00,$00,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$07,$00,$00,$00,$00,$00,$00,$00,$00
 $48E0 DEFB $00,$00,$00,$00,$00,$B8,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$30,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4900 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$3F,$C0,$78,$F7,$8E,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4920 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1F,$E0,$7C,$E0,$F0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4940 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4960 DEFB $20,$00,$00,$00,$00,$00,$1F,$3C,$7F,$1C,$60,$78,$03,$80,$60,$07,$C3,$86,$1E,$30,$3E,$03,$83,$C7,$03,$C0,$00,$00,$00,$00,$00,$12
 $4980 DEFB $00,$04,$40,$00,$00,$00,$1F,$07,$CF,$9E,$03,$D0,$78,$F1,$E0,$07,$C4,$F8,$30,$7D,$E0,$78,$F1,$E3,$DE,$80,$00,$00,$00,$38,$00,$00
 $49A0 DEFB $00,$00,$21,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$E0,$00,$00,$3D,$00,$00,$00,$00,$00
 $49C0 DEFB $00,$00,$00,$00,$20,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$38,$00,$00,$00,$00,$00,$00,$00,$00
 $49E0 DEFB $00,$00,$00,$00,$00,$14,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$38,$18,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4A00 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1F,$C0,$78,$F7,$8C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4A20 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$80,$30,$C0,$60,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4A40 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4A60 DEFB $18,$00,$00,$00,$00,$00,$1E,$7C,$3E,$3E,$F1,$FC,$0F,$E0,$E0,$07,$C7,$8B,$3F,$F0,$FE,$0F,$E3,$EF,$8F,$E0,$00,$00,$00,$00,$00,$1B
 $4A80 DEFB $00,$02,$80,$00,$00,$00,$0F,$47,$8F,$1E,$01,$E0,$78,$F1,$E0,$03,$E3,$F0,$00,$3D,$E0,$78,$F1,$E3,$CF,$00,$00,$00,$01,$C0,$00,$00
 $4AA0 DEFB $00,$00,$40,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$C0,$00,$01,$F4,$80,$00,$00,$00,$00
 $4AC0 DEFB $00,$00,$00,$00,$19,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$81,$C0,$00,$00,$00,$00,$00,$00,$00,$00
 $4AE0 DEFB $00,$00,$00,$00,$00,$22,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$C0,$08,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4B00 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$80,$78,$F7,$90,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4B20 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$C0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4B40 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4B60 DEFB $04,$00,$00,$00,$00,$00,$3E,$7E,$1C,$7F,$F3,$DC,$3B,$F8,$E0,$0F,$87,$EB,$6F,$E1,$EF,$3B,$F9,$F7,$DE,$E0,$00,$00,$00,$00,$00,$0F
 $4B80 DEFB $00,$01,$E0,$00,$00,$00,$0F,$47,$9F,$1E,$01,$E0,$78,$F1,$E0,$03,$E1,$E0,$07,$39,$E0,$78,$F3,$F3,$CF,$00,$00,$80,$0E,$00,$00,$00
 $4BA0 DEFB $00,$00,$40,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$C0,$00,$0E,$10,$00,$00,$00,$00,$00
 $4BC0 DEFB $00,$00,$00,$00,$05,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$02,$8E,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4BE0 DEFB $00,$00,$00,$00,$00,$21,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0E,$00,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4C00 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$03,$FF,$00,$78,$F7,$A0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4C20 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4C40 DEFB $00,$00,$00,$00,$00,$00,$00,$FC,$82,$00,$00,$00,$00,$00,$00,$00,$3E,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4C60 DEFB $02,$00,$00,$00,$00,$00,$3E,$7F,$7E,$1E,$FB,$CE,$79,$F1,$FC,$0F,$87,$F6,$EF,$C1,$EF,$78,$F1,$E3,$DE,$70,$00,$00,$00,$00,$00,$7D
 $4C80 DEFB $00,$06,$F0,$00,$00,$00,$07,$3E,$1E,$1E,$10,$F2,$78,$F1,$E4,$01,$F0,$02,$3F,$F1,$F3,$78,$F7,$FB,$87,$90,$01,$00,$70,$00,$00,$00
 $4CA0 DEFB $00,$00,$00,$18,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$00,$70,$20,$00,$00,$00,$00,$00
 $4CC0 DEFB $00,$00,$00,$00,$02,$82,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$8B,$70,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4CE0 DEFB $00,$00,$00,$00,$00,$40,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$70,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4D00 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$07,$FE,$01,$78,$F3,$C0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4D20 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4D40 DEFB $00,$00,$00,$00,$00,$00,$03,$C3,$04,$00,$00,$00,$00,$00,$20,$00,$F1,$70,$01,$C0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4D60 DEFB $01,$80,$00,$00,$00,$00,$3E,$3F,$BF,$1E,$F3,$CE,$78,$F7,$FC,$0F,$83,$F8,$E3,$31,$E6,$78,$F1,$E3,$DE,$70,$00,$00,$00,$00,$03,$84
 $4D80 DEFB $00,$08,$6C,$C0,$00,$00,$03,$80,$3C,$3F,$E0,$FC,$3D,$FB,$F8,$00,$FC,$1C,$FF,$C1,$FE,$3D,$F9,$FF,$87,$E0,$01,$03,$80,$00,$00,$00
 $4DA0 DEFB $00,$00,$00,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$03,$80,$00,$00,$00,$00,$00,$00
 $4DC0 DEFB $00,$00,$00,$00,$01,$D2,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$6F,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4DE0 DEFB $00,$00,$00,$00,$00,$00,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$03,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4E00 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0F,$FF,$8E,$78,$F3,$C0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4E20 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$03,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4E40 DEFB $00,$00,$00,$00,$00,$00,$07,$8E,$9C,$00,$00,$00,$00,$00,$20,$01,$E0,$FB,$02,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4E60 DEFB $00,$40,$00,$00,$00,$00,$3E,$3F,$9F,$1E,$63,$C7,$78,$F1,$E0,$0F,$83,$F8,$F0,$F9,$E0,$78,$F1,$E3,$DE,$38,$00,$00,$00,$00,$1C,$02
 $4E80 DEFB $00,$00,$BB,$00,$00,$00,$01,$C0,$78,$0F,$80,$78,$3E,$F1,$F0,$00,$7F,$F0,$1F,$80,$F8,$3E,$F1,$FE,$03,$C0,$02,$1C,$00,$00,$00,$00
 $4EA0 DEFB $00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1C,$00,$00,$00,$00,$00,$00,$00
 $4EC0 DEFB $00,$00,$00,$00,$0E,$E4,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$3D,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4EE0 DEFB $00,$00,$00,$00,$00,$00,$18,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4F00 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$09,$FF,$FC,$78,$E1,$E4,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4F20 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4F40 DEFB $80,$00,$00,$00,$00,$00,$0F,$1C,$3E,$00,$00,$00,$00,$00,$20,$03,$E1,$7C,$00,$10,$00,$00,$01,$80,$00,$00,$00,$00,$00,$00,$00,$04
 $4F60 DEFB $00,$20,$80,$00,$00,$00,$3E,$1F,$DF,$9E,$43,$C6,$78,$F1,$E0,$0F,$89,$FC,$7F,$F9,$E0,$78,$F1,$E3,$DE,$30,$00,$00,$00,$00,$E0,$02
 $4F80 DEFB $00,$00,$14,$00,$00,$00,$00,$79,$E0,$02,$00,$30,$18,$40,$40,$00,$1F,$80,$06,$00,$60,$18,$41,$E8,$01,$81,$0B,$E0,$00,$00,$00,$00
 $4FA0 DEFB $00,$00,$00,$01,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$E0,$00,$00,$00,$00,$00,$00,$00
 $4FC0 DEFB $00,$00,$00,$00,$00,$74,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$F4,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $4FE0 DEFB $00,$00,$00,$00,$00,$00,$04,$00,$00,$00,$00,$00,$00,$00,$00,$02,$08,$00,$E0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5000 DEFB $00,$00,$00,$00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$00,$00,$01,$04,$07,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5020 DEFB $00,$00,$00,$00,$00,$00,$00,$1A,$F6,$00,$00,$00,$00,$00,$07,$00,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5040 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$18,$04,$B7,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5060 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$07,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5080 DEFB $00,$00,$00,$00,$00,$0F,$60,$00,$00,$00,$00,$41,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $50A0 DEFB $00,$80,$07,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$08,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $50C0 DEFB $08,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$2F,$08,$00,$00,$3C,$00,$00,$00,$00,$20,$F1,$EF,$1E,$F1,$EF,$1F,$9E,$10
 $50E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$00,$00,$00,$00,$00,$00,$20,$7F,$C7,$FC,$7F,$C7,$FF,$0E,$10
 $5100 DEFB $00,$00,$00,$00,$00,$00,$01,$80,$00,$00,$00,$00,$00,$00,$00,$01,$08,$38,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5120 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$78,$00,$00,$00,$00,$00,$38,$00,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5140 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$04,$02,$F8,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5160 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$38,$00,$01,$88,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5180 DEFB $00,$00,$00,$00,$00,$3D,$20,$00,$00,$00,$00,$02,$30,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $51A0 DEFB $00,$80,$38,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $51C0 DEFB $10,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$46,$B0,$00,$00,$42,$18,$3C,$3C,$3C,$21,$E0,$FE,$0F,$E0,$FE,$0F,$0E,$10
 $51E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$20,$00,$00,$00,$00,$00,$00,$20,$1F,$01,$F0,$1F,$01,$F7,$0E,$10
 $5200 DEFB $00,$00,$00,$00,$00,$00,$00,$40,$80,$00,$00,$00,$00,$00,$00,$01,$2D,$C0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5220 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$38,$00,$00,$00,$00,$01,$C0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5240 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$03,$D0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5260 DEFB $00,$00,$00,$00,$00,$00,$10,$01,$C0,$00,$00,$44,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5280 DEFB $00,$00,$00,$00,$01,$C4,$10,$00,$00,$00,$00,$02,$08,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $52A0 DEFB $01,$01,$C0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1F,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$E0
 $52C0 DEFB $10,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$43,$C0,$00,$00,$99,$28,$42,$42,$40,$21,$C0,$7C,$01,$FF,$FC,$07,$0E,$10
 $52E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$18,$00,$00,$00,$00,$00,$00,$20,$00,$00,$00,$00,$00,$00,$00,$10
 $5300 DEFB $00,$00,$00,$00,$00,$00,$00,$20,$80,$00,$00,$00,$00,$00,$00,$00,$BE,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5320 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$44,$00,$00,$00,$00,$0E,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5340 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$0F,$48,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5360 DEFB $00,$00,$00,$00,$00,$00,$20,$0E,$00,$00,$00,$2C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5380 DEFB $00,$00,$00,$00,$0E,$08,$00,$00,$00,$00,$00,$04,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $53A0 DEFB $41,$0E,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$84,$00,$00,$00,$00,$00,$00,$00,$00,$30,$00,$00,$00,$00,$00,$00,$00,$30
 $53C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$A0,$00,$00,$A1,$08,$42,$3C,$7C,$21,$C0,$7C,$01,$FF,$FC,$07,$0E,$10
 $53E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$04,$00,$00,$00,$00,$00,$00,$30,$00,$00,$00,$00,$00,$00,$00,$30
 $5400 DEFB $00,$00,$00,$00,$00,$00,$00,$18,$80,$00,$00,$00,$00,$00,$00,$00,$F4,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5420 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$42,$00,$00,$04,$00,$70,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5440 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$72,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5460 DEFB $00,$00,$00,$00,$00,$00,$40,$70,$00,$00,$00,$1E,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5480 DEFB $00,$00,$00,$00,$70,$10,$00,$00,$00,$00,$00,$00,$03,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $54A0 DEFB $25,$F0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$44,$00,$00,$00,$00,$00,$00,$00,$00,$20,$00,$00,$00,$00,$00,$00,$00,$10
 $54C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$18,$00,$00,$A1,$08,$3E,$42,$42,$21,$C0,$7C,$01,$FF,$FC,$07,$0E,$10
 $54E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$00,$00,$00,$00,$00,$00,$1F,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$E0
 $5500 DEFB $00,$00,$00,$00,$00,$00,$00,$05,$80,$00,$00,$00,$00,$00,$00,$03,$D3,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5520 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$81,$80,$00,$04,$03,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5540 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$03,$84,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5560 DEFB $00,$00,$00,$00,$00,$00,$83,$80,$00,$00,$00,$2D,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5580 DEFB $00,$00,$00,$03,$80,$20,$00,$00,$00,$00,$00,$00,$00,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $55A0 DEFB $17,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$28,$00,$00,$00,$00,$00,$00,$00,$00,$20,$1F,$01,$F0,$1F,$01,$F7,$70,$10
 $55C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$04,$00,$00,$99,$08,$02,$42,$42,$21,$E0,$FE,$0F,$E0,$1E,$0F,$0E,$10
 $55E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5600 DEFB $00,$00,$00,$00,$00,$00,$00,$03,$51,$00,$00,$00,$00,$00,$00,$1C,$40,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5620 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$80,$40,$00,$08,$1C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5640 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$1C,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5660 DEFB $00,$00,$00,$00,$00,$32,$DC,$00,$00,$00,$00,$47,$CC,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5680 DEFB $00,$00,$00,$1C,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $56A0 DEFB $1E,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1C,$00,$00,$00,$00,$00,$00,$00,$00,$20,$7F,$C7,$FC,$7F,$C7,$FF,$FC,$10
 $56C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$06,$02,$00,$00,$42,$3E,$3C,$3C,$3C,$20,$F1,$EF,$1E,$F1,$EF,$1F,$0E,$10
 $56E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5700 DEFB $00,$00,$00,$00,$00,$00,$00,$25,$E1,$00,$00,$00,$00,$00,$00,$E0,$80,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5720 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$20,$08,$28,$E0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5740 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$E0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5760 DEFB $00,$00,$00,$00,$00,$0B,$E0,$00,$00,$00,$00,$4B,$B0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $5780 DEFB $00,$00,$00,$E0,$00,$00,$00,$00,$00,$00,$00,$00,$00,$30,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
 $57A0 DEFB $FA,$40,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$1E,$00,$00,$00,$00,$00,$00,$00,$00,$20,$FF,$EF,$FE,$FF,$EF,$FF,$FC,$10
 $57C0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$80,$00,$3C,$00,$00,$00,$00,$20,$FF,$EF,$FE,$FF,$EF,$FF,$0E,$10
 $57E0 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00 ; }
 $5800 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07 ; {Attributes.
 $5820 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07
 $5840 DEFB $06,$06,$06,$04,$04,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07
 $5860 DEFB $04,$04,$04,$04,$04,$04,$04,$04,$04,$04,$06,$06,$06,$04,$06,$06,$06,$06,$06,$06,$06,$06,$07,$07,$07,$07,$07,$07,$07,$07,$07,$07
 $5880 DEFB $06,$06,$06,$06,$04,$06,$06,$06,$04,$04,$04,$04,$04,$04,$04,$04,$06,$06,$04,$04,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $58A0 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$04,$04,$06,$04,$04,$04,$04,$04,$04,$04,$04,$04,$04,$06,$06,$04,$06,$06,$06
 $58C0 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$04,$06,$06,$06,$04,$04,$04,$04,$04,$04,$04,$04,$04
 $58E0 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$04,$04,$06,$06
 $5900 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$42,$42,$42,$42,$42,$42,$42,$42,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5920 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$42,$42,$42,$42,$42,$42,$42,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5940 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$05
 $5960 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$05,$05,$05
 $5980 DEFB $06,$06,$06,$06,$06,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$42,$05,$05,$05,$05,$06,$05
 $59A0 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$02,$42,$05,$05,$05,$05,$06,$06,$06,$06
 $59C0 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$05,$05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06
 $59E0 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$05,$05,$06,$05,$05,$05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5A00 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5A20 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$05,$05,$05,$05,$05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5A40 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5A60 DEFB $06,$06,$06,$06,$06,$05,$05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5A80 DEFB $06,$06,$06,$05,$05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06
 $5AA0 DEFB $05,$05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01
 $5AC0 DEFB $05,$05,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$41,$41,$41,$41,$41,$01,$01,$01,$01,$01,$01,$01,$01,$01
 $5AE0 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01 ; }

; Super tiles.
;
; The game's exterior map (at $BCEE) is constructed of references to these
; "super tiles" which are in turn a 4x4 array of tile indices.
@label=super_tiles
b$5B00 DEFB $94,$93,$92,$94 ; {super_tile $00 #HTML[#CALL:supertile($5B00, 0)]
 $5B04 DEFB $92,$92,$94,$93
 $5B08 DEFB $91,$94,$07,$08
 $5B0C DEFB $03,$04,$05,$06 ; }
 $5B10 DEFB $91,$92,$07,$08 ; {super_tile $01 #HTML[#CALL:supertile($5B10, 0)]
 $5B14 DEFB $07,$08,$09,$0A
 $5B18 DEFB $09,$0A,$0B,$17
 $5B1C DEFB $0C,$17,$18,$1F ; }
 $5B20 DEFB $94,$93,$92,$94 ; {super_tile $02 #HTML[#CALL:supertile($5B20, 0)]
 $5B24 DEFB $92,$91,$94,$93
 $5B28 DEFB $91,$94,$07,$08
 $5B2C DEFB $07,$08,$09,$0A ; }
 $5B30 DEFB $91,$92,$07,$08 ; {super_tile $03 #HTML[#CALL:supertile($5B30, 0)]
 $5B34 DEFB $07,$08,$09,$0A
 $5B38 DEFB $09,$0A,$0B,$17
 $5B3C DEFB $0B,$17,$18,$1F ; }
 $5B40 DEFB $09,$0A,$0B,$17 ; {super_tile $04 #HTML[#CALL:supertile($5B40, 0)]
 $5B44 DEFB $0B,$17,$18,$1F
 $5B48 DEFB $18,$1F,$19,$1A
 $5B4C DEFB $19,$1A,$1E,$17 ; }
 $5B50 DEFB $18,$1F,$19,$1A ; {super_tile $05 #HTML[#CALL:supertile($5B50, 0)]
 $5B54 DEFB $19,$1A,$1E,$17
 $5B58 DEFB $1E,$17,$1D,$1C
 $5B5C DEFB $1D,$1C,$19,$1B ; }
 $5B60 DEFB $93,$92,$91,$92 ; {super_tile $06 #HTML[#CALL:supertile($5B60, 0)]
 $5B64 DEFB $91,$93,$91,$94
 $5B68 DEFB $91,$91,$93,$94
 $5B6C DEFB $26,$27,$28,$29 ; }
 $5B70 DEFB $94,$93,$92,$94 ; {super_tile $07 #HTML[#CALL:supertile($5B70, 0)]
 $5B74 DEFB $92,$91,$94,$93
 $5B78 DEFB $91,$94,$93,$94
 $5B7C DEFB $2A,$92,$94,$91 ; }
 $5B80 DEFB $6D,$2B,$91,$93 ; {super_tile $08 #HTML[#CALL:supertile($5B80, 0)]
 $5B84 DEFB $19,$2C,$2D,$93
 $5B88 DEFB $1E,$17,$18,$2E
 $5B8C DEFB $1D,$1C,$19,$2F ; }
 $5B90 DEFB $1E,$17,$1D,$1C ; {super_tile $09 #HTML[#CALL:supertile($5B90, 0)]
 $5B94 DEFB $1D,$1C,$19,$1B
 $5B98 DEFB $19,$1B,$35,$36
 $5B9C DEFB $35,$36,$34,$00 ; }
 $5BA0 DEFB $1E,$17,$1D,$1C ; {super_tile $0A #HTML[#CALL:supertile($5BA0, 0)]
 $5BA4 DEFB $1D,$1C,$19,$1B
 $5BA8 DEFB $19,$1B,$35,$37
 $5BAC DEFB $35,$36,$34,$38 ; }
 $5BB0 DEFB $1E,$17,$1D,$1C ; {super_tile $0B #HTML[#CALL:supertile($5BB0, 0)]
 $5BB4 DEFB $1D,$1C,$19,$1B
 $5BB8 DEFB $19,$1B,$35,$37
 $5BBC DEFB $32,$33,$34,$38 ; }
 $5BC0 DEFB $0D,$0E,$19,$1A ; {super_tile $0C #HTML[#CALL:supertile($5BC0, 0)]
 $5BC4 DEFB $00,$0F,$10,$17
 $5BC8 DEFB $00,$00,$11,$12
 $5BCC DEFB $8B,$00,$13,$14 ; }
 $5BD0 DEFB $02,$00,$00,$00 ; {super_tile $0D #HTML[#CALL:supertile($5BD0, 0)]
 $5BD4 DEFB $85,$00,$86,$87
 $5BD8 DEFB $01,$00,$88,$89
 $5BDC DEFB $01,$00,$00,$8A ; }
 $5BE0 DEFB $01,$00,$00,$81 ; {super_tile $0E #HTML[#CALL:supertile($5BE0, 0)]
 $5BE4 DEFB $85,$00,$00,$4E
 $5BE8 DEFB $6C,$00,$00,$50
 $5BEC DEFB $6B,$69,$66,$4E ; }
 $5BF0 DEFB $82,$00,$00,$15 ; {super_tile $0F #HTML[#CALL:supertile($5BF0, 0)]
 $5BF4 DEFB $83,$84,$00,$55
 $5BF8 DEFB $00,$68,$00,$55
 $5BFC DEFB $00,$4E,$00,$62 ; }
 $5C00 DEFB $93,$94,$65,$6A ; {super_tile $10 #HTML[#CALL:supertile($5C00, 0)]
 $5C04 DEFB $94,$91,$8C,$8D
 $5C08 DEFB $91,$92,$94,$94
 $5C0C DEFB $92,$94,$93,$91 ; }
 $5C10 DEFB $00,$4E,$00,$61 ; {super_tile $11 #HTML[#CALL:supertile($5C10, 0)]
 $5C14 DEFB $8E,$67,$66,$60
 $5C18 DEFB $8F,$90,$65,$5F
 $5C1C DEFB $93,$92,$91,$5E ; }
 $5C20 DEFB $16,$73,$78,$38 ; {super_tile $12 #HTML[#CALL:supertile($5C20, 0)]
 $5C24 DEFB $01,$73,$00,$38
 $5C28 DEFB $77,$73,$00,$63
 $5C2C DEFB $76,$58,$00,$64 ; }
 $5C30 DEFB $75,$59,$00,$49 ; {super_tile $13 #HTML[#CALL:supertile($5C30, 0)]
 $5C34 DEFB $74,$5A,$4A,$4B
 $5C38 DEFB $5C,$5B,$91,$93
 $5C3C DEFB $5D,$93,$92,$94 ; }
 $5C40 DEFB $09,$21,$22,$24 ; {super_tile $14 #HTML[#CALL:supertile($5C40, 0)]
 $5C44 DEFB $0B,$20,$23,$25
 $5C48 DEFB $18,$1F,$19,$1A
 $5C4C DEFB $19,$1A,$1E,$17 ; }
 $5C50 DEFB $00,$00,$00,$49 ; {super_tile $15 #HTML[#CALL:supertile($5C50, 0)]
 $5C54 DEFB $00,$4C,$4A,$4B
 $5C58 DEFB $4A,$4B,$91,$93
 $5C5C DEFB $94,$93,$92,$94 ; }
 $5C60 DEFB $39,$3A,$3F,$3E ; {super_tile $16 #HTML[#CALL:supertile($5C60, 0)]
 $5C64 DEFB $40,$41,$42,$43
 $5C68 DEFB $44,$45,$46,$47
 $5C6C DEFB $48,$47,$4A,$4B ; }
 $5C70 DEFB $19,$1B,$35,$36 ; {super_tile $17 #HTML[#CALL:supertile($5C70, 0)]
 $5C74 DEFB $35,$36,$34,$00
 $5C78 DEFB $34,$7D,$00,$00
 $5C7C DEFB $00,$3B,$3C,$3D ; }
 $5C80 DEFB $4A,$4B,$93,$91 ; {super_tile $18 #HTML[#CALL:supertile($5C80, 0)]
 $5C84 DEFB $93,$94,$91,$92
 $5C88 DEFB $94,$92,$93,$94
 $5C8C DEFB $93,$91,$92,$91 ; }
 $5C90 DEFB $4A,$5B,$93,$94 ; {super_tile $19 #HTML[#CALL:supertile($5C90, 0)]
 $5C94 DEFB $93,$94,$91,$92
 $5C98 DEFB $94,$92,$93,$94
 $5C9C DEFB $93,$91,$92,$91 ; }
 $5CA0 DEFB $91,$93,$94,$92 ; {super_tile $1A #HTML[#CALL:supertile($5CA0, 0)]
 $5CA4 DEFB $92,$94,$91,$94
 $5CA8 DEFB $94,$93,$91,$92
 $5CAC DEFB $30,$92,$94,$93 ; }
 $5CB0 DEFB $31,$93,$92,$91 ; {super_tile $1B #HTML[#CALL:supertile($5CB0, 0)]
 $5CB4 DEFB $91,$92,$91,$94
 $5CB8 DEFB $93,$94,$93,$91
 $5CBC DEFB $94,$93,$94,$92 ; }
 $5CC0 DEFB $19,$1B,$35,$6E ; {super_tile $1C #HTML[#CALL:supertile($5CC0, 0)]
 $5CC4 DEFB $35,$33,$34,$55
 $5CC8 DEFB $34,$73,$00,$56
 $5CCC DEFB $00,$73,$00,$55 ; }
 $5CD0 DEFB $79,$73,$00,$55 ; {super_tile $1D #HTML[#CALL:supertile($5CD0, 0)]
 $5CD4 DEFB $00,$58,$00,$7E
 $5CD8 DEFB $7A,$59,$79,$56
 $5CDC DEFB $78,$5A,$4A,$57 ; }
 $5CE0 DEFB $34,$00,$00,$7C ; {super_tile $1E #HTML[#CALL:supertile($5CE0, 0)]
 $5CE4 DEFB $00,$3B,$72,$00
 $5CE8 DEFB $39,$4F,$4E,$00
 $5CEC DEFB $4E,$00,$80,$7B ; }
 $5CF0 DEFB $50,$00,$7F,$4C ; {super_tile $1F #HTML[#CALL:supertile($5CF0, 0)]
 $5CF4 DEFB $51,$00,$4D,$4B
 $5CF8 DEFB $52,$53,$54,$91
 $5CFC DEFB $6F,$70,$71,$94 ; }
 $5D00 DEFB $34,$00,$00,$38 ; {super_tile $20 #HTML[#CALL:supertile($5D00, 0)]
 $5D04 DEFB $7B,$78,$00,$38
 $5D08 DEFB $7C,$79,$00,$38
 $5D0C DEFB $7A,$00,$00,$38 ; }
 $5D10 DEFB $19,$1B,$35,$36 ; {super_tile $21 #HTML[#CALL:supertile($5D10, 0)]
 $5D14 DEFB $35,$36,$34,$7B
 $5D18 DEFB $34,$00,$00,$7C
 $5D1C DEFB $00,$3B,$3C,$3D ; }
 $5D20 DEFB $34,$00,$00,$38 ; {super_tile $22 #HTML[#CALL:supertile($5D20, 0)]
 $5D24 DEFB $77,$00,$00,$38
 $5D28 DEFB $79,$00,$00,$63
 $5D2C DEFB $7A,$00,$00,$64 ; }
 $5D30 DEFB $94,$93,$92,$94 ; {super_tile $23 #HTML[#CALL:supertile($5D30, 0)]
 $5D34 DEFB $92,$91,$94,$93
 $5D38 DEFB $91,$94,$93,$94
 $5D3C DEFB $93,$92,$94,$91 ; }
 $5D40 DEFB $93,$92,$91,$92 ; {super_tile $24 #HTML[#CALL:supertile($5D40, 0)]
 $5D44 DEFB $91,$93,$91,$93
 $5D48 DEFB $91,$91,$93,$94
 $5D4C DEFB $94,$92,$94,$93 ; }
 $5D50 DEFB $93,$94,$93,$91 ; {super_tile $25 #HTML[#CALL:supertile($5D50, 0)]
 $5D54 DEFB $94,$91,$94,$93
 $5D58 DEFB $91,$92,$94,$94
 $5D5C DEFB $92,$94,$93,$91 ; }
 $5D60 DEFB $AF,$B9,$C4,$B0 ; {super_tile $26 #HTML[#CALL:supertile($5D60, 0)]
 $5D64 DEFB $C5,$B9,$BA,$B0
 $5D68 DEFB $96,$BB,$B6,$C6
 $5D6C DEFB $94,$93,$BC,$98 ; }
 $5D70 DEFB $00,$F0,$F1,$00 ; {super_tile $27 #HTML[#CALL:supertile($5D70, 0)]
 $5D74 DEFB $B3,$F2,$F3,$00
 $5D78 DEFB $AF,$B5,$95,$B4
 $5D7C DEFB $AF,$B7,$B8,$B0 ; }
 $5D80 DEFB $00,$00,$00,$00 ; {super_tile $28 #HTML[#CALL:supertile($5D80, 0)]
 $5D84 DEFB $B3,$F4,$00,$00
 $5D88 DEFB $AF,$B5,$95,$B4
 $5D8C DEFB $AF,$B7,$B8,$B0 ; }
 $5D90 DEFB $AE,$C0,$C1,$9C ; {super_tile $29 #HTML[#CALL:supertile($5D90, 0)]
 $5D94 DEFB $F8,$C2,$91,$92
 $5D98 DEFB $94,$92,$93,$94
 $5D9C DEFB $93,$91,$92,$91 ; }
 $5DA0 DEFB $B2,$9B,$BE,$B0 ; {super_tile $2A #HTML[#CALL:supertile($5DA0, 0)]
 $5DA4 DEFB $AF,$BD,$BF,$B0
 $5DA8 DEFB $AF,$B9,$BA,$F9
 $5DAC DEFB $AF,$B9,$BA,$C3 ; }
 $5DB0 DEFB $E3,$E2,$E5,$00 ; {super_tile $2B #HTML[#CALL:supertile($5DB0, 0)]
 $5DB4 DEFB $E5,$00,$00,$00
 $5DB8 DEFB $00,$00,$00,$00
 $5DBC DEFB $00,$00,$F5,$B1 ; }
 $5DC0 DEFB $F6,$C7,$99,$9C ; {super_tile $2C #HTML[#CALL:supertile($5DC0, 0)]
 $5DC4 DEFB $99,$C8,$91,$93
 $5DC8 DEFB $91,$91,$93,$94
 $5DCC DEFB $94,$92,$94,$93 ; }
 $5DD0 DEFB $1E,$45,$45,$44 ; {super_tile $2D #HTML[#CALL:supertile($5DD0, 0)]
 $5DD4 DEFB $1E,$45,$48,$49
 $5DD8 DEFB $1E,$4A,$4B,$4C
 $5DDC DEFB $4D,$7B,$65,$0A ; }
 $5DE0 DEFB $52,$51,$54,$6D ; {super_tile $2E #HTML[#CALL:supertile($5DE0, 0)]
 $5DE4 DEFB $54,$6D,$6D,$6D
 $5DE8 DEFB $18,$64,$3A,$43
 $5DEC DEFB $47,$46,$45,$44 ; }
 $5DF0 DEFB $6D,$6D,$6D,$6D ; {super_tile $2F #HTML[#CALL:supertile($5DF0, 0)]
 $5DF4 DEFB $6D,$6D,$65,$0A
 $5DF8 DEFB $65,$36,$08,$0B
 $5DFC DEFB $08,$37,$00,$01 ; }
 $5E00 DEFB $13,$6D,$6D,$53 ; {super_tile $30 #HTML[#CALL:supertile($5E00, 0)]
 $5E04 DEFB $0D,$53,$52,$51
 $5E08 DEFB $6A,$51,$54,$6D
 $5E0C DEFB $6C,$6D,$4E,$4F ; }
 $5E10 DEFB $0F,$6D,$6D,$50 ; {super_tile $31 #HTML[#CALL:supertile($5E10, 0)]
 $5E14 DEFB $0D,$6D,$6D,$6D
 $5E18 DEFB $14,$19,$6D,$6D
 $5E1C DEFB $15,$16,$6D,$6D ; }
 $5E20 DEFB $0F,$6D,$6D,$6D ; {super_tile $32 #HTML[#CALL:supertile($5E20, 0)]
 $5E24 DEFB $0D,$6D,$65,$0A
 $5E28 DEFB $09,$0A,$08,$0B
 $5E2C DEFB $08,$0B,$02,$00 ; }
 $5E30 DEFB $1E,$45,$48,$49 ; {super_tile $33 #HTML[#CALL:supertile($5E30, 0)]
 $5E34 DEFB $1E,$4A,$4B,$4C
 $5E38 DEFB $4D,$7B,$6D,$53
 $5E3C DEFB $6D,$53,$52,$51 ; }
 $5E40 DEFB $6D,$6D,$6D,$53 ; {super_tile $34 #HTML[#CALL:supertile($5E40, 0)]
 $5E44 DEFB $6D,$53,$52,$51
 $5E48 DEFB $52,$51,$54,$6D
 $5E4C DEFB $54,$4E,$4F,$6D ; }
 $5E50 DEFB $6D,$6D,$50,$6D ; {super_tile $35 #HTML[#CALL:supertile($5E50, 0)]
 $5E54 DEFB $7C,$19,$6D,$6D
 $5E58 DEFB $17,$16,$1A,$6D
 $5E5C DEFB $18,$1C,$1B,$6D ; }
 $5E60 DEFB $7C,$19,$6D,$6D ; {super_tile $36 #HTML[#CALL:supertile($5E60, 0)]
 $5E64 DEFB $17,$16,$65,$0A
 $5E68 DEFB $7D,$36,$08,$0B
 $5E6C DEFB $08,$37,$00,$01 ; }
 $5E70 DEFB $6D,$7C,$50,$6D ; {super_tile $37 #HTML[#CALL:supertile($5E70, 0)]
 $5E74 DEFB $6D,$7E,$7F,$6D
 $5E78 DEFB $6D,$6D,$6D,$6D
 $5E7C DEFB $6D,$6D,$6D,$6D ; }
 $5E80 DEFB $7D,$36,$08,$0B ; {super_tile $38 #HTML[#CALL:supertile($5E80, 0)]
 $5E84 DEFB $08,$37,$00,$02
 $5E88 DEFB $00,$00,$02,$03
 $5E8C DEFB $03,$01,$03,$02 ; }
 $5E90 DEFB $52,$51,$54,$6D ; {super_tile $39 #HTML[#CALL:supertile($5E90, 0)]
 $5E94 DEFB $54,$6D,$6D,$6D
 $5E98 DEFB $6D,$6D,$6D,$6D
 $5E9C DEFB $6D,$7C,$19,$6D ; }
 $5EA0 DEFB $6D,$17,$16,$1A ; {super_tile $3A #HTML[#CALL:supertile($5EA0, 0)]
 $5EA4 DEFB $7C,$18,$1C,$1B
 $5EA8 DEFB $7E,$7F,$6D,$6D
 $5EAC DEFB $6D,$6D,$7D,$0A ; }
 $5EB0 DEFB $6D,$6D,$6D,$0E ; {super_tile $3B #HTML[#CALL:supertile($5EB0, 0)]
 $5EB4 DEFB $04,$63,$6D,$0C
 $5EB8 DEFB $05,$80,$04,$06
 $5EBC DEFB $00,$02,$05,$07 ; }
 $5EC0 DEFB $6D,$6D,$6D,$6D ; {super_tile $3C #HTML[#CALL:supertile($5EC0, 0)]
 $5EC4 DEFB $6D,$6D,$6D,$6D
 $5EC8 DEFB $58,$6D,$6D,$6D
 $5ECC DEFB $59,$5A,$58,$6D ; }
 $5ED0 DEFB $6D,$5B,$59,$5A ; {super_tile $3D #HTML[#CALL:supertile($5ED0, 0)]
 $5ED4 DEFB $6D,$6D,$6D,$5B
 $5ED8 DEFB $6D,$6D,$6D,$6D
 $5EDC DEFB $6D,$6D,$55,$57 ; }
 $5EE0 DEFB $58,$6D,$6D,$12 ; {super_tile $3E #HTML[#CALL:supertile($5EE0, 0)]
 $5EE4 DEFB $59,$5A,$58,$0C
 $5EE8 DEFB $6D,$5B,$59,$69
 $5EEC DEFB $6D,$6D,$6D,$6B ; }
 $5EF0 DEFB $70,$6D,$56,$6D ; {super_tile $3F #HTML[#CALL:supertile($5EF0, 0)]
 $5EF4 DEFB $73,$74,$6D,$6D
 $5EF8 DEFB $77,$78,$6D,$6D
 $5EFC DEFB $04,$66,$6D,$6D ; }
 $5F00 DEFB $6D,$6D,$6D,$0E ; {super_tile $40 #HTML[#CALL:supertile($5F00, 0)]
 $5F04 DEFB $6D,$6D,$6D,$0C
 $5F08 DEFB $6D,$6D,$6D,$12
 $5F0C DEFB $6D,$6D,$6D,$10 ; }
 $5F10 DEFB $05,$07,$04,$66 ; {super_tile $41 #HTML[#CALL:supertile($5F10, 0)]
 $5F14 DEFB $03,$00,$05,$07
 $5F18 DEFB $00,$01,$03,$03
 $5F1C DEFB $01,$03,$02,$00 ; }
 $5F20 DEFB $58,$6D,$6D,$6D ; {super_tile $42 #HTML[#CALL:supertile($5F20, 0)]
 $5F24 DEFB $59,$5A,$58,$6D
 $5F28 DEFB $38,$5B,$59,$5A
 $5F2C DEFB $3B,$39,$63,$5B ; }
 $5F30 DEFB $3C,$5E,$3D,$3E ; {super_tile $43 #HTML[#CALL:supertile($5F30, 0)]
 $5F34 DEFB $3C,$5E,$5E,$1F
 $5F38 DEFB $3C,$5E,$5E,$1F
 $5F3C DEFB $3F,$40,$5E,$1F ; }
 $5F40 DEFB $5C,$41,$42,$1F ; {super_tile $44 #HTML[#CALL:supertile($5F40, 0)]
 $5F44 DEFB $04,$66,$05,$5D
 $5F48 DEFB $05,$07,$04,$63
 $5F4C DEFB $02,$03,$05,$80 ; }
 $5F50 DEFB $58,$6D,$6D,$6D ; {super_tile $45 #HTML[#CALL:supertile($5F50, 0)]
 $5F54 DEFB $59,$5A,$58,$6D
 $5F58 DEFB $6D,$5B,$59,$5A
 $5F5C DEFB $6D,$6D,$6D,$5B ; }
 $5F60 DEFB $6D,$6D,$56,$74 ; {super_tile $46 #HTML[#CALL:supertile($5F60, 0)]
 $5F64 DEFB $70,$6D,$81,$78
 $5F68 DEFB $73,$6D,$6D,$6D
 $5F6C DEFB $04,$63,$6D,$6D ; }
 $5F70 DEFB $6D,$82,$6D,$6D ; {super_tile $47 #HTML[#CALL:supertile($5F70, 0)]
 $5F74 DEFB $74,$6D,$6D,$6D
 $5F78 DEFB $73,$6D,$6D,$6D
 $5F7C DEFB $04,$63,$6D,$6D ; }
 $5F80 DEFB $6D,$5B,$59,$5A ; {super_tile $48 #HTML[#CALL:supertile($5F80, 0)]
 $5F84 DEFB $6D,$6D,$6D,$5B
 $5F88 DEFB $55,$57,$74,$6D
 $5F8C DEFB $56,$81,$78,$6D ; }
 $5F90 DEFB $05,$80,$04,$63 ; {super_tile $49 #HTML[#CALL:supertile($5F90, 0)]
 $5F94 DEFB $01,$00,$05,$80
 $5F98 DEFB $00,$03,$02,$03
 $5F9C DEFB $02,$01,$03,$00 ; }
 $5FA0 DEFB $86,$6D,$56,$6D ; {super_tile $4A #HTML[#CALL:supertile($5FA0, 0)]
 $5FA4 DEFB $85,$6E,$6F,$70
 $5FA8 DEFB $84,$71,$72,$73
 $5FAC DEFB $83,$63,$76,$77 ; }
 $5FB0 DEFB $87,$5B,$59,$5A ; {super_tile $4B #HTML[#CALL:supertile($5FB0, 0)]
 $5FB4 DEFB $86,$82,$6D,$5B
 $5FB8 DEFB $84,$6D,$6D,$6D
 $5FBC DEFB $87,$6D,$55,$57 ; }
 $5FC0 DEFB $6D,$5B,$59,$5A ; {super_tile $4C #HTML[#CALL:supertile($5FC0, 0)]
 $5FC4 DEFB $6D,$6D,$6D,$5B
 $5FC8 DEFB $55,$57,$6D,$6D
 $5FCC DEFB $56,$6D,$55,$57 ; }
 $5FD0 DEFB $6D,$6D,$56,$6D ; {super_tile $4D #HTML[#CALL:supertile($5FD0, 0)]
 $5FD4 DEFB $6D,$6D,$6D,$6D
 $5FD8 DEFB $82,$6D,$6D,$6E
 $5FDC DEFB $04,$66,$6D,$71 ; }
 $5FE0 DEFB $6D,$74,$56,$6D ; {super_tile $4E #HTML[#CALL:supertile($5FE0, 0)]
 $5FE4 DEFB $81,$78,$6D,$6D
 $5FE8 DEFB $82,$6D,$6D,$6D
 $5FEC DEFB $04,$63,$6D,$6D ; }
 $5FF0 DEFB $70,$6D,$56,$6D ; {super_tile $4F #HTML[#CALL:supertile($5FF0, 0)]
 $5FF4 DEFB $73,$74,$6D,$6D ; [unused by map]
 $5FF8 DEFB $77,$78,$6D,$81
 $5FFC DEFB $04,$66,$6D,$82 ; }
 $6000 DEFB $6D,$6D,$6D,$6D ; {super_tile $50 #HTML[#CALL:supertile($6000, 0)]
 $6004 DEFB $38,$6D,$6D,$6D
 $6008 DEFB $3B,$39,$63,$6D
 $600C DEFB $3F,$40,$3D,$3E ; }
 $6010 DEFB $71,$72,$73,$74 ; {super_tile $51 #HTML[#CALL:supertile($6010, 0)]
 $6014 DEFB $38,$76,$77,$78
 $6018 DEFB $3B,$39,$63,$6D
 $601C DEFB $3F,$40,$3D,$3E ; }
 $6020 DEFB $58,$6D,$6D,$6D ; {super_tile $52 #HTML[#CALL:supertile($6020, 0)]
 $6024 DEFB $59,$5A,$58,$6D
 $6028 DEFB $6D,$5B,$59,$5A
 $602C DEFB $6E,$6F,$70,$5B ; }
 $6030 DEFB $38,$5B,$59,$5A ; {super_tile $53 #HTML[#CALL:supertile($6030, 0)]
 $6034 DEFB $3B,$39,$63,$5B
 $6038 DEFB $3C,$5E,$3D,$3E
 $603C DEFB $3C,$5E,$5E,$1F ; }
 $6040 DEFB $3C,$5E,$5E,$1F ; {super_tile $54 #HTML[#CALL:supertile($6040, 0)]
 $6044 DEFB $3F,$40,$5E,$1F
 $6048 DEFB $5C,$41,$42,$1F
 $604C DEFB $04,$63,$05,$5D ; }
 $6050 DEFB $86,$6D,$6D,$6D ; {super_tile $55 #HTML[#CALL:supertile($6050, 0)]
 $6054 DEFB $84,$6D,$6D,$6D
 $6058 DEFB $87,$6D,$6D,$6D
 $605C DEFB $86,$5A,$58,$6D ; }
 $6060 DEFB $6D,$6D,$6D,$6D ; {super_tile $56 #HTML[#CALL:supertile($6060, 0)]
 $6064 DEFB $04,$66,$82,$6D
 $6068 DEFB $05,$07,$04,$63
 $606C DEFB $02,$03,$05,$80 ; }
 $6070 DEFB $6E,$6F,$70,$6D ; {super_tile $57 #HTML[#CALL:supertile($6070, 0)]
 $6074 DEFB $71,$72,$73,$74
 $6078 DEFB $75,$76,$77,$78
 $607C DEFB $6D,$6D,$82,$6D ; }
 $6080 DEFB $3C,$5E,$5E,$1F ; {super_tile $58 #HTML[#CALL:supertile($6080, 0)]
 $6084 DEFB $3F,$40,$5E,$1F
 $6088 DEFB $5C,$41,$42,$1F
 $608C DEFB $6D,$6D,$05,$5D ; }
 $6090 DEFB $87,$6D,$6D,$5B ; {super_tile $59 #HTML[#CALL:supertile($6090, 0)]
 $6094 DEFB $86,$82,$55,$57
 $6098 DEFB $84,$6E,$56,$6D
 $609C DEFB $87,$82,$6D,$6D ; }
 $60A0 DEFB $55,$57,$6D,$6D ; {super_tile $5A #HTML[#CALL:supertile($60A0, 0)]
 $60A4 DEFB $56,$6D,$55,$57
 $60A8 DEFB $6D,$6D,$56,$6D
 $60AC DEFB $73,$6D,$6D,$6D ; }
 $60B0 DEFB $6D,$6D,$6E,$6F ; {super_tile $5B #HTML[#CALL:supertile($60B0, 0)]
 $60B4 DEFB $6D,$6D,$71,$72
 $60B8 DEFB $58,$6D,$75,$76
 $60BC DEFB $59,$5A,$58,$6D ; }
 $60C0 DEFB $86,$6D,$6D,$6D ; {super_tile $5C #HTML[#CALL:supertile($60C0, 0)]
 $60C4 DEFB $84,$5A,$58,$6D
 $60C8 DEFB $87,$5B,$59,$5A
 $60CC DEFB $86,$6D,$6D,$5B ; }
 $60D0 DEFB $86,$6D,$6D,$74 ; {super_tile $5D #HTML[#CALL:supertile($60D0, 0)]
 $60D4 DEFB $84,$6D,$81,$78
 $60D8 DEFB $84,$6D,$82,$6D
 $60DC DEFB $87,$66,$6D,$6D ; }
 $60E0 DEFB $6E,$6F,$70,$12 ; {super_tile $5E #HTML[#CALL:supertile($60E0, 0)]
 $60E4 DEFB $71,$72,$73,$10
 $60E8 DEFB $75,$76,$77,$0E
 $60EC DEFB $6D,$6D,$6D,$0C ; }
 $60F0 DEFB $6D,$6D,$6D,$6D ; {super_tile $5F #HTML[#CALL:supertile($60F0, 0)]
 $60F4 DEFB $65,$7C,$6D,$6D
 $60F8 DEFB $08,$7E,$7F,$6D
 $60FC DEFB $6D,$6D,$6D,$7C ; }
 $6100 DEFB $6D,$6D,$6D,$6D ; {super_tile $60 #HTML[#CALL:supertile($6100, 0)]
 $6104 DEFB $6D,$6D,$6D,$6D
 $6108 DEFB $6D,$6D,$6D,$6D
 $610C DEFB $6D,$6D,$6D,$6D ; }
 $6110 DEFB $86,$3F,$40,$5E ; {super_tile $61 #HTML[#CALL:supertile($6110, 0)]
 $6114 DEFB $85,$5C,$41,$88
 $6118 DEFB $84,$6D,$82,$05
 $611C DEFB $83,$63,$6D,$6D ; }
 $6120 DEFB $5E,$3D,$3E,$0E ; {super_tile $62 #HTML[#CALL:supertile($6120, 0)]
 $6124 DEFB $40,$5E,$1F,$0C
 $6128 DEFB $41,$42,$1F,$12
 $612C DEFB $58,$05,$5D,$10 ; }
 $6130 DEFB $87,$6D,$6D,$5B ; {super_tile $63 #HTML[#CALL:supertile($6130, 0)]
 $6134 DEFB $86,$38,$81,$78
 $6138 DEFB $84,$3B,$39,$63
 $613C DEFB $87,$3C,$5E,$3D ; }
 $6140 DEFB $59,$5A,$58,$0E ; {super_tile $64 #HTML[#CALL:supertile($6140, 0)]
 $6144 DEFB $6D,$5B,$59,$5F
 $6148 DEFB $6D,$6D,$81,$6B
 $614C DEFB $39,$63,$82,$10 ; }
 $6150 DEFB $86,$3F,$40,$5E ; {super_tile $65 #HTML[#CALL:supertile($6150, 0)]
 $6154 DEFB $84,$5C,$41,$88
 $6158 DEFB $87,$5A,$58,$05
 $615C DEFB $86,$5B,$59,$5A ; }
 $6160 DEFB $0F,$53,$52,$51 ; {super_tile $66 #HTML[#CALL:supertile($6160, 0)]
 $6164 DEFB $6A,$51,$54,$7F
 $6168 DEFB $6C,$4E,$4F,$6D
 $616C DEFB $11,$6D,$50,$6D ; }
 $6170 DEFB $6D,$6D,$6D,$6D ; {super_tile $67 #HTML[#CALL:supertile($6170, 0)]
 $6174 DEFB $04,$66,$6D,$6D
 $6178 DEFB $05,$07,$04,$63
 $617C DEFB $03,$02,$05,$80 ; }
 $6180 DEFB $6D,$6F,$70,$6D ; {super_tile $68 #HTML[#CALL:supertile($6180, 0)]
 $6184 DEFB $81,$72,$73,$6D
 $6188 DEFB $82,$76,$77,$6D
 $618C DEFB $04,$66,$82,$6D ; }
 $6190 DEFB $66,$6D,$6D,$6D ; {super_tile $69 #HTML[#CALL:supertile($6190, 0)]
 $6194 DEFB $07,$74,$6E,$6D
 $6198 DEFB $81,$78,$04,$82
 $619C DEFB $82,$6D,$05,$6D ; }
 $61A0 DEFB $A1,$9A,$A3,$A4 ; {super_tile $6A #HTML[#CALL:supertile($61A0, 0)]
 $61A4 DEFB $86,$6D,$8E,$9A
 $61A8 DEFB $85,$5A,$58,$81
 $61AC DEFB $84,$5B,$59,$5A ; }
 $61B0 DEFB $8E,$8F,$90,$91 ; {super_tile $6B #HTML[#CALL:supertile($61B0, 0)]
 $61B4 DEFB $6E,$5A,$8E,$94
 $61B8 DEFB $82,$5B,$59,$5A
 $61BC DEFB $6D,$6D,$6D,$5B ; }
 $61C0 DEFB $0F,$6D,$64,$20 ; {super_tile $6C #HTML[#CALL:supertile($61C0, 0)]
 $61C4 DEFB $8B,$0A,$2D,$1F
 $61C8 DEFB $8C,$2C,$2E,$1F
 $61CC DEFB $8D,$28,$29,$68 ; }
 $61D0 DEFB $17,$16,$1A,$9B ; {super_tile $6D #HTML[#CALL:supertile($61D0, 0)]
 $61D4 DEFB $18,$1C,$1B,$9C
 $61D8 DEFB $6D,$53,$52,$9D
 $61DC DEFB $52,$51,$54,$9C ; }
 $61E0 DEFB $92,$93,$6D,$9D ; {super_tile $6E #HTML[#CALL:supertile($61E0, 0)]
 $61E4 DEFB $95,$96,$9A,$9F
 $61E8 DEFB $8E,$97,$95,$96
 $61EC DEFB $59,$5A,$8E,$97 ; }
 $61F0 DEFB $54,$19,$6D,$9B ; {super_tile $6F #HTML[#CALL:supertile($61F0, 0)]
 $61F4 DEFB $17,$16,$6D,$9C
 $61F8 DEFB $6D,$7D,$6D,$9D
 $61FC DEFB $7C,$19,$6D,$9E ; }
 $6200 DEFB $9A,$A0,$00,$01 ; {super_tile $70 #HTML[#CALL:supertile($6200, 0)]
 $6204 DEFB $95,$96,$9A,$A0
 $6208 DEFB $8E,$97,$95,$96
 $620C DEFB $59,$5A,$8E,$97 ; }
 $6210 DEFB $02,$00,$01,$00 ; {super_tile $71 #HTML[#CALL:supertile($6210, 0)]
 $6214 DEFB $03,$01,$02,$03
 $6218 DEFB $9A,$A0,$01,$00
 $621C DEFB $95,$96,$9A,$A0 ; }
 $6220 DEFB $8E,$97,$95,$96 ; {super_tile $72 #HTML[#CALL:supertile($6220, 0)]
 $6224 DEFB $59,$5A,$8E,$94
 $6228 DEFB $6D,$5B,$59,$5A
 $622C DEFB $6D,$6D,$6D,$5B ; }
 $6230 DEFB $6D,$5B,$59,$5A ; {super_tile $73 #HTML[#CALL:supertile($6230, 0)]
 $6234 DEFB $6D,$6E,$74,$5B
 $6238 DEFB $6D,$81,$78,$6D
 $623C DEFB $6D,$82,$6D,$6D ; }
 $6240 DEFB $00,$03,$B2,$B3 ; {super_tile $74 #HTML[#CALL:supertile($6240, 0)]
 $6244 DEFB $A0,$01,$B6,$B7
 $6248 DEFB $8E,$9A,$A0,$02
 $624C DEFB $58,$82,$8E,$9A ; }
 $6250 DEFB $02,$00,$01,$00 ; {super_tile $75 #HTML[#CALL:supertile($6250, 0)]
 $6254 DEFB $03,$01,$02,$03
 $6258 DEFB $01,$00,$A6,$A7
 $625C DEFB $A6,$A7,$A8,$6D ; }
 $6260 DEFB $02,$01,$A6,$A7 ; {super_tile $76 #HTML[#CALL:supertile($6260, 0)]
 $6264 DEFB $A6,$A7,$A8,$6D
 $6268 DEFB $A8,$6D,$A5,$A4
 $626C DEFB $A5,$A4,$00,$03 ; }
 $6270 DEFB $B4,$B5,$02,$01 ; {super_tile $77 #HTML[#CALL:supertile($6270, 0)]
 $6274 DEFB $B8,$B9,$03,$B1
 $6278 DEFB $02,$B1,$AF,$B0
 $627C DEFB $AF,$B0,$6D,$53 ; }
 $6280 DEFB $AD,$AE,$AF,$A2 ; {super_tile $78 #HTML[#CALL:supertile($6280, 0)]
 $6284 DEFB $AF,$B0,$7E,$9E
 $6288 DEFB $7C,$53,$52,$9B
 $628C DEFB $52,$51,$54,$9C ; }
 $6290 DEFB $02,$03,$00,$02 ; {super_tile $79 #HTML[#CALL:supertile($6290, 0)]
 $6294 DEFB $00,$00,$02,$03
 $6298 DEFB $AA,$AB,$03,$02
 $629C DEFB $6D,$A9,$AA,$AB ; }
 $62A0 DEFB $AA,$AB,$03,$00 ; {super_tile $7A #HTML[#CALL:supertile($62A0, 0)]
 $62A4 DEFB $6D,$A9,$AA,$AB
 $62A8 DEFB $AD,$AC,$6D,$A9
 $62AC DEFB $02,$01,$AD,$AC ; }
 $62B0 DEFB $BD,$6D,$A5,$A4 ; {super_tile $7B #HTML[#CALL:supertile($62B0, 0)]
 $62B4 DEFB $BF,$A4,$01,$00
 $62B8 DEFB $00,$02,$03,$B1
 $62BC DEFB $00,$B1,$AF,$B0 ; }
 $62C0 DEFB $A8,$6D,$A5,$A4 ; {super_tile $7C #HTML[#CALL:supertile($62C0, 0)]
 $62C4 DEFB $A5,$A4,$01,$00
 $62C8 DEFB $00,$02,$03,$B1
 $62CC DEFB $00,$B1,$AF,$B0 ; }
 $62D0 DEFB $BE,$B0,$BA,$BC ; {super_tile $7D #HTML[#CALL:supertile($62D0, 0)]
 $62D4 DEFB $BF,$BC,$BB,$6D
 $62D8 DEFB $6D,$7C,$BB,$6D
 $62DC DEFB $6D,$7E,$7F,$6D ; }
 $62E0 DEFB $AF,$B0,$BA,$BC ; {super_tile $7E #HTML[#CALL:supertile($62E0, 0)]
 $62E4 DEFB $A5,$BC,$BB,$7C
 $62E8 DEFB $6D,$6D,$BB,$6D
 $62EC DEFB $6D,$6D,$6D,$6D ; }
 $62F0 DEFB $02,$03,$FE,$B1 ; {super_tile $7F #HTML[#CALL:supertile($62F0, 0)]
 $62F4 DEFB $01,$B1,$AF,$B0
 $62F8 DEFB $AF,$B0,$A5,$BC
 $62FC DEFB $A5,$BC,$6D,$6D ; }
 $6300 DEFB $AF,$B0,$BA,$C1 ; {super_tile $80 #HTML[#CALL:supertile($6300, 0)]
 $6304 DEFB $A5,$BC,$6D,$5B
 $6308 DEFB $89,$6D,$55,$57
 $630C DEFB $87,$6D,$56,$6D ; }
 $6310 DEFB $C5,$28,$33,$15 ; {super_tile $81 #HTML[#CALL:supertile($6310, 0)]
 $6314 DEFB $C4,$28,$29,$1F
 $6318 DEFB $05,$2A,$25,$C2
 $631C DEFB $00,$B1,$C3,$B0 ; }
 $6320 DEFB $85,$5B,$59,$5A ; {super_tile $82 #HTML[#CALL:supertile($6320, 0)]
 $6324 DEFB $C7,$63,$6D,$5B
 $6328 DEFB $C6,$24,$04,$23
 $632C DEFB $C6,$26,$27,$1F ; }
 $6330 DEFB $6D,$6D,$6D,$5B ; {super_tile $83 #HTML[#CALL:supertile($6330, 0)]
 $6334 DEFB $70,$38,$81,$78
 $6338 DEFB $73,$3B,$39,$63
 $633C DEFB $6D,$3C,$5E,$3D ; }
 $6340 DEFB $B4,$B5,$02,$01 ; {super_tile $84 #HTML[#CALL:supertile($6340, 0)]
 $6344 DEFB $B8,$B9,$03,$00
 $6348 DEFB $00,$02,$03,$01
 $634C DEFB $A0,$00,$01,$02 ; }
 $6350 DEFB $AD,$AC,$6D,$A9 ; {super_tile $85 #HTML[#CALL:supertile($6350, 0)]
 $6354 DEFB $03,$00,$AD,$AC
 $6358 DEFB $00,$01,$03,$03
 $635C DEFB $01,$03,$02,$00 ; }
 $6360 DEFB $59,$5A,$58,$6D ; {super_tile $86 #HTML[#CALL:supertile($6360, 0)]
 $6364 DEFB $6D,$5B,$59,$5A
 $6368 DEFB $6D,$6D,$81,$5B
 $636C DEFB $39,$63,$82,$6D ; }
 $6370 DEFB $5E,$3D,$3E,$6D ; {super_tile $87 #HTML[#CALL:supertile($6370, 0)]
 $6374 DEFB $40,$5E,$1F,$70
 $6378 DEFB $41,$42,$1F,$73
 $637C DEFB $58,$05,$5D,$6D ; }
 $6380 DEFB $8E,$9A,$A0,$01 ; {super_tile $88 #HTML[#CALL:supertile($6380, 0)]
 $6384 DEFB $58,$6D,$8E,$9A
 $6388 DEFB $59,$5A,$58,$6D
 $638C DEFB $6D,$5B,$59,$5A ; }
 $6390 DEFB $86,$6F,$70,$6D ; {super_tile $89 #HTML[#CALL:supertile($6390, 0)]
 $6394 DEFB $85,$72,$73,$74
 $6398 DEFB $84,$76,$77,$78
 $639C DEFB $83,$63,$6D,$6D ; }
 $63A0 DEFB $0F,$6D,$6D,$6D ; {super_tile $8A #HTML[#CALL:supertile($63A0, 0)]
 $63A4 DEFB $0D,$7C,$19,$6D
 $63A8 DEFB $13,$17,$16,$1A
 $63AC DEFB $11,$18,$1C,$1B ; }
 $63B0 DEFB $08,$09,$0B,$09 ; {super_tile $8B #HTML[#CALL:supertile($63B0, 0)]
 $63B4 DEFB $08,$09,$0B,$09
 $63B8 DEFB $08,$09,$0B,$09
 $63BC DEFB $10,$09,$0B,$09 ; }
 $63C0 DEFB $11,$0F,$0B,$09 ; {super_tile $8C #HTML[#CALL:supertile($63C0, 0)]
 $63C4 DEFB $15,$13,$0D,$0F
 $63C8 DEFB $12,$16,$12,$13
 $63CC DEFB $13,$14,$15,$15 ; }
 $63D0 DEFB $0B,$09,$0B,$0C ; {super_tile $8D #HTML[#CALL:supertile($63D0, 0)]
 $63D4 DEFB $0B,$09,$0B,$0C
 $63D8 DEFB $0D,$0F,$0B,$0C
 $63DC DEFB $14,$13,$0D,$0E ; }
 $63E0 DEFB $0B,$09,$0A,$06 ; {super_tile $8E #HTML[#CALL:supertile($63E0, 0)]
 $63E4 DEFB $0B,$09,$0B,$0C
 $63E8 DEFB $0B,$09,$0B,$0C
 $63EC DEFB $0B,$09,$0B,$0C ; }
 $63F0 DEFB $15,$14,$13,$12 ; {super_tile $8F #HTML[#CALL:supertile($63F0, 0)]
 $63F4 DEFB $02,$12,$14,$15
 $63F8 DEFB $05,$06,$02,$16
 $63FC DEFB $0A,$06,$05,$06 ; }
 $6400 DEFB $07,$01,$02,$17 ; {super_tile $90 #HTML[#CALL:supertile($6400, 0)]
 $6404 DEFB $03,$06,$05,$06
 $6408 DEFB $08,$09,$0A,$06
 $640C DEFB $08,$09,$0B,$09 ; }
 $6410 DEFB $14,$16,$12,$13 ; {super_tile $91 #HTML[#CALL:supertile($6410, 0)]
 $6414 DEFB $15,$14,$13,$17
 $6418 DEFB $17,$13,$15,$14
 $641C DEFB $02,$12,$13,$12 ; }
 $6420 DEFB $16,$15,$17,$14 ; {super_tile $92 #HTML[#CALL:supertile($6420, 0)]
 $6424 DEFB $14,$13,$15,$12
 $6428 DEFB $16,$12,$17,$13
 $642C DEFB $15,$14,$13,$17 ; }
 $6430 DEFB $1E,$20,$1E,$1F ; {super_tile $93 #HTML[#CALL:supertile($6430, 0)]
 $6434 DEFB $1E,$20,$1E,$1F
 $6438 DEFB $1E,$20,$1E,$1F
 $643C DEFB $1E,$20,$1E,$1F ; }
 $6440 DEFB $1E,$20,$22,$23 ; {super_tile $94 #HTML[#CALL:supertile($6440, 0)]
 $6444 DEFB $22,$21,$17,$14
 $6448 DEFB $14,$13,$15,$12
 $644C DEFB $16,$12,$17,$13 ; }
 $6450 DEFB $25,$20,$1E,$20 ; {super_tile $95 #HTML[#CALL:supertile($6450, 0)]
 $6454 DEFB $25,$20,$1E,$20
 $6458 DEFB $25,$20,$22,$21
 $645C DEFB $24,$21,$17,$13 ; }
 $6460 DEFB $1B,$00,$1E,$20 ; {super_tile $96 #HTML[#CALL:supertile($6460, 0)]
 $6464 DEFB $25,$20,$1E,$20
 $6468 DEFB $25,$20,$1E,$20
 $646C DEFB $25,$20,$1E,$20 ; }
 $6470 DEFB $17,$18,$19,$1A ; {super_tile $97 #HTML[#CALL:supertile($6470, 0)]
 $6474 DEFB $1B,$1C,$1B,$1D
 $6478 DEFB $1B,$00,$1E,$1F
 $647C DEFB $1E,$20,$1E,$1F ; }
 $6480 DEFB $13,$15,$14,$15 ; {super_tile $98 #HTML[#CALL:supertile($6480, 0)]
 $6484 DEFB $14,$16,$17,$18
 $6488 DEFB $17,$18,$1B,$1C
 $648C DEFB $1B,$1C,$1B,$00 ; }
 $6490 DEFB $16,$15,$17,$14 ; {super_tile $99 #HTML[#CALL:supertile($6490, 0)]
 $6494 DEFB $14,$13,$15,$12
 $6498 DEFB $12,$16,$17,$13
 $649C DEFB $15,$17,$13,$18 ; }
 $64A0 DEFB $16,$14,$15,$12 ; {super_tile $9A #HTML[#CALL:supertile($64A0, 0)]
 $64A4 DEFB $13,$69,$6A,$13 ; [unused by map]
 $64A8 DEFB $15,$6B,$6C,$14
 $64AC DEFB $14,$13,$16,$12 ; }
 $64B0 DEFB $28,$27,$26,$29 ; {super_tile $9B #HTML[#CALL:supertile($64B0, 0)]
 $64B4 DEFB $02,$28,$29,$27
 $64B8 DEFB $05,$06,$02,$17
 $64BC DEFB $0A,$06,$05,$06 ; }
 $64C0 DEFB $27,$28,$29,$28 ; {super_tile $9C #HTML[#CALL:supertile($64C0, 0)]
 $64C4 DEFB $26,$29,$28,$27
 $64C8 DEFB $28,$27,$27,$26
 $64CC DEFB $02,$28,$26,$18 ; }
 $64D0 DEFB $26,$28,$27,$28 ; {super_tile $9D #HTML[#CALL:supertile($64D0, 0)]
 $64D4 DEFB $28,$27,$29,$18
 $64D8 DEFB $26,$18,$1B,$1C
 $64DC DEFB $1B,$1C,$1B,$00 ; }
 $64E0 DEFB $2D,$20,$1E,$20 ; {super_tile $9E #HTML[#CALL:supertile($64E0, 0)]
 $64E4 DEFB $2D,$20,$1E,$20
 $64E8 DEFB $2D,$20,$22,$21
 $64EC DEFB $2B,$21,$17,$13 ; }
 $64F0 DEFB $0B,$09,$0B,$2C ; {super_tile $9F #HTML[#CALL:supertile($64F0, 0)]
 $64F4 DEFB $0B,$09,$0B,$2C
 $64F8 DEFB $0D,$0F,$0B,$2C
 $64FC DEFB $13,$14,$0D,$2A ; }
 $6500 DEFB $0B,$09,$0A,$2E ; {super_tile $A0 #HTML[#CALL:supertile($6500, 0)]
 $6504 DEFB $0B,$09,$0B,$2C
 $6508 DEFB $0B,$09,$0B,$2C
 $650C DEFB $0B,$09,$0B,$2C ; }
 $6510 DEFB $2F,$00,$1E,$20 ; {super_tile $A1 #HTML[#CALL:supertile($6510, 0)]
 $6514 DEFB $2D,$20,$1E,$20
 $6518 DEFB $2D,$20,$1E,$20
 $651C DEFB $2D,$20,$1E,$20 ; }
 $6520 DEFB $15,$14,$13,$12 ; {super_tile $A2 #HTML[#CALL:supertile($6520, 0)]
 $6524 DEFB $02,$17,$14,$15
 $6528 DEFB $05,$06,$02,$17
 $652C DEFB $0A,$06,$05,$30 ; }
 $6530 DEFB $13,$15,$14,$15 ; {super_tile $A3 #HTML[#CALL:supertile($6530, 0)]
 $6534 DEFB $14,$16,$17,$18
 $6538 DEFB $17,$18,$1B,$1C
 $653C DEFB $31,$1C,$1B,$00 ; }
 $6540 DEFB $42,$09,$0B,$3A ; {super_tile $A4 #HTML[#CALL:supertile($6540, 0)]
 $6544 DEFB $41,$09,$0B,$3A
 $6548 DEFB $3D,$3E,$3B,$3A
 $654C DEFB $13,$17,$3D,$3C ; }
 $6550 DEFB $36,$3E,$3B,$45 ; {super_tile $A5 #HTML[#CALL:supertile($6550, 0)]
 $6554 DEFB $12,$13,$3D,$46
 $6558 DEFB $14,$15,$14,$13
 $655C DEFB $12,$13,$12,$14 ; }
 $6560 DEFB $44,$38,$37,$06 ; {super_tile $A6 #HTML[#CALL:supertile($6560, 0)]
 $6564 DEFB $42,$43,$40,$39
 $6568 DEFB $42,$09,$0B,$3F
 $656C DEFB $42,$09,$0B,$3A ; }
 $6570 DEFB $35,$09,$0B,$47 ; {super_tile $A7 #HTML[#CALL:supertile($6570, 0)]
 $6574 DEFB $35,$09,$0B,$45
 $6578 DEFB $34,$09,$0B,$45
 $657C DEFB $35,$09,$0B,$45 ; }
 $6580 DEFB $07,$01,$02,$17 ; {super_tile $A8 #HTML[#CALL:supertile($6580, 0)]
 $6584 DEFB $32,$06,$05,$06
 $6588 DEFB $33,$38,$37,$06
 $658C DEFB $34,$43,$40,$38 ; }
 $6590 DEFB $16,$15,$14,$15 ; {super_tile $A9 #HTML[#CALL:supertile($6590, 0)]
 $6594 DEFB $02,$17,$13,$17
 $6598 DEFB $05,$06,$02,$15
 $659C DEFB $41,$06,$05,$06 ; }
 $65A0 DEFB $29,$27,$28,$29 ; {super_tile $AA #HTML[#CALL:supertile($65A0, 0)]
 $65A4 DEFB $02,$28,$29,$27
 $65A8 DEFB $05,$06,$02,$26
 $65AC DEFB $0A,$06,$05,$06 ; }
 $65B0 DEFB $08,$09,$0B,$09 ; {super_tile $AB #HTML[#CALL:supertile($65B0, 0)]
 $65B4 DEFB $08,$09,$0B,$4F
 $65B8 DEFB $08,$4F,$50,$4A
 $65BC DEFB $52,$4A,$51,$4B ; }
 $65C0 DEFB $0B,$49,$19,$48 ; {super_tile $AC #HTML[#CALL:supertile($65C0, 0)]
 $65C4 DEFB $50,$4A,$50,$1D
 $65C8 DEFB $51,$4B,$4C,$4E
 $65CC DEFB $4C,$4D,$4C,$4E ; }
 $65D0 DEFB $53,$4B,$4C,$4D ; {super_tile $AD #HTML[#CALL:supertile($65D0, 0)]
 $65D4 DEFB $25,$20,$1E,$4D
 $65D8 DEFB $25,$20,$1E,$20
 $65DC DEFB $25,$20,$1E,$20 ; }
 $65E0 DEFB $4C,$4D,$4C,$4E ; {super_tile $AE #HTML[#CALL:supertile($65E0, 0)]
 $65E4 DEFB $4C,$4D,$4C,$4E
 $65E8 DEFB $1E,$4D,$4C,$4E
 $65EC DEFB $1E,$20,$1E,$4E ; }
 $65F0 DEFB $55,$54,$57,$55 ; {super_tile $AF #HTML[#CALL:supertile($65F0, 0)]
 $65F4 DEFB $54,$56,$55,$18
 $65F8 DEFB $57,$18,$1B,$1C
 $65FC DEFB $1B,$1C,$1B,$00 ; }
 $6600 DEFB $54,$55,$56,$57 ; {super_tile $B0 #HTML[#CALL:supertile($6600, 0)]
 $6604 DEFB $56,$57,$54,$55
 $6608 DEFB $55,$56,$57,$54
 $660C DEFB $54,$55,$54,$18 ; }
 $6610 DEFB $28,$28,$26,$29 ; {super_tile $B1 #HTML[#CALL:supertile($6610, 0)]
 $6614 DEFB $27,$29,$27,$56
 $6618 DEFB $29,$56,$57,$57
 $661C DEFB $57,$56,$55,$54 ; }
 $6620 DEFB $17,$18,$19,$1A ; {super_tile $B2 #HTML[#CALL:supertile($6620, 0)]
 $6624 DEFB $5A,$1C,$1B,$1D
 $6628 DEFB $65,$64,$58,$1F
 $662C DEFB $65,$5E,$5F,$5C ; }
 $6630 DEFB $61,$66,$62,$5C ; {super_tile $B3 #HTML[#CALL:supertile($6630, 0)]
 $6634 DEFB $61,$66,$68,$63
 $6638 DEFB $61,$66,$68,$63
 $663C DEFB $61,$66,$68,$63 ; }
 $6640 DEFB $61,$66,$68,$09 ; {super_tile $B4 #HTML[#CALL:supertile($6640, 0)]
 $6644 DEFB $61,$67,$0B,$09
 $6648 DEFB $11,$0F,$0B,$09
 $664C DEFB $15,$14,$0D,$0F ; }
 $6650 DEFB $5B,$01,$58,$20 ; {super_tile $B5 #HTML[#CALL:supertile($6650, 0)]
 $6654 DEFB $03,$06,$5F,$5D
 $6658 DEFB $61,$60,$0A,$5E
 $665C DEFB $61,$09,$0B,$09 ; }
 $6660 DEFB $1E,$20,$22,$23 ; {super_tile $B6 #HTML[#CALL:supertile($6660, 0)]
 $6664 DEFB $59,$21,$17,$15
 $6668 DEFB $05,$06,$02,$16
 $666C DEFB $0A,$06,$05,$06 ; }
 $6670 DEFB $1B,$00,$1E,$20 ; {super_tile $B7 #HTML[#CALL:supertile($6670, 0)]
 $6674 DEFB $25,$20,$1E,$20
 $6678 DEFB $25,$20,$1E,$20
 $667C DEFB $58,$20,$1E,$20 ; }
 $6680 DEFB $16,$14,$15,$12 ; {super_tile $B8 #HTML[#CALL:supertile($6680, 0)]
 $6684 DEFB $13,$69,$6A,$13
 $6688 DEFB $15,$6B,$6C,$14
 $668C DEFB $14,$13,$16,$12 ; }
 $6690 DEFB $28,$27,$26,$16 ; {super_tile $B9 #HTML[#CALL:supertile($6690, 0)]
 $6694 DEFB $29,$17,$28,$27
 $6698 DEFB $17,$28,$16,$51
 $669C DEFB $17,$A0,$9F,$9B ; }
 $66A0 DEFB $17,$28,$16,$26 ; {super_tile $BA #HTML[#CALL:supertile($66A0, 0)]
 $66A4 DEFB $16,$29,$27,$28
 $66A8 DEFB $9A,$17,$28,$27
 $66AC DEFB $9C,$9D,$9E,$17 ; }
 $66B0 DEFB $26,$27,$17,$70 ; {super_tile $BB #HTML[#CALL:supertile($66B0, 0)]
 $66B4 DEFB $16,$28,$29,$15
 $66B8 DEFB $28,$29,$26,$16
 $66BC DEFB $02,$17,$26,$70 ; }
 $66C0 DEFB $97,$99,$B0,$B1 ; {super_tile $BC #HTML[#CALL:supertile($66C0, 0)]
 $66C4 DEFB $88,$8F,$8A,$AC
 $66C8 DEFB $8D,$96,$98,$6E
 $66CC DEFB $8B,$AF,$8C,$83 ; }
 $66D0 DEFB $B2,$AE,$94,$95 ; {super_tile $BD #HTML[#CALL:supertile($66D0, 0)]
 $66D4 DEFB $AD,$85,$92,$93
 $66D8 DEFB $6F,$91,$A9,$8E
 $66DC DEFB $84,$AB,$AA,$85 ; }
 $66E0 DEFB $6D,$16,$28,$27 ; {super_tile $BE #HTML[#CALL:supertile($66E0, 0)]
 $66E4 DEFB $17,$28,$27,$26
 $66E8 DEFB $16,$27,$17,$28
 $66EC DEFB $6D,$15,$29,$18 ; }
 $66F0 DEFB $90,$8F,$8A,$AC ; {super_tile $BF #HTML[#CALL:supertile($66F0, 0)]
 $66F4 DEFB $81,$17,$0D,$75
 $66F8 DEFB $77,$06,$02,$7B
 $66FC DEFB $78,$06,$05,$71 ; }
 $6700 DEFB $AD,$85,$92,$89 ; {super_tile $C0 #HTML[#CALL:supertile($6700, 0)]
 $6704 DEFB $76,$21,$26,$82
 $6708 DEFB $7C,$18,$1B,$7E
 $670C DEFB $72,$1C,$1B,$7F ; }
 $6710 DEFB $79,$09,$0A,$71 ; {super_tile $C1 #HTML[#CALL:supertile($6710, 0)]
 $6714 DEFB $79,$09,$0B,$73
 $6718 DEFB $79,$09,$0B,$73
 $671C DEFB $79,$09,$0B,$73 ; }
 $6720 DEFB $72,$00,$1E,$80 ; {super_tile $C2 #HTML[#CALL:supertile($6720, 0)]
 $6724 DEFB $74,$20,$1E,$80
 $6728 DEFB $74,$20,$1E,$80
 $672C DEFB $74,$20,$1E,$80 ; }
 $6730 DEFB $79,$09,$0B,$73 ; {super_tile $C3 #HTML[#CALL:supertile($6730, 0)]
 $6734 DEFB $79,$09,$0B,$73
 $6738 DEFB $0D,$0F,$0B,$73
 $673C DEFB $13,$12,$0D,$7A ; }
 $6740 DEFB $74,$20,$1E,$80 ; {super_tile $C4 #HTML[#CALL:supertile($6740, 0)]
 $6744 DEFB $74,$20,$1E,$80
 $6748 DEFB $74,$20,$22,$21
 $674C DEFB $7D,$21,$14,$15 ; }
 $6750 DEFB $90,$8F,$8A,$AC ; {super_tile $C5 #HTML[#CALL:supertile($6750, 0)]
 $6754 DEFB $A1,$28,$0D,$75
 $6758 DEFB $A1,$15,$27,$7B
 $675C DEFB $A1,$28,$17,$A4 ; }
 $6760 DEFB $A1,$18,$1B,$A5 ; {super_tile $C6 #HTML[#CALL:supertile($6760, 0)]
 $6764 DEFB $A2,$1C,$1B,$A6
 $6768 DEFB $A2,$00,$1E,$A8
 $676C DEFB $A3,$20,$1E,$A8 ; }
 $6770 DEFB $A3,$20,$1E,$A8 ; {super_tile $C7 #HTML[#CALL:supertile($6770, 0)]
 $6774 DEFB $A3,$20,$1E,$A8
 $6778 DEFB $1E,$20,$1E,$A8
 $677C DEFB $1E,$20,$1E,$A7 ; }
 $6780 DEFB $CB,$CB,$CA,$CB ; {super_tile $C8 #HTML[#CALL:supertile($6780, 0)]
 $6784 DEFB $CB,$CB,$CB,$18
 $6788 DEFB $CB,$18,$1B,$1C
 $678C DEFB $BC,$BA,$1B,$00 ; }
 $6790 DEFB $CC,$CD,$19,$04 ; {super_tile $C9 #HTML[#CALL:supertile($6790, 0)]
 $6794 DEFB $1B,$1C,$1B,$1D
 $6798 DEFB $1B,$00,$1E,$1F
 $679C DEFB $1E,$20,$1E,$1F ; }
 $67A0 DEFB $BB,$B9,$B6,$B7 ; {super_tile $CA #HTML[#CALL:supertile($67A0, 0)]
 $67A4 DEFB $25,$20,$B5,$B8
 $67A8 DEFB $25,$20,$1E,$20
 $67AC DEFB $25,$20,$1E,$20 ; }
 $67B0 DEFB $1E,$20,$1E,$1F ; {super_tile $CB #HTML[#CALL:supertile($67B0, 0)]
 $67B4 DEFB $B6,$B7,$1E,$1F
 $67B8 DEFB $B5,$B8,$B6,$B3
 $67BC DEFB $1E,$20,$B5,$B4 ; }
 $67C0 DEFB $59,$5A,$58,$6D ; {super_tile $CC #HTML[#CALL:supertile($67C0, 0)]
 $67C4 DEFB $C8,$C9,$59,$5A
 $67C8 DEFB $13,$19,$CB,$C9
 $67CC DEFB $0D,$16,$CC,$CE ; }
 $67D0 DEFB $6D,$3F,$40,$5E ; {super_tile $CD #HTML[#CALL:supertile($67D0, 0)]
 $67D4 DEFB $58,$5C,$41,$88
 $67D8 DEFB $59,$5A,$58,$05
 $67DC DEFB $CB,$C9,$59,$5A ; }
 $67E0 DEFB $14,$19,$CC,$CC ; {super_tile $CE #HTML[#CALL:supertile($67E0, 0)]
 $67E4 DEFB $15,$16,$CD,$D5
 $67E8 DEFB $0F,$6D,$CC,$CE
 $67EC DEFB $0D,$6D,$CC,$CC ; }
 $67F0 DEFB $CC,$CE,$CB,$C9 ; {super_tile $CF #HTML[#CALL:supertile($67F0, 0)]
 $67F4 DEFB $CC,$CC,$CC,$CE
 $67F8 DEFB $CC,$CC,$CC,$CC
 $67FC DEFB $CC,$CC,$CC,$CA ; }
 $6800 DEFB $09,$0A,$D1,$CC ; {super_tile $D0 #HTML[#CALL:supertile($6800, 0)]
 $6804 DEFB $08,$0B,$D2,$D3
 $6808 DEFB $6D,$F4,$F7,$F8
 $680C DEFB $F7,$F8,$F7,$DC ; }
 $6810 DEFB $CC,$CA,$F5,$F6 ; {super_tile $D1 #HTML[#CALL:supertile($6810, 0)]
 $6814 DEFB $D4,$F8,$F7,$F9
 $6818 DEFB $F7,$DC,$FA,$FB
 $681C DEFB $FA,$FC,$FA,$FB ; }
 $6820 DEFB $59,$5A,$58,$0E ; {super_tile $D2 #HTML[#CALL:supertile($6820, 0)]
 $6824 DEFB $6D,$5B,$59,$69
 $6828 DEFB $6D,$6D,$6D,$6B
 $682C DEFB $F5,$E0,$6D,$10 ; }
 $6830 DEFB $F7,$F9,$6D,$0E ; {super_tile $D3 #HTML[#CALL:supertile($6830, 0)]
 $6834 DEFB $FA,$FB,$6D,$0C
 $6838 DEFB $FA,$FB,$6D,$12
 $683C DEFB $FA,$FB,$6D,$10 ; }
 $6840 DEFB $FA,$FB,$6D,$0E ; {super_tile $D4 #HTML[#CALL:supertile($6840, 0)]
 $6844 DEFB $FA,$D7,$6D,$0C
 $6848 DEFB $FA,$D0,$04,$06
 $684C DEFB $FE,$FF,$05,$07 ; }
 $6850 DEFB $0F,$53,$52,$51 ; {super_tile $D5 #HTML[#CALL:supertile($6850, 0)]
 $6854 DEFB $6A,$51,$54,$6D
 $6858 DEFB $6C,$6D,$6D,$6D
 $685C DEFB $11,$6D,$CF,$DD ; }
 $6860 DEFB $0F,$6D,$DF,$E2 ; {super_tile $D6 #HTML[#CALL:supertile($6860, 0)]
 $6864 DEFB $0D,$6D,$E4,$E8
 $6868 DEFB $13,$6D,$E4,$E8
 $686C DEFB $11,$6D,$E4,$E8 ; }
 $6870 DEFB $0F,$6D,$E4,$E8 ; {super_tile $D7 #HTML[#CALL:supertile($6870, 0)]
 $6874 DEFB $0D,$6D,$DA,$E8
 $6878 DEFB $09,$0A,$DB,$E8
 $687C DEFB $08,$0B,$ED,$EA ; }
 $6880 DEFB $E3,$DD,$DE,$D6 ; {super_tile $D8 #HTML[#CALL:supertile($6880, 0)]
 $6884 DEFB $DF,$E2,$E1,$D8
 $6888 DEFB $E4,$E5,$E6,$D8
 $688C DEFB $E4,$E5,$E6,$D9 ; }
 $6890 DEFB $DA,$D9,$E7,$E5 ; {super_tile $D9 #HTML[#CALL:supertile($6890, 0)]
 $6894 DEFB $E4,$E5,$E7,$E5
 $6898 DEFB $E4,$E5,$E7,$E5
 $689C DEFB $E4,$E5,$E7,$E5 ; }

; Index of the current room, or 0 when outside.
@label=room_index
g$68A0 DEFB $00

; Holds the current door id.
@label=current_door
g$68A1 DEFB $00

; The hero or a non-player character changes room.
;
; Used by the routines at #R$B1F5, #R$B32D, #R$CA81, #R$CB98 and #R$EFCB.
;
; I:HL Pointer to pos.
; I:IY Pointer to visible character.
@label=transition
c$68A2 EX DE,HL
 $68A3 PUSH IY       ; {HL = IY;
 $68A5 POP HL        ; }
 $68A6 LD A,L        ; A = L; // stash vischar index/offset
 $68A7 PUSH AF
 $68A8 ADD A,$0F     ; {L = A + 0x0F; // $8xxF (position on X axis)
 $68AA LD L,A        ; }
 $68AB LD A,(IY+$1C) ; A = IY[0x1C]; // $8x1C (vischar.room)
 $68AE AND A         ; {if (A == 0) <% // outdoors
 $68AF JP NZ,$68C3   ; }
; Set position on X axis, Y axis and height (dividing by 4).
 $68B2 LD B,$03      ;   B = 3; // 3 iterations
*$68B4 PUSH BC       ;   do <%
 $68B5 LD A,(DE)     ;     A = *DE++;
 $68B6 CALL $B295    ;     multiply_by_4();
 $68B9 LD (HL),C     ; {    *HL++ = C;
 $68BA INC L         ; }
 $68BB LD (HL),B     ; {    *HL++ = B;
 $68BC INC L         ;
 $68BD INC DE        ; }
 $68BE POP BC
 $68BF DJNZ $68B4    ;   %> while (--B); %>
 $68C1 JR $68CE      ; else <% // interior
; Set position on X axis, Y axis and height (copying).
*$68C3 LD B,$03      ;   B = 3; // 3 iterations
*$68C5 LD A,(DE)     ; {  do <% *HL++ = *DE++;
 $68C6 LD (HL),A     ;
 $68C7 INC L         ; }
 $68C8 LD (HL),$00   ; {    *HL++ = 0;
 $68CA INC L         ;
 $68CB INC DE        ; }
 $68CC DJNZ $68C5    ;   %> while (--B); %>
*$68CE POP AF
 $68CF LD L,A        ; L = A;
 $68D0 AND A         ; {if (A) <% reset_visible_character(); return; %> // exit via
 $68D1 JP Z,$68D7    ;
 $68D4 JP $C5D3      ; }
; HL points to the hero vischar at this point.
*$68D7 INC L         ; {*++HL &= ~vischar_FLAGS_NO_COLLIDE; // $8001
 $68D8 RES 7,(HL)    ; }
 $68DA LD A,($801C)  ; A = vischar.room;
 $68DD LD ($68A0),A  ; room_index = A;
 $68E0 AND A         ; {if (A != 0) goto enter_room;
 $68E1 JP NZ,$68F4   ; }
; Outdoors.
 $68E4 LD A,$0C      ; {HL += 12;
 $68E6 ADD A,L       ;
 $68E7 LD L,A        ; }
 $68E8 LD (HL),$80   ; {*HL++ = input_KICK; // $800D
 $68EA INC L         ; }
 $68EB LD A,(HL)     ; {*HL &= vischar_DIRECTION_MASK; // $800E // likely a sprite direction
 $68EC AND $03       ;
 $68EE LD (HL),A     ; }
 $68EF CALL $B2FC    ; reset_outdoors();
 $68F2 JR $691A      ; goto squash_stack_goto_main;

; The hero enters a room.
;
; Used by the routines at #R$68A2, #R$9D78, #R$9DE5 and #R$B75A.
@label=enter_room
c$68F4 LD HL,$0000   ; {game_window_offset = 0;
 $68F7 LD ($A7C7),HL ; }
 $68FA CALL $6A35    ; setup_room();
 $68FD CALL $6B42    ; plot_interior_tiles();
 $6900 LD HL,$EA74   ; {map_position = 0xEA74;
 $6903 LD ($81BB),HL ; }
 $6906 CALL $6920    ; set_hero_sprite_for_room();
 $6909 LD HL,$8000   ; HL = $8000;
 $690C CALL $B71B    ; calc_vischar_screenpos_from_mi_pos(); // reset hero
 $690F CALL $6939    ; setup_movable_items();
 $6912 CALL $ABA0    ; zoombox();
 $6915 LD B,$01      ; {increase_score(1);
 $6917 CALL $A0F9    ; }
; FALL THROUGH into squash_stack_goto_main.

; Squash stack, then goto main.
;
; Used by the routine at #R$68A2.
@label=squash_stack_goto_main
c$691A LD SP,$FFFF   ; SP = $FFFF;
 $691D JP $9D7B      ; goto main_loop;

; Set appropriate hero sprite for room.
;
; Used by the routine at #R$68F4.
; .
; Called when changing rooms.
@label=set_hero_sprite_for_room
@nowarn
c$6920 LD HL,$800D   ; HL = $800D;
 $6923 LD (HL),$80   ; {*HL++ = input_KICK;
 $6925 INC L         ; }
; vischar_DIRECTION_CRAWL is set, or cleared, here but not tested directly
; anywhere else so it must be an offset into byte_CDAA[].
;
; When in tunnel rooms force the hero sprite to 'prisoner' and set the crawl
; flag appropriately.
 $6926 LD A,($68A0)  ; {if (room_index >= room_29_SECOND_TUNNEL_START) <%
 $6929 CP $1D        ;
 $692B JR C,$6936    ; }
 $692D SET 2,(HL)    ;   *HL |= vischar_DIRECTION_CRAWL; // $800E, set crawl flag
 $692F LD HL,$CE2E   ; {  $8015 = &sprite_prisoner; %>
 $6932 LD ($8015),HL ; }
 $6935 RET           ; else <%
*$6936 RES 2,(HL)    ;   *HL &= ~vischar_DIRECTION_CRAWL; %> // clear crawl flag
 $6938 RET           ; return;

; Setup movable items.
;
; Used by the routines at #R$68F4 and #R$B2FC.
@label=setup_movable_items
c$6939 CALL $69C9    ; reset_nonplayer_visible_characters();
 $693C LD A,($68A0)  ; A = room_index;
 $693F CP $02        ; {     if (A == room_2_HUT2LEFT) setup_stove1();
 $6941 JP NZ,$6949   ;
 $6944 CALL $6978    ;
 $6947 JR $695B      ; }
*$6949 CP $04        ; {else if (A == room_4_HUT3LEFT) setup_stove2();
 $694B JP NZ,$6953   ;
 $694E CALL $6971    ;
 $6951 JR $695B      ; }
*$6953 CP $09        ; {else if (A == room_9_CRATE)    setup_crate();
 $6955 JP NZ,$695B   ;
 $6958 CALL $696A    ; }
*$695B CALL $C41C    ; spawn_characters();
 $695E CALL $DB9E    ; mark_nearby_items();
 $6961 CALL $B5CE    ; called_from_main_loop_9();
 $6964 CALL $AAB2    ; move_map();
 $6967 JP $B866      ; plot_sprites(); return;
@label=setup_crate
*$696A LD HL,$69B7   ; HL = &movable_items[movable_item_CRATE];
 $696D LD A,$1C      ; A = character_28_CRATE;
 $696F JR $697D      ; goto setup_movable_item;
@label=setup_stove2
*$6971 LD HL,$69C0   ; HL = &movable_items[movable_item_STOVE2];
 $6974 LD A,$1B      ; A = character_27_STOVE_2;
 $6976 JR $697D      ; goto setup_movable_item;
@label=setup_stove1
*$6978 LD HL,$69AE   ; HL = &movable_items[movable_item_STOVE1];
 $697B LD A,$1A      ; A = character_26_STOVE_1;
; FALL THROUGH into setup_movable_item.

; Setup the second vischar as a movable item.
;
; Used by the routine at #R$6939.
;
; I:HL Pointer to movable item.
@label=setup_movable_item
@nowarn
c$697D LD ($8020),A     ; setup_movable_item: $8020 = A; // character index
 $6980 LD BC,$0009      ; {memcpy($802F, HL, 9); // non-player character 0 is $8020..$803F
 $6983 LD DE,$802F      ;
 $6986 LDIR             ; }
@nowarn
 $6988 LD HL,$69A0      ; {memcpy($8021, movable_item_reset_data, 14);
 $698B LD DE,$8021      ;
 $698E LD BC,$000E      ;
 $6991 LDIR             ; }
 $6993 LD A,($68A0)     ; {$803C = room_index;
 $6996 LD ($803C),A     ; }
@nowarn
 $6999 LD HL,$8020      ; HL = $8020;
 $699C CALL $B71B       ; calc_vischar_screenpos_from_mi_pos(); // reset item vischar
 $699F RET              ; return;
; Fourteen bytes of reset data.
@label=movable_item_reset_data
 $69A0 DEFB $00         ; flags
 $69A1 DEFW $0000       ; target
 $69A3 DEFB $00,$00,$00 ; pos
 $69A6 DEFB $00         ; counter_and_flags
 $69A7 DEFW $CDF2       ; animbase = &animations[0]
 $69A9 DEFW $CF76       ; anim     = animations[8] // anim_wait_tl animation
 $69AB DEFB $00         ; animindex
 $69AC DEFB $00         ; input
 $69AD DEFB $00         ; direction

; Movable items.
;
; struct movable_item { word x_coord, y_coord, height; const sprite *; byte
; index; };
; .
; Sub-struct of vischar ($802F..$8038).
;
; .
;
; struct movable_item stove1 = { { 62, 35, 16 }, &sprite_stove, 0 };
@label=movable_item_stove1
b$69AE DEFW $003E,$0023,$0010 ; pos: 62, 35, 16
 $69B4 DEFW $CE22             ; sprite: sprite_stove
 $69B6 DEFB $00               ; index: 0
; struct movable_item crate  = { { 55, 54, 14 }, &sprite_crate, 0 };
@label=movable_item_crate
 $69B7 DEFW $0037,$0036,$000E ; pos: 55, 54, 14
 $69BD DEFW $CE28             ; sprite: sprite_crate
 $69BF DEFB $00               ; index: 0
; struct movable_item stove2 = { { 62, 35, 16 }, &sprite_stove, 0 };
@label=movable_item_stove2
 $69C0 DEFW $003E,$0023,$0010 ; pos: 62, 35, 16
 $69C6 DEFW $CE22             ; sprite: sprite_stove
 $69C8 DEFB $00               ; index: 0

; Reset all non-player visible characters.
;
; Used by the routine at #R$6939.
@label=reset_nonplayer_visible_characters
@nowarn
c$69C9 LD HL,$8020   ; HL = $8020; // iterate over non-player characters
 $69CC LD BC,$0720   ; B = 7; // 7 iterations
*$69CF PUSH BC       ; do <%
 $69D0 PUSH HL
 $69D1 CALL $C5D3    ;   reset_visible_character();
 $69D4 POP HL
 $69D5 POP BC
 $69D6 LD A,L        ; {  HL += 32; // stride
 $69D7 ADD A,C       ;
 $69D8 LD L,A        ; }
 $69D9 DJNZ $69CF    ; %> while (--B);
 $69DB RET           ; return;

; Setup interior doors.
;
; Used by the routine at #R$6A35.
; .
; Used by setup_room only.
;
; .
;
; Wipe interior doors with 0xFF.
@label=setup_doors
c$69DC LD A,$FF
 $69DE LD DE,$81D9   ; DE = interior_doors + 3;
 $69E1 LD B,$04      ; B = 4;
*$69E3 LD (DE),A     ; {do <% *DE-- = door_NONE;
 $69E4 DEC DE        ; }
 $69E5 DJNZ $69E3    ; %> while (--B);
 $69E7 INC DE        ; DE++; // DE = &interior_doors[0];
 $69E8 LD A,($68A0)  ; {B = room_index << 2;
 $69EB ADD A,A       ;
 $69EC ADD A,A       ;
 $69ED LD B,A        ; }
 $69EE LD C,$00      ; {C = 0;
 $69F0 EXX           ; }
 $69F1 LD HL,$78D6   ; HLdash = &doors[0];
 $69F4 LD B,$7C      ; Bdash = 124; // length of doors[]
 $69F6 LD DE,$0004
*$69F9 LD A,(HL)     ; {do <% if ((HLdash[0] & ~doorpos_FLAGS_MASK_DIRECTION) == B) <%
 $69FA EXX
 $69FB AND $FC       ;
 $69FD CP B          ;
 $69FE JR NZ,$6A05   ; }
 $6A00 LD A,C        ; {    *DE++ = C ^ door_REVERSE; %>
 $6A01 XOR $80       ;
 $6A03 LD (DE),A     ;
 $6A04 INC DE        ; }
*$6A05 LD A,C        ; {  C ^= door_REVERSE;
 $6A06 XOR $80       ; }
 $6A08 JP M,$6A0C    ; {  if (C < door_REVERSE) C++; // increment every two stops?
 $6A0B INC A         ;
*$6A0C LD C,A        ;
 $6A0D EXX           ; }
 $6A0E ADD HL,DE     ;   HLdash += 4; %>
 $6A0F DJNZ $69F9    ; while (--Bdash);
 $6A11 RET           ; return;

; Turn a door index into a doorpos pointer.
;
; Used by the routines at #R$B32D, #R$B4D0, #R$C651 and #R$CA81.
;
; I:A  Index of door + lock flag in bit 7.
; O:HL Pointer to doorpos.
; O:DE Corrupted.
@label=get_door
c$6A12 LD C,A        ; {HL = &doors[(A & ~door_REVERSE) * 2]; // are they pairs of doors?
 $6A13 ADD A,A       ;
 $6A14 LD L,A        ;
 $6A15 LD H,$00      ;
 $6A17 ADD HL,HL     ;
 $6A18 ADD HL,HL     ;
 $6A19 LD DE,$78D6   ;
 $6A1C ADD HL,DE     ; }
 $6A1D BIT 7,C       ; {if (A & door_REVERSE) HL += 4; // if locked
 $6A1F RET Z         ;
 $6A20 LD A,L        ;
 $6A21 ADD A,$04     ;
 $6A23 LD L,A        ;
 $6A24 RET NC        ;
 $6A25 INC H         ; }
 $6A26 RET           ; return;

; Wipe the visible tiles array.
;
; Used by the routines at #R$6A35, #R$A50B and #R$AB6B.
@label=wipe_visible_tiles
c$6A27 LD DE,$F0F9   ; {memset($F0F8, 0, 24 * 17);
 $6A2A LD HL,$F0F8   ;
 $6A2D LD BC,$0197   ;
 $6A30 LD (HL),$00   ;
 $6A32 LDIR          ; }
 $6A34 RET           ; return;

; Expand out the room definition for room_index.
;
; Used by the routines at #R$68F4, #R$7B36, #R$9E07, #R$A289, #R$A2E2, #R$A479
; and #R$B3F6.
@label=setup_room
c$6A35 CALL $6A27    ; wipe_visible_tiles();
 $6A38 LD A,($68A0)  ; {HL = rooms_and_tunnels[room_index - 1]; // array starts with room 1
 $6A3B ADD A,A       ;
@isub=LD HL,rooms_and_tunnels - 2
 $6A3C LD HL,$6BAB   ;
 $6A3F ADD A,L       ;
 $6A40 LD L,A        ;
 $6A41 JR NC,$6A44   ;
 $6A43 INC H         ;
*$6A44 LD A,(HL)     ;
 $6A45 INC HL        ;
 $6A46 LD H,(HL)     ;
 $6A47 LD L,A        ; }
 $6A48 PUSH HL
 $6A49 CALL $69DC    ; setup_doors();
 $6A4C POP HL
; Copy boundaries into state.
 $6A4D LD DE,$81BE   ; DE = &roomdef_bounds_index; // room dimensions index
 $6A50 LDI           ; *DE++ = *HL++;
 $6A52 LD A,(HL)     ; A = *HL;
 $6A53 AND A
 $6A54 LD (DE),A     ; *DE = A;
 $6A55 JR NZ,$6A5A   ; if (A == 0) <% // no boundaries
 $6A57 INC HL        ;   HL++; %> // skip to interior mask
 $6A58 JR $6A62      ; else <%
*$6A5A ADD A,A       ; {  memcpy(DE, HL, A * 4 + 1); HL += A * 4 + 1; %> // skip to interior mask
 $6A5B ADD A,A       ;
 $6A5C INC A         ;
 $6A5D LD C,A        ;
 $6A5E LD B,$00      ;
 $6A60 LDIR          ; }
; Copy interior mask into interior_mask_data.
*$6A62 LD DE,$81DA   ; DE = &interior_mask_data;
 $6A65 LD A,(HL)     ; {A = *HL++; // sampled HL=$6E22,$6EF8,$6F38 // count of interior masks}
 $6A66 INC HL        ;
 $6A67 LD (DE),A     ; *DE = A;
 $6A68 AND A
 $6A69 JR Z,$6A8C    ; if (A) <%
 $6A6B INC DE        ;   DE++;
 $6A6C LD B,A        ;   B = A;
*$6A6D PUSH BC       ;   do <%
 $6A6E PUSH HL
 $6A6F LD L,(HL)     ; {    memcpy(DE, &interior_mask_data_source[*HL++], 7);
 $6A70 LD H,$00      ; DE += 7;
 $6A72 LD B,H        ;
 $6A73 LD C,L        ;
 $6A74 ADD HL,HL     ;
 $6A75 ADD HL,HL     ;
 $6A76 ADD HL,HL     ;
 $6A77 AND A         ;
 $6A78 SBC HL,BC     ;
 $6A7A LD BC,$EA7C   ;
 $6A7D ADD HL,BC     ;
 $6A7E LD BC,$0007   ;
 $6A81 LDIR          ; }
 $6A83 LD A,$20      ; {    *DE++ = 32;
 $6A85 LD (DE),A     ;
 $6A86 INC DE        ; }
 $6A87 POP HL
 $6A88 INC HL
 $6A89 POP BC        ;     - %>
 $6A8A DJNZ $6A6D    ;   while (--B); %>
; Plot all objects (as tiles).
*$6A8C LD B,(HL)     ; B = *HL; // count of objects // sample: HL -> $6E25 (room_16_CORRIDOR + 5)
 $6A8D LD A,B        ; {if (B == 0) return;
 $6A8E AND A         ;
 $6A8F RET Z         ; }
 $6A90 INC HL        ; HL++;
*$6A91 PUSH BC       ; do <%
 $6A92 LD C,(HL)     ; {  C = *HL++; // object index
 $6A93 INC HL        ; }
 $6A94 LD A,(HL)     ; {  A = *HL++; // column
 $6A95 INC HL        ; }
 $6A96 PUSH HL
 $6A97 LD L,(HL)     ; {  DE = $F0F8 + *HL * 24 + A; // $F0F8 = visible tiles array (so *HL = row, A = column)
 $6A98 LD H,$00      ;
 $6A9A ADD HL,HL     ;
 $6A9B ADD HL,HL     ;
 $6A9C ADD HL,HL     ;
 $6A9D LD E,L        ;
 $6A9E LD D,H        ;
 $6A9F ADD HL,HL     ;
 $6AA0 ADD HL,DE     ;
 $6AA1 ADD A,L       ;
 $6AA2 LD L,A        ;
 $6AA3 JR NC,$6AA6   ;
 $6AA5 INC H         ;
*$6AA6 LD DE,$F0F8   ;
 $6AA9 ADD HL,DE     ;
 $6AAA EX DE,HL      ; }
 $6AAB LD A,C        ; {  expand_object(C); // pass C as A
 $6AAC CALL $6AB5    ; }
 $6AAF POP HL
 $6AB0 POP BC
 $6AB1 INC HL        ;   HL++; %>
 $6AB2 DJNZ $6A91    ; while (--B);
 $6AB4 RET           ; return;

; Expands RLE-encoded objects to a full set of tile references.
;
; Used by the routine at #R$6A35.
; .
; #TABLE(default)
; { =c2 Each object starts with dimension bytes: }
; { <w> <h>               | width, height }
; { =c2 Which are then followed by a repetition of the following bytes: }
; { <t>                   | emit tile <t> }
; { <0xFF> <64..127> <t>  | emit tile <t> <t+1> <t+2> .. up to 63 times }
; { <0xFF> <128..254> <t> | emit tile <t> up to 126 times }
; { <0xFF> <0xFF>         | emit <0xFF> }
; TABLE#
;
; I:A  Object index.
; I:DE Tile buffer location to expand to.
; O:BC Corrupted.
; O:HL Corrupted.
@label=expand_object
c$6AB5 ADD A,A       ; {HL = interior_object_defs[A];
 $6AB6 LD HL,$7095   ;
 $6AB9 LD C,A        ;
 $6ABA LD B,$00      ;
 $6ABC ADD HL,BC     ;
 $6ABD LD A,(HL)     ;
 $6ABE INC HL        ;
 $6ABF LD H,(HL)     ;
 $6AC0 LD L,A        ; }
 $6AC1 LD B,(HL)     ; {B = *HL++; // width
 $6AC2 INC HL        ; }
 $6AC3 LD C,(HL)     ; {C = *HL++; // height
 $6AC4 INC HL        ; }
 $6AC5 LD A,B        ; {($6AE6 + 1) = B; // self modify (== width)
@isub=LD (expand_object_width + 1),A
 $6AC6 LD ($6AE7),A  ; }
*$6AC9 LD A,(HL)     ; do <% do <% expand: A = *HL;
 $6ACA CP $FF        ; {    if (A == interiorobjecttile_ESCAPE) <%
 $6ACC JR NZ,$6ADE   ; }
 $6ACE INC HL        ;       HL++;
 $6ACF LD A,(HL)     ;       A = *HL;
 $6AD0 CP $FF        ; {      if (A != interiorobjecttile_ESCAPE) <% // FF FF => FF
 $6AD2 JR Z,$6ADE    ; }
 $6AD4 AND $F0       ;         A &= 0xF0;
 $6AD6 CP $80        ; {        if (A >= 128) goto run;
 $6AD8 JR NC,$6AF4   ; }
 $6ADA CP $40        ; {        if (A == 64) goto range; %> %>
 $6ADC JR Z,$6B19    ; }
*$6ADE AND A         ; {    if (A) *DE = A;
 $6ADF JR Z,$6AE2    ;
 $6AE1 LD (DE),A     ; }
*$6AE2 INC HL        ;     HL++;
 $6AE3 INC DE        ;     DE++;
 $6AE4 DJNZ $6AC9    ;   %> while (--B);
@label=expand_object_width
 $6AE6 LD B,$01      ;   B = 1; // self modified
 $6AE8 LD A,$18      ; {  DE += 24 - B;
 $6AEA SUB B         ;
 $6AEB ADD A,E       ;
 $6AEC LD E,A        ;
 $6AED JR NC,$6AF0   ;
 $6AEF INC D         ; }
*$6AF0 DEC C         ; {%> while (--C); // for each row
 $6AF1 JR NZ,$6AC9   ; }
 $6AF3 RET           ; return;
; 128..255 case
@label=run
*$6AF4 LD A,(HL)     ; {A = *HL++ & 0x7F; // run length
 $6AF5 AND $7F       ; }
 $6AF7 EX AF,AF'
 $6AF8 INC HL
 $6AF9 LD A,(HL)     ; Adash = *HL;
 $6AFA EX AF,AF'
*$6AFB EX AF,AF'     ; do <%
 $6AFC AND A         ; {  if (Adash > 0) *DE = Adash;
 $6AFD JR Z,$6B00    ;
 $6AFF LD (DE),A     ; }
*$6B00 INC DE        ;   DE++;
 $6B01 DJNZ $6B12
; Ran out of width.
@isub=LD A,(expand_object_width + 1)
 $6B03 LD A,($6AE7)  ;   LD Adash,($6AE6 + 1)  // Adash = width
 $6B06 LD B,A        ;   B = Adash;
 $6B07 LD A,$18      ; {  DE += 24 - B; // stride // move to next row
 $6B09 SUB B         ;
 $6B0A ADD A,E       ;
 $6B0B LD E,A        ;
 $6B0C JR NC,$6B0F   ;
 $6B0E INC D         ; }
*$6B0F LD A,(HL)     ;   Adash = *HL;
 $6B10 DEC C         ; {  if (--C == 0) return;
 $6B11 RET Z         ; }
*$6B12 EX AF,AF'
 $6B13 DEC A         ; {%> while (--A);
 $6B14 JR NZ,$6AFB   ; }
 $6B16 INC HL        ; HL++;
 $6B17 JR $6AC9      ; goto expand;
; 64..127 case.
@label=range
@rfix-begin
; .
; Bug: This self-modifies the INC A at the end of the loop body, but nothing
; else in the code modifies it! Possible evidence that other encodings (e.g.
; 'DEC A') were attempted.
*$6B19 LD A,$3C      ; A = 60; // opcode of 'INC A'
@nowarn
 $6B1B LD ($6B28),A  ; ($6B28) = A;
@rfix-end
 $6B1E LD A,(HL)     ; {A = *HL++ & 0x0F;
 $6B1F AND $0F       ; }
 $6B21 EX AF,AF'
 $6B22 INC HL
 $6B23 LD A,(HL)     ; Adash = *HL;
 $6B24 EX AF,AF'
*$6B25 EX AF,AF'     ; do <%
 $6B26 LD (DE),A     ; {  *DE++ = Adash;
 $6B27 INC DE        ; }
@label=expand_object_increment
 $6B28 INC A         ;   INC Adash // self modified
 $6B29 DJNZ $6B3B
; Ran out of width.
 $6B2B PUSH AF       ;   PUSH AFdash
@isub=LD A,(expand_object_width + 1)
 $6B2C LD A,($6AE7)  ; {  LD Adash,($6AE6 + 1)  // Adash = width
 $6B2F LD B,A        ; }
 $6B30 LD A,$18      ; {  DE += 24 - Adash; // stride // move to next row
 $6B32 SUB B         ;
 $6B33 ADD A,E       ;
 $6B34 LD E,A        ;
 $6B35 JR NC,$6B38   ;
 $6B37 INC D         ; }
*$6B38 POP AF        ; {  POP AFdash
 $6B39 DEC C         ; }
 $6B3A RET Z         ;   if (--C == 0) return;
*$6B3B EX AF,AF'
 $6B3C DEC A
 $6B3D JR NZ,$6B25   ; %> while (--A);
 $6B3F INC HL        ; HL++;
 $6B40 JR $6AC9      ; goto expand;

; Expand all of the tile indices in the tiles buffer to full tiles in the
; screen buffer.
;
; Used by the routines at #R$68F4, #R$7B36, #R$9E07, #R$A289, #R$A2E2, #R$A479,
; #R$A50B, #R$AB6B and #R$B3F6.
;
; O:A   Corrupted.
; O:BC  Corrupted.
; O:DE  Corrupted.
; O:HL  Corrupted.
; O:A'  Corrupted.
; O:BC' Corrupted.
; O:DE' Corrupted.
; O:HL' Corrupted.
@label=plot_interior_tiles
c$6B42 LD HL,$F290   ; HL = $F290;  // screen buffer start address
 $6B45 LD DE,$F0F8   ; DE = $F0F8;  // visible tiles array
 $6B48 LD C,$10      ; C = 16;      // rows
*$6B4A LD B,$18      ; do <% B = 24; // columns
*$6B4C PUSH HL       ;   do <%
 $6B4D LD A,(DE)     ; {    tileptr = &interior_tiles[*DE];
 $6B4E EXX
 $6B4F LD L,A        ;
 $6B50 LD H,$00      ;
 $6B52 ADD HL,HL     ;
 $6B53 ADD HL,HL     ;
 $6B54 ADD HL,HL     ;
 $6B55 LD DE,$9768   ;
 $6B58 ADD HL,DE     ; }
 $6B59 POP DE        ;     screenptr = HL;
 $6B5A LD BC,$0818   ;     iters = 8; stride = 24;
*$6B5D LD A,(HL)     ; {    do <% *screenptr = *tileptr++;
 $6B5E LD (DE),A     ; }
 $6B5F LD A,C        ; {      screenptr += stride;
 $6B60 ADD A,E       ;
 $6B61 JR NC,$6B64   ;
 $6B63 INC D         ;
*$6B64 LD E,A        ;
 $6B65 INC L         ; }
 $6B66 DJNZ $6B5D    ; {    %> while (--iters);
 $6B68 EXX           ; }
 $6B69 INC DE        ;     DE++;
 $6B6A INC HL        ;     HL++;
 $6B6B DJNZ $6B4C    ;   %> while (--B);
 $6B6D LD A,$A8      ; {  HL += 7 * 24;
 $6B6F ADD A,L       ;
 $6B70 JR NC,$6B73   ;
 $6B72 INC H         ;
*$6B73 LD L,A        ; }
 $6B74 DEC C         ; {%> while (--C);
 $6B75 JP NZ,$6B4A   ; }
 $6B78 RET           ; return;

; Locations of beds.
;
; 6x pointers to bed. These are the beds of active prisoners.
; .
; Note that the top hut has prisoners permanently in bed.
@label=beds
w$6B79 DEFW $6C8A    ; &roomdef_3_hut2_right[29]
 $6B7B DEFW $6C8D    ; &roomdef_3_hut2_right[32]
 $6B7D DEFW $6C90    ; &roomdef_3_hut2_right[35]
 $6B7F DEFW $6CE6    ; &roomdef_5_hut3_right[29]
 $6B81 DEFW $6CE9    ; &roomdef_5_hut3_right[32]
 $6B83 DEFW $6CEC    ; &roomdef_5_hut3_right[35]

; Room dimensions.
;
; Looks like (x1,x0, y1,y0).
; .
; Used only by interior_bounds_check.
; .
; 10x 4-byte structures which are range checked by routine at #R$B29F.
@label=roomdef_bounds
b$6B85 DEFB $42,$1A,$46,$16 ;  66, 26,  70, 22
 $6B89 DEFB $3E,$16,$3A,$1A ;  62, 22,  58, 26
 $6B8D DEFB $36,$1E,$42,$12 ;  54, 30,  66, 18
 $6B91 DEFB $3E,$1E,$3A,$22 ;  62, 30,  58, 34
 $6B95 DEFB $4A,$12,$3E,$1E ;  74, 18,  62, 30
 $6B99 DEFB $38,$32,$64,$0A ;  56, 50, 100, 10
 $6B9D DEFB $68,$06,$38,$32 ; 104,  6,  56, 50
 $6BA1 DEFB $38,$32,$64,$1A ;  56, 50, 100, 26
 $6BA5 DEFB $68,$1C,$38,$32 ; 104, 28,  56, 50
 $6BA9 DEFB $38,$32,$58,$0A ;  56, 50,  88, 10

; Room and tunnel definitions.
;
; Array of pointers to rooms (starting with room 1).
@label=rooms_and_tunnels
w$6BAD DEFW $6C15    ; &roomdef_1_hut1_right,
 $6BAF DEFW $6C47    ; &roomdef_2_hut2_left,
 $6BB1 DEFW $6C6D    ; &roomdef_3_hut2_right,
 $6BB3 DEFW $6C9F    ; &roomdef_4_hut3_left,
 $6BB5 DEFW $6CC9    ; &roomdef_5_hut3_right,
 $6BB7 DEFW $6CFB    ; &roomdef_8_corridor, // room 6 unused
 $6BB9 DEFW $6E32    ; &roomdef_7_corridor,
 $6BBB DEFW $6CFB    ; &roomdef_8_corridor,
 $6BBD DEFW $6D0F    ; &roomdef_9_crate,
 $6BBF DEFW $6D37    ; &roomdef_10_lockpick,
 $6BC1 DEFW $6D70    ; &roomdef_11_papers,
 $6BC3 DEFW $6D94    ; &roomdef_12_corridor,
 $6BC5 DEFW $6DA6    ; &roomdef_13_corridor,
 $6BC7 DEFW $6DBE    ; &roomdef_14_torch,
 $6BC9 DEFW $6DEA    ; &roomdef_15_uniform,
 $6BCB DEFW $6E20    ; &roomdef_16_corridor,
 $6BCD DEFW $6E32    ; &roomdef_7_corridor, // room 17 same defn as room 7
 $6BCF DEFW $6E43    ; &roomdef_18_radio,
 $6BD1 DEFW $6E76    ; &roomdef_19_food,
 $6BD3 DEFW $6EA0    ; &roomdef_20_redcross,
 $6BD5 DEFW $6E20    ; &roomdef_16_corridor, // room 21 same defn as room 16
 $6BD7 DEFW $6ECF    ; &roomdef_22_red_key,
 $6BD9 DEFW $6EF2    ; &roomdef_23_breakfast,
 $6BDB DEFW $6F20    ; &roomdef_24_solitary,
 $6BDD DEFW $6F32    ; &roomdef_25_breakfast,
 $6BDF DEFW $6F5B    ; &roomdef_28_hut1_left, // room 26 unused
 $6BE1 DEFW $6F5B    ; &roomdef_28_hut1_left, // room 27 unused
 $6BE3 DEFW $6F5B    ; &roomdef_28_hut1_left,
; Array of pointers to tunnels.
 $6BE5 DEFW $6F82    ; &roomdef_29_second_tunnel_start,
 $6BE7 DEFW $7024    ; &roomdef_30,
 $6BE9 DEFW $6F9E    ; &roomdef_31,
 $6BEB DEFW $6FD3    ; &roomdef_32,
 $6BED DEFW $6F82    ; &roomdef_29_second_tunnel_start, // room 33 same defn as room 29
 $6BEF DEFW $6FEC    ; &roomdef_34,
 $6BF1 DEFW $7008    ; &roomdef_35,
 $6BF3 DEFW $6FBA    ; &roomdef_36,
 $6BF5 DEFW $6FEC    ; &roomdef_34, // room 37 same defn as 34
 $6BF7 DEFW $7008    ; &roomdef_35, // room 38 same defn as 35
 $6BF9 DEFW $6FD3    ; &roomdef_32, // room 39 same defn as 32
 $6BFB DEFW $7041    ; &roomdef_40,
 $6BFD DEFW $7024    ; &roomdef_30, // room 41 same defn as 30
 $6BFF DEFW $6FD3    ; &roomdef_32, // room 42 same defn as 32
 $6C01 DEFW $6F82    ; &roomdef_29_second_tunnel_start, // room 43 same defn as 29
 $6C03 DEFW $705D    ; &roomdef_44,
 $6C05 DEFW $6FBA    ; &roomdef_36, // room 45 same defn as 36
 $6C07 DEFW $6FBA    ; &roomdef_36, // room 46 same defn as 36
 $6C09 DEFW $6FD3    ; &roomdef_32, // room 47 same defn as 32
 $6C0B DEFW $6FEC    ; &roomdef_34, // room 48 same defn as 34
 $6C0D DEFW $6FBA    ; &roomdef_36, // room 49 same defn as 36
 $6C0F DEFW $7075    ; &roomdef_50_blocked_tunnel,
 $6C11 DEFW $6FD3    ; &roomdef_32, // room 51 same defn as 32
 $6C13 DEFW $7041    ; &roomdef_40, // room 52 same defn as 40

; Room 1: Hut 1, far side.
@label=roomdef_1_hut1_right
b$6C15 DEFB $00                         ; 0
 $6C16 DEFB $03                         ; 3 // count of boundaries
 $6C17 DEFB $36,$44,$17,$22             ; { 54, 68, 23, 34 }, // boundary
 $6C1B DEFB $36,$44,$27,$32             ; { 54, 68, 39, 50 }, // boundary
 $6C1F DEFB $36,$44,$37,$44             ; { 54, 68, 55, 68 }, // boundary
 $6C23 DEFB $04                         ; 4 // count of mask bytes
 $6C24 DEFB $00,$01,$03,$0A             ; [0, 1, 3, 10] // data mask bytes
 $6C28 DEFB $0A                         ; 10 // count of objects
 $6C29 DEFB $02,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_A,         1,  4 },
 $6C2C DEFB $08,$08,$00                 ; { interiorobject_WIDE_WINDOW,                  8,  0 },
 $6C2F DEFB $08,$02,$03                 ; { interiorobject_WIDE_WINDOW,                  2,  3 },
 $6C32 DEFB $17,$0A,$05                 ; { interiorobject_OCCUPIED_BED,                10,  5 },
 $6C35 DEFB $17,$06,$07                 ; { interiorobject_OCCUPIED_BED,                 6,  7 },
 $6C38 DEFB $0F,$0F,$08                 ; { interiorobject_DOOR_FRAME_SW_NE,            15,  8 },
 $6C3B DEFB $18,$12,$05                 ; { interiorobject_ORNATE_WARDROBE_FACING_SW,   18,  5 },
 $6C3E DEFB $18,$14,$06                 ; { interiorobject_ORNATE_WARDROBE_FACING_SW,   20,  6 },
 $6C41 DEFB $09,$02,$09                 ; { interiorobject_EMPTY_BED,                    2,  9 },
 $6C44 DEFB $10,$07,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             7, 10 },

; Room 2: Hut 2, near side.
@label=roomdef_2_hut2_left
b$6C47 DEFB $01                         ; 1
 $6C48 DEFB $02                         ; 2 // count of boundaries
 $6C49 DEFB $30,$40,$2B,$38             ; { 48, 64, 43, 56 }, // boundary
 $6C4D DEFB $18,$26,$1A,$28             ; { 24, 38, 26, 40 }, // boundary
 $6C51 DEFB $02                         ; 2 // count of mask bytes
 $6C52 DEFB $0D,$08                     ; [13, 8] // data mask bytes
 $6C54 DEFB $08                         ; 8 // count of objects
 $6C55 DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6C58 DEFB $08,$06,$02                 ; { interiorobject_WIDE_WINDOW,                  6,  2 },
 $6C5B DEFB $28,$10,$05                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        16,  5 },
 $6C5E DEFB $1E,$04,$05                 ; { interiorobject_STOVE_PIPE,                   4,  5 },
@label=roomdef_2_hut2_left_heros_bed
 $6C61 DEFB $17,$08,$07                 ; { interiorobject_OCCUPIED_BED,                 8,  7 },
 $6C64 DEFB $10,$07,$09                 ; { interiorobject_DOOR_FRAME_NW_SE,             7,  9 },
 $6C67 DEFB $1D,$0B,$0C                 ; { interiorobject_TABLE,                       11, 12 },
 $6C6A DEFB $01,$05,$09                 ; { interiorobject_SMALL_TUNNEL_ENTRANCE,        5,  9 },

; Room 3: Hut 2, far side.
@label=roomdef_3_hut2_right
b$6C6D DEFB $00                         ; 0
 $6C6E DEFB $03                         ; 3 // count of boundaries
 $6C6F DEFB $36,$44,$17,$22             ; { 54, 68, 23, 34 }, // boundary
 $6C73 DEFB $36,$44,$27,$32             ; { 54, 68, 39, 50 }, // boundary
 $6C77 DEFB $36,$44,$37,$44             ; { 54, 68, 55, 68 }, // boundary
 $6C7B DEFB $04                         ; 4 // count of mask bytes
 $6C7C DEFB $00,$01,$03,$0A             ; [0, 1, 3, 10] // data mask bytes
 $6C80 DEFB $0A                         ; 10 // count of objects
 $6C81 DEFB $02,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_A,         1,  4 },
 $6C84 DEFB $08,$08,$00                 ; { interiorobject_WIDE_WINDOW,                  8,  0 },
 $6C87 DEFB $08,$02,$03                 ; { interiorobject_WIDE_WINDOW,                  2,  3 },
@label=roomdef_3_hut2_right_bed_A
 $6C8A DEFB $17,$0A,$05                 ; { interiorobject_OCCUPIED_BED,                10,  5 },
@label=roomdef_3_hut2_right_bed_B
 $6C8D DEFB $17,$06,$07                 ; { interiorobject_OCCUPIED_BED,                 6,  7 },
@label=roomdef_3_hut2_right_bed_C
 $6C90 DEFB $17,$02,$09                 ; { interiorobject_OCCUPIED_BED,                 2,  9 },
 $6C93 DEFB $0B,$10,$05                 ; { interiorobject_CHEST_OF_DRAWERS,            16,  5 },
 $6C96 DEFB $0F,$0F,$08                 ; { interiorobject_DOOR_FRAME_SW_NE,            15,  8 },
 $6C99 DEFB $0A,$12,$05                 ; { interiorobject_SHORT_WARDROBE,              18,  5 },
 $6C9C DEFB $10,$07,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             7, 10 },

; Room 4: Hut 3, near side.
@label=roomdef_4_hut3_left
b$6C9F DEFB $01                         ; 1
 $6CA0 DEFB $02                         ; 2 // count of boundaries
 $6CA1 DEFB $18,$28,$18,$2A             ; { 24, 40, 24, 42 }, // boundary
 $6CA5 DEFB $30,$40,$2B,$38             ; { 48, 64, 43, 56 }, // boundary
 $6CA9 DEFB $03                         ; 3 // count of mask bytes
 $6CAA DEFB $12,$14,$08                 ; [18, 20, 8] // data mask bytes
 $6CAD DEFB $09                         ; 9 // count of objects
 $6CAE DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6CB1 DEFB $28,$10,$05                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        16,  5 },
 $6CB4 DEFB $08,$06,$02                 ; { interiorobject_WIDE_WINDOW,                  6,  2 },
 $6CB7 DEFB $1E,$04,$05                 ; { interiorobject_STOVE_PIPE,                   4,  5 },
 $6CBA DEFB $09,$08,$07                 ; { interiorobject_EMPTY_BED,                    8,  7 },
 $6CBD DEFB $10,$07,$09                 ; { interiorobject_DOOR_FRAME_NW_SE,             7,  9 },
 $6CC0 DEFB $16,$0B,$0B                 ; { interiorobject_CHAIR_FACING_SE,             11, 11 },
 $6CC3 DEFB $19,$0D,$0A                 ; { interiorobject_CHAIR_FACING_SW,             13, 10 },
 $6CC6 DEFB $1F,$0E,$0E                 ; { interiorobject_STUFF,                       14, 14 },

; Room 5: Hut 3, far side.
@label=roomdef_5_hut3_right
b$6CC9 DEFB $00                         ; 0
 $6CCA DEFB $03                         ; 3 // count of boundaries
 $6CCB DEFB $36,$44,$17,$22             ; { 54, 68, 23, 34 }, // boundary
 $6CCF DEFB $36,$44,$27,$32             ; { 54, 68, 39, 50 }, // boundary
 $6CD3 DEFB $36,$44,$37,$44             ; { 54, 68, 55, 68 }, // boundary
 $6CD7 DEFB $04                         ; 4 // count of mask bytes
 $6CD8 DEFB $00,$01,$03,$0A             ; [0, 1, 3, 10] // data mask bytes
 $6CDC DEFB $0A                         ; 10 // count of objects
 $6CDD DEFB $02,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_A,         1,  4 },
 $6CE0 DEFB $08,$08,$00                 ; { interiorobject_WIDE_WINDOW,                  8,  0 },
 $6CE3 DEFB $08,$02,$03                 ; { interiorobject_WIDE_WINDOW,                  2,  3 },
@label=roomdef_5_hut2_right_bed_D
 $6CE6 DEFB $17,$0A,$05                 ; { interiorobject_OCCUPIED_BED,                10,  5 },
@label=roomdef_5_hut2_right_bed_E
 $6CE9 DEFB $17,$06,$07                 ; { interiorobject_OCCUPIED_BED,                 6,  7 },
@label=roomdef_5_hut2_right_bed_F
 $6CEC DEFB $17,$02,$09                 ; { interiorobject_OCCUPIED_BED,                 2,  9 },
 $6CEF DEFB $0F,$0F,$08                 ; { interiorobject_DOOR_FRAME_SW_NE,            15,  8 },
 $6CF2 DEFB $0B,$10,$05                 ; { interiorobject_CHEST_OF_DRAWERS,            16,  5 },
 $6CF5 DEFB $0B,$14,$07                 ; { interiorobject_CHEST_OF_DRAWERS,            20,  7 },
 $6CF8 DEFB $10,$07,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             7, 10 },

; Room 8: Corridor.
@label=roomdef_8_corridor
b$6CFB DEFB $02                         ; 2
 $6CFC DEFB $00                         ; 0 // count of boundaries
 $6CFD DEFB $01                         ; 1 // count of mask bytes
 $6CFE DEFB $09                         ; [9] // data mask bytes
 $6CFF DEFB $05                         ; 5 // count of objects
 $6D00 DEFB $2E,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_B,         3,  6 },
 $6D03 DEFB $26,$0A,$03                 ; { interiorobject_END_DOOR_FRAME_SW_NE,        10,  3 },
 $6D06 DEFB $26,$04,$06                 ; { interiorobject_END_DOOR_FRAME_SW_NE,         4,  6 },
 $6D09 DEFB $10,$05,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             5, 10 },
 $6D0C DEFB $0A,$12,$06                 ; { interiorobject_SHORT_WARDROBE,              18,  6 },

; Room 9: Room with crate.
@label=roomdef_9_crate
b$6D0F DEFB $01                         ; 1
 $6D10 DEFB $01                         ; 1 // count of boundaries
 $6D11 DEFB $3A,$40,$1C,$2A             ; { 58, 64, 28, 42 }, // boundary
 $6D15 DEFB $02                         ; 2 // count of mask bytes
 $6D16 DEFB $04,$15                     ; [4, 21] // data mask bytes
 $6D18 DEFB $0A                         ; 10 // count of objects
 $6D19 DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6D1C DEFB $23,$06,$03                 ; { interiorobject_SMALL_WINDOW,                 6,  3 },
 $6D1F DEFB $21,$09,$04                 ; { interiorobject_SMALL_SHELF,                  9,  4 },
 $6D22 DEFB $24,$0C,$06                 ; { interiorobject_TINY_DOOR_FRAME_NW_SE,       12,  6 },
 $6D25 DEFB $0F,$0D,$0A                 ; { interiorobject_DOOR_FRAME_SW_NE,            13, 10 },
 $6D28 DEFB $20,$10,$06                 ; { interiorobject_TALL_WARDROBE,               16,  6 },
 $6D2B DEFB $0A,$12,$08                 ; { interiorobject_SHORT_WARDROBE,              18,  8 },
 $6D2E DEFB $1A,$03,$06                 ; { interiorobject_CUPBOARD,                     3,  6 },
 $6D31 DEFB $22,$06,$08                 ; { interiorobject_SMALL_CRATE,                  6,  8 },
 $6D34 DEFB $22,$04,$09                 ; { interiorobject_SMALL_CRATE,                  4,  9 },

; Room 10: Room with lockpick.
@label=roomdef_10_lockpick
b$6D37 DEFB $04                         ; 4
 $6D38 DEFB $02                         ; 2 // count of boundaries
 $6D39 DEFB $45,$4B,$20,$36             ; { 69, 75, 32, 54 }, // boundary
 $6D3D DEFB $24,$2F,$30,$3C             ; { 36, 47, 48, 60 }, // boundary
 $6D41 DEFB $03                         ; 3 // count of mask bytes
 $6D42 DEFB $06,$0E,$16                 ; [6, 14, 22] // data mask bytes
 $6D45 DEFB $0E                         ; 14 // count of objects
 $6D46 DEFB $2F,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_B,         1,  4 },
 $6D49 DEFB $0F,$0F,$0A                 ; { interiorobject_DOOR_FRAME_SW_NE,            15, 10 },
 $6D4C DEFB $23,$04,$01                 ; { interiorobject_SMALL_WINDOW,                 4,  1 },
 $6D4F DEFB $35,$02,$03                 ; { interiorobject_KEY_RACK,                     2,  3 },
 $6D52 DEFB $35,$07,$02                 ; { interiorobject_KEY_RACK,                     7,  2 },
 $6D55 DEFB $20,$0A,$02                 ; { interiorobject_TALL_WARDROBE,               10,  2 },
 $6D58 DEFB $2A,$0D,$03                 ; { interiorobject_CUPBOARD_42,                 13,  3 },
 $6D5B DEFB $2A,$0F,$04                 ; { interiorobject_CUPBOARD_42,                 15,  4 },
 $6D5E DEFB $2A,$11,$05                 ; { interiorobject_CUPBOARD_42,                 17,  5 },
 $6D61 DEFB $1D,$0E,$08                 ; { interiorobject_TABLE,                       14,  8 },
 $6D64 DEFB $0B,$12,$08                 ; { interiorobject_CHEST_OF_DRAWERS,            18,  8 },
 $6D67 DEFB $0B,$14,$09                 ; { interiorobject_CHEST_OF_DRAWERS,            20,  9 },
 $6D6A DEFB $22,$06,$05                 ; { interiorobject_SMALL_CRATE,                  6,  5 },
 $6D6D DEFB $1D,$02,$06                 ; { interiorobject_TABLE,                        2,  6 },

; Room 11: Room with papers.
@label=roomdef_11_papers
b$6D70 DEFB $04                         ; 4
 $6D71 DEFB $01                         ; 1 // count of boundaries
 $6D72 DEFB $1B,$2C,$24,$30             ; { 27, 44, 36, 48 }, // boundary
 $6D76 DEFB $01                         ; 1 // count of mask bytes
 $6D77 DEFB $17                         ; [23] // data mask bytes
 $6D78 DEFB $09                         ; 9 // count of objects
 $6D79 DEFB $2F,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_B,         1,  4 },
 $6D7C DEFB $21,$06,$03                 ; { interiorobject_SMALL_SHELF,                  6,  3 },
 $6D7F DEFB $20,$0C,$03                 ; { interiorobject_TALL_WARDROBE,               12,  3 },
 $6D82 DEFB $32,$0A,$03                 ; { interiorobject_TALL_DRAWERS,                10,  3 },
 $6D85 DEFB $0A,$0E,$05                 ; { interiorobject_SHORT_WARDROBE,              14,  5 },
 $6D88 DEFB $26,$02,$02                 ; { interiorobject_END_DOOR_FRAME_SW_NE,         2,  2 },
 $6D8B DEFB $32,$12,$07                 ; { interiorobject_TALL_DRAWERS,                18,  7 },
 $6D8E DEFB $32,$14,$08                 ; { interiorobject_TALL_DRAWERS,                20,  8 },
 $6D91 DEFB $33,$0C,$0A                 ; { interiorobject_DESK,                        12, 10 },

; Room 12: Corridor.
@label=roomdef_12_corridor
b$6D94 DEFB $01                         ; 1
 $6D95 DEFB $00                         ; 0 // count of boundaries
 $6D96 DEFB $02                         ; 2 // count of mask bytes
 $6D97 DEFB $04,$07                     ; [4, 7] // data mask bytes
 $6D99 DEFB $04                         ; 4 // count of objects
 $6D9A DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6D9D DEFB $23,$06,$03                 ; { interiorobject_SMALL_WINDOW,                 6,  3 },
 $6DA0 DEFB $10,$09,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             9, 10 },
 $6DA3 DEFB $0F,$0D,$0A                 ; { interiorobject_DOOR_FRAME_SW_NE,            13, 10 },

; Room 13: Corridor.
@label=roomdef_13_corridor
b$6DA6 DEFB $01                         ; 1
 $6DA7 DEFB $00                         ; 0 // count of boundaries
 $6DA8 DEFB $02                         ; 2 // count of mask bytes
 $6DA9 DEFB $04,$08                     ; [4, 8] // data mask bytes
 $6DAB DEFB $06                         ; 6 // count of objects
 $6DAC DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6DAF DEFB $26,$06,$03                 ; { interiorobject_END_DOOR_FRAME_SW_NE,         6,  3 },
 $6DB2 DEFB $10,$07,$09                 ; { interiorobject_DOOR_FRAME_NW_SE,             7,  9 },
 $6DB5 DEFB $0F,$0D,$0A                 ; { interiorobject_DOOR_FRAME_SW_NE,            13, 10 },
 $6DB8 DEFB $32,$0C,$05                 ; { interiorobject_TALL_DRAWERS,                12,  5 },
 $6DBB DEFB $0B,$0E,$07                 ; { interiorobject_CHEST_OF_DRAWERS,            14,  7 },

; Room 14: Room with torch.
@label=roomdef_14_torch
b$6DBE DEFB $00                         ; 0
 $6DBF DEFB $03                         ; 3 // count of boundaries
 $6DC0 DEFB $36,$44,$16,$20             ; { 54, 68, 22, 32 }, // boundary
 $6DC4 DEFB $3E,$44,$30,$3A             ; { 62, 68, 48, 58 }, // boundary
 $6DC8 DEFB $36,$44,$36,$44             ; { 54, 68, 54, 68 }, // boundary
 $6DCC DEFB $01                         ; 1 // count of mask bytes
 $6DCD DEFB $01                         ; [1] // data mask bytes
 $6DCE DEFB $09                         ; 9 // count of objects
 $6DCF DEFB $02,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_A,         1,  4 },
 $6DD2 DEFB $26,$04,$03                 ; { interiorobject_END_DOOR_FRAME_SW_NE,         4,  3 },
 $6DD5 DEFB $31,$08,$05                 ; { interiorobject_TINY_DRAWERS,                 8,  5 },
 $6DD8 DEFB $09,$0A,$05                 ; { interiorobject_EMPTY_BED,                   10,  5 },
 $6DDB DEFB $0B,$10,$05                 ; { interiorobject_CHEST_OF_DRAWERS,            16,  5 },
 $6DDE DEFB $0A,$12,$05                 ; { interiorobject_SHORT_WARDROBE,              18,  5 },
 $6DE1 DEFB $28,$14,$04                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        20,  4 },
 $6DE4 DEFB $21,$02,$07                 ; { interiorobject_SMALL_SHELF,                  2,  7 },
 $6DE7 DEFB $09,$02,$09                 ; { interiorobject_EMPTY_BED,                    2,  9 },

; Room 15: Room with uniform.
@label=roomdef_15_uniform
b$6DEA DEFB $00                         ; 0
 $6DEB DEFB $04                         ; 4 // count of boundaries
 $6DEC DEFB $36,$44,$16,$20             ; { 54, 68, 22, 32 }, // boundary
 $6DF0 DEFB $36,$44,$36,$44             ; { 54, 68, 54, 68 }, // boundary
 $6DF4 DEFB $3E,$44,$28,$3A             ; { 62, 68, 40, 58 }, // boundary
 $6DF8 DEFB $1E,$28,$38,$43             ; { 30, 40, 56, 67 }, // boundary
 $6DFC DEFB $04                         ; 4 // count of mask bytes
 $6DFD DEFB $01,$05,$0A,$0F             ; [1, 5, 10, 15] // data mask bytes
 $6E01 DEFB $0A                         ; 10 // count of objects
 $6E02 DEFB $02,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_A,         1,  4 },
 $6E05 DEFB $0A,$10,$04                 ; { interiorobject_SHORT_WARDROBE,              16,  4 },
 $6E08 DEFB $09,$0A,$05                 ; { interiorobject_EMPTY_BED,                   10,  5 },
 $6E0B DEFB $31,$08,$05                 ; { interiorobject_TINY_DRAWERS,                 8,  5 },
 $6E0E DEFB $31,$06,$06                 ; { interiorobject_TINY_DRAWERS,                 6,  6 },
 $6E11 DEFB $21,$02,$07                 ; { interiorobject_SMALL_SHELF,                  2,  7 },
 $6E14 DEFB $09,$02,$09                 ; { interiorobject_EMPTY_BED,                    2,  9 },
 $6E17 DEFB $10,$07,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             7, 10 },
 $6E1A DEFB $0F,$0D,$09                 ; { interiorobject_DOOR_FRAME_SW_NE,            13,  9 },
 $6E1D DEFB $1D,$12,$08                 ; { interiorobject_TABLE,                       18,  8 },

; Room 16: Corridor.
@label=roomdef_16_corridor
b$6E20 DEFB $01                         ; 1
 $6E21 DEFB $00                         ; 0 // count of boundaries
 $6E22 DEFB $02                         ; 2 // count of mask bytes
 $6E23 DEFB $04,$07                     ; [4, 7] // data mask bytes
 $6E25 DEFB $04                         ; 4 // count of objects
 $6E26 DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6E29 DEFB $26,$04,$04                 ; { interiorobject_END_DOOR_FRAME_SW_NE,         4,  4 },
 $6E2C DEFB $10,$09,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             9, 10 },
 $6E2F DEFB $0F,$0D,$0A                 ; { interiorobject_DOOR_FRAME_SW_NE,            13, 10 },

; Room 7: Corridor.
@label=roomdef_7_corridor
b$6E32 DEFB $01                         ; 1
 $6E33 DEFB $00                         ; 0 // count of boundaries
 $6E34 DEFB $01                         ; 1 // count of mask bytes
 $6E35 DEFB $04                         ; [4] // data mask bytes
 $6E36 DEFB $04                         ; 4 // count of objects
 $6E37 DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6E3A DEFB $26,$04,$04                 ; { interiorobject_END_DOOR_FRAME_SW_NE,         4,  4 },
 $6E3D DEFB $0F,$0D,$0A                 ; { interiorobject_DOOR_FRAME_SW_NE,            13, 10 },
 $6E40 DEFB $20,$0C,$04                 ; { interiorobject_TALL_WARDROBE,               12,  4 },

; Room 18: Room with radio.
@label=roomdef_18_radio
b$6E43 DEFB $04                         ; 4
 $6E44 DEFB $03                         ; 3 // count of boundaries
 $6E45 DEFB $26,$38,$30,$3C             ; { 38, 56, 48, 60 }, // boundary
 $6E49 DEFB $26,$2E,$27,$3C             ; { 38, 46, 39, 60 }, // boundary
 $6E4D DEFB $16,$20,$30,$3C             ; { 22, 32, 48, 60 }, // boundary
 $6E51 DEFB $05                         ; 5 // count of mask bytes
 $6E52 DEFB $0B,$11,$10,$18,$19         ; [11, 17, 16, 24, 25] // data mask bytes
 $6E57 DEFB $0A                         ; 10 // count of objects
 $6E58 DEFB $2F,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_B,         1,  4 },
 $6E5B DEFB $1A,$01,$04                 ; { interiorobject_CUPBOARD,                     1,  4 },
 $6E5E DEFB $23,$04,$01                 ; { interiorobject_SMALL_WINDOW,                 4,  1 },
 $6E61 DEFB $21,$07,$02                 ; { interiorobject_SMALL_SHELF,                  7,  2 },
 $6E64 DEFB $28,$0A,$01                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        10,  1 },
 $6E67 DEFB $1D,$0C,$07                 ; { interiorobject_TABLE,                       12,  7 },
 $6E6A DEFB $2D,$0C,$09                 ; { interiorobject_MESS_BENCH_SHORT,            12,  9 },
 $6E6D DEFB $1D,$12,$0A                 ; { interiorobject_TABLE,                       18, 10 },
 $6E70 DEFB $30,$10,$0C                 ; { interiorobject_TINY_TABLE,                  16, 12 },
 $6E73 DEFB $10,$05,$07                 ; { interiorobject_DOOR_FRAME_NW_SE,             5,  7 },

; Room 19: Room with food.
@label=roomdef_19_food
b$6E76 DEFB $01                         ; 1
 $6E77 DEFB $01                         ; 1 // count of boundaries
 $6E78 DEFB $34,$40,$2F,$38             ; { 52, 64, 47, 56 }, // boundary
 $6E7C DEFB $01                         ; 1 // count of mask bytes
 $6E7D DEFB $07                         ; [7] // data mask bytes
 $6E7E DEFB $0B                         ; 11 // count of objects
 $6E7F DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6E82 DEFB $23,$06,$03                 ; { interiorobject_SMALL_WINDOW,                 6,  3 },
 $6E85 DEFB $1A,$09,$03                 ; { interiorobject_CUPBOARD,                     9,  3 },
 $6E88 DEFB $2A,$0C,$03                 ; { interiorobject_CUPBOARD_42,                 12,  3 },
 $6E8B DEFB $2A,$0E,$04                 ; { interiorobject_CUPBOARD_42,                 14,  4 },
 $6E8E DEFB $1D,$09,$06                 ; { interiorobject_TABLE,                        9,  6 },
 $6E91 DEFB $21,$03,$05                 ; { interiorobject_SMALL_SHELF,                  3,  5 },
 $6E94 DEFB $34,$03,$07                 ; { interiorobject_SINK,                         3,  7 },
 $6E97 DEFB $0B,$0E,$07                 ; { interiorobject_CHEST_OF_DRAWERS,            14,  7 },
 $6E9A DEFB $28,$10,$05                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        16,  5 },
 $6E9D DEFB $10,$09,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             9, 10 },

; Room 20: Room with red cross parcel.
@label=roomdef_20_redcross
b$6EA0 DEFB $01                         ; 1
 $6EA1 DEFB $02                         ; 2 // count of boundaries
 $6EA2 DEFB $3A,$40,$1A,$2A             ; { 58, 64, 26, 42 }, // boundary
 $6EA6 DEFB $32,$40,$2E,$36             ; { 50, 64, 46, 54 }, // boundary
 $6EAA DEFB $02                         ; 2 // count of mask bytes
 $6EAB DEFB $15,$04                     ; [21, 4] // data mask bytes
 $6EAD DEFB $0B                         ; 11 // count of objects
 $6EAE DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6EB1 DEFB $0F,$0D,$0A                 ; { interiorobject_DOOR_FRAME_SW_NE,            13, 10 },
 $6EB4 DEFB $21,$09,$04                 ; { interiorobject_SMALL_SHELF,                  9,  4 },
 $6EB7 DEFB $1A,$03,$06                 ; { interiorobject_CUPBOARD,                     3,  6 },
 $6EBA DEFB $22,$06,$08                 ; { interiorobject_SMALL_CRATE,                  6,  8 },
 $6EBD DEFB $22,$04,$09                 ; { interiorobject_SMALL_CRATE,                  4,  9 },
 $6EC0 DEFB $1D,$09,$06                 ; { interiorobject_TABLE,                        9,  6 },
 $6EC3 DEFB $20,$0E,$05                 ; { interiorobject_TALL_WARDROBE,               14,  5 },
 $6EC6 DEFB $20,$10,$06                 ; { interiorobject_TALL_WARDROBE,               16,  6 },
 $6EC9 DEFB $18,$12,$08                 ; { interiorobject_ORNATE_WARDROBE_FACING_SW,   18,  8 },
 $6ECC DEFB $30,$0B,$08                 ; { interiorobject_TINY_TABLE,                  11,  8 },

; Room 22: Room with red key.
@label=roomdef_22_red_key
b$6ECF DEFB $03                         ; 3
 $6ED0 DEFB $02                         ; 2 // count of boundaries
 $6ED1 DEFB $36,$40,$2E,$38             ; { 54, 64, 46, 56 }, // boundary
 $6ED5 DEFB $3A,$40,$24,$2C             ; { 58, 64, 36, 44 }, // boundary
 $6ED9 DEFB $02                         ; 2 // count of mask bytes
 $6EDA DEFB $0C,$15                     ; [12, 21] // data mask bytes
 $6EDC DEFB $07                         ; 7 // count of objects
 $6EDD DEFB $29,$05,$06                 ; { interiorobject_ROOM_OUTLINE_15x8,            5,  6 },
 $6EE0 DEFB $25,$04,$04                 ; { interiorobject_NOTICEBOARD,                  4,  4 },
 $6EE3 DEFB $21,$09,$04                 ; { interiorobject_SMALL_SHELF,                  9,  4 },
 $6EE6 DEFB $22,$06,$08                 ; { interiorobject_SMALL_CRATE,                  6,  8 },
 $6EE9 DEFB $10,$09,$08                 ; { interiorobject_DOOR_FRAME_NW_SE,             9,  8 },
 $6EEC DEFB $1D,$09,$06                 ; { interiorobject_TABLE,                        9,  6 },
 $6EEF DEFB $28,$0E,$04                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        14,  4 },

; Room 23: Breakfast room.
@label=roomdef_23_breakfast
b$6EF2 DEFB $00                         ; 0
 $6EF3 DEFB $01                         ; 1 // count of boundaries
 $6EF4 DEFB $36,$44,$22,$44             ; { 54, 68, 34, 68 }, // boundary
 $6EF8 DEFB $02                         ; 2 // count of mask bytes
 $6EF9 DEFB $0A,$03                     ; [10, 3] // data mask bytes
 $6EFB DEFB $0C                         ; 12 // count of objects
 $6EFC DEFB $02,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_A,         1,  4 },
 $6EFF DEFB $23,$08,$00                 ; { interiorobject_SMALL_WINDOW,                 8,  0 },
 $6F02 DEFB $23,$02,$03                 ; { interiorobject_SMALL_WINDOW,                 2,  3 },
 $6F05 DEFB $10,$07,$0A                 ; { interiorobject_DOOR_FRAME_NW_SE,             7, 10 },
 $6F08 DEFB $2C,$05,$04                 ; { interiorobject_MESS_TABLE,                   5,  4 },
 $6F0B DEFB $2A,$12,$04                 ; { interiorobject_CUPBOARD_42,                 18,  4 },
 $6F0E DEFB $28,$14,$04                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        20,  4 },
 $6F11 DEFB $0F,$0F,$08                 ; { interiorobject_DOOR_FRAME_SW_NE,            15,  8 },
 $6F14 DEFB $2B,$07,$06                 ; { interiorobject_MESS_BENCH,                   7,  6 },
@label=roomdef_23_breakfast_bench_A
 $6F17 DEFB $0D,$0C,$05                 ; { interiorobject_EMPTY_BENCH,                 12,  5 },
@label=roomdef_23_breakfast_bench_B
 $6F1A DEFB $0D,$0A,$06                 ; { interiorobject_EMPTY_BENCH,                 10,  6 },
@label=roomdef_23_breakfast_bench_C
 $6F1D DEFB $0D,$08,$07                 ; { interiorobject_EMPTY_BENCH,                  8,  7 },

; Room 24: Solitary confinement cell.
@label=roomdef_24_solitary
b$6F20 DEFB $03                         ; 3
 $6F21 DEFB $01                         ; 1 // count of boundaries
 $6F22 DEFB $30,$36,$26,$2E             ; { 48, 54, 38, 46 }, // boundary
 $6F26 DEFB $01                         ; 1 // count of mask bytes
 $6F27 DEFB $1A                         ; [26] // data mask bytes
 $6F28 DEFB $03                         ; 3 // count of objects
 $6F29 DEFB $29,$05,$06                 ; { interiorobject_ROOM_OUTLINE_15x8,            5,  6 },
 $6F2C DEFB $28,$0E,$04                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        14,  4 },
 $6F2F DEFB $30,$0A,$09                 ; { interiorobject_TINY_TABLE,                  10,  9 },

; Room 25: Breakfast room.
@label=roomdef_25_breakfast
b$6F32 DEFB $00                         ; 0
 $6F33 DEFB $01                         ; 1 // count of boundaries
 $6F34 DEFB $36,$44,$22,$44             ; { 54, 68, 34, 68 }, // boundary
 $6F38 DEFB $00                         ; 0 // count of mask bytes
 $6F39 DEFB $0B                         ; 11 // count of objects
 $6F3A DEFB $02,$01,$04                 ; { interiorobject_ROOM_OUTLINE_22x12_A,         1,  4 },
 $6F3D DEFB $23,$08,$00                 ; { interiorobject_SMALL_WINDOW,                 8,  0 },
 $6F40 DEFB $1A,$05,$03                 ; { interiorobject_CUPBOARD,                     5,  3 },
 $6F43 DEFB $23,$02,$03                 ; { interiorobject_SMALL_WINDOW,                 2,  3 },
 $6F46 DEFB $28,$12,$03                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        18,  3 },
 $6F49 DEFB $2C,$05,$04                 ; { interiorobject_MESS_TABLE,                   5,  4 },
 $6F4C DEFB $2B,$07,$06                 ; { interiorobject_MESS_BENCH,                   7,  6 },
@label=roomdef_25_breakfast_bench_D
 $6F4F DEFB $0D,$0C,$05                 ; { interiorobject_EMPTY_BENCH,                 12,  5 },
@label=roomdef_25_breakfast_bench_E
 $6F52 DEFB $0D,$0A,$06                 ; { interiorobject_EMPTY_BENCH,                 10,  6 },
@label=roomdef_25_breakfast_bench_F
 $6F55 DEFB $0D,$08,$07                 ; { interiorobject_EMPTY_BENCH,                  8,  7 },
@label=roomdef_25_breakfast_bench_G
 $6F58 DEFB $0D,$0E,$04                 ; { interiorobject_EMPTY_BENCH,                 14,  4 },

; Room 28: Hut 1, near side.
@label=roomdef_28_hut1_left
b$6F5B DEFB $01                         ; 1
 $6F5C DEFB $02                         ; 2 // count of boundaries
 $6F5D DEFB $1C,$28,$1C,$34             ; { 28, 40, 28, 52 }, // boundary
 $6F61 DEFB $30,$3F,$2C,$38             ; { 48, 63, 44, 56 }, // boundary
 $6F65 DEFB $03                         ; 3 // count of mask bytes
 $6F66 DEFB $08,$0D,$13                 ; [8, 13, 19] // data mask bytes
 $6F69 DEFB $08                         ; 8 // count of objects
 $6F6A DEFB $1B,$03,$06                 ; { interiorobject_ROOM_OUTLINE_18x10_A,         3,  6 },
 $6F6D DEFB $08,$06,$02                 ; { interiorobject_WIDE_WINDOW,                  6,  2 },
 $6F70 DEFB $28,$0E,$04                 ; { interiorobject_END_DOOR_FRAME_NW_SE,        14,  4 },
 $6F73 DEFB $1A,$03,$06                 ; { interiorobject_CUPBOARD,                     3,  6 },
 $6F76 DEFB $17,$08,$07                 ; { interiorobject_OCCUPIED_BED,                 8,  7 },
 $6F79 DEFB $10,$07,$09                 ; { interiorobject_DOOR_FRAME_NW_SE,             7,  9 },
 $6F7C DEFB $19,$0F,$0A                 ; { interiorobject_CHAIR_FACING_SW,             15, 10 },
 $6F7F DEFB $1D,$0B,$0C                 ; { interiorobject_TABLE,                       11, 12 },

; Room 29: Start of second tunnel.
@label=roomdef_29_second_tunnel_start
b$6F82 DEFB $05                         ; 5
 $6F83 DEFB $00                         ; 0 // count of boundaries
 $6F84 DEFB $06                         ; 6 // count of mask bytes
 $6F85 DEFB $1E,$1F,$20,$21,$22,$23     ; [30, 31, 32, 33, 34, 35] // data mask bytes
 $6F8B DEFB $06                         ; 6 // count of objects
 $6F8C DEFB $00,$14,$00                 ; { interiorobject_TUNNEL_SW_NE,                20,  0 },
 $6F8F DEFB $00,$10,$02                 ; { interiorobject_TUNNEL_SW_NE,                16,  2 },
 $6F92 DEFB $00,$0C,$04                 ; { interiorobject_TUNNEL_SW_NE,                12,  4 },
 $6F95 DEFB $00,$08,$06                 ; { interiorobject_TUNNEL_SW_NE,                 8,  6 },
 $6F98 DEFB $00,$04,$08                 ; { interiorobject_TUNNEL_SW_NE,                 4,  8 },
 $6F9B DEFB $00,$00,$0A                 ; { interiorobject_TUNNEL_SW_NE,                 0, 10 },

; Room 31.
@label=roomdef_31
b$6F9E DEFB $06                         ; 6
 $6F9F DEFB $00                         ; 0 // count of boundaries
 $6FA0 DEFB $06                         ; 6 // count of mask bytes
 $6FA1 DEFB $24,$25,$26,$27,$28,$29     ; [36, 37, 38, 39, 40, 41] // data mask bytes
 $6FA7 DEFB $06                         ; 6 // count of objects
 $6FA8 DEFB $03,$00,$00                 ; { interiorobject_TUNNEL_NW_SE,                 0,  0 },
 $6FAB DEFB $03,$04,$02                 ; { interiorobject_TUNNEL_NW_SE,                 4,  2 },
 $6FAE DEFB $03,$08,$04                 ; { interiorobject_TUNNEL_NW_SE,                 8,  4 },
 $6FB1 DEFB $03,$0C,$06                 ; { interiorobject_TUNNEL_NW_SE,                12,  6 },
 $6FB4 DEFB $03,$10,$08                 ; { interiorobject_TUNNEL_NW_SE,                16,  8 },
 $6FB7 DEFB $03,$14,$0A                 ; { interiorobject_TUNNEL_NW_SE,                20, 10 },

; Room 36.
@label=roomdef_36
b$6FBA DEFB $07                         ; 7
 $6FBB DEFB $00                         ; 0 // count of boundaries
 $6FBC DEFB $06                         ; 6 // count of mask bytes
 $6FBD DEFB $1F,$20,$21,$22,$23,$2D     ; [31, 32, 33, 34, 35, 45] // data mask
                                        ; bytes
 $6FC3 DEFB $05                         ; 5 // count of objects
 $6FC4 DEFB $00,$14,$00                 ; { interiorobject_TUNNEL_SW_NE,                20,  0 },
 $6FC7 DEFB $00,$10,$02                 ; { interiorobject_TUNNEL_SW_NE,                16,  2 },
 $6FCA DEFB $00,$0C,$04                 ; { interiorobject_TUNNEL_SW_NE,                12,  4 },
 $6FCD DEFB $00,$08,$06                 ; { interiorobject_TUNNEL_SW_NE,                 8,  6 },
 $6FD0 DEFB $0E,$04,$08                 ; { interiorobject_TUNNEL_14,                    4,  8 },

; Room 32.
@label=roomdef_32
b$6FD3 DEFB $08                         ; 8
 $6FD4 DEFB $00                         ; 0 // count of boundaries
 $6FD5 DEFB $06                         ; 6 // count of mask bytes
 $6FD6 DEFB $24,$25,$26,$27,$28,$2A     ; [36, 37, 38, 39, 40, 42] // data mask bytes
 $6FDC DEFB $05                         ; 5 // count of objects
 $6FDD DEFB $03,$00,$00                 ; { interiorobject_TUNNEL_NW_SE,                 0,  0 },
 $6FE0 DEFB $03,$04,$02                 ; { interiorobject_TUNNEL_NW_SE,                 4,  2 },
 $6FE3 DEFB $03,$08,$04                 ; { interiorobject_TUNNEL_NW_SE,                 8,  4 },
 $6FE6 DEFB $03,$0C,$06                 ; { interiorobject_TUNNEL_NW_SE,                12,  6 },
 $6FE9 DEFB $11,$10,$08                 ; { interiorobject_TUNNEL_17,                   16,  8 },

; Room 34.
@label=roomdef_34
b$6FEC DEFB $06                         ; 6
 $6FED DEFB $00                         ; 0 // count of boundaries
 $6FEE DEFB $06                         ; 6 // count of mask bytes
 $6FEF DEFB $24,$25,$26,$27,$28,$2E     ; [36, 37, 38, 39, 40, 46] // data mask
                                        ; bytes
 $6FF5 DEFB $06                         ; 6 // count of objects
 $6FF6 DEFB $03,$00,$00                 ; { interiorobject_TUNNEL_NW_SE,                 0,  0 },
 $6FF9 DEFB $03,$04,$02                 ; { interiorobject_TUNNEL_NW_SE,                 4,  2 },
 $6FFC DEFB $03,$08,$04                 ; { interiorobject_TUNNEL_NW_SE,                 8,  4 },
 $6FFF DEFB $03,$0C,$06                 ; { interiorobject_TUNNEL_NW_SE,                12,  6 },
 $7002 DEFB $03,$10,$08                 ; { interiorobject_TUNNEL_NW_SE,                16,  8 },
 $7005 DEFB $12,$14,$0A                 ; { interiorobject_TUNNEL_JOIN_18,              20, 10 },

; Room 35.
@label=roomdef_35
b$7008 DEFB $06                         ; 6
 $7009 DEFB $00                         ; 0 // count of boundaries
 $700A DEFB $06                         ; 6 // count of mask bytes
 $700B DEFB $24,$25,$26,$27,$28,$29     ; [36, 37, 38, 39, 40, 41] // data mask bytes
 $7011 DEFB $06                         ; 6 // count of objects
 $7012 DEFB $03,$00,$00                 ; { interiorobject_TUNNEL_NW_SE,                 0,  0 },
 $7015 DEFB $03,$04,$02                 ; { interiorobject_TUNNEL_NW_SE,                 4,  2 },
 $7018 DEFB $04,$08,$04                 ; { interiorobject_TUNNEL_T_JOIN_NW_SE,          8,  4 },
 $701B DEFB $03,$0C,$06                 ; { interiorobject_TUNNEL_NW_SE,                12,  6 },
 $701E DEFB $03,$10,$08                 ; { interiorobject_TUNNEL_NW_SE,                16,  8 },
 $7021 DEFB $03,$14,$0A                 ; { interiorobject_TUNNEL_NW_SE,                20, 10 },

; Room 30.
@label=roomdef_30
b$7024 DEFB $05                         ; 5
 $7025 DEFB $00                         ; 0 // count of boundaries
 $7026 DEFB $07                         ; 7 // count of mask bytes
 $7027 DEFB $1E,$1F,$20,$21,$22,$23,$2C ; [30, 31, 32, 33, 34, 35, 44] // data mask bytes
 $702E DEFB $06                         ; 6 // count of objects
 $702F DEFB $00,$14,$00                 ; { interiorobject_TUNNEL_SW_NE,                20,  0 },
 $7032 DEFB $00,$10,$02                 ; { interiorobject_TUNNEL_SW_NE,                16,  2 },
 $7035 DEFB $00,$0C,$04                 ; { interiorobject_TUNNEL_SW_NE,                12,  4 },
 $7038 DEFB $06,$08,$06                 ; { interiorobject_TUNNEL_CORNER_6,              8,  6 },
 $703B DEFB $00,$04,$08                 ; { interiorobject_TUNNEL_SW_NE,                 4,  8 },
 $703E DEFB $00,$00,$0A                 ; { interiorobject_TUNNEL_SW_NE,                 0, 10 },

; Room 40.
@label=roomdef_40
b$7041 DEFB $09                         ; 9
 $7042 DEFB $00                         ; 0 // count of boundaries
 $7043 DEFB $06                         ; 6 // count of mask bytes
 $7044 DEFB $1E,$1F,$20,$21,$22,$2B     ; [30, 31, 32, 33, 34, 43] // data mask bytes
 $704A DEFB $06                         ; 6 // count of objects
 $704B DEFB $07,$14,$00                 ; { interiorobject_TUNNEL_CORNER_7,             20,  0 },
 $704E DEFB $00,$10,$02                 ; { interiorobject_TUNNEL_SW_NE,                16,  2 },
 $7051 DEFB $00,$0C,$04                 ; { interiorobject_TUNNEL_SW_NE,                12,  4 },
 $7054 DEFB $00,$08,$06                 ; { interiorobject_TUNNEL_SW_NE,                 8,  6 },
 $7057 DEFB $00,$04,$08                 ; { interiorobject_TUNNEL_SW_NE,                 4,  8 },
 $705A DEFB $00,$00,$0A                 ; { interiorobject_TUNNEL_SW_NE,                 0, 10 },

; Room 44.
@label=roomdef_44
b$705D DEFB $08                         ; 8
 $705E DEFB $00                         ; 0 // count of boundaries
 $705F DEFB $05                         ; 5 // count of mask bytes
 $7060 DEFB $24,$25,$26,$27,$28         ; [36, 37, 38, 39, 40] // data mask bytes
 $7065 DEFB $05                         ; 5 // count of objects
 $7066 DEFB $03,$00,$00                 ; { interiorobject_TUNNEL_NW_SE,                 0,  0 },
 $7069 DEFB $03,$04,$02                 ; { interiorobject_TUNNEL_NW_SE,                 4,  2 },
 $706C DEFB $03,$08,$04                 ; { interiorobject_TUNNEL_NW_SE,                 8,  4 },
 $706F DEFB $03,$0C,$06                 ; { interiorobject_TUNNEL_NW_SE,                12,  6 },
 $7072 DEFB $0C,$10,$08                 ; { interiorobject_TUNNEL_CORNER_NW_NE,         16,  8 },

; Room 50: Blocked tunnel.
@label=roomdef_50_blocked_tunnel
b$7075 DEFB $05                         ; 5
 $7076 DEFB $01                         ; 1 // count of boundaries
@label=roomdef_50_blocked_tunnel_boundary
 $7077 DEFB $34,$3A,$20,$36             ; { 52, 58, 32, 54 }, // boundary
 $707B DEFB $06                         ; 6 // count of mask bytes
 $707C DEFB $1E,$1F,$20,$21,$22,$2B     ; [30, 31, 32, 33, 34, 43] // data mask bytes
 $7082 DEFB $06                         ; 6 // count of objects
 $7083 DEFB $07,$14,$00                 ; { interiorobject_TUNNEL_CORNER_7,             20,  0 },
 $7086 DEFB $00,$10,$02                 ; { interiorobject_TUNNEL_SW_NE,                16,  2 },
 $7089 DEFB $00,$0C,$04                 ; { interiorobject_TUNNEL_SW_NE,                12,  4 },
@label=roomdef_50_blocked_tunnel_collapsed_tunnel
 $708C DEFB $14,$08,$06                 ; { interiorobject_COLLAPSED_TUNNEL_SW_NE,       8,  6 },
 $708F DEFB $00,$04,$08                 ; { interiorobject_TUNNEL_SW_NE,                 4,  8 },
 $7092 DEFB $00,$00,$0A                 ; { interiorobject_TUNNEL_SW_NE,                 0, 10 },

; Interior object definitions.
@label=interior_object_defs
b$7095 DEFW $7101    ; {Array of pointer to interior object definitions, 54
 $7097 DEFW $711B    ; entries long (== number of interior objects).
 $7099 DEFW $721A
 $709B DEFW $7121
 $709D DEFW $713B
 $709F DEFW $7155
 $70A1 DEFW $715A
 $70A3 DEFW $7174
 $70A5 DEFW $728E
 $70A7 DEFW $72AE
 $70A9 DEFW $72C1
 $70AB DEFW $72CC
 $70AD DEFW $718E
 $70AF DEFW $71A6
 $70B1 DEFW $71AB
 $70B3 DEFW $72D1
 $70B5 DEFW $72EB
 $70B7 DEFW $71C4
 $70B9 DEFW $71DE
 $70BB DEFW $71F8
 $70BD DEFW $7200
 $70BF DEFW $721A
 $70C1 DEFW $7305
 $70C3 DEFW $730F
 $70C5 DEFW $7325
 $70C7 DEFW $7333
 $70C9 DEFW $733C
 $70CB DEFW $75B0
 $70CD DEFW $7342
 $70CF DEFW $7342
 $70D1 DEFW $734B
 $70D3 DEFW $7359
 $70D5 DEFW $735C
 $70D7 DEFW $736A
 $70D9 DEFW $736F
 $70DB DEFW $7374
 $70DD DEFW $7385
 $70DF DEFW $7393
 $70E1 DEFW $73A5
 $70E3 DEFW $73BF
 $70E5 DEFW $73BF
 $70E7 DEFW $73D9
 $70E9 DEFW $7425
 $70EB DEFW $742D
 $70ED DEFW $7452
 $70EF DEFW $7482
 $70F1 DEFW $7493
 $70F3 DEFW $74F5
 $70F5 DEFW $7570
 $70F7 DEFW $7576
 $70F9 DEFW $757E
 $70FB DEFW $7588
 $70FD DEFW $75A2
 $70FF DEFW $75AA    ; }

; Room object 0: Straight tunnel section SW-NE
@label=interior_object_tile_refs_0
b$7101 DEFB $04             ; width
 $7102 DEFB $06             ; height
 $7103 DEFB $00,$00,$00,$02 ; {tile references
 $7107 DEFB $03,$02,$04,$05
 $710B DEFB $08,$0F,$09,$0A
 $710F DEFB $06,$07,$0E,$0C
 $7113 DEFB $0E,$0B,$0D,$00
 $7117 DEFB $0D,$00,$00,$00 ; }
; #HTML[#CALL:decode_object($7101, 0)]

; Room object 1: Small tunnel entrance
@label=interior_object_tile_refs_1
b$711B DEFB $02      ; width
 $711C DEFB $02      ; height
 $711D DEFB $B6,$00  ; {tile references
 $711F DEFB $B7,$B5  ; }
; #HTML[#CALL:decode_object($711B, 1)]

; Room object 3: Straight tunnel section NW-SE
@label=interior_object_tile_refs_3
b$7121 DEFB $04             ; width
 $7122 DEFB $06             ; height
 $7123 DEFB $02,$00,$00,$00 ; {tile references
 $7127 DEFB $11,$12,$02,$00
 $712B DEFB $15,$16,$17,$08
 $712F DEFB $18,$0E,$07,$19
 $7133 DEFB $00,$13,$1A,$0E
 $7137 DEFB $00,$00,$00,$13 ; }
; #HTML[#CALL:decode_object($7121, 3)]

; Room object 4: Tunnel T-join section NW-SE
@label=interior_object_tile_refs_4
b$713B DEFB $04             ; width
 $713C DEFB $06             ; height
 $713D DEFB $02,$00,$00,$00 ; {tile references
 $7141 DEFB $11,$12,$04,$05
 $7145 DEFB $15,$16,$09,$0A
 $7149 DEFB $18,$0E,$07,$0C
 $714D DEFB $00,$13,$1A,$0E
 $7151 DEFB $00,$00,$00,$13 ; }
; #HTML[#CALL:decode_object($713B, 4)]

; Room object 5: Prisoner sat mid table
@label=interior_object_tile_refs_5
b$7155 DEFB $02         ; width
 $7156 DEFB $03         ; height
 $7157 DEFB $FF,$46,$B8 ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($7155, 5)]

; Room object 6: Tunnel T-join section SW-NE
@label=interior_object_tile_refs_6
b$715A DEFB $04             ; width
 $715B DEFB $06             ; height
 $715C DEFB $00,$00,$03,$02 ; {tile references
 $7160 DEFB $00,$02,$04,$05
 $7164 DEFB $08,$0F,$09,$0A
 $7168 DEFB $11,$12,$0E,$0C
 $716C DEFB $15,$16,$0D,$00
 $7170 DEFB $18,$0E,$00,$00 ; }
; #HTML[#CALL:decode_object($715A, 6)]

; Room object 7: Tunnel corner section SW-SE
@label=interior_object_tile_refs_7
b$7174 DEFB $04             ; width
 $7175 DEFB $06             ; height
 $7176 DEFB $00,$00,$02,$17 ; {tile references
 $717A DEFB $00,$08,$0F,$02
 $717E DEFB $08,$0F,$18,$08
 $7182 DEFB $11,$12,$07,$16
 $7186 DEFB $15,$16,$0D,$00
 $718A DEFB $18,$0E,$00,$00 ; }
; #HTML[#CALL:decode_object($7174, 7)]

; Room object 12: Tunnel corner section NW-NE
@label=interior_object_tile_refs_12
b$718E DEFB $04                             ; width
 $718F DEFB $06                             ; height
 $7190 DEFB $02,$00,$00,$00,$11,$12,$04,$05 ; {tile references (incl. RLE)
 $7198 DEFB $15,$16,$09,$0A,$18,$0E,$07,$0C
 $71A0 DEFB $00,$13,$0D,$FF,$85,$00         ; }
; #HTML[#CALL:decode_object($718E, 12)]

; Room object 13: Empty bench
@label=interior_object_tile_refs_13
b$71A6 DEFB $02         ; width
 $71A7 DEFB $03         ; height
 $71A8 DEFB $FF,$86,$00 ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($71A6, 13)]

; Room object 14: Tunnel corner section NE-SE
@label=interior_object_tile_refs_14
b$71AB DEFB $04                             ; width
 $71AC DEFB $06                             ; height
 $71AD DEFB $00,$00,$03,$02,$00,$02,$04,$05 ; {tile references (incl. RLE)
 $71B5 DEFB $08,$0F,$1D,$12,$09,$07,$15,$16
 $71BD DEFB $00,$13,$18,$07,$FF,$84,$00     ; }
; #HTML[#CALL:decode_object($71AB, 14)]

; Room object 17: Tunnel corner section NW-SW
@label=interior_object_tile_refs_17
b$71C4 DEFB $04             ; width
 $71C5 DEFB $06             ; height
 $71C6 DEFB $08,$02,$00,$00 ; {tile references
 $71CA DEFB $11,$12,$08,$00
 $71CE DEFB $04,$1C,$17,$0F
 $71D2 DEFB $09,$0A,$07,$16
 $71D6 DEFB $07,$0C,$0D,$00
 $71DA DEFB $0D,$00,$00,$00 ; }
; #HTML[#CALL:decode_object($71C4, 17)]

; Room object 18: Tunnel entrance
@label=interior_object_tile_refs_18
b$71DE DEFB $04             ; width
 $71DF DEFB $06             ; height
 $71E0 DEFB $02,$00,$00,$00 ; {tile references
 $71E4 DEFB $11,$12,$04,$05
 $71E8 DEFB $04,$1C,$1D,$12
 $71EC DEFB $09,$0A,$07,$0C
 $71F0 DEFB $00,$0C,$0D,$00
 $71F4 DEFB $00,$00,$00,$00 ; }
; #HTML[#CALL:decode_object($71DE, 18)]

; Room object 19: Prisoner sat end table
@label=interior_object_tile_refs_19
b$71F8 DEFB $02      ; width
 $71F9 DEFB $03      ; height
 $71FA DEFB $BE,$BF  ; {tile references
 $71FC DEFB $BA,$C0
 $71FE DEFB $BC,$C1  ; }
; #HTML[#CALL:decode_object($71F8, 19)]

; Room object 20: Collapsed tunnel section SW-NE
@label=interior_object_tile_refs_20
b$7200 DEFB $04                             ; width
 $7201 DEFB $06                             ; height
 $7202 DEFB $00,$00,$00                     ; tile references (incl. RLE)
 $7205 DEFB $02,$00,$02,$1E,$05,$1B,$22,$22
 $720D DEFB $24,$21,$22,$22,$23,$1F,$20,$0D
 $7215 DEFB $00,$0D,$00,$00,$00
; #HTML[#CALL:decode_object($7200, 20)]

; Room object 2: Room outline 22x12 A
@label=interior_object_tile_refs_2
b$721A DEFB $16                             ; width
 $721B DEFB $0C                             ; height
 $721C DEFB $FF,$8B,$00,$32,$36,$FF,$92,$00 ; {tile references (incl. RLE)
 $7224 DEFB $32,$25,$34,$37,$35,$36,$FF,$8E
 $722C DEFB $00,$32,$25,$34,$FF,$84,$00,$37
 $7234 DEFB $35,$36,$FF,$8A,$00,$32,$25,$34
 $723C DEFB $FF,$88,$00,$37,$35,$36,$FF,$86
 $7244 DEFB $00,$32,$25,$34,$FF,$8C,$00,$37
 $724C DEFB $35,$36,$00,$00,$32,$25,$34,$FF
 $7254 DEFB $90,$00,$37,$35,$25,$34,$FF,$92
 $725C DEFB $00,$39,$0D,$13,$3A,$FF,$90,$00
 $7264 DEFB $39,$0D,$FF,$84,$00,$13,$3A,$FF
 $726C DEFB $8C,$00,$39,$0D,$FF,$88,$00,$13
 $7274 DEFB $3A,$FF,$88,$00,$39,$0D,$FF,$8C
 $727C DEFB $00,$13,$3A,$FF,$84,$00,$39,$0D
 $7284 DEFB $FF,$90,$00,$13,$3A,$39,$0D,$FF
 $728C DEFB $8A,$00                         ; }
; #HTML[#CALL:decode_object($721A, 2)]

; Room object 8: Wide window facing SE
@label=interior_object_tile_refs_8
b$728E DEFB $05                 ; width
 $728F DEFB $06                 ; height
 $7290 DEFB $00,$00,$00,$32,$36 ; {tile references
 $7295 DEFB $00,$32,$25,$26,$27
 $729A DEFB $25,$26,$2A,$29,$27
 $729F DEFB $28,$29,$2B,$2C,$2D
 $72A4 DEFB $31,$2C,$30,$2F,$00
 $72A9 DEFB $2E,$2F,$00,$00,$00 ; }
; #HTML[#CALL:decode_object($728E, 8)]

; Room object 9: Empty bed facing SE
@label=interior_object_tile_refs_9
b$72AE DEFB $05                             ; width
 $72AF DEFB $04                             ; height
 $72B0 DEFB $3E,$3F,$40,$00,$00,$FF,$45,$41 ; {tile references (incl. RLE)
 $72B8 DEFB $00,$FF,$44,$46,$00,$00,$00,$4A
 $72C0 DEFB $00                             ; }
; #HTML[#CALL:decode_object($72AE, 9)]

; Room object 10: Short wardrobe facing SW
@label=interior_object_tile_refs_10
b$72C1 DEFB $03                             ; width
 $72C2 DEFB $04                             ; height
 $72C3 DEFB $FF,$46,$51,$54,$57,$56,$58,$59 ; {tile references (incl. RLE)
 $72CB DEFB $5A                             ; }
; #HTML[#CALL:decode_object($72C1, 10)]

; Room object 11: Chest of drawers facing SW
@label=interior_object_tile_refs_11
b$72CC DEFB $02         ; width
 $72CD DEFB $03         ; height
 $72CE DEFB $FF,$46,$4B ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($72CC, 11)]

; Room object 15: Door frame SE
@label=interior_object_tile_refs_15
b$72D1 DEFB $04             ; width
 $72D2 DEFB $06             ; height
 $72D3 DEFB $00,$00,$32,$36 ; {tile references
 $72D7 DEFB $32,$25,$34,$27
 $72DB DEFB $38,$00,$00,$27
 $72DF DEFB $38,$00,$00,$27
 $72E3 DEFB $38,$00,$01,$3B
 $72E7 DEFB $3C,$01,$01,$00 ; }
; #HTML[#CALL:decode_object($72D1, 15)]

; Room object 16: Door frame SW
@label=interior_object_tile_refs_16
b$72EB DEFB $04             ; width
 $72EC DEFB $06             ; height
 $72ED DEFB $32,$36,$00,$00 ; {tile references
 $72F1 DEFB $38,$37,$35,$36
 $72F5 DEFB $38,$00,$00,$27
 $72F9 DEFB $38,$00,$00,$27
 $72FD DEFB $33,$01,$00,$27
 $7301 DEFB $00,$01,$01,$3D ; }
; #HTML[#CALL:decode_object($72EB, 16)]

; Room object 22: Chair facing SE
@label=interior_object_tile_refs_22
b$7305 DEFB $02      ; width
 $7306 DEFB $04      ; height
 $7307 DEFB $67,$00  ; {tile references
 $7309 DEFB $68,$36
 $730B DEFB $69,$6B
 $730D DEFB $6A,$00  ; }
; #HTML[#CALL:decode_object($7305, 22)]

; Room object 23: Occupied bed
@label=interior_object_tile_refs_23
b$730F DEFB $05                 ; width
 $7310 DEFB $04                 ; height
 $7311 DEFB $3E,$70,$6C,$00,$00 ; {tile references
 $7316 DEFB $41,$42,$6D,$6E,$45
 $731B DEFB $00,$46,$47,$6F,$49
 $7320 DEFB $00,$00,$00,$4A,$00 ; }
; #HTML[#CALL:decode_object($730F, 23)]

; Room object 24: Ornate wardrobe facing SW
@label=interior_object_tile_refs_24
b$7325 DEFB $03         ; width
 $7326 DEFB $04         ; height
 $7327 DEFB $51,$52,$53 ; {tile references
 $732A DEFB $71,$72,$56
 $732D DEFB $54,$57,$56
 $7330 DEFB $58,$59,$5A ; }
; #HTML[#CALL:decode_object($7325, 24)]

; Room object 25: Chair facing SW
@label=interior_object_tile_refs_25
b$7333 DEFB $02                         ; width
 $7334 DEFB $04                         ; height
 $7335 DEFB $00,$73,$5C,$FF,$44,$74,$00 ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($7333, 25)]

; Room object 26: Cupboard facing SE
@label=interior_object_tile_refs_26
b$733C DEFB $03             ; width
 $733D DEFB $03             ; height
 $733E DEFB $5C,$FF,$48,$78 ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($733C, 26)]

; Room object 29: Table
@label=interior_object_tile_refs_29
b$7342 DEFB $04                         ; width
 $7343 DEFB $03                         ; height
 $7344 DEFB $FF,$48,$5C,$4A,$38,$00,$00 ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($7342, 29)]

; Room object 30: Stove pipe
@label=interior_object_tile_refs_30
b$734B DEFB $03                             ; width
 $734C DEFB $04                             ; height
 $734D DEFB $80,$81,$00,$00,$82,$00,$00,$82 ; {tile references (incl. RLE)
 $7355 DEFB $00,$00,$80,$00                 ; }
; #HTML[#CALL:decode_object($734B, 30)]

; Room object 31: Papers on floor
@label=interior_object_tile_refs_31
b$7359 DEFB $01      ; width
 $735A DEFB $01      ; height
 $735B DEFB $83      ; tile references
; #HTML[#CALL:decode_object($7359, 31)]

; Room object 32: Tall wardrobe facing SW
@label=interior_object_tile_refs_32
b$735C DEFB $03                             ; width
 $735D DEFB $05                             ; height
 $735E DEFB $FF,$46,$51,$54,$57,$56,$54,$57 ; {tile references (incl. RLE)
 $7366 DEFB $56,$58,$59,$5A                 ; }
; #HTML[#CALL:decode_object($735C, 32)]

; Room object 33: Small shelf facing SE
@label=interior_object_tile_refs_33
b$736A DEFB $02         ; width
 $736B DEFB $02         ; height
 $736C DEFB $FF,$44,$88 ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($736A, 33)]

; Room object 34: Small crate
@label=interior_object_tile_refs_34
b$736F DEFB $02         ; width
 $7370 DEFB $02         ; height
 $7371 DEFB $FF,$44,$8C ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($736F, 34)]

; Room object 35: Small window with bars facing SE
@label=interior_object_tile_refs_35
b$7374 DEFB $03                             ; width
 $7375 DEFB $05                             ; height
 $7376 DEFB $00,$32,$36,$25,$84,$27,$85,$86 ; {tile references (incl. RLE)
 $737E DEFB $27,$85,$87,$2D,$2E,$2F,$00     ; }
; #HTML[#CALL:decode_object($7374, 35)]

; Room object 36: Tiny door frame NE (tunnel entrance)
@label=interior_object_tile_refs_36
b$7385 DEFB $04                             ; width
 $7386 DEFB $03                             ; height
 $7387 DEFB $32,$36,$00,$00,$5B,$37,$35,$36 ; {tile references (incl. RLE)
 $738F DEFB $00,$01,$01,$27                 ; }
; #HTML[#CALL:decode_object($7385, 36)]

; Room object 37: Noticeboard facing SE
@label=interior_object_tile_refs_37
b$7393 DEFB $04                             ; width
 $7394 DEFB $04                             ; height
 $7395 DEFB $00,$00,$32,$36,$32,$25,$34,$27 ; {tile references (incl. RLE)
 $739D DEFB $38,$90,$90,$27,$38,$25,$34,$00 ; }
; #HTML[#CALL:decode_object($7393, 37)]

; Room object 38: Door frame NW
@label=interior_object_tile_refs_38
b$73A5 DEFB $04             ; width
 $73A6 DEFB $06             ; height
 $73A7 DEFB $00,$00,$32,$36 ; {tile references
 $73AB DEFB $32,$25,$34,$27
 $73AF DEFB $38,$00,$00,$27
 $73B3 DEFB $38,$00,$00,$27
 $73B7 DEFB $38,$00,$01,$91
 $73BB DEFB $38,$01,$01,$00 ; }
; #HTML[#CALL:decode_object($73A5, 38)]

; Room object 40: Door frame NE
@label=interior_object_tile_refs_40
b$73BF DEFB $04             ; width
 $73C0 DEFB $06             ; height
 $73C1 DEFB $32,$36,$00,$00 ; {tile references
 $73C5 DEFB $38,$37,$35,$36
 $73C9 DEFB $38,$00,$00,$27
 $73CD DEFB $38,$00,$00,$27
 $73D1 DEFB $5B,$01,$00,$27
 $73D5 DEFB $00,$01,$01,$27 ; }
; #HTML[#CALL:decode_object($73BF, 40)]

; Room object 41: Room outline 15x8
@label=interior_object_tile_refs_41
b$73D9 DEFB $0E                             ; width
 $73DA DEFB $08                             ; height
 $73DB DEFB $FF,$85,$00,$32,$36,$FF,$8A,$00 ; {tile references (incl. RLE)
 $73E3 DEFB $32,$25,$34,$37,$35,$36,$FF,$86
 $73EB DEFB $00,$32,$25,$34,$FF,$84,$00,$37
 $73F3 DEFB $35,$36,$00,$00,$00,$25,$34,$FF
 $73FB DEFB $88,$00,$37,$35,$36,$00,$13,$3A
 $7403 DEFB $FF,$8A,$00,$37,$35,$00,$00,$13
 $740B DEFB $3A,$FF,$88,$00,$39,$0D,$FF,$84
 $7413 DEFB $00,$13,$3A,$FF,$84,$00,$39,$0D
 $741B DEFB $FF,$88,$00,$13,$3A,$39,$0D,$FF
 $7423 DEFB $84,$00                         ; }
; #HTML[#CALL:decode_object($73D9, 41)]

; Room object 42: Cupboard facing SW
@label=interior_object_tile_refs_42
b$7425 DEFB $02      ; width
 $7426 DEFB $03      ; height
 $7427 DEFB $51,$52  ; {tile references
 $7429 DEFB $54,$55
 $742B DEFB $58,$59  ; }
; #HTML[#CALL:decode_object($7425, 42)]

; Room object 43: Mess bench
@label=interior_object_tile_refs_43
b$742D DEFB $09                             ; width
 $742E DEFB $05                             ; height
 $742F DEFB $FF,$86,$00,$5C,$94,$99,$FF,$84 ; {tile references (incl. RLE)
 $7437 DEFB $00,$5C,$94,$97,$66,$96,$00,$00
 $743F DEFB $5C,$94,$97,$66,$00,$00,$00,$5C
 $7447 DEFB $94,$97,$66,$FF,$85,$00,$98,$66
 $744F DEFB $FF,$87,$00                     ; }
; #HTML[#CALL:decode_object($742D, 43)]

; Room object 44: Mess table
@label=interior_object_tile_refs_44
b$7452 DEFB $0A                             ; width
 $7453 DEFB $06                             ; height
 $7454 DEFB $FF,$86,$00,$FF,$44,$5C,$FF,$84 ; {tile references (incl. RLE)
 $745C DEFB $00,$5C,$5D,$64,$65,$62,$63,$00
 $7464 DEFB $00,$5C,$5D,$64,$65,$62,$66,$00
 $746C DEFB $00,$5C,$5D,$64,$65,$62,$66,$FF
 $7474 DEFB $84,$00,$60,$61,$62,$66,$FF,$86
 $747C DEFB $00,$4A,$38,$FF,$88,$00         ; }
; #HTML[#CALL:decode_object($7452, 44)]

; Room object 45: Mess bench short
@label=interior_object_tile_refs_45
b$7482 DEFB $05                             ; width
 $7483 DEFB $03                             ; height
 $7484 DEFB $00,$00,$5C,$94,$95,$5C,$94,$97 ; {tile references (incl. RLE)
 $748C DEFB $66,$96,$98,$66,$00,$00,$00     ; }
; #HTML[#CALL:decode_object($7482, 45)]

; Room object 46: Room outline 18x10 B
@label=interior_object_tile_refs_46
b$7493 DEFB $12                             ; width
 $7494 DEFB $0A                             ; height
 $7495 DEFB $FF,$8B,$00,$32,$36,$FF,$8E,$00 ; {tile references (incl. RLE)
 $749D DEFB $32,$25,$34,$37,$35,$36,$FF,$8A
 $74A5 DEFB $00,$32,$25,$34,$FF,$84,$00,$37
 $74AD DEFB $35,$36,$FF,$86,$00,$32,$25,$34
 $74B5 DEFB $FF,$88,$00,$37,$35,$00,$00,$00
 $74BD DEFB $32,$25,$34,$FF,$8A,$00,$39,$0D
 $74C5 DEFB $00,$32,$25,$34,$FF,$8A,$00,$39
 $74CD DEFB $0D,$00,$00,$25,$34,$FF,$8A,$00
 $74D5 DEFB $39,$0D,$FF,$84,$00,$13,$3A,$FF
 $74DD DEFB $88,$00,$39,$0D,$FF,$88,$00,$13
 $74E5 DEFB $3A,$FF,$84,$00,$39,$0D,$FF,$8C
 $74ED DEFB $00,$13,$3A,$39,$0D,$FF,$8A,$00 ; }
; #HTML[#CALL:decode_object($7493, 46)]

; Room object 47: Room outline 22x12 B
@label=interior_object_tile_refs_47
b$74F5 DEFB $16                             ; width
 $74F6 DEFB $0C                             ; height
 $74F7 DEFB $FF,$87,$00,$32,$36,$FF,$92,$00 ; {tile references (incl. RLE)
 $74FF DEFB $32,$25,$34,$37,$35,$36,$FF,$8E
 $7507 DEFB $00,$32,$25,$34,$FF,$84,$00,$37
 $750F DEFB $35,$36,$FF,$8A,$00,$32,$25,$34
 $7517 DEFB $FF,$88,$00,$37,$35,$36,$FF,$87
 $751F DEFB $00,$25,$34,$FF,$8C,$00,$37,$35
 $7527 DEFB $36,$FF,$85,$00,$13,$3A,$FF,$8E
 $752F DEFB $00,$37,$35,$36,$FF,$85,$00,$13
 $7537 DEFB $3A,$FF,$8E,$00,$37,$35,$36,$FF
 $753F DEFB $85,$00,$13,$3A,$FF,$8E,$00,$37
 $7547 DEFB $35,$FF,$86,$00,$13,$3A,$FF,$8C
 $754F DEFB $00,$39,$0D,$FF,$88,$00,$13,$3A
 $7557 DEFB $FF,$88,$00,$39,$0D,$FF,$8C,$00
 $755F DEFB $13,$3A,$FF,$84,$00,$39,$0D,$FF
 $7567 DEFB $90,$00,$13,$3A,$39,$0D,$FF,$86
 $756F DEFB $00                             ; }
; #HTML[#CALL:decode_object($74F5, 47)]

; Room object 48: Tiny table
@label=interior_object_tile_refs_48
b$7570 DEFB $02      ; width
 $7571 DEFB $02      ; height
 $7572 DEFB $5C,$36  ; {tile references
 $7574 DEFB $98,$93  ; }
; #HTML[#CALL:decode_object($7570, 48)]

; Room object 49: Tiny drawers facing SE
@label=interior_object_tile_refs_49
b$7576 DEFB $02      ; width
 $7577 DEFB $03      ; height
 $7578 DEFB $5C,$9A  ; {tile references
 $757A DEFB $7A,$9B
 $757C DEFB $9D,$9C  ; }
; #HTML[#CALL:decode_object($7576, 49)]

; Room object 50: Tall drawers facing SW
@label=interior_object_tile_refs_50
b$757E DEFB $02      ; width
 $757F DEFB $04      ; height
 $7580 DEFB $4B,$4C  ; {tile references
 $7582 DEFB $9E,$4E
 $7584 DEFB $9F,$4E
 $7586 DEFB $4F,$50  ; }
; #HTML[#CALL:decode_object($757E, 50)]

; Room object 51: Desk facing SW
@label=interior_object_tile_refs_51
b$7588 DEFB $06                     ; width
 $7589 DEFB $04                     ; height
 $758A DEFB $5C,$5D,$5E,$A0,$A8,$00 ; {tile references
 $7590 DEFB $60,$61,$A1,$A2,$A3,$A7
 $7596 DEFB $4A,$38,$A4,$A5,$A6,$00
 $759C DEFB $00,$00,$00,$2D,$00,$00 ; }
; #HTML[#CALL:decode_object($7588, 51)]

; Room object 52: Sink facing SE
@label=interior_object_tile_refs_52
b$75A2 DEFB $03                     ; width
 $75A3 DEFB $03                     ; height
 $75A4 DEFB $A9,$AA,$00,$FF,$46,$AB ; tile references (incl. RLE)
; #HTML[#CALL:decode_object($75A2, 52)]

; Room object 53: Key rack facing SE
@label=interior_object_tile_refs_53
b$75AA DEFB $02      ; width
 $75AB DEFB $02      ; height
 $75AC DEFB $B2,$B1  ; {tile references
 $75AE DEFB $B3,$B4  ; }
; #HTML[#CALL:decode_object($75AA, 53)]

; Room object 27: Room outline 18x10 A
@label=interior_object_tile_refs_27
b$75B0 DEFB $12                             ; width
 $75B1 DEFB $0A                             ; height
 $75B2 DEFB $FF,$87,$00,$32,$36,$FF,$8E,$00 ; {tile references (incl. RLE)
 $75BA DEFB $32,$25,$34,$37,$35,$36,$FF,$8A
 $75C2 DEFB $00,$32,$25,$34,$FF,$84,$00,$37
 $75CA DEFB $35,$36,$FF,$86,$00,$32,$25,$34
 $75D2 DEFB $FF,$88,$00,$37,$35,$36,$00,$00
 $75DA DEFB $00,$25,$34,$FF,$8C,$00,$37,$35
 $75E2 DEFB $36,$00,$13,$3A,$FF,$8E,$00,$37
 $75EA DEFB $35,$00,$00,$13,$3A,$FF,$8C,$00
 $75F2 DEFB $39,$0D,$FF,$84,$00,$13,$3A,$FF
 $75FA DEFB $88,$00,$39,$0D,$FF,$88,$00,$13
 $7602 DEFB $3A,$FF,$84,$00,$39,$0D,$FF,$8C
 $760A DEFB $00,$13,$3A,$39,$0D,$FF,$86,$00 ; }
; #HTML[#CALL:decode_object($75B0, 27)]

; Character structures.
;
; Array, 26 long, of 7-byte character structures.
; .
; struct { byte character_and_flags; byte room; byte x,y,height; byte x,y; }
@label=character_structs
b$7612 DEFB $00,$0B,$2E,$2E,$18,$03,$00 ; character_0_COMMANDANT,   room_11_PAPERS,    46, 46, 0x18, 0x03, 0x00
 $7619 DEFB $01,$00,$66,$44,$03,$01,$00 ; character_1_GUARD_1,      room_0_OUTDOORS,  102, 68, 0x03, 0x01, 0x00
 $7620 DEFB $02,$00,$44,$68,$03,$01,$02 ; character_2_GUARD_2,      room_0_OUTDOORS,   68,104, 0x03, 0x01, 0x02
 $7627 DEFB $03,$10,$2E,$2E,$18,$03,$13 ; character_3_GUARD_3,      room_16_CORRIDOR,  46, 46, 0x18, 0x03, 0x13
 $762E DEFB $04,$00,$3D,$67,$03,$02,$04 ; character_4_GUARD_4,      room_0_OUTDOORS,   61,103, 0x03, 0x02, 0x04
 $7635 DEFB $05,$00,$6A,$38,$0D,$00,$00 ; character_5_GUARD_5,      room_0_OUTDOORS,  106, 56, 0x0D, 0x00, 0x00
 $763C DEFB $06,$00,$48,$5E,$0D,$00,$00 ; character_6_GUARD_6,      room_0_OUTDOORS,   72, 94, 0x0D, 0x00, 0x00
 $7643 DEFB $07,$00,$48,$46,$0D,$00,$00 ; character_7_GUARD_7,      room_0_OUTDOORS,   72, 70, 0x0D, 0x00, 0x00
 $764A DEFB $08,$00,$50,$2E,$0D,$00,$00 ; character_8_GUARD_8,      room_0_OUTDOORS,   80, 46, 0x0D, 0x00, 0x00
 $7651 DEFB $09,$00,$6C,$47,$15,$04,$00 ; character_9_GUARD_9,      room_0_OUTDOORS,  108, 71, 0x15, 0x04, 0x00
 $7658 DEFB $0A,$00,$5C,$34,$03,$FF,$38 ; character_10_GUARD_10,    room_0_OUTDOORS,   92, 52, 0x03, 0xFF, 0x38
 $765F DEFB $0B,$00,$6D,$45,$03,$00,$00 ; character_11_GUARD_11,    room_0_OUTDOORS,  109, 69, 0x03, 0x00, 0x00
 $7666 DEFB $0C,$03,$28,$3C,$18,$00,$08 ; character_12_GUARD_12,    room_3_HUT2RIGHT,  40, 60, 0x18, 0x00, 0x08
; Bug: The room field here is 2 but reset_map_and_characters will reset it to
; 3.
 $766D DEFB $0D,$02,$24,$30,$18,$00,$08 ; character_13_GUARD_13,    room_2_HUT2LEFT,   36, 48, 0x18, 0x00, 0x08
 $7674 DEFB $0E,$05,$28,$3C,$18,$00,$10 ; character_14_GUARD_14,    room_5_HUT3RIGHT,  40, 60, 0x18, 0x00, 0x10
 $767B DEFB $0F,$05,$24,$22,$18,$00,$10 ; character_15_GUARD_15,    room_5_HUT3RIGHT,  36, 34, 0x18, 0x00, 0x10
 $7682 DEFB $10,$00,$44,$54,$01,$FF,$00 ; character_16_GUARD_DOG_1, room_0_OUTDOORS,   68, 84, 0x01, 0xFF, 0x00
 $7689 DEFB $11,$00,$44,$68,$01,$FF,$00 ; character_16_GUARD_DOG_2, room_0_OUTDOORS,   68,104, 0x01, 0xFF, 0x00
 $7690 DEFB $12,$00,$66,$44,$01,$FF,$18 ; character_18_GUARD_DOG_3, room_0_OUTDOORS,  102, 68, 0x01, 0xFF, 0x18
 $7697 DEFB $13,$00,$58,$44,$01,$FF,$18 ; character_19_GUARD_DOG_4, room_0_OUTDOORS,   88, 68, 0x01, 0xFF, 0x18
 $769E DEFB $14,$FF,$34,$3C,$18,$00,$08 ; character_20_PRISONER_1,  room_NONE,         52, 60, 0x18, 0x00, 0x08
 $76A5 DEFB $15,$FF,$34,$2C,$18,$00,$08 ; character_21_PRISONER_2,  room_NONE,         52, 44, 0x18, 0x00, 0x08
 $76AC DEFB $16,$FF,$34,$1C,$18,$00,$08 ; character_22_PRISONER_3,  room_NONE,         52, 28, 0x18, 0x00, 0x08
 $76B3 DEFB $17,$FF,$34,$3C,$18,$00,$10 ; character_23_PRISONER_4,  room_NONE,         52, 60, 0x18, 0x00, 0x10
 $76BA DEFB $18,$FF,$34,$2C,$18,$00,$10 ; character_24_PRISONER_5,  room_NONE,         52, 44, 0x18, 0x00, 0x10
 $76C1 DEFB $19,$FF,$34,$1C,$18,$00,$10 ; character_25_PRISONER_6,  room_NONE,         52, 28, 0x18, 0x00, 0x10

; Item structures.
;
; Array, 16 long, of 7-byte item structures.
; .
; struct { byte item_and_flags; byte room_and_flags; byte x,y,height; byte
; screen_x,screen_y; }
@label=item_structs
b$76C8 DEFB $00,$FF,$40,$20,$02,$78,$F4 ; item_WIRESNIPS,        room_NONE,        64,32, 0x02, 0x78, 0xF4 // <- item_to_itemstruct, find_nearby_item
 $76CF DEFB $01,$09,$3E,$30,$00,$7C,$F2 ; item_SHOVEL,           room_9_CRATE,     62,48, 0x00, 0x7C, 0xF2
 $76D6 DEFB $02,$0A,$49,$24,$10,$77,$F0 ; item_LOCKPICK,         room_10_LOCKPICK, 73,36, 0x10, 0x77, 0xF0
 $76DD DEFB $03,$0B,$2A,$3A,$04,$84,$F3 ; item_PAPERS,           room_11_PAPERS,   42,58, 0x04, 0x84, 0xF3
 $76E4 DEFB $04,$0E,$32,$18,$02,$7A,$F6 ; item_TORCH,            room_14_TORCH,    34,24, 0x02, 0x7A, 0xF6
 $76EB DEFB $05,$FF,$24,$2C,$04,$7E,$F4 ; item_BRIBE,            room_NONE,        36,44, 0x04, 0x7E, 0xF4 // <- accept_bribe
 $76F2 DEFB $06,$0F,$2C,$41,$10,$87,$F1 ; item_UNIFORM,          room_15_UNIFORM,  44,65, 0x10, 0x87, 0xF1
@label=item_structs_food
 $76F9 DEFB $07,$13,$40,$30,$10,$7E,$F0 ; item_FOOD,             room_19_FOOD,     64,48, 0x10, 0x7E, 0xF0 // <- action_poison, called_from_main_loop
 $7700 DEFB $08,$01,$42,$34,$04,$7C,$F1 ; item_POISON,           room_1_HUT1RIGHT, 66,52, 0x04, 0x7C, 0xF1
 $7707 DEFB $09,$16,$3C,$2A,$00,$7B,$F2 ; item_RED_KEY,          room_22_REDKEY,   60,42, 0x00, 0x7B, 0xF2
 $770E DEFB $0A,$0B,$1C,$22,$00,$81,$F8 ; item_YELLOW_KEY,       room_11_PAPERS,   28,34, 0x00, 0x81, 0xF8
 $7715 DEFB $0B,$00,$4A,$48,$00,$7A,$6E ; item_GREEN_KEY,        room_0_OUTDOORS,  74,72, 0x00, 0x7A, 0x6E
 $771C DEFB $0C,$FF,$1C,$32,$0C,$85,$F6 ; item_RED_CROSS_PARCEL, room_NONE,        28,50, 0x0C, 0x85, 0xF6 // <- event_new_red_cross_parcel, new_red_cross_parcel
 $7723 DEFB $0D,$12,$24,$3A,$08,$85,$F4 ; item_RADIO,            room_18_RADIO,    36,58, 0x08, 0x85, 0xF4
 $772A DEFB $0E,$FF,$24,$2C,$04,$7E,$F4 ; item_PURSE,            room_NONE,        36,44, 0x04, 0x7E, 0xF4
 $7731 DEFB $0F,$FF,$34,$1C,$04,$7E,$F4 ; item_COMPASS,          room_NONE,        52,28, 0x04, 0x7E, 0xF4

; Not yet understood table.
@label=table_7738
b$7738 DEFW $0000                           ; {Array, 46 long, of pointers to
 $773A DEFW $7795                           ; $FF-terminated runs.
 $773C DEFW $7799
 $773E DEFW $77A0
 $7740 DEFW $77CD
 $7742 DEFW $77D0
 $7744 DEFW $77D4
 $7746 DEFW $77D8
 $7748 DEFW $77DA
 $774A DEFW $77DC
 $774C DEFW $77D8
 $774E DEFW $77DA
 $7750 DEFW $77DC
 $7752 DEFW $77DE
 $7754 DEFW $77E1
 $7756 DEFW $77E1
 $7758 DEFW $77E7
 $775A DEFW $77EC
 $775C DEFW $77F1
 $775E DEFW $77F3
 $7760 DEFW $77F5
 $7762 DEFW $77F1
 $7764 DEFW $77F3
 $7766 DEFW $77F5
 $7768 DEFW $77F7
 $776A DEFW $77F9
 $776C DEFW $77FB
 $776E DEFW $77FD
 $7770 DEFW $7803
 $7772 DEFW $7805
 $7774 DEFW $7807
 $7776 DEFW $77FF
 $7778 DEFW $7801
 $777A DEFW $7809
 $777C DEFW $780B
 $777E DEFW $780D
 $7780 DEFW $780F
 $7782 DEFW $7815
 $7784 DEFW $781A
 $7786 DEFW $781F
 $7788 DEFW $7825
 $778A DEFW $782B
 $778C DEFW $7831
 $778E DEFW $7833
 $7790 DEFW $7835
 $7792 DEFW $7838                           ; }
 $7794 DEFB $FF                             ; could be a terminating $FF
@label=byte_7738_0
 $7795 DEFB $48,$49,$4A,$FF                 ; byte_7738_0
@label=byte_7738_1
 $7799 DEFB $4B,$4C,$4D,$4E,$4F,$50,$FF     ; byte_7738_1
@label=byte_7738_2
 $77A0 DEFB $56,$1F,$1D,$20,$1A,$23,$99,$96 ; {byte_7738_2
 $77A8 DEFB $95,$94,$97,$52,$17,$8A,$0B,$8B
 $77B0 DEFB $0C,$9B,$1C,$9D,$8D,$33,$5F,$80
 $77B8 DEFB $81,$64,$01,$00,$04,$10,$85,$33
 $77C0 DEFB $07,$91,$86,$08,$12,$89,$55,$0E
 $77C8 DEFB $22,$A2,$21,$A1,$FF             ; }
@label=byte_7738_3
 $77CD DEFB $53,$54,$FF                     ; byte_7738_3
@label=byte_7738_4
 $77D0 DEFB $87,$33,$34,$FF                 ; byte_7738_4
@label=byte_7738_5
 $77D4 DEFB $89,$55,$36,$FF                 ; byte_7738_5
@label=byte_7738_6
 $77D8 DEFB $56,$FF                         ; byte_7738_6
@label=byte_7738_7
 $77DA DEFB $57,$FF                         ; byte_7738_7
@label=byte_7738_8
 $77DC DEFB $58,$FF                         ; byte_7738_8
@label=byte_7738_9
 $77DE DEFB $5C,$5D,$FF                     ; byte_7738_9
@label=byte_7738_10
 $77E1 DEFB $33,$5F,$80,$81,$60,$FF         ; byte_7738_10
@label=byte_7738_11
 $77E7 DEFB $34,$0A,$14,$93,$FF             ; byte_7738_11
@label=byte_7738_12
 $77EC DEFB $38,$34,$0A,$14,$FF             ; byte_7738_12
@label=byte_7738_13
 $77F1 DEFB $68,$FF                         ; byte_7738_13
@label=byte_7738_14
 $77F3 DEFB $69,$FF                         ; byte_7738_14
@label=byte_7738_15
 $77F5 DEFB $6A,$FF                         ; byte_7738_15
@label=byte_7738_16
 $77F7 DEFB $6C,$FF                         ; byte_7738_16
@label=byte_7738_17
 $77F9 DEFB $6D,$FF                         ; byte_7738_17
@label=byte_7738_18
 $77FB DEFB $31,$FF                         ; byte_7738_18
@label=byte_7738_19
 $77FD DEFB $33,$FF                         ; byte_7738_19
@label=byte_7738_20
 $77FF DEFB $39,$FF                         ; byte_7738_20
@label=byte_7738_21
 $7801 DEFB $59,$FF                         ; byte_7738_21
@label=byte_7738_22
 $7803 DEFB $70,$FF                         ; byte_7738_22
@label=byte_7738_23
 $7805 DEFB $71,$FF                         ; byte_7738_23
@label=byte_7738_24
 $7807 DEFB $72,$FF                         ; byte_7738_24
@label=byte_7738_25
 $7809 DEFB $73,$FF                         ; byte_7738_25
@label=byte_7738_26
 $780B DEFB $74,$FF                         ; byte_7738_26
@label=byte_7738_27
 $780D DEFB $75,$FF                         ; byte_7738_27
@label=byte_7738_28
 $780F DEFB $36,$0A,$97,$98,$52,$FF         ; byte_7738_28
@label=byte_7738_29
 $7815 DEFB $18,$17,$8A,$36,$FF             ; byte_7738_29
@label=byte_7738_30
 $781A DEFB $34,$33,$07,$5C,$FF             ; byte_7738_30
@label=byte_7738_31
 $781F DEFB $34,$33,$07,$91,$5D,$FF         ; byte_7738_31
@label=byte_7738_32
 $7825 DEFB $34,$33,$55,$09,$5C,$FF         ; byte_7738_32
@label=byte_7738_33
 $782B DEFB $34,$33,$55,$09,$5D,$FF         ; byte_7738_33
@label=byte_7738_34
 $7831 DEFB $11,$FF                         ; byte_7738_34
@label=byte_7738_35
 $7833 DEFB $6B,$FF                         ; byte_7738_35
@label=byte_7738_36
 $7835 DEFB $91,$6E,$FF                     ; byte_7738_36
@label=byte_7738_37
 $7838 DEFB $5A,$FF                         ; byte_7738_37

; Locations.
;
; Array, 78 long, of two-byte locations (x,y)
@label=locations
w$783A DEFW $6844    ; 0x44, 0x68
 $783C DEFW $5444    ; 0x44, 0x54
 $783E DEFW $4644    ; 0x44, 0x46
 $7840 DEFW $6640    ; 0x40, 0x66
 $7842 DEFW $4040    ; 0x40, 0x40
 $7844 DEFW $4444    ; 0x44, 0x44
 $7846 DEFW $4040    ; 0x40, 0x40
 $7848 DEFW $4044    ; 0x44, 0x40
 $784A DEFW $7068    ; 0x68, 0x70
 $784C DEFW $7060    ; 0x60, 0x70
 $784E DEFW $666A    ; 0x6A, 0x66
 $7850 DEFW $685D    ; 0x5D, 0x68
 $7852 DEFW $657C    ; 0x7C, 0x65
 $7854 DEFW $707C    ; 0x7C, 0x70
 $7856 DEFW $6874    ; 0x74, 0x68
 $7858 DEFW $6470    ; 0x70, 0x64
 $785A DEFW $6078    ; 0x78, 0x60
 $785C DEFW $5880    ; 0x80, 0x58
 $785E DEFW $6070    ; 0x70, 0x60
 $7860 DEFW $5474    ; 0x74, 0x54
 $7862 DEFW $647C    ; 0x7C, 0x64
 $7864 DEFW $707C    ; 0x7C, 0x70
 $7866 DEFW $6874    ; 0x74, 0x68
 $7868 DEFW $6470    ; 0x70, 0x64
 $786A DEFW $4466    ; 0x66, 0x44
 $786C DEFW $4066    ; 0x66, 0x40
 $786E DEFW $4060    ; 0x60, 0x40
 $7870 DEFW $445C    ; 0x5C, 0x44
 $7872 DEFW $4456    ; 0x56, 0x44
 $7874 DEFW $4054    ; 0x54, 0x40
 $7876 DEFW $444A    ; 0x4A, 0x44
 $7878 DEFW $404A    ; 0x4A, 0x40
 $787A DEFW $4466    ; 0x66, 0x44
 $787C DEFW $4444    ; 0x44, 0x44
 $787E DEFW $6844    ; 0x44, 0x68
 $7880 DEFW $456B    ; 0x6B, 0x45
 $7882 DEFW $2D6B    ; 0x6B, 0x2D
 $7884 DEFW $2D4D    ; 0x4D, 0x2D
 $7886 DEFW $3D4D    ; 0x4D, 0x3D
 $7888 DEFW $3D3D    ; 0x3D, 0x3D
 $788A DEFW $673D    ; 0x3D, 0x67
 $788C DEFW $4C74    ; 0x74, 0x4C
 $788E DEFW $2A2C    ; 0x2C, 0x2A
 $7890 DEFW $486A    ; 0x6A, 0x48
 $7892 DEFW $486E    ; 0x6E, 0x48
 $7894 DEFW $6851    ; 0x51, 0x68
 $7896 DEFW $3C34    ; 0x34, 0x3C
 $7898 DEFW $2C34    ; 0x34, 0x2C
 $789A DEFW $1C34    ; 0x34, 0x1C
 $789C DEFW $6B77    ; 0x77, 0x6B
 $789E DEFW $6E7A    ; 0x7A, 0x6E
 $78A0 DEFW $1C34    ; 0x34, 0x1C
 $78A2 DEFW $3C28    ; 0x28, 0x3C
 $78A4 DEFW $2224    ; 0x24, 0x22
 $78A6 DEFW $4C50    ; 0x50, 0x4C
 $78A8 DEFW $4C59    ; 0x59, 0x4C
 $78AA DEFW $3C59    ; 0x59, 0x3C
 $78AC DEFW $3D64    ; 0x64, 0x3D
 $78AE DEFW $365C    ; 0x5C, 0x36
 $78B0 DEFW $3254    ; 0x54, 0x32
 $78B2 DEFW $3066    ; 0x66, 0x30
 $78B4 DEFW $3860    ; 0x60, 0x38
 $78B6 DEFW $3B4F    ; 0x4F, 0x3B
 $78B8 DEFW $2F67    ; 0x67, 0x2F
 $78BA DEFW $3634    ; 0x34, 0x36
 $78BC DEFW $2E34    ; 0x34, 0x2E
 $78BE DEFW $2434    ; 0x34, 0x24
 $78C0 DEFW $3E34    ; 0x34, 0x3E
 $78C2 DEFW $3820    ; 0x20, 0x38
 $78C4 DEFW $1834    ; 0x34, 0x18
 $78C6 DEFW $2E2A    ; 0x2A, 0x2E
 $78C8 DEFW $2222    ; 0x22, 0x22
 $78CA DEFW $6E78    ; 0x78, 0x6E
 $78CC DEFW $6E76    ; 0x76, 0x6E
 $78CE DEFW $6E74    ; 0x74, 0x6E
 $78D0 DEFW $6D79    ; 0x79, 0x6D
 $78D2 DEFW $6D77    ; 0x77, 0x6D
 $78D4 DEFW $6D75    ; 0x75, 0x6D

; Door positions.
;
; 62 pairs of four-byte structs (<- setup_doors)
; .
; #define BYTE0(room, direction) ((room << 2) | direction)
@label=doors
b$78D6 DEFB $01,$B2,$8A,$06 ; { BYTE0(room_0_OUTDOORS,             1), 0xB2, 0x8A,  6 }, // gates
@label=door_positions_1
 $78DA DEFB $03,$B2,$8E,$06 ; { BYTE0(room_0_OUTDOORS,             3), 0xB2, 0x8E,  6 }, // gates
 $78DE DEFB $01,$B2,$7A,$06 ; { BYTE0(room_0_OUTDOORS,             1), 0xB2, 0x7A,  6 },
 $78E2 DEFB $03,$B2,$7E,$06 ; { BYTE0(room_0_OUTDOORS,             3), 0xB2, 0x7E,  6 },
 $78E6 DEFB $88,$8A,$B3,$06 ; { BYTE0(room_34,                     0), 0x8A, 0xB3,  6 },
 $78EA DEFB $02,$10,$34,$0C ; { BYTE0(room_0_OUTDOORS,             2), 0x10, 0x34, 12 },
 $78EE DEFB $C0,$CC,$79,$06 ; { BYTE0(room_48,                     0), 0xCC, 0x79,  6 },
 $78F2 DEFB $02,$10,$34,$0C ; { BYTE0(room_0_OUTDOORS,             2), 0x10, 0x34, 12 },
 $78F6 DEFB $71,$D9,$A3,$06 ; { BYTE0(room_28_HUT1LEFT,            1), 0xD9, 0xA3,  6 },
 $78FA DEFB $03,$2A,$1C,$18 ; { BYTE0(room_0_OUTDOORS,             3), 0x2A, 0x1C, 24 },
 $78FE DEFB $04,$D4,$BD,$06 ; { BYTE0(room_1_HUT1RIGHT,            0), 0xD4, 0xBD,  6 },
 $7902 DEFB $02,$1E,$2E,$18 ; { BYTE0(room_0_OUTDOORS,             2), 0x1E, 0x2E, 24 },
; If I set the room number to $80 in the next entry then I can't use the (left)
; door to exit, entering the door from the otherside puts me in a tunnel (I
; think).
 $7906 DEFB $09,$C1,$A3,$06 ; { BYTE0(room_2_HUT2LEFT,             1), 0xC1, 0xA3,  6 },
 $790A DEFB $03,$2A,$1C,$18 ; { BYTE0(room_0_OUTDOORS,             3), 0x2A, 0x1C, 24 },
 $790E DEFB $0C,$BC,$BD,$06 ; { BYTE0(room_3_HUT2RIGHT,            0), 0xBC, 0xBD,  6 },
 $7912 DEFB $02,$20,$2E,$18 ; { BYTE0(room_0_OUTDOORS,             2), 0x20, 0x2E, 24 },
 $7916 DEFB $11,$A9,$A3,$06 ; { BYTE0(room_4_HUT3LEFT,             1), 0xA9, 0xA3,  6 },
 $791A DEFB $03,$2A,$1C,$18 ; { BYTE0(room_0_OUTDOORS,             3), 0x2A, 0x1C, 24 },
 $791E DEFB $14,$A4,$BD,$06 ; { BYTE0(room_5_HUT3RIGHT,            0), 0xA4, 0xBD,  6 },
 $7922 DEFB $02,$20,$2E,$18 ; { BYTE0(room_0_OUTDOORS,             2), 0x20, 0x2E, 24 },
 $7926 DEFB $54,$FC,$CA,$06 ; { BYTE0(room_21_CORRIDOR,            0), 0xFC, 0xCA,  6 },
 $792A DEFB $02,$1C,$24,$18 ; { BYTE0(room_0_OUTDOORS,             2), 0x1C, 0x24, 24 },
 $792E DEFB $50,$FC,$DA,$06 ; { BYTE0(room_20_REDCROSS,            0), 0xFC, 0xDA,  6 },
 $7932 DEFB $02,$1A,$22,$18 ; { BYTE0(room_0_OUTDOORS,             2), 0x1A, 0x22, 24 },
 $7936 DEFB $3D,$F7,$E3,$06 ; { BYTE0(room_15_UNIFORM,             1), 0xF7, 0xE3,  6 },
 $793A DEFB $03,$26,$19,$18 ; { BYTE0(room_0_OUTDOORS,             3), 0x26, 0x19, 24 },
 $793E DEFB $35,$DF,$E3,$06 ; { BYTE0(room_13_CORRIDOR,            1), 0xDF, 0xE3,  6 },
 $7942 DEFB $03,$2A,$1C,$18 ; { BYTE0(room_0_OUTDOORS,             3), 0x2A, 0x1C, 24 },
 $7946 DEFB $21,$97,$D3,$06 ; { BYTE0(room_8_CORRIDOR,             1), 0x97, 0xD3,  6 },
 $794A DEFB $03,$2A,$15,$18 ; { BYTE0(room_0_OUTDOORS,             3), 0x2A, 0x15, 24 },
 $794E DEFB $19,$00,$00,$00 ; { BYTE0(room_6,                      1), 0x00, 0x00,  0 }, // unused room
 $7952 DEFB $03,$22,$22,$18 ; { BYTE0(room_0_OUTDOORS,             3), 0x22, 0x22, 24 },
 $7956 DEFB $05,$2C,$34,$18 ; { BYTE0(room_1_HUT1RIGHT,            1), 0x2C, 0x34, 24 },
 $795A DEFB $73,$26,$1A,$18 ; { BYTE0(room_28_HUT1LEFT,            3), 0x26, 0x1A, 24 },
 $795E DEFB $0D,$24,$36,$18 ; { BYTE0(room_3_HUT2RIGHT,            1), 0x24, 0x36, 24 },
 $7962 DEFB $0B,$26,$1A,$18 ; { BYTE0(room_2_HUT2LEFT,             3), 0x26, 0x1A, 24 },
 $7966 DEFB $15,$24,$36,$18 ; { BYTE0(room_5_HUT3RIGHT,            1), 0x24, 0x36, 24 },
 $796A DEFB $13,$26,$1A,$18 ; { BYTE0(room_4_HUT3LEFT,             3), 0x26, 0x1A, 24 },
 $796E DEFB $5D,$28,$42,$18 ; { BYTE0(room_23_BREAKFAST,           1), 0x28, 0x42, 24 },
 $7972 DEFB $67,$26,$18,$18 ; { BYTE0(room_25_BREAKFAST,           3), 0x26, 0x18, 24 },
 $7976 DEFB $5C,$3E,$24,$18 ; { BYTE0(room_23_BREAKFAST,           0), 0x3E, 0x24, 24 },
 $797A DEFB $56,$20,$2E,$18 ; { BYTE0(room_21_CORRIDOR,            2), 0x20, 0x2E, 24 },
 $797E DEFB $4D,$22,$42,$18 ; { BYTE0(room_19_FOOD,                1), 0x22, 0x42, 24 },
 $7982 DEFB $5F,$22,$1C,$18 ; { BYTE0(room_23_BREAKFAST,           3), 0x22, 0x1C, 24 },
 $7986 DEFB $49,$24,$36,$18 ; { BYTE0(room_18_RADIO,               1), 0x24, 0x36, 24 },
 $798A DEFB $4F,$38,$22,$18 ; { BYTE0(room_19_FOOD,                3), 0x38, 0x22, 24 },
 $798E DEFB $55,$2C,$36,$18 ; { BYTE0(room_21_CORRIDOR,            1), 0x2C, 0x36, 24 },
 $7992 DEFB $5B,$22,$1C,$18 ; { BYTE0(room_22_REDKEY,              3), 0x22, 0x1C, 24 },
 $7996 DEFB $59,$2C,$36,$18 ; { BYTE0(room_22_REDKEY,              1), 0x2C, 0x36, 24 },
 $799A DEFB $63,$2A,$26,$18 ; { BYTE0(room_24_SOLITARY,            3), 0x2A, 0x26, 24 },
 $799E DEFB $31,$42,$3A,$18 ; { BYTE0(room_12_CORRIDOR,            1), 0x42, 0x3A, 24 },
 $79A2 DEFB $4B,$22,$1C,$18 ; { BYTE0(room_18_RADIO,               3), 0x22, 0x1C, 24 },
 $79A6 DEFB $44,$3C,$24,$18 ; { BYTE0(room_17_CORRIDOR,            0), 0x3C, 0x24, 24 },
 $79AA DEFB $1E,$1C,$22,$18 ; { BYTE0(room_7_CORRIDOR,             2), 0x1C, 0x22, 24 },
 $79AE DEFB $3C,$40,$28,$18 ; { BYTE0(room_15_UNIFORM,             0), 0x40, 0x28, 24 },
 $79B2 DEFB $3A,$1E,$28,$18 ; { BYTE0(room_14_TORCH,               2), 0x1E, 0x28, 24 },
 $79B6 DEFB $41,$22,$42,$18 ; { BYTE0(room_16_CORRIDOR,            1), 0x22, 0x42, 24 },
 $79BA DEFB $3B,$22,$1C,$18 ; { BYTE0(room_14_TORCH,               3), 0x22, 0x1C, 24 },
 $79BE DEFB $40,$3E,$2E,$18 ; { BYTE0(room_16_CORRIDOR,            0), 0x3E, 0x2E, 24 },
 $79C2 DEFB $36,$1A,$22,$18 ; { BYTE0(room_13_CORRIDOR,            2), 0x1A, 0x22, 24 },
 $79C6 DEFB $00,$44,$30,$18 ; { BYTE0(room_0_OUTDOORS,             0), 0x44, 0x30, 24 },
 $79CA DEFB $02,$20,$30,$18 ; { BYTE0(room_0_OUTDOORS,             2), 0x20, 0x30, 24 },
 $79CE DEFB $34,$4A,$28,$18 ; { BYTE0(room_13_CORRIDOR,            0), 0x4A, 0x28, 24 },
 $79D2 DEFB $2E,$1A,$22,$18 ; { BYTE0(room_11_PAPERS,              2), 0x1A, 0x22, 24 },
 $79D6 DEFB $1C,$40,$24,$18 ; { BYTE0(room_7_CORRIDOR,             0), 0x40, 0x24, 24 },
 $79DA DEFB $42,$1A,$22,$18 ; { BYTE0(room_16_CORRIDOR,            2), 0x1A, 0x22, 24 },
 $79DE DEFB $28,$36,$35,$18 ; { BYTE0(room_10_LOCKPICK,            0), 0x36, 0x35, 24 },
 $79E2 DEFB $22,$17,$26,$18 ; { BYTE0(room_8_CORRIDOR,             2), 0x17, 0x26, 24 },
 $79E6 DEFB $24,$36,$1C,$18 ; { BYTE0(room_9_CRATE,                0), 0x36, 0x1C, 24 },
 $79EA DEFB $22,$1A,$22,$18 ; { BYTE0(room_8_CORRIDOR,             2), 0x1A, 0x22, 24 },
 $79EE DEFB $30,$3E,$24,$18 ; { BYTE0(room_12_CORRIDOR,            0), 0x3E, 0x24, 24 },
 $79F2 DEFB $46,$1A,$22,$18 ; { BYTE0(room_17_CORRIDOR,            2), 0x1A, 0x22, 24 },
 $79F6 DEFB $75,$36,$36,$18 ; { BYTE0(room_29_SECOND_TUNNEL_START, 1), 0x36, 0x36, 24 },
 $79FA DEFB $27,$38,$0A,$0C ; { BYTE0(room_9_CRATE,                3), 0x38, 0x0A, 12 },
 $79FE DEFB $D1,$38,$62,$0C ; { BYTE0(room_52,                     1), 0x38, 0x62, 12 },
 $7A02 DEFB $7B,$38,$0A,$0C ; { BYTE0(room_30,                     3), 0x38, 0x0A, 12 },
 $7A06 DEFB $78,$64,$34,$0C ; { BYTE0(room_30,                     0), 0x64, 0x34, 12 },
 $7A0A DEFB $7E,$38,$26,$0C ; { BYTE0(room_31,                     2), 0x38, 0x26, 12 },
 $7A0E DEFB $79,$38,$62,$0C ; { BYTE0(room_30,                     1), 0x38, 0x62, 12 },
 $7A12 DEFB $93,$38,$0A,$0C ; { BYTE0(room_36,                     3), 0x38, 0x0A, 12 },
 $7A16 DEFB $7C,$64,$34,$0C ; { BYTE0(room_31,                     0), 0x64, 0x34, 12 },
 $7A1A DEFB $82,$0A,$34,$0C ; { BYTE0(room_32,                     2), 0x0A, 0x34, 12 },
 $7A1E DEFB $81,$38,$62,$0C ; { BYTE0(room_32,                     1), 0x38, 0x62, 12 },
 $7A22 DEFB $87,$20,$34,$0C ; { BYTE0(room_33,                     3), 0x20, 0x34, 12 },
 $7A26 DEFB $85,$40,$34,$0C ; { BYTE0(room_33,                     1), 0x40, 0x34, 12 },
 $7A2A DEFB $8F,$38,$0A,$0C ; { BYTE0(room_35,                     3), 0x38, 0x0A, 12 },
 $7A2E DEFB $8C,$64,$34,$0C ; { BYTE0(room_35,                     0), 0x64, 0x34, 12 },
 $7A32 DEFB $8A,$0A,$34,$0C ; { BYTE0(room_34,                     2), 0x0A, 0x34, 12 },
 $7A36 DEFB $90,$64,$34,$0C ; { BYTE0(room_36,                     0), 0x64, 0x34, 12 },
 $7A3A DEFB $8E,$38,$1C,$0C ; { BYTE0(room_35,                     2), 0x38, 0x1C, 12 },
 $7A3E DEFB $94,$3E,$22,$18 ; { BYTE0(room_37,                     0), 0x3E, 0x22, 24 }, // tunnel entrance
 $7A42 DEFB $0A,$10,$34,$0C ; { BYTE0(room_2_HUT2LEFT,             2), 0x10, 0x34, 12 },
 $7A46 DEFB $98,$64,$34,$0C ; { BYTE0(room_38,                     0), 0x64, 0x34, 12 },
 $7A4A DEFB $96,$10,$34,$0C ; { BYTE0(room_37,                     2), 0x10, 0x34, 12 },
 $7A4E DEFB $9D,$40,$34,$0C ; { BYTE0(room_39,                     1), 0x40, 0x34, 12 },
 $7A52 DEFB $9B,$20,$34,$0C ; { BYTE0(room_38,                     3), 0x20, 0x34, 12 },
 $7A56 DEFB $A0,$64,$34,$0C ; { BYTE0(room_40,                     0), 0x64, 0x34, 12 },
 $7A5A DEFB $9A,$38,$54,$0C ; { BYTE0(room_38,                     2), 0x38, 0x54, 12 },
 $7A5E DEFB $A1,$38,$62,$0C ; { BYTE0(room_40,                     1), 0x38, 0x62, 12 },
 $7A62 DEFB $A7,$38,$0A,$0C ; { BYTE0(room_41,                     3), 0x38, 0x0A, 12 },
 $7A66 DEFB $A4,$64,$34,$0C ; { BYTE0(room_41,                     0), 0x64, 0x34, 12 },
 $7A6A DEFB $AA,$38,$26,$0C ; { BYTE0(room_42,                     2), 0x38, 0x26, 12 },
 $7A6E DEFB $A5,$38,$62,$0C ; { BYTE0(room_41,                     1), 0x38, 0x62, 12 },
 $7A72 DEFB $B7,$38,$0A,$0C ; { BYTE0(room_45,                     3), 0x38, 0x0A, 12 },
 $7A76 DEFB $B4,$64,$34,$0C ; { BYTE0(room_45,                     0), 0x64, 0x34, 12 },
 $7A7A DEFB $B2,$38,$1C,$0C ; { BYTE0(room_44,                     2), 0x38, 0x1C, 12 },
 $7A7E DEFB $AD,$20,$34,$0C ; { BYTE0(room_43,                     1), 0x20, 0x34, 12 },
 $7A82 DEFB $B3,$38,$0A,$0C ; { BYTE0(room_44,                     3), 0x38, 0x0A, 12 },
 $7A86 DEFB $A9,$38,$62,$0C ; { BYTE0(room_42,                     1), 0x38, 0x62, 12 },
 $7A8A DEFB $AF,$20,$34,$0C ; { BYTE0(room_43,                     3), 0x20, 0x34, 12 },
 $7A8E DEFB $B8,$64,$34,$0C ; { BYTE0(room_46,                     0), 0x64, 0x34, 12 },
 $7A92 DEFB $9E,$38,$1C,$0C ; { BYTE0(room_39,                     2), 0x38, 0x1C, 12 },
 $7A96 DEFB $BD,$38,$62,$0C ; { BYTE0(room_47,                     1), 0x38, 0x62, 12 },
 $7A9A DEFB $BB,$20,$34,$0C ; { BYTE0(room_46,                     3), 0x20, 0x34, 12 },
 $7A9E DEFB $C8,$64,$34,$0C ; { BYTE0(room_50_BLOCKED_TUNNEL,      0), 0x64, 0x34, 12 },
 $7AA2 DEFB $BE,$38,$56,$0C ; { BYTE0(room_47,                     2), 0x38, 0x56, 12 },
 $7AA6 DEFB $C9,$38,$62,$0C ; { BYTE0(room_50_BLOCKED_TUNNEL,      1), 0x38, 0x62, 12 },
 $7AAA DEFB $C7,$38,$0A,$0C ; { BYTE0(room_49,                     3), 0x38, 0x0A, 12 },
 $7AAE DEFB $C4,$64,$34,$0C ; { BYTE0(room_49,                     0), 0x64, 0x34, 12 },
 $7AB2 DEFB $C2,$38,$1C,$0C ; { BYTE0(room_48,                     2), 0x38, 0x1C, 12 },
 $7AB6 DEFB $CD,$38,$62,$0C ; { BYTE0(room_51,                     1), 0x38, 0x62, 12 },
 $7ABA DEFB $77,$20,$34,$0C ; { BYTE0(room_29_SECOND_TUNNEL_START, 3), 0x20, 0x34, 12 },
 $7ABE DEFB $D0,$64,$34,$0C ; { BYTE0(room_52,                     0), 0x64, 0x34, 12 },
 $7AC2 DEFB $CE,$38,$54,$0C ; { BYTE0(room_51,                     2), 0x38, 0x54, 12 },

; Solitary map position.
;
; Used by solitary.
@label=solitary_pos
b$7AC6 DEFB $3A,$2A,$18 ; 0x3A, 0x2A, 24 // tinypos_t

; Check for 'pick up', 'drop' and 'use' input.
;
; Used by the routine at #R$9E07.
;
; I:A Input event.
@label=process_player_input_fire
c$7AC9 CP $0A        ; {if (A == input_UP_FIRE) pick_up_item();
 $7ACB JP NZ,$7AD3   ;
 $7ACE CALL $7B36    ;
 $7AD1 JR $7AEF      ; }
*$7AD3 CP $0B        ; {else if (A == input_DOWN_FIRE) drop_item();
 $7AD5 JP NZ,$7ADD   ;
 $7AD8 CALL $7B8B    ;
 $7ADB JR $7AEF      ; }
*$7ADD CP $0C        ; {else if (A == input_LEFT_FIRE) use_item_A();
 $7ADF JP NZ,$7AE7   ;
 $7AE2 CALL $7AF5    ;
 $7AE5 JR $7AEF      ; }
*$7AE7 CP $0F        ; {else if (A == input_RIGHT_FIRE) use_item_B();
 $7AE9 JP NZ,$7AEF   ;
 $7AEC CALL $7AF0    ; }
@label=check_for_pick_up_keypress_exit
*$7AEF RET           ; return;
; Use item 'B'.
@label=use_item_B
@isub=LD A,(items_held + 1)
*$7AF0 LD A,($8216)  ; A = items_held[1]; // $8216
 $7AF3 JR $7AF8      ; goto use_item_common;
; Use item 'A'.
@label=use_item_A
*$7AF5 LD A,($8215)  ; A = items_held[0]; // $8215
; Use item common.
@label=use_item_common
*$7AF8 CP $FF        ; {if (A == item_NONE) return;
 $7AFA RET Z         ; }
@rfix-begin
 $7AFB JR $7AFD      ; Bug: Pointless jump to adjacent instruction.
@rfix-end
*$7AFD ADD A,A       ; {HL = &item_actions_jump_table[A];
 $7AFE LD C,A        ;
 $7AFF LD B,$00      ;
@nowarn
 $7B01 LD HL,$7B16   ;
 $7B04 ADD HL,BC     ; }
 $7B05 LD A,(HL)     ; {L = *HL++;
 $7B06 INC HL        ; }
 $7B07 LD H,(HL)     ; {H = *HL;
 $7B08 LD L,A        ; }
 $7B09 PUSH HL       ; // exit via stacked jump table entry
 $7B0A LD DE,$81A4   ; {memcpy(&saved_pos_x, $800F, 6); // copy X,Y and height
 $7B0D LD HL,$800F   ;
 $7B10 LD BC,$0006   ;
 $7B13 LDIR          ; }
 $7B15 RET           ; return;
; Item actions jump table.
@label=item_actions_jump_table
 $7B16 DEFW $B417    ; action_wiresnips
 $7B18 DEFW $B3F6    ; action_shovel
 $7B1A DEFW $B495    ; action_lockpick
 $7B1C DEFW $EFCB    ; action_papers
 $7B1E DEFW $7AEF
 $7B20 DEFW $B3A8    ; action_bribe
 $7B22 DEFW $B3E1    ; action_uniform
 $7B24 DEFW $7AEF
 $7B26 DEFW $B3C4    ; action_poison
 $7B28 DEFW $B4AE    ; action_red_key
 $7B2A DEFW $B4B2    ; action_yellow_key
 $7B2C DEFW $B4B6    ; action_green_key
 $7B2E DEFW $B387    ; action_red_cross_parcel
 $7B30 DEFW $7AEF
 $7B32 DEFW $7AEF
 $7B34 DEFW $7AEF

; Pick up an item.
;
; Used by the routine at #R$7AC9.
@label=pick_up_item
c$7B36 LD HL,($8215) ; HL = items_held;
 $7B39 LD A,$FF      ; A = item_NONE;
 $7B3B CP L          ; {if (L != A && H != A) return; // no spare slots
 $7B3C JR Z,$7B40    ;
 $7B3E CP H          ;
 $7B3F RET NZ        ; }
*$7B40 CALL $7C82    ; find_nearby_item();
 $7B43 RET NZ        ; if (!Z) return; // no item nearby
; Locate an empty item slot.
 $7B44 LD DE,$8215   ; DE = &items_held[0];
 $7B47 LD A,(DE)     ; A = *DE;
 $7B48 CP $FF        ; {if (A != item_NONE) DE++;
 $7B4A JR Z,$7B4D    ;
 $7B4C INC DE        ; }
*$7B4D LD A,(HL)     ; {*DE = *HL & 0x1F; // item mask + extra bit (which is not seen elsewhere in the code...)
 $7B4E AND $1F       ;
 $7B50 LD (DE),A     ; }
 $7B51 PUSH HL
 $7B52 LD A,($68A0)  ; A = room_index;
 $7B55 CP $00        ; {if (A == 0) <% // outdoors
 $7B57 JP NZ,$7B5F   ; }
 $7B5A CALL $A8A2    ;   plot_all_tiles();
 $7B5D JR $7B6B      ; %>
*$7B5F CALL $6A35    ; else <% setup_room(); // indoors
 $7B62 CALL $6B42    ;   plot_interior_tiles();
 $7B65 CALL $AB6B    ;   choose_game_window_attributes();
 $7B68 CALL $A15F    ;   set_game_window_attributes(); %>
*$7B6B POP HL
 $7B6C BIT 7,(HL)    ; {if ((*HL & itemstruct_ITEM_FLAG_HELD) == 0) <%
 $7B6E JR NZ,$7B77   ; }
; Have picked up an item not previously held.
 $7B70 SET 7,(HL)    ;   *HL |= itemstruct_ITEM_FLAG_HELD;
 $7B72 PUSH HL
 $7B73 CALL $A0F2    ;   increase_morale_by_5_score_by_5();
 $7B76 POP HL        ;   %>
*$7B77 XOR A         ; A = 0;
 $7B78 INC HL        ; HL++;
 $7B79 LD (HL),A     ; *HL = A; // itemstruct->room_and_flags = 0
 $7B7A INC HL        ; {HL += 4;
 $7B7B INC HL        ;
 $7B7C INC HL        ;
 $7B7D INC HL        ; }
 $7B7E LD (HL),A     ; {*HL++ = A; // itemstruct->screenpos.x = 0
 $7B7F INC HL        ; }
 $7B80 LD (HL),A     ; *HL = A; // itemstruct->screenpos.x = 0
 $7B81 CALL $7C33    ; draw_all_items();
 $7B84 LD BC,$3030   ; {play_speaker(sound_PICK_UP_ITEM);
 $7B87 CALL $A11D    ; }
 $7B8A RET           ; return;

; Drop the first item.
;
; Used by the routine at #R$7AC9.
;
; .
;
; Return if no items held.
@label=drop_item
c$7B8B LD A,($8215)  ; A = items_held[0];
 $7B8E CP $FF        ; {if (A == item_NONE) return;
 $7B90 RET Z         ; }
; When dropping the uniform reset the player sprite.
 $7B91 CP $06        ; {if (A == item_UNIFORM) $8015 = sprite_prisoner;
 $7B93 JP NZ,$7B9C   ;
 $7B96 LD HL,$CE2E   ;
 $7B99 LD ($8015),HL ; }
*$7B9C PUSH AF
; Shuffle items down.
@isub=LD HL,items_held + 1
 $7B9D LD HL,$8216   ; HL = &items_held[1];  // item slot B
 $7BA0 LD A,(HL)     ; A = *HL;
 $7BA1 LD (HL),$FF   ; {*HL-- = item_NONE;
 $7BA3 DEC HL        ; }
 $7BA4 LD (HL),A     ; *HL = A;
 $7BA5 CALL $7C33    ; draw_all_items();
 $7BA8 LD BC,$3040   ; {play_speaker(sound_DROP_ITEM);
 $7BAB CALL $A11D    ; }
 $7BAE CALL $AB6B    ; choose_game_window_attributes();
 $7BB1 CALL $A15F    ; set_game_window_attributes();
 $7BB4 POP AF
; FALL THROUGH into drop_item_tail.

; Drop item, tail part.
;
; Used by the routine at #R$B387.
;
; I:A Item.
@label=drop_item_tail
c$7BB5 CALL $7C26    ; HL = item_to_itemstruct(A);
 $7BB8 INC HL        ; HL++;
 $7BB9 LD A,($68A0)  ; A = room_index;
 $7BBC LD (HL),A     ; *HL = A; // set object's room index
 $7BBD AND A         ; {if (A == 0) <%
 $7BBE JR NZ,$7BE4   ; }
; Outdoors.
 $7BC0 INC HL        ;   HL++;    // -> .x
 $7BC1 PUSH HL
; HL is incremented here but then immediately overwritten by $7BC5.
 $7BC2 INC HL        ; {  HL += 2; // -> .unk1
 $7BC3 INC HL        ; }
 $7BC4 POP DE
 $7BC5 LD HL,$800F   ;   HL = $800F;
 $7BC8 CALL $E542    ;   pos_to_tinypos(HL,DE);
 $7BCB DEC DE        ;   DE--;
 $7BCC LD A,$00      ; {  *DE = 0; // ->height ?
 $7BCE LD (DE),A     ; }
 $7BCF EX DE,HL
; FALL THROUGH into calc_exterior_item_screenpos.

; Assign target member for dropped exterior objects.
;
; Used by the routine at #R$CD31.
@label=calc_exterior_item_screenpos
c$7BD0 DEC HL        ; {  HL--; C = (0x40 + HL[1] - HL[0]) * 2; // itemstruct.y, itemstruct.x
 $7BD1 LD A,$40      ;
 $7BD3 ADD A,(HL)    ;
 $7BD4 DEC HL        ;
 $7BD5 SUB (HL)      ;
 $7BD6 ADD A,A       ;
 $7BD7 LD C,A        ; }
 $7BD8 XOR A         ; {  B = 0 - HL[0] - HL[1] - HL[2]; HL += 3; // itemstruct.x, .y, .height
 $7BD9 SUB (HL)      ;
 $7BDA INC HL        ;
 $7BDB SUB (HL)      ;
 $7BDC INC HL        ;
 $7BDD SUB (HL)      ;
 $7BDE LD B,A        ;
 $7BDF INC HL        ; }
 $7BE0 LD (HL),C     ; {  *HL++ = C;
 $7BE1 INC HL        ; }
 $7BE2 LD (HL),B     ;   *HL = B;
 $7BE3 RET           ;   return; %>

; Drop item, interior part.
;
; Used by the routine at #R$7BB5.
;
@label=drop_item_interior
c$7BE4 INC HL        ; else <% HL++; // The else is logically here when considered as part of drop_item.
 $7BE5 LD DE,$800F   ;   DE = $800F; // position on X axis
 $7BE8 LD A,(DE)     ; {  *HL++ = *DE;
 $7BE9 LD (HL),A     ;
 $7BEA INC HL        ; }
 $7BEB INC E         ; {  DE += 2; // position on Y axis
 $7BEC INC E         ; }
 $7BED LD A,(DE)     ; {  *HL++ = *DE;
 $7BEE LD (HL),A     ;
 $7BEF INC HL        ; }
 $7BF0 LD (HL),$05   ;   *HL = 5;
; FALL THROUGH into calc_interior_item_screenpos.

; Calculate screen position for dropped items.
;
; Used by the routine at #R$CD31.
@label=calc_interior_item_screenpos
c$7BF2 DEC HL        ;   HL--;
 $7BF3 LD D,$02      ; {  DE = 0x0200 + HL[0];  // 512 / 8 = 64
 $7BF5 LD E,(HL)     ; }
 $7BF6 EX DE,HL
 $7BF7 DEC DE        ;   DE--;
 $7BF8 LD A,(DE)     ; {  HL = (HL - DE[0]) * 2;
 $7BF9 LD C,A        ;
 $7BFA LD B,$00      ;
 $7BFC AND A         ;
 $7BFD SBC HL,BC     ;
 $7BFF ADD HL,HL     ; }
 $7C00 LD C,H        ; {  A = divide_by_8_with_rounding(H,L);
 $7C01 LD A,L        ;
 $7C02 CALL $E550    ; }
 $7C05 EX AF,AF'
 $7C06 LD HL,$0800   ; {  HL = 0x0800 - DE[0] - DE[1] - DE[2]; DE += 2;
 $7C09 LD B,$00      ;
 $7C0B LD A,(DE)     ;
 $7C0C LD C,A        ;
 $7C0D AND A         ;
 $7C0E SBC HL,BC     ;
 $7C10 INC DE        ;
 $7C11 LD A,(DE)     ;
 $7C12 LD C,A        ;
 $7C13 SBC HL,BC     ;
 $7C15 INC DE        ;
 $7C16 LD A,(DE)     ;
 $7C17 LD C,A        ;
 $7C18 SBC HL,BC     ; }
 $7C1A LD C,H        ; {  Adash = divide_by_8_with_rounding(H,L);
 $7C1B LD A,L        ;
 $7C1C CALL $E550    ; }
 $7C1F INC DE        ; {  DE += 2;
 $7C20 INC DE        ; }
 $7C21 LD (DE),A     ; {  *DE-- = Adash;
 $7C22 DEC DE        ; }
 $7C23 EX AF,AF'
 $7C24 LD (DE),A     ;   *DE = A;
 $7C25 RET           ;   return; %>

; Convert an item to an itemstruct pointer.
;
; Used by the routines at #R$7BB5, #R$A228 and #R$CD31.
;
; I:A  Item index.
; O:HL Pointer to itemstruct.
@label=item_to_itemstruct
c$7C26 LD L,A        ; {return &item_structs[A]; // $76C8 + A * 7
 $7C27 ADD A,A       ;
 $7C28 ADD A,A       ;
 $7C29 ADD A,A       ;
 $7C2A SUB L         ;
 $7C2B LD HL,$76C8   ;
 $7C2E ADD A,L       ;
 $7C2F LD L,A        ;
 $7C30 RET NC        ;
 $7C31 INC H         ;
 $7C32 RET           ; }

; Draw both held items.
;
; Used by the routines at #R$7B36, #R$7B8B, #R$B107, #R$B387, #R$B3C4, #R$B75A
; and #R$CB98.
@label=draw_all_items
c$7C33 LD HL,$5087   ; {draw_item(screenaddr_item1, items_held[0]);
 $7C36 LD A,($8215)  ;
 $7C39 CALL $7C46    ; }
 $7C3C LD HL,$508A   ; {draw_item(screenaddr_item2, items_held[1]);
 $7C3F LD A,($8216)  ;
 $7C42 CALL $7C46    ; }
 $7C45 RET           ; return;

; Draw a single held item.
;
; Used by the routine at #R$7C33.
;
; I:A  Item index.
; I:HL Screen address of item.
@label=draw_item
c$7C46 PUSH HL
 $7C47 EX AF,AF'
; Wipe item.
 $7C48 LD B,$02      ; B = 2; // 16 wide
 $7C4A LD C,$10      ; C = 16;
 $7C4C CALL $7CD4    ; screen_wipe();
 $7C4F POP HL
 $7C50 EX AF,AF'
 $7C51 CP $FF        ; {if (A == item_NONE) return;
 $7C53 RET Z         ; }
; Set screen attributes.
 $7C54 PUSH HL
 $7C55 LD H,$5A      ; HL = (HL & ~0xFF00) | 0x5A00; // point to screen attributes
 $7C57 PUSH AF
 $7C58 LD BC,$DD69   ; {A = item_attributes[A];
 $7C5B ADD A,C       ;
 $7C5C LD C,A        ;
 $7C5D JR NC,$7C60   ;
 $7C5F INC B         ;
*$7C60 LD A,(BC)     ; }
 $7C61 LD (HL),A     ; {*HL++ = A;
 $7C62 INC L         ; }
 $7C63 LD (HL),A     ; {*HL-- = A;
 $7C64 DEC L         ; }
; Move to next attribute row.
 $7C65 SET 5,L       ; HL |= 1<<5;
 $7C67 LD (HL),A     ; {*HL++ = A;
 $7C68 INC L         ; }
 $7C69 LD (HL),A     ; *HL = A;
 $7C6A POP AF
; Plot bitmap.
 $7C6B ADD A,A       ; {HL = &item_definitions[A]; // elements are six bytes
 $7C6C LD C,A        ; wide
 $7C6D ADD A,A       ;
 $7C6E ADD A,C       ;
 $7C6F LD C,A        ;
 $7C70 LD B,$00      ;
 $7C72 LD HL,$DD7D   ;
 $7C75 ADD HL,BC     ; }
 $7C76 LD B,(HL)     ; {B = *HL++;
 $7C77 INC HL        ; }
 $7C78 LD C,(HL)     ; {C = *HL++;
 $7C79 INC HL        ; }
 $7C7A LD E,(HL)     ; {E = *HL++;
 $7C7B INC HL        ; }
 $7C7C LD D,(HL)     ; D = *HL;
 $7C7D POP HL
 $7C7E CALL $7CBE    ; plot_bitmap();
 $7C81 RET           ; return;

; Returns an item within range of the hero.
;
; Used by the routine at #R$7B36.
;
; O:AF Z set if item found.
; O:HL If item was found contains pointer to the item.
;
; Select a pick up radius.
@label=find_nearby_item
c$7C82 LD C,$01      ; C = 1; // outdoors
 $7C84 LD A,($68A0)  ; {if (room_index) C = 6; // interior
 $7C87 AND A         ;
 $7C88 JR Z,$7C8C    ;
 $7C8A LD C,$06      ; }
; For all items.
*$7C8C LD B,$10      ; B = item__LIMIT; // 16 iterations
 $7C8E LD HL,$76C9   ; HL = &item_structs[0].room;
*$7C91 BIT 7,(HL)    ; {do <% if (*HL & itemstruct_ROOM_FLAG_ITEM_NEARBY_7) <%
 $7C93 JR Z,$7CB2    ; }
 $7C95 PUSH BC
 $7C96 PUSH HL
 $7C97 INC HL        ;     HL++; // itemstruct.x
 $7C98 LD DE,$81B8   ;     DE = &hero_map_position.x;
 $7C9B LD B,$02      ;     B = 2; // 2 iterations
; Range check.
*$7C9D LD A,(DE)     ; {    do <% A = *DE++; // get hero map position
 $7C9E SUB C         ; }
 $7C9F CP (HL)       ; {      if (A - C >= *HL || A + C < *HL) goto popnext;
 $7CA0 JR NC,$7CB0   ;
 $7CA2 ADD A,C       ;
 $7CA3 ADD A,C       ;
 $7CA4 CP (HL)       ;
 $7CA5 JR C,$7CB0    ; }
 $7CA7 INC HL        ; {      HL++;
 $7CA8 INC DE        ; }
 $7CA9 DJNZ $7C9D    ;     %> while (--B);
 $7CAB POP HL
 $7CAC DEC HL        ;     HL--; // compensate for overshoot
 $7CAD POP BC
 $7CAE XOR A         ;     A = 0; // set Z (found)
@bfix-begin
; Bug: The next instruction is written as RET Z but there's no need for it to
; be conditional.
 $7CAF RET Z         ;     return;
@bfix+else
 $7CAF RET           ;     return;
@bfix+end
*$7CB0 POP HL        ;     popnext:
 $7CB1 POP BC        ;     %>
*$7CB2 LD A,$07      ; {  HL += 7; // stride
 $7CB4 ADD A,L       ;
 $7CB5 LD L,A        ;
 $7CB6 JR NC,$7CB9   ;
 $7CB8 INC H         ; }
*$7CB9 DJNZ $7C91    ; %> while (--B);
 $7CBB OR $01        ; A |= 1; // set NZ (not found)
 $7CBD RET           ; return;

; Plot a bitmap without masking.
;
; Used by the routines at #R$7C46, #R$A035 and #R$A0C9.
;
; I:BC Dimensions (w x h, where w is in bytes).
; I:DE Source address.
; I:HL Destination address.
@label=plot_bitmap
c$7CBE LD A,B        ; A = B;
 $7CBF LD ($7CC3),A  ; (loopcounter + 1) = A; // self modifying
*$7CC2 LD B,$02      ; do <% loopcounter: B = 3; // modified
 $7CC4 PUSH HL       ;   dst = HL;
*$7CC5 LD A,(DE)     ; {  do <% *dst++ = *DE++; %> while (--B);
 $7CC6 LD (HL),A     ;
 $7CC7 INC L         ;
 $7CC8 INC DE        ;
 $7CC9 DJNZ $7CC5    ;
 $7CCB POP HL        ; }
 $7CCC CALL $7CE9    ;   get_next_scanline();
 $7CCF DEC C         ; {%> while (--C);
 $7CD0 JP NZ,$7CC2   ; }
 $7CD3 RET           ; return;

; Wipe the screen.
;
; Used by the routine at #R$7C46.
;
; I:B  Number of bytes to set.
; I:C  Number of scanlines.
; I:HL Destination address.
@label=screen_wipe
c$7CD4 LD A,B        ; A = B;
 $7CD5 LD ($7CD9),A  ; (loopcounter + 1) = A; // self modifying
*$7CD8 LD B,$02      ; do <% loopcounter: B = 2; // modified
 $7CDA PUSH HL       ;   dst = HL;
*$7CDB LD (HL),$00   ; {  do <% *dst++ = 0; %> while (--B);
 $7CDD INC L         ;
 $7CDE DJNZ $7CDB    ;
 $7CE0 POP HL        ; }
 $7CE1 CALL $7CE9    ;   get_next_scanline();
 $7CE4 DEC C         ; {%> while (--C);
 $7CE5 JP NZ,$7CD8   ; }
 $7CE8 RET           ; return;

; Given a screen address, return the same position on the next scanline.
;
; Used by the routines at #R$7CBE, #R$7CD4, #R$A035 and #R$F20B.
;
; I:HL Original screen address.
; O:HL Updated screen address.
@label=get_next_scanline
c$7CE9 INC H         ; HL += 256;
 $7CEA LD A,H        ; {if ((H & 7) != 0) return;
 $7CEB AND $07       ;
 $7CED RET NZ        ; }
 $7CEE PUSH DE
 $7CEF LD DE,$F820   ; DE = 0xF820;
 $7CF2 LD A,L        ; {if (L >= 0xE0) D = 0xFF;
 $7CF3 CP $E0        ;
 $7CF5 JR C,$7CF9    ;
 $7CF7 LD D,$FF      ; }
*$7CF9 ADD HL,DE     ; HL += DE;
 $7CFA POP DE
 $7CFB RET           ; return;

; Message queue stuff.
@label=message_queue
g$7CFC DEFB $FF,$FF,$00,$00,$00,$00,$00,$00 ; {Queue of message indexes. Pairs of bytes + 0xFF terminator.
 $7D04 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ;
 $7D0C DEFB $00,$00,$FF                     ; }
@label=message_display_delay
 $7D0F DEFB $00                             ; Decrementing counter which shows the next message when it reaches zero.
@label=message_display_index
 $7D10 DEFB $80                             ; Index into the message we're displaying or wiping. If 128 then next_message. If > 128 then wipe_message. Else display.
@label=message_queue_pointer
 $7D11 DEFW $7CFE                           ; Pointer to the next available slot in the message queue.
@label=current_message_character
 $7D13 DEFW $0000                           ; Pointer to the next message character to be displayed.

; Add a message to the pending messages queue.
;
; Used by the routines at #R$9DCF, #R$9E98, #R$A1D3, #R$A1E7, #R$A1F0, #R$A1F9,
; #R$A206, #R$A219, #R$A228, #R$B107, #R$B1D4, #R$B387, #R$B417, #R$B495,
; #R$B4B8, #R$CB98, #R$CD31 and #R$EF9A.
; .
; The use of C here is puzzling. One routine (check_morale) explicitly sets it
; to zero before calling, but others do not and we receive whatever was in C
; previously.
;
; I:B message_* index.
; I:C Possibly a second message index.
@label=queue_message_for_display
c$7D15 LD HL,($7D11) ; {if ((*HL = message_queue_pointer) == message_QUEUE_END) return; // queue full
 $7D18 LD A,$FF      ;
 $7D1A CP (HL)       ;
 $7D1B RET Z         ; }
; Is this message pending?
 $7D1C DEC HL        ; {HL -= 2;
 $7D1D DEC HL        ; }
 $7D1E LD A,(HL)     ; {if (*HL++ == B && *HL++ == C) return; // yes - skip adding it
 $7D1F CP B          ;
 $7D20 INC HL        ;
 $7D21 JR NZ,$7D26   ;
 $7D23 LD A,(HL)     ;
 $7D24 CP C          ;
 $7D25 RET Z         ; }
; Add it to the queue.
*$7D26 INC HL        ; {*HL++ = B; *HL++ = C;
 $7D27 LD (HL),B     ;
 $7D28 INC HL        ;
 $7D29 LD (HL),C     ;
 $7D2A INC HL        ; }
 $7D2B LD ($7D11),HL ; message_queue_pointer = HL;
 $7D2E RET           ; return;

; Plot a single glyph (indirectly).
;
; Used by the routines at #R$7D48, #R$A10B, #R$A5BF and #R$F350.
;
; I:HL Pointer to glyph.
; I:DE Pointer to destination.
; O:HL Preserved.
; O:DE Points to next character.
@label=plot_glyph
c$7D2F LD A,(HL)     ; A = *HL;
; FALL THROUGH into plot_single_glyph,

; Plot a single glyph.
;
; Used by the routine at #R$7D87.
c$7D30 PUSH HL
 $7D31 LD L,A        ; {HL = A * 8;
 $7D32 LD H,$00      ;
 $7D34 ADD HL,HL     ;
 $7D35 ADD HL,HL     ;
 $7D36 ADD HL,HL     ; }
 $7D37 LD BC,$A69E   ; BC = bitmap_font;
 $7D3A ADD HL,BC     ; {HL += BC;
 $7D3B PUSH DE       ; }
 $7D3C LD B,$08      ; B = 8; // 8 iterations
*$7D3E LD A,(HL)     ; {do <% *DE = *HL;
 $7D3F LD (DE),A     ; }
 $7D40 INC D         ; D++; // i.e. DE += 256;
 $7D41 INC HL        ; HL++;
 $7D42 DJNZ $7D3E    ; %> while (--B);
 $7D44 POP DE        ; {DE++;
 $7D45 INC DE        ;
 $7D46 POP HL        ; }
 $7D47 RET           ; return;

; Incrementally display queued game messages.
;
; Used by the routine at #R$9D7B.
;
; .
;
; Proceed only if message_display_delay is zero.
@label=message_display
c$7D48 LD A,($7D0F)  ; {if (message_display_delay > 0) <%
 $7D4B AND A         ;
 $7D4C JP Z,$7D54    ;
 $7D4F DEC A         ; }
 $7D50 LD ($7D0F),A  ;   message_display_delay--;
 $7D53 RET           ;   return; %>
; message_display_delay reached zero.
*$7D54 LD A,($7D10)  ; A = message_display_index;
 $7D57 CP $80        ; {if (A == 128) goto next_message; // exit via
 $7D59 JR Z,$7D99    ; }
 $7D5B JR NC,$7D87   ; else if (A > 128) goto wipe_message; // exit via
 $7D5D LD HL,($7D13) ; else <% HL = current_message_character;
@nowarn
 $7D60 LD DE,$50E0   ; {  DE = message_text_screen_address + A;
 $7D63 OR E          ;
 $7D64 LD E,A        ; }
 $7D65 CALL $7D2F    ;   plot_glyph();
 $7D68 LD A,E        ; {  message_display_index = E & 31;
 $7D69 AND $1F       ;
 $7D6B LD ($7D10),A  ; }
 $7D6E INC HL        ; {  A = *++HL;
 $7D6F LD A,(HL)     ; }
 $7D70 CP $FF        ; {  if (A == 255) <%
 $7D72 JP NZ,$7D83   ; }
; Leave the message for 31 turns, then wipe it.
 $7D75 LD A,$1F      ; {  message_display_delay = 31;
 $7D77 LD ($7D0F),A  ; }
 $7D7A LD A,($7D10)  ; {  message_display_index |= 128;
 $7D7D OR $80        ;
 $7D7F LD ($7D10),A  ; }
 $7D82 RET           ;   return; %>
*$7D83 LD ($7D13),HL ;   else <% current_message_character = HL;
 $7D86 RET           ;   return; %>

; Incrementally wipe away any on-screen game message.
;
; Used by the routine at #R$7D48.
@label=wipe_message
c$7D87 LD A,($7D10)  ; A = message_display_index;
 $7D8A DEC A         ; {message_display_index = --A;
 $7D8B LD ($7D10),A  ; }
@nowarn
 $7D8E LD DE,$50E0   ; {DE = message_text_screen_address + A;
 $7D91 OR E          ;
 $7D92 LD E,A        ; }
; Plot a single space character.
 $7D93 LD A,$23      ; {plot_single_glyph(35);
 $7D95 CALL $7D30    ; }
 $7D98 RET           ; return;

; Change to displaying the next queued game message.
;
; Used by the routine at #R$7D48.
; .
; Called when messages.display_index == 128.
@label=next_message
c$7D99 LD HL,($7D11) ; HL = message_queue_pointer;
 $7D9C LD DE,$7CFE   ; DE = &message_queue[2];
 $7D9F LD A,L        ; {if (L == E) return; // cheap test -- no more messages?
 $7DA0 CP E          ;
 $7DA1 RET Z         ;
 $7DA2 EX DE,HL      ; }
 $7DA3 LD A,(HL)     ; {A = *DE++;
 $7DA4 INC HL        ; }
@rsub-begin
; Bug: C is loaded here but not used. This could be a hangover from 16-bit
; message IDs.
 $7DA5 LD C,(HL)     ; C = *DE;
@rsub-end
 $7DA6 ADD A,A       ; {HL = messages_table[A];
 $7DA7 LD HL,$7DCD   ;
 $7DAA LD E,A        ;
 $7DAB LD D,$00      ;
 $7DAD ADD HL,DE     ;
 $7DAE LD E,(HL)     ;
 $7DAF INC HL        ;
 $7DB0 LD D,(HL)     ;
 $7DB1 EX DE,HL      ; }
 $7DB2 LD ($7D13),HL ; current_message_character = HL;
; Discard the first element.
 $7DB5 LD DE,$7CFC   ; {memmove(message_queue, message_queue + 2, 16);
 $7DB8 LD HL,$7CFE   ;
 $7DBB LD BC,$0010   ;
 $7DBE LDIR          ; }
 $7DC0 LD HL,($7D11) ; {message_queue_pointer -= 2;
 $7DC3 DEC HL        ;
 $7DC4 DEC HL        ;
 $7DC5 LD ($7D11),HL ; }
 $7DC8 XOR A         ; {message_display_index = 0;
 $7DC9 LD ($7D10),A  ; }
 $7DCC RET           ; return;

; Array of pointers to game messages.
@label=messages_table
w$7DCD DEFW $7DF5
 $7DCF DEFW $7E06
 $7DD1 DEFW $7E16
 $7DD3 DEFW $7E25
 $7DD5 DEFW $7E33
 $7DD7 DEFW $7E40
 $7DD9 DEFW $7E53
 $7DDB DEFW $7E5E
 $7DDD DEFW $7E6C
 $7DDF DEFW $7E76
 $7DE1 DEFW $7E87
 $7DE3 DEFW $7E98
 $7DE5 DEFW $7EA9
 $7DE7 DEFW $7EBA
 $7DE9 DEFW $7ECE
 $7DEB DEFW $7EDF
 $7DED DEFW $7EEE
 $7DEF DEFW $F026
 $7DF1 DEFW $F039
 $7DF3 DEFW $F04B

; Game messages.
;
; Non-ASCII: encoded to match the font; $FF terminated.
@label=messages_missed_roll_call
t$7DF5 DEFB $16,$12,$1B,$1B,$0E,$0D,$23,$1A,$00,$15,$15,$23,$0C,$0A,$15,$15,$FF             ; "MISSED ROLL CALL" #HTML[/ #CALL:decode_stringFF($7DF5)]
@label=messages_time_to_wake_up
 $7E06 DEFB $1C,$12,$16,$0E,$23,$1C,$00,$23,$1F,$0A,$14,$0E,$23,$1D,$18,$FF                 ; "TIME TO WAKE UP" #HTML[/ #CALL:decode_stringFF($7E06)]
@label=messages_breakfast_time
 $7E16 DEFB $0B,$1A,$0E,$0A,$14,$0F,$0A,$1B,$1C,$23,$1C,$12,$16,$0E,$FF                     ; "BREAKFAST TIME" #HTML[/ #CALL:decode_stringFF($7E16)]
@label=messages_exercise_time
 $7E25 DEFB $0E,$20,$0E,$1A,$0C,$12,$1B,$0E,$23,$1C,$12,$16,$0E,$FF                         ; "EXERCISE TIME" #HTML[/ #CALL:decode_stringFF($7E25)]
@label=messages_time_for_bed
 $7E33 DEFB $1C,$12,$16,$0E,$23,$0F,$00,$1A,$23,$0B,$0E,$0D,$FF                             ; "TIME FOR BED" #HTML[/ #CALL:decode_stringFF($7E33)]
@label=messages_the_door_is_locked
 $7E40 DEFB $1C,$11,$0E,$23,$0D,$00,$00,$1A,$23,$12,$1B,$23,$15,$00,$0C,$14,$0E,$0D,$FF     ; "THE DOOR IS LOCKED" #HTML[/ #CALL:decode_stringFF($7E40)]
@label=messages_it_is_open
 $7E53 DEFB $12,$1C,$23,$12,$1B,$23,$00,$18,$0E,$17,$FF                                     ; "IT IS OPEN" #HTML[/ #CALL:decode_stringFF($7E53)]
@label=messages_incorrect_key
 $7E5E DEFB $12,$17,$0C,$00,$1A,$1A,$0E,$0C,$1C,$23,$14,$0E,$21,$FF                         ; "INCORRECT KEY" #HTML[/ #CALL:decode_stringFF($7E5E)]
@label=messages_roll_call
 $7E6C DEFB $1A,$00,$15,$15,$23,$0C,$0A,$15,$15,$FF                                         ; "ROLL CALL" #HTML[/ #CALL:decode_stringFF($7E6C)]
@label=messages_red_cross_parcel
 $7E76 DEFB $1A,$0E,$0D,$23,$0C,$1A,$00,$1B,$1B,$23,$18,$0A,$1A,$0C,$0E,$15,$FF             ; "RED CROSS PARCEL" #HTML[/ #CALL:decode_stringFF($7E76)]
@label=messages_picking_the_lock
 $7E87 DEFB $18,$12,$0C,$14,$12,$17,$10,$23,$1C,$11,$0E,$23,$15,$00,$0C,$14,$FF             ; "PICKING THE LOCK" #HTML[/ #CALL:decode_stringFF($7E87)]
@label=messages_cutting_the_wire
 $7E98 DEFB $0C,$1D,$1C,$1C,$12,$17,$10,$23,$1C,$11,$0E,$23,$1F,$12,$1A,$0E,$FF             ; "CUTTING THE WIRE" #HTML[/ #CALL:decode_stringFF($7E98)]
@label=messages_you_open_the_box
 $7EA9 DEFB $21,$00,$1D,$23,$00,$18,$0E,$17,$23,$1C,$11,$0E,$23,$0B,$00,$20,$FF             ; "YOU OPEN THE BOX" #HTML[/ #CALL:decode_stringFF($7EA9)]
@label=messages_you_are_in_solitary
 $7EBA DEFB $21,$00,$1D,$23,$0A,$1A,$0E,$23,$12,$17,$23,$1B,$00,$15,$12,$1C,$0A,$1A,$21,$FF ; "YOU ARE IN SOLITARY" #HTML[/ #CALL:decode_stringFF($7EBA)]
@label=messages_wait_for_release
 $7ECE DEFB $1F,$0A,$12,$1C,$23,$0F,$00,$1A,$23,$1A,$0E,$15,$0E,$0A,$1B,$0E,$FF             ; "WAIT FOR RELEASE" #HTML[/ #CALL:decode_stringFF($7ECE)]
@label=messages_morale_is_zero
 $7EDF DEFB $16,$00,$1A,$0A,$15,$0E,$23,$12,$1B,$23,$22,$0E,$1A,$00,$FF                     ; "MORALE IS ZERO" #HTML[/ #CALL:decode_stringFF($7EDF)]
@label=messages_item_discovered
 $7EEE DEFB $12,$1C,$0E,$16,$23,$0D,$12,$1B,$0C,$00,$1E,$0E,$1A,$0E,$0D,$FF                 ; "ITEM DISCOVERED" #HTML[/ #CALL:decode_stringFF($7EEE)]

; Unreferenced bytes.
;
; Two alignment bytes to make static_tiles start at $7F00.
g$7EFE DEFB $00,$00 ; unused_7EFE

; Static tiles.
;
; These tiles are used to draw fixed screen elements such as medals.
; .
; 9 bytes each: 8x8 bitmap + 1 byte attribute. 75 tiles.
; .
; #UDGTABLE
; {
; #UDGARRAY75,6,1;$7F00,7;$7F09;$7F12;$7F1B;$7F24;$7F2D;$7F36;$7F3F;$7F48;$7F51;$7F5A;$7F63;$7F6C;$7F75;$7F7E;$7F87;$7F90;$7F99;$7FA2;$7FAB;$7FB4;$7FBD;$7FC6;$7FCF;$7FD8,7;$7FE1,7;$7FEA,7;$7FF3,7;$7FFC,4;$8005,4;$800E,4;$8017,4;$8020,3;$8029,7;$8032,3;$803B,3;$8044,3;$804D,3;$8056,3;$805F,3;$8068,3;$8071,3;$807A,3;$8083,3;$808C,7;$8095,3;$809E,3;$80A7,3;$80B0,3;$80B9,7;$80C2,7;$80CB;$80D4;$80DD;$80E6;$80EF,5;$80F8,5;$8101,4;$810A,4;$8113,4;$811C,7;$8125,7;$812E;$8137;$8140;$8149;$8152,5;$815B,5;$8164,5;$816D,4;$8176;$817F;$8188;$8191;$819A(static-tiles)
; }
; TABLE#
@label=static_tiles
b$7F00 DEFB $00,$00,$00,$00,$00,$00,$00,$00,$07 ; blank
 $7F09 DEFB $00,$00,$00,$00,$03,$04,$09,$0C,$06 ; speaker_tl_tl
 $7F12 DEFB $00,$00,$00,$00,$E0,$50,$10,$58,$06 ; speaker_tl_tr
 $7F1B DEFB $08,$0C,$09,$07,$01,$00,$00,$00,$06 ; speaker_tl_bl
 $7F24 DEFB $98,$3C,$7C,$FB,$FC,$6F,$17,$16,$06 ; speaker_tl_br
 $7F2D DEFB $00,$00,$00,$00,$07,$0A,$08,$1C,$06 ; speaker_tr_tl
 $7F36 DEFB $00,$00,$00,$00,$C0,$A0,$10,$50,$06 ; speaker_tr_tr
 $7F3F DEFB $19,$3C,$3E,$DF,$3F,$F6,$E8,$68,$06 ; speaker_tr_bl
 $7F48 DEFB $10,$B0,$10,$E0,$80,$00,$00,$00,$06 ; speaker_tr_br
 $7F51 DEFB $68,$E8,$F6,$3F,$DF,$3E,$3C,$18,$06 ; speaker_br_tl
 $7F5A DEFB $00,$00,$00,$80,$E0,$90,$30,$90,$06 ; speaker_br_tr
 $7F63 DEFB $19,$08,$0A,$07,$00,$00,$00,$00,$06 ; speaker_br_bl
 $7F6C DEFB $30,$10,$20,$C0,$00,$00,$00,$00,$06 ; speaker_br_br
 $7F75 DEFB $00,$00,$00,$01,$07,$08,$0C,$09,$06 ; speaker_bl_tl
 $7F7E DEFB $16,$17,$6F,$FC,$FB,$7C,$3C,$18,$06 ; speaker_bl_tr
 $7F87 DEFB $0C,$08,$05,$03,$00,$00,$00,$00,$06 ; speaker_bl_bl
 $7F90 DEFB $98,$10,$10,$E0,$00,$00,$00,$00,$06 ; speaker_bl_br
 $7F99 DEFB $10,$10,$91,$42,$5A,$24,$18,$24,$06 ; barbwire_v_top
 $7FA2 DEFB $18,$24,$52,$52,$91,$10,$10,$10,$06 ; barbwire_v_bottom
 $7FAB DEFB $10,$0C,$02,$FD,$01,$02,$0C,$10,$06 ; barbwire_h_left
 $7FB4 DEFB $04,$18,$A0,$57,$50,$A0,$18,$04,$06 ; barbwire_h_right
 $7FBD DEFB $02,$01,$00,$FF,$00,$00,$01,$02,$06 ; barbwire_h_wide_left
 $7FC6 DEFB $00,$83,$54,$AA,$2A,$54,$83,$00,$06 ; barbwire_h_wide_middle
 $7FCF DEFB $80,$00,$00,$FF,$00,$00,$00,$80,$06 ; barbwire_h_wide_right
 $7FD8 DEFB $00,$00,$00,$FE,$38,$38,$3E,$38,$07 ; flagpole_top
 $7FE1 DEFB $3A,$3A,$3A,$3A,$3A,$3A,$3A,$3A,$07 ; flagpole_middle
 $7FEA DEFB $7C,$7C,$7C,$7C,$7C,$7C,$7C,$7C,$07 ; flagpole_bottom
 $7FF3 DEFB $7C,$7C,$7C,$7A,$B5,$74,$7A,$FB,$07 ; flagpole_ground1
 $7FFC DEFB $00,$00,$10,$49,$49,$D5,$D4,$FD,$04 ; flagpole_ground2
 $8005 DEFB $00,$00,$00,$42,$A4,$2A,$5A,$BD,$04 ; flagpole_ground3
 $800E DEFB $00,$00,$00,$00,$40,$80,$D0,$A6,$04 ; flagpole_ground4
 $8017 DEFB $00,$00,$00,$00,$0A,$24,$55,$DB,$04 ; flagpole_ground0
 $8020 DEFB $00,$00,$00,$00,$1F,$08,$06,$06,$03 ; medal_0_0
 $8029 DEFB $00,$00,$00,$00,$FF,$00,$BA,$BA,$07 ; medal_0_1/3/5/7/9
 $8032 DEFB $00,$00,$00,$00,$FF,$30,$CE,$CE,$03 ; medal_0_2
 $803B DEFB $00,$00,$00,$00,$FF,$18,$E6,$E6,$03 ; medal_0_4
 $8044 DEFB $00,$00,$00,$00,$FF,$28,$C6,$C6,$03 ; medal_0_6
 $804D DEFB $00,$00,$00,$00,$F8,$10,$E0,$E0,$03 ; medal_0_8
 $8056 DEFB $06,$06,$06,$06,$06,$06,$06,$06,$03 ; medal_1_0
 $805F DEFB $CE,$CE,$CE,$CE,$CE,$CE,$CE,$CE,$03 ; medal_1_2
 $8068 DEFB $E6,$E6,$E6,$E6,$E6,$E6,$E6,$E6,$03 ; medal_1_4
 $8071 DEFB $C6,$C6,$C6,$C6,$C6,$C6,$C6,$C6,$03 ; medal_1_6
 $807A DEFB $E0,$E0,$E0,$E0,$E0,$E0,$E0,$E0,$03 ; medal_1_8
 $8083 DEFB $06,$06,$06,$06,$02,$04,$07,$00,$03 ; medal_1_10
 $808C DEFB $00,$BA,$BA,$BA,$BA,$00,$FF,$10,$07 ; medal_2_0
 $8095 DEFB $CE,$CE,$CE,$CE,$86,$48,$CF,$00,$03 ; medal_2_1/3/5/7/9
 $809E DEFB $E6,$E6,$E6,$E6,$C2,$24,$E7,$00,$03 ; medal_2_2
 $80A7 DEFB $C6,$C6,$C6,$C6,$82,$44,$C7,$00,$03 ; medal_2_4
 $80B0 DEFB $E0,$E0,$E0,$E0,$C0,$20,$E0,$00,$03 ; medal_2_6
 $80B9 DEFB $03,$02,$02,$02,$02,$01,$02,$02,$07 ; medal_2_8
 $80C2 DEFB $EF,$38,$FE,$AA,$B2,$FF,$96,$A2,$07 ; medal_2_10
 $80CB DEFB $80,$81,$83,$87,$86,$0E,$8E,$86,$06 ; medal_3_0
 $80D4 DEFB $7C,$FF,$C7,$11,$E0,$72,$5C,$A6,$06 ; medal_3_1
 $80DD DEFB $00,$00,$81,$C1,$C3,$E3,$E3,$C1,$06 ; medal_3_2
 $80E6 DEFB $38,$FE,$C7,$AB,$6D,$01,$6D,$AB,$06 ; medal_3_3
 $80EF DEFB $00,$00,$00,$00,$8C,$8F,$8B,$08,$05 ; medal_3_4
 $80F8 DEFB $FE,$C6,$6C,$6C,$28,$39,$D7,$6C,$05 ; medal_3_5
 $8101 DEFB $00,$00,$00,$01,$61,$E6,$A6,$26,$04 ; medal_3_6
 $810A DEFB $38,$38,$C6,$BB,$45,$BA,$BA,$BA,$04 ; medal_3_7
 $8113 DEFB $00,$00,$00,$00,$00,$C0,$C0,$C0,$04 ; medal_3_8
 $811C DEFB $02,$02,$03,$00,$00,$00,$00,$00,$07 ; medal_3_9
 $8125 DEFB $FE,$10,$EF,$00,$00,$00,$00,$00,$07 ; medal_4_0
 $812E DEFB $87,$83,$81,$00,$00,$00,$00,$00,$06 ; medal_4_1
 $8137 DEFB $19,$C7,$FF,$7C,$00,$00,$00,$00,$06 ; medal_4_2
 $8140 DEFB $C1,$80,$00,$00,$00,$00,$00,$00,$06 ; medal_4_3
 $8149 DEFB $C7,$FE,$38,$00,$00,$00,$00,$00,$06 ; medal_4_4
 $8152 DEFB $0B,$0F,$0C,$00,$00,$00,$00,$00,$05 ; medal_4_5
 $815B DEFB $D7,$39,$28,$6C,$6C,$C6,$FE,$00,$05 ; medal_4_6
 $8164 DEFB $A1,$E1,$60,$00,$00,$00,$00,$00,$05 ; medal_4_7
 $816D DEFB $45,$BB,$C6,$38,$38,$00,$00,$00,$04 ; medal_4_8
 $8176 DEFB $00,$00,$00,$01,$03,$03,$06,$06,$06 ; medal_4_9
 $817F DEFB $00,$00,$7E,$FF,$8F,$7F,$FF,$FF,$06 ; bell_top_middle
 $8188 DEFB $00,$00,$00,$80,$C0,$C0,$E0,$E0,$06 ; bell_top_right
 $8191 DEFB $06,$E7,$E7,$87,$83,$43,$41,$20,$06 ; bell_middle_left
 $819A DEFB $E7,$E7,$FF,$FF,$FE,$F9,$FF,$7E,$06 ; bell_middle_middle

; Unreferenced byte.
g$81A3 DEFB $E0      ; unused_81A3

; Saved/stashed position.
;
; Structure type: pos_t.
@label=saved_pos_x
g$81A4 DEFW $60E0    ; saved_pos_x
@label=saved_pos_y
 $81A6 DEFW $C060    ; saved_pos_y
@label=saved_height
 $81A8 DEFW $80C0    ; saved_height

; Used by touch() only.
@label=touch_stashed_A
g$81AA DEFB $00      ; touch_stashed_A

; Unreferenced byte.
g$81AB DEFB $06      ; unused_81AB

; Bitmap and mask pointers.
@label=bitmap_pointer
g$81AC DEFW $0810    ; bitmap_pointer
@label=mask_pointer
 $81AE DEFW $0204    ; mask_pointer
@label=foreground_mask_pointer
 $81B0 DEFW $0102    ; foreground_mask_pointer

; Saved/stashed position.
;
; Structure type: tinypos_t.
; .
; Written by setup_item_plotting, setup_vischar_plotting.
; .
; Read by render_mask_buffer, guards_follow_suspicious_character.
@label=tinypos_stash_x
g$81B2 DEFB $01      ; tinypos_stash_x
@label=tinypos_stash_y
 $81B3 DEFB $00      ; tinypos_stash_y
@label=tinypos_stash_height
 $81B4 DEFB $06      ; tinypos_stash_height

; Map position related variables.
@label=screenpos_x
g$81B5 DEFB $81      ; screenpos_x
@label=screenpos_y
 $81B6 DEFB $FF      ; screenpos_y

; Controls character left/right flipping.
@label=flip_sprite
g$81B7 DEFB $E7      ; flip_sprite

; Hero's map position.
;
; Structure type: tinypos_t.
@label=hero_map_position_x
g$81B8 DEFB $DB      ; hero_map_position_x
@label=hero_map_position_y
 $81B9 DEFB $DB      ; hero_map_position_y
@label=hero_map_position_height
 $81BA DEFB $FF      ; hero_map_position_height

; Map position.
;
; Used when drawing tiles.
@label=map_position
g$81BB DEFW $FF81    ; map_position

; Searchlight state.
;
; Suspect that this is a 'hero has been found in searchlight' flag. (possible
; states: 0, 31, 255)
; .
; Used by the routines at #R$ADBD, #R$B866.
; .
; #TABLE(default,centre)
; { =h Value | =h Meaning }
; { 0 | Searchlight is sweeping }
; { 31 | Searchlight is tracking the hero }
; { 255 | Searchlight is off }
; TABLE#
@label=searchlight_state
g$81BD DEFB $04      ; searchlight_state

; Copy of first byte of current room def.
;
; Indexes roomdef_bounds[].
@label=roomdef_bounds_index
g$81BE DEFB $00      ; roomdef_bounds_index

; Count of object bounds.
@label=roomdef_object_bounds_count
g$81BF DEFB $38      ; roomdef_object_bounds_count

; Copy of current room def's additional bounds (allows for four room objects).
@label=roomdef_object_bounds
g$81C0 DEFB $44,$CA,$D2,$E2
 $81C4 DEFB $7C,$38,$47,$00
 $81C8 DEFB $00,$00,$00,$00
 $81CC DEFB $00,$00,$00,$00

; Unreferenced bytes.
;
; These are possibly spare object bounds bytes, but not ever used.
g$81D0 DEFB $00,$00,$00,$00,$00,$00 ; unused_81D0

; Indices of interior doors.
;
; Used by the routines at #R$69DC, #R$B32D, #R$B4D0.
@label=interior_doors
g$81D6 DEFB $FF,$FF,$FF,$FF

; Interior mask data.
;
; Used by the routines at #R$6A35, #R$B916.
;
; FIXME: First byte is a count.
;
@label=interior_mask_data
g$81DA DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; {interior_mask_data
 $81E2 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $81EA DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $81F2 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $81FA DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $8202 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $820A DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $8212 DEFB $00                             ; }

; Written to by #R$DC41 setup_item_plotting but never read.
@label=saved_item
g$8213 DEFB $00      ; saved_item

; A copy of item_definition height.
;
; Used by the routines at #R$DC41, #R$DD02.
@label=item_height
g$8214 DEFB $00      ; item_height

; The items which the hero is holding.
;
; Each byte holds one item. Initialised to 0xFFFF meaning no item in either
; slot.
@label=items_held
g$8215 DEFW $FF05    ; items_held

; The current character index.
@label=character_index
g$8217 DEFB $00      ; character_index

; Tiles
;
; Exterior tiles set 0. 111 tiles. Looks like mask tiles for huts. (<-
; plot_tile)
@label=tiles
@label=mask_tiles
b$8218 DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8218-$821F-8(exterior-tiles0-000)]
 $8220 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8220-$8227-8(exterior-tiles0-001)]
 $8228 DEFB $FE,$FE,$FE,$FE,$FE,$FE,$FE,$FE ; #HTML[#UDGARRAY1,7,4,1;$8228-$822F-8(exterior-tiles0-002)]
 $8230 DEFB $FF,$FF,$FF,$FC,$F0,$C0,$C0,$00 ; #HTML[#UDGARRAY1,7,4,1;$8230-$8237-8(exterior-tiles0-003)]
 $8238 DEFB $F0,$C0,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8238-$823F-8(exterior-tiles0-004)]
 $8240 DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FC ; #HTML[#UDGARRAY1,7,4,1;$8240-$8247-8(exterior-tiles0-005)]
 $8248 DEFB $FF,$FF,$FF,$FC,$F0,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8248-$824F-8(exterior-tiles0-006)]
 $8250 DEFB $FF,$FF,$FF,$FF,$FF,$F0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8250-$8257-8(exterior-tiles0-007)]
 $8258 DEFB $FF,$FF,$FF,$F0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8258-$825F-8(exterior-tiles0-008)]
 $8260 DEFB $FF,$F0,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8260-$8267-8(exterior-tiles0-009)]
 $8268 DEFB $7F,$3F,$1F,$0F,$07,$03,$01,$00 ; #HTML[#UDGARRAY1,7,4,1;$8268-$826F-8(exterior-tiles0-010)]
 $8270 DEFB $FF,$7F,$3F,$1F,$0F,$07,$07,$03 ; #HTML[#UDGARRAY1,7,4,1;$8270-$8277-8(exterior-tiles0-011)]
 $8278 DEFB $FF,$FF,$7F,$3F,$3F,$1F,$0F,$07 ; #HTML[#UDGARRAY1,7,4,1;$8278-$827F-8(exterior-tiles0-012)]
 $8280 DEFB $03,$03,$01,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8280-$8287-8(exterior-tiles0-013)]
 $8288 DEFB $FF,$FF,$FF,$FF,$7F,$3F,$1F,$1F ; #HTML[#UDGARRAY1,7,4,1;$8288-$828F-8(exterior-tiles0-014)]
 $8290 DEFB $0F,$07,$03,$01,$01,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8290-$8297-8(exterior-tiles0-015)]
 $8298 DEFB $FF,$FF,$FF,$FF,$FF,$FF,$7F,$3F ; #HTML[#UDGARRAY1,7,4,1;$8298-$829F-8(exterior-tiles0-016)]
 $82A0 DEFB $3F,$1F,$3F,$7F,$7F,$7F,$7F,$7F ; #HTML[#UDGARRAY1,7,4,1;$82A0-$82A7-8(exterior-tiles0-017)]
 $82A8 DEFB $7F,$7F,$7F,$7F,$7F,$7F,$7F,$7F ; #HTML[#UDGARRAY1,7,4,1;$82A8-$82AF-8(exterior-tiles0-018)]
 $82B0 DEFB $03,$C0,$F0,$F0,$F8,$D8,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$82B0-$82B7-8(exterior-tiles0-019)]
 $82B8 DEFB $C3,$81,$03,$01,$03,$00,$00,$10 ; #HTML[#UDGARRAY1,7,4,1;$82B8-$82BF-8(exterior-tiles0-020)]
 $82C0 DEFB $FF,$FF,$FF,$FF,$FF,$DF,$0F,$0D ; #HTML[#UDGARRAY1,7,4,1;$82C0-$82C7-8(exterior-tiles0-021)]
 $82C8 DEFB $C0,$80,$00,$00,$03,$07,$03,$00 ; #HTML[#UDGARRAY1,7,4,1;$82C8-$82CF-8(exterior-tiles0-022)]
 $82D0 DEFB $FF,$DF,$0F,$0D,$00,$00,$B0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$82D0-$82D7-8(exterior-tiles0-023)]
 $82D8 DEFB $00,$00,$B0,$F0,$FB,$DF,$0F,$0D ; #HTML[#UDGARRAY1,7,4,1;$82D8-$82DF-8(exterior-tiles0-024)]
 $82E0 DEFB $00,$04,$07,$07,$07,$07,$07,$03 ; #HTML[#UDGARRAY1,7,4,1;$82E0-$82E7-8(exterior-tiles0-025)]
 $82E8 DEFB $CF,$0F,$03,$80,$90,$9C,$CF,$CF ; #HTML[#UDGARRAY1,7,4,1;$82E8-$82EF-8(exterior-tiles0-026)]
 $82F0 DEFB $00,$00,$B0,$D0,$0B,$0F,$03,$00 ; #HTML[#UDGARRAY1,7,4,1;$82F0-$82F7-8(exterior-tiles0-027)]
 $82F8 DEFB $90,$9C,$CF,$CF,$CF,$0F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$82F8-$82FF-8(exterior-tiles0-028)]
 $8300 DEFB $0E,$0E,$0E,$02,$90,$9C,$CE,$CE ; #HTML[#UDGARRAY1,7,4,1;$8300-$8307-8(exterior-tiles0-029)]
 $8308 DEFB $00,$00,$00,$03,$0F,$3F,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8308-$830F-8(exterior-tiles0-030)]
 $8310 DEFB $0E,$0E,$0E,$02,$B0,$FC,$FE,$FE ; #HTML[#UDGARRAY1,7,4,1;$8310-$8317-8(exterior-tiles0-031)]
 $8318 DEFB $0F,$0F,$0F,$03,$B0,$FC,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8318-$831F-8(exterior-tiles0-032)]
 $8320 DEFB $00,$9C,$FF,$FF,$FF,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8320-$8327-8(exterior-tiles0-033)]
 $8328 DEFB $00,$00,$0D,$0B,$D8,$F8,$C0,$01 ; #HTML[#UDGARRAY1,7,4,1;$8328-$832F-8(exterior-tiles0-034)]
 $8330 DEFB $FF,$FF,$FF,$FF,$FF,$FB,$F0,$B0 ; #HTML[#UDGARRAY1,7,4,1;$8330-$8337-8(exterior-tiles0-035)]
 $8338 DEFB $C3,$81,$C0,$80,$C0,$00,$00,$08 ; #HTML[#UDGARRAY1,7,4,1;$8338-$833F-8(exterior-tiles0-036)]
 $8340 DEFB $00,$03,$0F,$0F,$1F,$1B,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8340-$8347-8(exterior-tiles0-037)]
 $8348 DEFB $FF,$FB,$F0,$B0,$00,$00,$0D,$0F ; #HTML[#UDGARRAY1,7,4,1;$8348-$834F-8(exterior-tiles0-038)]
 $8350 DEFB $00,$00,$0D,$0F,$DF,$FB,$F0,$B0 ; #HTML[#UDGARRAY1,7,4,1;$8350-$8357-8(exterior-tiles0-039)]
 $8358 DEFB $00,$01,$00,$00,$C0,$E0,$C0,$00 ; #HTML[#UDGARRAY1,7,4,1;$8358-$835F-8(exterior-tiles0-040)]
 $8360 DEFB $F0,$F8,$F1,$C1,$09,$39,$F3,$F3 ; #HTML[#UDGARRAY1,7,4,1;$8360-$8367-8(exterior-tiles0-041)]
 $8368 DEFB $00,$20,$E0,$E0,$E0,$E0,$E0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8368-$836F-8(exterior-tiles0-042)]
 $8370 DEFB $09,$39,$F3,$F3,$F3,$F0,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8370-$8377-8(exterior-tiles0-043)]
 $8378 DEFB $00,$00,$00,$C0,$F0,$FC,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8378-$837F-8(exterior-tiles0-044)]
 $8380 DEFB $00,$39,$FF,$FF,$FF,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8380-$8387-8(exterior-tiles0-045)]
 $8388 DEFB $79,$7C,$70,$40,$0D,$3F,$7F,$7F ; #HTML[#UDGARRAY1,7,4,1;$8388-$838F-8(exterior-tiles0-046)]
 $8390 DEFB $7B,$78,$70,$41,$09,$39,$73,$73 ; #HTML[#UDGARRAY1,7,4,1;$8390-$8397-8(exterior-tiles0-047)]
 $8398 DEFB $FF,$FF,$FF,$3F,$0F,$03,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8398-$839F-8(exterior-tiles0-048)]
 $83A0 DEFB $F0,$F0,$C0,$00,$0D,$3F,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$83A0-$83A7-8(exterior-tiles0-049)]
 $83A8 DEFB $0F,$03,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$83A8-$83AF-8(exterior-tiles0-050)]
 $83B0 DEFB $9F,$0F,$07,$0F,$0F,$07,$0F,$9F ; #HTML[#UDGARRAY1,7,4,1;$83B0-$83B7-8(exterior-tiles0-051)]
 $83B8 DEFB $F9,$F0,$E0,$F0,$F0,$E0,$F0,$F9 ; #HTML[#UDGARRAY1,7,4,1;$83B8-$83BF-8(exterior-tiles0-052)]
 $83C0 DEFB $C0,$C0,$C1,$C0,$C0,$C0,$C0,$00 ; #HTML[#UDGARRAY1,7,4,1;$83C0-$83C7-8(exterior-tiles0-053)]
 $83C8 DEFB $03,$03,$83,$03,$03,$03,$03,$00 ; #HTML[#UDGARRAY1,7,4,1;$83C8-$83CF-8(exterior-tiles0-054)]
 $83D0 DEFB $00,$00,$00,$00,$00,$38,$FE,$FF ; #HTML[#UDGARRAY1,7,4,1;$83D0-$83D7-8(exterior-tiles0-055)]
 $83D8 DEFB $0F,$3F,$7F,$7F,$7F,$7F,$7F,$7F ; #HTML[#UDGARRAY1,7,4,1;$83D8-$83DF-8(exterior-tiles0-056)]
 $83E0 DEFB $01,$01,$01,$01,$01,$01,$01,$01 ; #HTML[#UDGARRAY1,7,4,1;$83E0-$83E7-8(exterior-tiles0-057)]
 $83E8 DEFB $00,$00,$00,$00,$00,$01,$03,$03 ; #HTML[#UDGARRAY1,7,4,1;$83E8-$83EF-8(exterior-tiles0-058)]
 $83F0 DEFB $00,$00,$00,$00,$00,$80,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$83F0-$83F7-8(exterior-tiles0-059)]
 $83F8 DEFB $80,$80,$80,$80,$80,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$83F8-$83FF-8(exterior-tiles0-060)]
 $8400 DEFB $F0,$FC,$FE,$FE,$FE,$FE,$FE,$FE ; #HTML[#UDGARRAY1,7,4,1;$8400-$8407-8(exterior-tiles0-061)]
 $8408 DEFB $00,$00,$00,$00,$00,$1C,$7F,$FF ; #HTML[#UDGARRAY1,7,4,1;$8408-$840F-8(exterior-tiles0-062)]
 $8410 DEFB $00,$00,$00,$00,$00,$00,$00,$03 ; #HTML[#UDGARRAY1,7,4,1;$8410-$8417-8(exterior-tiles0-063)]
 $8418 DEFB $00,$00,$00,$00,$00,$00,$00,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8418-$841F-8(exterior-tiles0-064)]
 $8420 DEFB $0F,$3F,$FF,$FF,$FF,$FF,$FC,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8420-$8427-8(exterior-tiles0-065)]
 $8428 DEFB $00,$00,$00,$03,$01,$03,$07,$1F ; #HTML[#UDGARRAY1,7,4,1;$8428-$842F-8(exterior-tiles0-066)]
 $8430 DEFB $1F,$1F,$1C,$10,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8430-$8437-8(exterior-tiles0-067)]
 $8438 DEFB $C0,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8438-$843F-8(exterior-tiles0-068)]
 $8440 DEFB $FF,$FF,$FC,$F0,$C0,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8440-$8447-8(exterior-tiles0-069)]
 $8448 DEFB $03,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8448-$844F-8(exterior-tiles0-070)]
 $8450 DEFB $FF,$FF,$3F,$0F,$03,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8450-$8457-8(exterior-tiles0-071)]
 $8458 DEFB $F0,$FC,$FF,$FF,$FF,$FF,$3F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8458-$845F-8(exterior-tiles0-072)]
 $8460 DEFB $00,$00,$00,$C0,$80,$C0,$E0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8460-$8467-8(exterior-tiles0-073)]
 $8468 DEFB $80,$C0,$E0,$E0,$E0,$E0,$E0,$E0 ; #HTML[#UDGARRAY1,7,4,1;$8468-$846F-8(exterior-tiles0-074)]
 $8470 DEFB $F8,$F8,$38,$08,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8470-$8477-8(exterior-tiles0-075)]
 $8478 DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$3F ; #HTML[#UDGARRAY1,7,4,1;$8478-$847F-8(exterior-tiles0-076)]
 $8480 DEFB $00,$00,$01,$01,$01,$01,$01,$01 ; #HTML[#UDGARRAY1,7,4,1;$8480-$8487-8(exterior-tiles0-077)]
 $8488 DEFB $00,$00,$80,$80,$80,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$8488-$848F-8(exterior-tiles0-078)]
 $8490 DEFB $3F,$0F,$03,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8490-$8497-8(exterior-tiles0-079)]
 $8498 DEFB $00,$00,$00,$00,$10,$1C,$8F,$8F ; #HTML[#UDGARRAY1,7,4,1;$8498-$849F-8(exterior-tiles0-080)]
 $84A0 DEFB $00,$00,$00,$00,$10,$1C,$8C,$8C ; #HTML[#UDGARRAY1,7,4,1;$84A0-$84A7-8(exterior-tiles0-081)]
 $84A8 DEFB $00,$00,$00,$00,$00,$00,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$84A8-$84AF-8(exterior-tiles0-082)]
 $84B0 DEFB $0C,$0C,$00,$00,$10,$1C,$8C,$8C ; #HTML[#UDGARRAY1,7,4,1;$84B0-$84B7-8(exterior-tiles0-083)]
 $84B8 DEFB $0F,$0F,$03,$00,$00,$C0,$F0,$FC ; #HTML[#UDGARRAY1,7,4,1;$84B8-$84BF-8(exterior-tiles0-084)]
 $84C0 DEFB $0C,$0C,$00,$00,$00,$C0,$F0,$FC ; #HTML[#UDGARRAY1,7,4,1;$84C0-$84C7-8(exterior-tiles0-085)]
 $84C8 DEFB $FC,$D8,$08,$08,$00,$00,$B0,$F8 ; #HTML[#UDGARRAY1,7,4,1;$84C8-$84CF-8(exterior-tiles0-086)]
 $84D0 DEFB $3F,$1B,$10,$10,$00,$00,$0D,$1F ; #HTML[#UDGARRAY1,7,4,1;$84D0-$84D7-8(exterior-tiles0-087)]
 $84D8 DEFB $38,$08,$00,$00,$10,$18,$88,$88 ; #HTML[#UDGARRAY1,7,4,1;$84D8-$84DF-8(exterior-tiles0-088)]
 $84E0 DEFB $1C,$10,$00,$00,$08,$18,$11,$11 ; #HTML[#UDGARRAY1,7,4,1;$84E0-$84E7-8(exterior-tiles0-089)]
 $84E8 DEFB $FF,$FF,$FF,$FF,$FF,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$84E8-$84EF-8(exterior-tiles0-090)]
 $84F0 DEFB $FF,$3F,$0F,$03,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$84F0-$84F7-8(exterior-tiles0-091)]
 $84F8 DEFB $FF,$FC,$F0,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$84F8-$84FF-8(exterior-tiles0-092)]
 $8500 DEFB $FF,$FF,$FF,$FF,$FF,$FC,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8500-$8507-8(exterior-tiles0-093)]
 $8508 DEFB $3F,$3F,$1F,$0F,$0F,$03,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8508-$850F-8(exterior-tiles0-094)]
 $8510 DEFB $7F,$7F,$7F,$7F,$7F,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8510-$8517-8(exterior-tiles0-095)]
 $8518 DEFB $1F,$1F,$1F,$1F,$1F,$1F,$1F,$1F ; #HTML[#UDGARRAY1,7,4,1;$8518-$851F-8(exterior-tiles0-096)]
 $8520 DEFB $F8,$F8,$F8,$F8,$F8,$F8,$F8,$F8 ; #HTML[#UDGARRAY1,7,4,1;$8520-$8527-8(exterior-tiles0-097)]
 $8528 DEFB $FE,$FE,$FE,$FE,$FF,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8528-$852F-8(exterior-tiles0-098)]
 $8530 DEFB $FF,$FF,$FC,$F0,$C0,$00,$03,$0F ; #HTML[#UDGARRAY1,7,4,1;$8530-$8537-8(exterior-tiles0-099)]
 $8538 DEFB $C0,$00,$02,$0E,$3E,$FE,$FE,$FE ; #HTML[#UDGARRAY1,7,4,1;$8538-$853F-8(exterior-tiles0-100)]
 $8540 DEFB $03,$00,$40,$70,$7C,$7F,$7F,$7F ; #HTML[#UDGARRAY1,7,4,1;$8540-$8547-8(exterior-tiles0-101)]
 $8548 DEFB $FF,$FF,$3F,$0F,$03,$00,$C0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8548-$854F-8(exterior-tiles0-102)]
 $8550 DEFB $FF,$FF,$3F,$0F,$07,$0F,$0F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8550-$8557-8(exterior-tiles0-103)]
 $8558 DEFB $FF,$FF,$FF,$FF,$FF,$FF,$3F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8558-$855F-8(exterior-tiles0-104)]
 $8560 DEFB $07,$07,$07,$07,$07,$07,$07,$07 ; #HTML[#UDGARRAY1,7,4,1;$8560-$8567-8(exterior-tiles0-105)]
 $8568 DEFB $0F,$03,$00,$10,$18,$08,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8568-$856F-8(exterior-tiles0-106)]
 $8570 DEFB $FF,$FF,$3F,$1F,$3F,$FF,$7F,$7F ; #HTML[#UDGARRAY1,7,4,1;$8570-$8577-8(exterior-tiles0-107)]
 $8578 DEFB $FF,$FF,$FF,$FF,$FF,$F3,$C1,$01 ; #HTML[#UDGARRAY1,7,4,1;$8578-$857F-8(exterior-tiles0-108)]
 $8580 DEFB $FE,$FE,$FE,$FE,$FE,$FC,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8580-$8587-8(exterior-tiles0-109)]
 $8588 DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FE,$FE ; #HTML[#UDGARRAY1,7,4,1;$8588-$858F-8(exterior-tiles0-110)]
; Exterior tiles. 145 + 220 + 206 tiles. (<- plot_tile)
@label=exterior_tiles
 $8590 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8590-$8597-8(exterior-tiles1-000)]
 $8598 DEFB $80,$80,$80,$80,$80,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$8598-$859F-8(exterior-tiles1-001)]
 $85A0 DEFB $FF,$F0,$00,$8C,$C3,$B0,$80,$C0 ; #HTML[#UDGARRAY1,7,4,1;$85A0-$85A7-8(exterior-tiles1-002)]
 $85A8 DEFB $00,$20,$06,$00,$03,$4C,$03,$3F ; #HTML[#UDGARRAY1,7,4,1;$85A8-$85AF-8(exterior-tiles1-003)]
 $85B0 DEFB $03,$0C,$30,$C0,$03,$3F,$FF,$F0 ; #HTML[#UDGARRAY1,7,4,1;$85B0-$85B7-8(exterior-tiles1-004)]
 $85B8 DEFB $0F,$F0,$03,$3F,$FF,$F0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$85B8-$85BF-8(exterior-tiles1-005)]
 $85C0 DEFB $06,$3F,$FF,$F1,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$85C0-$85C7-8(exterior-tiles1-006)]
 $85C8 DEFB $00,$40,$00,$08,$03,$0C,$30,$C0 ; #HTML[#UDGARRAY1,7,4,1;$85C8-$85CF-8(exterior-tiles1-007)]
 $85D0 DEFB $23,$0C,$30,$C0,$0F,$F0,$0F,$F0 ; #HTML[#UDGARRAY1,7,4,1;$85D0-$85D7-8(exterior-tiles1-008)]
 $85D8 DEFB $0F,$F0,$0F,$F0,$03,$CF,$3F,$FF ; #HTML[#UDGARRAY1,7,4,1;$85D8-$85DF-8(exterior-tiles1-009)]
 $85E0 DEFB $03,$CF,$3F,$FF,$FC,$F2,$C9,$24 ; #HTML[#UDGARRAY1,7,4,1;$85E0-$85E7-8(exterior-tiles1-010)]
 $85E8 DEFB $FC,$F2,$C9,$04,$82,$49,$20,$90 ; #HTML[#UDGARRAY1,7,4,1;$85E8-$85EF-8(exterior-tiles1-011)]
 $85F0 DEFB $FC,$72,$A9,$C4,$E2,$75,$78,$38 ; #HTML[#UDGARRAY1,7,4,1;$85F0-$85F7-8(exterior-tiles1-012)]
 $85F8 DEFB $1C,$0E,$07,$07,$03,$01,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$85F8-$85FF-8(exterior-tiles1-013)]
 $8600 DEFB $49,$24,$12,$A9,$C5,$C4,$E2,$71 ; #HTML[#UDGARRAY1,7,4,1;$8600-$8607-8(exterior-tiles1-014)]
 $8608 DEFB $38,$3D,$1E,$0E,$07,$03,$01,$01 ; #HTML[#UDGARRAY1,7,4,1;$8608-$860F-8(exterior-tiles1-015)]
 $8610 DEFB $92,$4A,$29,$24,$12,$89,$D4,$E2 ; #HTML[#UDGARRAY1,7,4,1;$8610-$8617-8(exterior-tiles1-016)]
 $8618 DEFB $E2,$71,$38,$1C,$1E,$0F,$07,$03 ; #HTML[#UDGARRAY1,7,4,1;$8618-$861F-8(exterior-tiles1-017)]
 $8620 DEFB $49,$24,$92,$49,$A5,$14,$12,$89 ; #HTML[#UDGARRAY1,7,4,1;$8620-$8627-8(exterior-tiles1-018)]
 $8628 DEFB $01,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8628-$862F-8(exterior-tiles1-019)]
 $8630 DEFB $C4,$EA,$F1,$71,$38,$1C,$0E,$0F ; #HTML[#UDGARRAY1,7,4,1;$8630-$8637-8(exterior-tiles1-020)]
 $8638 DEFB $07,$03,$01,$00,$05,$03,$31,$09 ; #HTML[#UDGARRAY1,7,4,1;$8638-$863F-8(exterior-tiles1-021)]
 $8640 DEFB $30,$00,$00,$80,$80,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$8640-$8647-8(exterior-tiles1-022)]
 $8648 DEFB $92,$49,$24,$92,$4A,$29,$A4,$90 ; #HTML[#UDGARRAY1,7,4,1;$8648-$864F-8(exterior-tiles1-023)]
 $8650 DEFB $48,$28,$A4,$92,$49,$24,$92,$49 ; #HTML[#UDGARRAY1,7,4,1;$8650-$8657-8(exterior-tiles1-024)]
 $8658 DEFB $25,$94,$52,$49,$24,$92,$49,$24 ; #HTML[#UDGARRAY1,7,4,1;$8658-$865F-8(exterior-tiles1-025)]
 $8660 DEFB $20,$92,$48,$24,$92,$4A,$29,$A4 ; #HTML[#UDGARRAY1,7,4,1;$8660-$8667-8(exterior-tiles1-026)]
 $8668 DEFB $04,$92,$41,$21,$90,$50,$49,$24 ; #HTML[#UDGARRAY1,7,4,1;$8668-$866F-8(exterior-tiles1-027)]
 $8670 DEFB $49,$24,$92,$49,$25,$14,$12,$09 ; #HTML[#UDGARRAY1,7,4,1;$8670-$8677-8(exterior-tiles1-028)]
 $8678 DEFB $42,$21,$A0,$90,$49,$24,$92,$49 ; #HTML[#UDGARRAY1,7,4,1;$8678-$867F-8(exterior-tiles1-029)]
 $8680 DEFB $92,$4A,$29,$24,$12,$09,$24,$82 ; #HTML[#UDGARRAY1,7,4,1;$8680-$8687-8(exterior-tiles1-030)]
 $8688 DEFB $49,$24,$12,$09,$25,$84,$42,$41 ; #HTML[#UDGARRAY1,7,4,1;$8688-$868F-8(exterior-tiles1-031)]
 $8690 DEFB $90,$48,$24,$92,$4A,$29,$A4,$92 ; #HTML[#UDGARRAY1,7,4,1;$8690-$8697-8(exterior-tiles1-032)]
 $8698 DEFB $03,$CE,$3E,$FE,$FC,$F0,$C6,$20 ; #HTML[#UDGARRAY1,7,4,1;$8698-$869F-8(exterior-tiles1-033)]
 $86A0 DEFB $0C,$F2,$F5,$F0,$F0,$EF,$EF,$EF ; #HTML[#UDGARRAY1,7,4,1;$86A0-$86A7-8(exterior-tiles1-034)]
 $86A8 DEFB $6F,$0F,$06,$00,$63,$0C,$B2,$49 ; #HTML[#UDGARRAY1,7,4,1;$86A8-$86AF-8(exterior-tiles1-035)]
 $86B0 DEFB $92,$49,$24,$92,$4A,$29,$24,$12 ; #HTML[#UDGARRAY1,7,4,1;$86B0-$86B7-8(exterior-tiles1-036)]
 $86B8 DEFB $69,$0C,$32,$C9,$05,$94,$42,$41 ; #HTML[#UDGARRAY1,7,4,1;$86B8-$86BF-8(exterior-tiles1-037)]
 $86C0 DEFB $00,$10,$00,$04,$40,$00,$0F,$F0 ; #HTML[#UDGARRAY1,7,4,1;$86C0-$86C7-8(exterior-tiles1-038)]
 $86C8 DEFB $00,$04,$40,$00,$0F,$F0,$03,$3C ; #HTML[#UDGARRAY1,7,4,1;$86C8-$86CF-8(exterior-tiles1-039)]
 $86D0 DEFB $00,$00,$0F,$F0,$03,$0F,$3F,$FF ; #HTML[#UDGARRAY1,7,4,1;$86D0-$86D7-8(exterior-tiles1-040)]
 $86D8 DEFB $03,$CF,$3F,$FF,$FC,$F2,$C9,$24 ; #HTML[#UDGARRAY1,7,4,1;$86D8-$86DF-8(exterior-tiles1-041)]
 $86E0 DEFB $10,$80,$C2,$20,$90,$48,$24,$92 ; #HTML[#UDGARRAY1,7,4,1;$86E0-$86E7-8(exterior-tiles1-042)]
 $86E8 DEFB $00,$08,$80,$40,$22,$90,$50,$48 ; #HTML[#UDGARRAY1,7,4,1;$86E8-$86EF-8(exterior-tiles1-043)]
 $86F0 DEFB $24,$92,$49,$24,$92,$4A,$29,$A4 ; #HTML[#UDGARRAY1,7,4,1;$86F0-$86F7-8(exterior-tiles1-044)]
 $86F8 DEFB $20,$00,$04,$80,$80,$40,$22,$90 ; #HTML[#UDGARRAY1,7,4,1;$86F8-$86FF-8(exterior-tiles1-045)]
 $8700 DEFB $02,$00,$20,$00,$02,$80,$40,$40 ; #HTML[#UDGARRAY1,7,4,1;$8700-$8707-8(exterior-tiles1-046)]
 $8708 DEFB $20,$90,$48,$24,$94,$52,$49,$24 ; #HTML[#UDGARRAY1,7,4,1;$8708-$870F-8(exterior-tiles1-047)]
 $8710 DEFB $00,$00,$0C,$00,$80,$02,$00,$80 ; #HTML[#UDGARRAY1,7,4,1;$8710-$8717-8(exterior-tiles1-048)]
 $8718 DEFB $00,$C0,$00,$04,$00,$00,$20,$01 ; #HTML[#UDGARRAY1,7,4,1;$8718-$871F-8(exterior-tiles1-049)]
 $8720 DEFB $94,$52,$49,$24,$93,$4C,$B3,$CC ; #HTML[#UDGARRAY1,7,4,1;$8720-$8727-8(exterior-tiles1-050)]
 $8728 DEFB $93,$4C,$33,$CE,$32,$C2,$02,$02 ; #HTML[#UDGARRAY1,7,4,1;$8728-$872F-8(exterior-tiles1-051)]
 $8730 DEFB $30,$C0,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8730-$8737-8(exterior-tiles1-052)]
 $8738 DEFB $94,$52,$49,$24,$93,$4C,$33,$CC ; #HTML[#UDGARRAY1,7,4,1;$8738-$873F-8(exterior-tiles1-053)]
 $8740 DEFB $93,$4C,$33,$CC,$30,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8740-$8747-8(exterior-tiles1-054)]
 $8748 DEFB $93,$4C,$33,$CC,$32,$C6,$06,$06 ; #HTML[#UDGARRAY1,7,4,1;$8748-$874F-8(exterior-tiles1-055)]
 $8750 DEFB $06,$06,$06,$06,$06,$06,$06,$06 ; #HTML[#UDGARRAY1,7,4,1;$8750-$8757-8(exterior-tiles1-056)]
 $8758 DEFB $30,$C3,$00,$33,$CF,$3C,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8758-$875F-8(exterior-tiles1-057)]
 $8760 DEFB $CF,$3C,$F1,$C1,$01,$81,$81,$81 ; #HTML[#UDGARRAY1,7,4,1;$8760-$8767-8(exterior-tiles1-058)]
 $8768 DEFB $00,$30,$42,$04,$10,$C3,$08,$03 ; #HTML[#UDGARRAY1,7,4,1;$8768-$876F-8(exterior-tiles1-059)]
 $8770 DEFB $30,$C3,$00,$03,$4F,$3C,$F1,$C1 ; #HTML[#UDGARRAY1,7,4,1;$8770-$8777-8(exterior-tiles1-060)]
 $8778 DEFB $CE,$3D,$F3,$C3,$03,$03,$03,$03 ; #HTML[#UDGARRAY1,7,4,1;$8778-$877F-8(exterior-tiles1-061)]
 $8780 DEFB $03,$0D,$33,$C3,$03,$03,$03,$03 ; #HTML[#UDGARRAY1,7,4,1;$8780-$8787-8(exterior-tiles1-062)]
 $8788 DEFB $01,$81,$81,$81,$83,$8D,$B1,$C1 ; #HTML[#UDGARRAY1,7,4,1;$8788-$878F-8(exterior-tiles1-063)]
 $8790 DEFB $C0,$C0,$C0,$C0,$C3,$CC,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8790-$8797-8(exterior-tiles1-064)]
 $8798 DEFB $82,$8D,$B1,$C1,$81,$81,$81,$C1 ; #HTML[#UDGARRAY1,7,4,1;$8798-$879F-8(exterior-tiles1-065)]
 $87A0 DEFB $81,$83,$85,$85,$81,$81,$81,$81 ; #HTML[#UDGARRAY1,7,4,1;$87A0-$87A7-8(exterior-tiles1-066)]
 $87A8 DEFB $83,$43,$43,$00,$03,$0F,$3F,$7C ; #HTML[#UDGARRAY1,7,4,1;$87A8-$87AF-8(exterior-tiles1-067)]
 $87B0 DEFB $C1,$C2,$C2,$C0,$C0,$C0,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$87B0-$87B7-8(exterior-tiles1-068)]
 $87B8 DEFB $A1,$A1,$81,$80,$83,$8F,$BF,$BC ; #HTML[#UDGARRAY1,7,4,1;$87B8-$87BF-8(exterior-tiles1-069)]
 $87C0 DEFB $81,$8E,$BF,$BC,$71,$CC,$10,$00 ; #HTML[#UDGARRAY1,7,4,1;$87C0-$87C7-8(exterior-tiles1-070)]
 $87C8 DEFB $70,$C0,$10,$C0,$0C,$30,$01,$07 ; #HTML[#UDGARRAY1,7,4,1;$87C8-$87CF-8(exterior-tiles1-071)]
 $87D0 DEFB $C3,$CF,$DF,$DC,$D3,$C4,$30,$C1 ; #HTML[#UDGARRAY1,7,4,1;$87D0-$87D7-8(exterior-tiles1-072)]
 $87D8 DEFB $86,$0E,$36,$46,$0E,$36,$C7,$07 ; #HTML[#UDGARRAY1,7,4,1;$87D8-$87DF-8(exterior-tiles1-073)]
 $87E0 DEFB $8C,$10,$C1,$07,$1F,$7C,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$87E0-$87E7-8(exterior-tiles1-074)]
 $87E8 DEFB $1F,$7C,$F0,$C0,$02,$00,$00,$18 ; #HTML[#UDGARRAY1,7,4,1;$87E8-$87EF-8(exterior-tiles1-075)]
 $87F0 DEFB $01,$06,$88,$00,$06,$18,$21,$07 ; #HTML[#UDGARRAY1,7,4,1;$87F0-$87F7-8(exterior-tiles1-076)]
 $87F8 DEFB $CC,$D0,$C1,$C7,$DF,$FC,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$87F8-$87FF-8(exterior-tiles1-077)]
 $8800 DEFB $C0,$C0,$C0,$C0,$C0,$C0,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8800-$8807-8(exterior-tiles1-078)]
 $8808 DEFB $0F,$3C,$F0,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8808-$880F-8(exterior-tiles1-079)]
 $8810 DEFB $C0,$C0,$C0,$C0,$C0,$C0,$D0,$DC ; #HTML[#UDGARRAY1,7,4,1;$8810-$8817-8(exterior-tiles1-080)]
 $8818 DEFB $C0,$C0,$C0,$C0,$00,$C0,$00,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8818-$881F-8(exterior-tiles1-081)]
 $8820 DEFB $C0,$C0,$C0,$C0,$C0,$C3,$CF,$DF ; #HTML[#UDGARRAY1,7,4,1;$8820-$8827-8(exterior-tiles1-082)]
 $8828 DEFB $00,$03,$0F,$3F,$FC,$F0,$C3,$0F ; #HTML[#UDGARRAY1,7,4,1;$8828-$882F-8(exterior-tiles1-083)]
 $8830 DEFB $C0,$06,$C0,$21,$30,$C8,$F4,$CE ; #HTML[#UDGARRAY1,7,4,1;$8830-$8837-8(exterior-tiles1-084)]
 $8838 DEFB $01,$01,$01,$01,$01,$01,$01,$01 ; #HTML[#UDGARRAY1,7,4,1;$8838-$883F-8(exterior-tiles1-085)]
 $8840 DEFB $03,$0D,$21,$01,$0D,$31,$81,$05 ; #HTML[#UDGARRAY1,7,4,1;$8840-$8847-8(exterior-tiles1-086)]
 $8848 DEFB $1A,$7B,$F3,$C3,$03,$03,$13,$01 ; #HTML[#UDGARRAY1,7,4,1;$8848-$884F-8(exterior-tiles1-087)]
 $8850 DEFB $32,$02,$0A,$12,$C2,$0A,$32,$42 ; #HTML[#UDGARRAY1,7,4,1;$8850-$8857-8(exterior-tiles1-088)]
 $8858 DEFB $0A,$12,$82,$0A,$22,$C2,$0A,$32 ; #HTML[#UDGARRAY1,7,4,1;$8858-$885F-8(exterior-tiles1-089)]
 $8860 DEFB $C2,$02,$32,$C2,$0A,$32,$82,$02 ; #HTML[#UDGARRAY1,7,4,1;$8860-$8867-8(exterior-tiles1-090)]
 $8868 DEFB $1A,$7A,$F2,$C2,$02,$02,$02,$22 ; #HTML[#UDGARRAY1,7,4,1;$8868-$886F-8(exterior-tiles1-091)]
 $8870 DEFB $8C,$B0,$C1,$87,$DF,$BC,$B0,$80 ; #HTML[#UDGARRAY1,7,4,1;$8870-$8877-8(exterior-tiles1-092)]
 $8878 DEFB $40,$D0,$C2,$C0,$C0,$C0,$CA,$80 ; #HTML[#UDGARRAY1,7,4,1;$8878-$887F-8(exterior-tiles1-093)]
 $8880 DEFB $02,$03,$03,$03,$03,$03,$03,$01 ; #HTML[#UDGARRAY1,7,4,1;$8880-$8887-8(exterior-tiles1-094)]
 $8888 DEFB $31,$0D,$83,$E1,$FB,$3D,$0D,$01 ; #HTML[#UDGARRAY1,7,4,1;$8888-$888F-8(exterior-tiles1-095)]
 $8890 DEFB $09,$C3,$31,$0D,$C3,$11,$0D,$C3 ; #HTML[#UDGARRAY1,7,4,1;$8890-$8897-8(exterior-tiles1-096)]
 $8898 DEFB $C3,$31,$0D,$81,$31,$0D,$43,$31 ; #HTML[#UDGARRAY1,7,4,1;$8898-$889F-8(exterior-tiles1-097)]
 $88A0 DEFB $01,$09,$03,$01,$0D,$03,$11,$0D ; #HTML[#UDGARRAY1,7,4,1;$88A0-$88A7-8(exterior-tiles1-098)]
 $88A8 DEFB $06,$07,$0E,$16,$06,$06,$16,$06 ; #HTML[#UDGARRAY1,7,4,1;$88A8-$88AF-8(exterior-tiles1-099)]
 $88B0 DEFB $0E,$36,$07,$0E,$26,$46,$0E,$36 ; #HTML[#UDGARRAY1,7,4,1;$88B0-$88B7-8(exterior-tiles1-100)]
 $88B8 DEFB $F8,$3E,$0F,$43,$00,$00,$04,$08 ; #HTML[#UDGARRAY1,7,4,1;$88B8-$88BF-8(exterior-tiles1-101)]
 $88C0 DEFB $03,$20,$0C,$C3,$30,$08,$83,$E0 ; #HTML[#UDGARRAY1,7,4,1;$88C0-$88C7-8(exterior-tiles1-102)]
 $88C8 DEFB $C0,$C0,$C0,$E0,$F8,$3E,$CF,$C3 ; #HTML[#UDGARRAY1,7,4,1;$88C8-$88CF-8(exterior-tiles1-103)]
 $88D0 DEFB $F0,$C8,$C2,$E0,$C8,$C0,$E0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$88D0-$88D7-8(exterior-tiles1-104)]
 $88D8 DEFB $10,$0C,$82,$E0,$F8,$3E,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$88D8-$88DF-8(exterior-tiles1-105)]
 $88E0 DEFB $C0,$C0,$C0,$C0,$C0,$C0,$30,$FC ; #HTML[#UDGARRAY1,7,4,1;$88E0-$88E7-8(exterior-tiles1-106)]
 $88E8 DEFB $58,$DE,$CF,$C3,$C0,$C0,$C8,$84 ; #HTML[#UDGARRAY1,7,4,1;$88E8-$88EF-8(exterior-tiles1-107)]
 $88F0 DEFB $C0,$B0,$84,$C0,$B0,$8C,$81,$A0 ; #HTML[#UDGARRAY1,7,4,1;$88F0-$88F7-8(exterior-tiles1-108)]
 $88F8 DEFB $4A,$29,$A4,$92,$49,$24,$92,$49 ; #HTML[#UDGARRAY1,7,4,1;$88F8-$88FF-8(exterior-tiles1-109)]
 $8900 DEFB $93,$4C,$33,$CC,$31,$C1,$01,$01 ; #HTML[#UDGARRAY1,7,4,1;$8900-$8907-8(exterior-tiles1-110)]
 $8908 DEFB $3C,$D0,$E3,$F7,$FB,$3C,$0E,$03 ; #HTML[#UDGARRAY1,7,4,1;$8908-$890F-8(exterior-tiles1-111)]
 $8910 DEFB $3F,$FC,$F0,$C0,$00,$0C,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8910-$8917-8(exterior-tiles1-112)]
 $8918 DEFB $03,$00,$60,$00,$01,$00,$00,$08 ; #HTML[#UDGARRAY1,7,4,1;$8918-$891F-8(exterior-tiles1-113)]
 $8920 DEFB $00,$00,$00,$00,$00,$00,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8920-$8927-8(exterior-tiles1-114)]
 $8928 DEFB $02,$02,$02,$02,$02,$02,$02,$02 ; #HTML[#UDGARRAY1,7,4,1;$8928-$892F-8(exterior-tiles1-115)]
 $8930 DEFB $90,$C2,$8C,$B0,$C3,$84,$B0,$80 ; #HTML[#UDGARRAY1,7,4,1;$8930-$8937-8(exterior-tiles1-116)]
 $8938 DEFB $C3,$84,$B0,$C3,$8C,$90,$C3,$8C ; #HTML[#UDGARRAY1,7,4,1;$8938-$893F-8(exterior-tiles1-117)]
 $8940 DEFB $84,$B0,$C0,$8C,$90,$C3,$84,$B0 ; #HTML[#UDGARRAY1,7,4,1;$8940-$8947-8(exterior-tiles1-118)]
 $8948 DEFB $90,$C0,$80,$B0,$C0,$84,$90,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8948-$894F-8(exterior-tiles1-119)]
 $8950 DEFB $00,$00,$00,$80,$00,$00,$C0,$00 ; #HTML[#UDGARRAY1,7,4,1;$8950-$8957-8(exterior-tiles1-120)]
 $8958 DEFB $10,$C0,$08,$30,$80,$0C,$20,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8958-$895F-8(exterior-tiles1-121)]
 $8960 DEFB $08,$30,$C2,$04,$30,$80,$08,$20 ; #HTML[#UDGARRAY1,7,4,1;$8960-$8967-8(exterior-tiles1-122)]
 $8968 DEFB $00,$00,$00,$00,$03,$08,$10,$01 ; #HTML[#UDGARRAY1,7,4,1;$8968-$896F-8(exterior-tiles1-123)]
 $8970 DEFB $0C,$10,$C3,$0C,$20,$03,$04,$00 ; #HTML[#UDGARRAY1,7,4,1;$8970-$8977-8(exterior-tiles1-124)]
 $8978 DEFB $00,$00,$00,$10,$00,$0C,$30,$42 ; #HTML[#UDGARRAY1,7,4,1;$8978-$897F-8(exterior-tiles1-125)]
 $8980 DEFB $01,$01,$03,$01,$01,$03,$09,$01 ; #HTML[#UDGARRAY1,7,4,1;$8980-$8987-8(exterior-tiles1-126)]
 $8988 DEFB $D0,$C1,$CC,$D0,$C2,$CC,$D0,$C3 ; #HTML[#UDGARRAY1,7,4,1;$8988-$898F-8(exterior-tiles1-127)]
 $8990 DEFB $C0,$C0,$D0,$C0,$C8,$D0,$C2,$C4 ; #HTML[#UDGARRAY1,7,4,1;$8990-$8997-8(exterior-tiles1-128)]
 $8998 DEFB $00,$10,$C3,$F0,$FC,$CF,$C3,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8998-$899F-8(exterior-tiles1-129)]
 $89A0 DEFB $00,$20,$0C,$C0,$30,$0C,$C2,$F0 ; #HTML[#UDGARRAY1,7,4,1;$89A0-$89A7-8(exterior-tiles1-130)]
 $89A8 DEFB $3C,$0F,$03,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$89A8-$89AF-8(exterior-tiles1-131)]
 $89B0 DEFB $00,$00,$D0,$CC,$C1,$F0,$CC,$C2 ; #HTML[#UDGARRAY1,7,4,1;$89B0-$89B7-8(exterior-tiles1-132)]
 $89B8 DEFB $80,$80,$C0,$80,$80,$C0,$B0,$80 ; #HTML[#UDGARRAY1,7,4,1;$89B8-$89BF-8(exterior-tiles1-133)]
 $89C0 DEFB $03,$00,$0C,$02,$30,$0C,$03,$20 ; #HTML[#UDGARRAY1,7,4,1;$89C0-$89C7-8(exterior-tiles1-134)]
 $89C8 DEFB $00,$C0,$30,$00,$C0,$30,$0C,$C0 ; #HTML[#UDGARRAY1,7,4,1;$89C8-$89CF-8(exterior-tiles1-135)]
 $89D0 DEFB $0C,$02,$00,$04,$03,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$89D0-$89D7-8(exterior-tiles1-136)]
 $89D8 DEFB $20,$0C,$C0,$30,$08,$43,$30,$0C ; #HTML[#UDGARRAY1,7,4,1;$89D8-$89DF-8(exterior-tiles1-137)]
 $89E0 DEFB $03,$30,$08,$01,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$89E0-$89E7-8(exterior-tiles1-138)]
 $89E8 DEFB $00,$C0,$30,$08,$C0,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$89E8-$89EF-8(exterior-tiles1-139)]
 $89F0 DEFB $01,$43,$04,$0B,$1C,$30,$01,$02 ; #HTML[#UDGARRAY1,7,4,1;$89F0-$89F7-8(exterior-tiles1-140)]
 $89F8 DEFB $3F,$0F,$C3,$F0,$FC,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$89F8-$89FF-8(exterior-tiles1-141)]
 $8A00 DEFB $00,$C0,$F0,$FC,$3E,$0F,$C2,$F1 ; #HTML[#UDGARRAY1,7,4,1;$8A00-$8A07-8(exterior-tiles1-142)]
 $8A08 DEFB $FB,$37,$0F,$1C,$30,$00,$00,$40 ; #HTML[#UDGARRAY1,7,4,1;$8A08-$8A0F-8(exterior-tiles1-143)]
 $8A10 DEFB $C0,$C4,$00,$00,$20,$18,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8A10-$8A17-8(exterior-tiles1-144)]
 $8A18 DEFB $00,$01,$00,$30,$00,$02,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8A18-$8A1F-8(exterior-tiles2-000)]
 $8A20 DEFB $04,$00,$00,$00,$80,$00,$18,$04 ; #HTML[#UDGARRAY1,7,4,1;$8A20-$8A27-8(exterior-tiles2-001)]
 $8A28 DEFB $02,$80,$00,$08,$04,$00,$60,$00 ; #HTML[#UDGARRAY1,7,4,1;$8A28-$8A2F-8(exterior-tiles2-002)]
 $8A30 DEFB $00,$00,$20,$01,$00,$00,$00,$20 ; #HTML[#UDGARRAY1,7,4,1;$8A30-$8A37-8(exterior-tiles2-003)]
 $8A38 DEFB $00,$40,$30,$78,$77,$7B,$3F,$7F ; #HTML[#UDGARRAY1,7,4,1;$8A38-$8A3F-8(exterior-tiles2-004)]
 $8A40 DEFB $FF,$3D,$0F,$03,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8A40-$8A47-8(exterior-tiles2-005)]
 $8A48 DEFB $0B,$0F,$0F,$0F,$0D,$4F,$73,$7C ; #HTML[#UDGARRAY1,7,4,1;$8A48-$8A4F-8(exterior-tiles2-006)]
 $8A50 DEFB $7B,$7F,$7F,$7F,$6F,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8A50-$8A57-8(exterior-tiles2-007)]
 $8A58 DEFB $FE,$FC,$DE,$FE,$FE,$B4,$E0,$C2 ; #HTML[#UDGARRAY1,7,4,1;$8A58-$8A5F-8(exterior-tiles2-008)]
 $8A60 DEFB $FC,$DC,$FC,$FC,$FC,$F2,$CE,$36 ; #HTML[#UDGARRAY1,7,4,1;$8A60-$8A67-8(exterior-tiles2-009)]
 $8A68 DEFB $00,$02,$0E,$1E,$EE,$FE,$7E,$FE ; #HTML[#UDGARRAY1,7,4,1;$8A68-$8A6F-8(exterior-tiles2-010)]
 $8A70 DEFB $FE,$FC,$70,$C1,$00,$10,$00,$02 ; #HTML[#UDGARRAY1,7,4,1;$8A70-$8A77-8(exterior-tiles2-011)]
 $8A78 DEFB $33,$3C,$2F,$3F,$0F,$03,$0C,$0F ; #HTML[#UDGARRAY1,7,4,1;$8A78-$8A7F-8(exterior-tiles2-012)]
 $8A80 DEFB $C0,$30,$F0,$F0,$70,$CC,$3C,$FC ; #HTML[#UDGARRAY1,7,4,1;$8A80-$8A87-8(exterior-tiles2-013)]
 $8A88 DEFB $0F,$03,$0C,$0F,$0F,$0B,$0F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8A88-$8A8F-8(exterior-tiles2-014)]
 $8A90 DEFB $F0,$CC,$3C,$EC,$FC,$FC,$FC,$B0 ; #HTML[#UDGARRAY1,7,4,1;$8A90-$8A97-8(exterior-tiles2-015)]
 $8A98 DEFB $33,$3C,$3F,$37,$3F,$3F,$3F,$3D ; #HTML[#UDGARRAY1,7,4,1;$8A98-$8A9F-8(exterior-tiles2-016)]
 $8AA0 DEFB $C0,$30,$F0,$F0,$70,$F0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8AA0-$8AA7-8(exterior-tiles2-017)]
 $8AA8 DEFB $0F,$0F,$0F,$0F,$0B,$0F,$0F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8AA8-$8AAF-8(exterior-tiles2-018)]
 $8AB0 DEFB $BC,$FC,$F4,$FC,$FC,$DC,$FC,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8AB0-$8AB7-8(exterior-tiles2-019)]
 $8AB8 DEFB $BC,$FC,$F4,$FC,$FC,$DC,$FC,$F3 ; #HTML[#UDGARRAY1,7,4,1;$8AB8-$8ABF-8(exterior-tiles2-020)]
 $8AC0 DEFB $C7,$37,$F4,$F3,$77,$F4,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8AC0-$8AC7-8(exterior-tiles2-021)]
 $8AC8 DEFB $CC,$3C,$B0,$88,$38,$F8,$F0,$CC ; #HTML[#UDGARRAY1,7,4,1;$8AC8-$8ACF-8(exterior-tiles2-022)]
 $8AD0 DEFB $0F,$0F,$6C,$63,$07,$34,$F0,$CC ; #HTML[#UDGARRAY1,7,4,1;$8AD0-$8AD7-8(exterior-tiles2-023)]
 $8AD8 DEFB $3C,$FC,$F3,$C7,$04,$03,$03,$03 ; #HTML[#UDGARRAY1,7,4,1;$8AD8-$8ADF-8(exterior-tiles2-024)]
 $8AE0 DEFB $00,$00,$00,$00,$00,$00,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8AE0-$8AE7-8(exterior-tiles2-025)]
 $8AE8 DEFB $00,$00,$00,$00,$20,$E0,$C0,$30 ; #HTML[#UDGARRAY1,7,4,1;$8AE8-$8AEF-8(exterior-tiles2-026)]
 $8AF0 DEFB $F0,$F0,$C8,$38,$70,$40,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8AF0-$8AF7-8(exterior-tiles2-027)]
 $8AF8 DEFB $3C,$B3,$83,$33,$F0,$F3,$CF,$0C ; #HTML[#UDGARRAY1,7,4,1;$8AF8-$8AFF-8(exterior-tiles2-028)]
 $8B00 DEFB $0F,$0E,$0F,$0F,$0C,$03,$0F,$3F ; #HTML[#UDGARRAY1,7,4,1;$8B00-$8B07-8(exterior-tiles2-029)]
 $8B08 DEFB $0F,$0B,$0F,$0F,$0F,$0D,$0F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8B08-$8B0F-8(exterior-tiles2-030)]
 $8B10 DEFB $70,$F0,$F0,$F0,$F0,$D0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8B10-$8B17-8(exterior-tiles2-031)]
 $8B18 DEFB $00,$00,$00,$20,$F0,$E0,$E0,$D0 ; #HTML[#UDGARRAY1,7,4,1;$8B18-$8B1F-8(exterior-tiles2-032)]
 $8B20 DEFB $00,$00,$00,$00,$00,$03,$07,$09 ; #HTML[#UDGARRAY1,7,4,1;$8B20-$8B27-8(exterior-tiles2-033)]
 $8B28 DEFB $00,$00,$00,$0C,$0F,$0F,$0B,$0F ; #HTML[#UDGARRAY1,7,4,1;$8B28-$8B2F-8(exterior-tiles2-034)]
 $8B30 DEFB $00,$00,$00,$00,$00,$C0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8B30-$8B37-8(exterior-tiles2-035)]
 $8B38 DEFB $FF,$FF,$7F,$FB,$FF,$3F,$4F,$73 ; #HTML[#UDGARRAY1,7,4,1;$8B38-$8B3F-8(exterior-tiles2-036)]
 $8B40 DEFB $B6,$B6,$B6,$B6,$B6,$B6,$96,$E6 ; #HTML[#UDGARRAY1,7,4,1;$8B40-$8B47-8(exterior-tiles2-037)]
 $8B48 DEFB $7C,$7F,$77,$6B,$6B,$6D,$6D,$6D ; #HTML[#UDGARRAY1,7,4,1;$8B48-$8B4F-8(exterior-tiles2-038)]
 $8B50 DEFB $FF,$3B,$CF,$F3,$FC,$DE,$AE,$AE ; #HTML[#UDGARRAY1,7,4,1;$8B50-$8B57-8(exterior-tiles2-039)]
 $8B58 DEFB $6D,$6D,$6D,$6D,$6D,$6D,$6D,$6D ; #HTML[#UDGARRAY1,7,4,1;$8B58-$8B5F-8(exterior-tiles2-040)]
 $8B60 DEFB $B6,$B6,$B6,$B6,$B6,$B6,$B6,$B6 ; #HTML[#UDGARRAY1,7,4,1;$8B60-$8B67-8(exterior-tiles2-041)]
 $8B68 DEFB $6D,$6D,$6D,$65,$79,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8B68-$8B6F-8(exterior-tiles2-042)]
 $8B70 DEFB $FF,$3E,$0E,$02,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8B70-$8B77-8(exterior-tiles2-043)]
 $8B78 DEFB $FE,$EC,$73,$0F,$3F,$7B,$75,$75 ; #HTML[#UDGARRAY1,7,4,1;$8B78-$8B7F-8(exterior-tiles2-044)]
 $8B80 DEFB $FF,$F7,$FF,$FE,$FB,$B4,$E2,$CE ; #HTML[#UDGARRAY1,7,4,1;$8B80-$8B87-8(exterior-tiles2-045)]
 $8B88 DEFB $3F,$FE,$EE,$D6,$D6,$B6,$B6,$B6 ; #HTML[#UDGARRAY1,7,4,1;$8B88-$8B8F-8(exterior-tiles2-046)]
 $8B90 DEFB $6D,$6D,$6D,$6D,$6D,$6D,$69,$67 ; #HTML[#UDGARRAY1,7,4,1;$8B90-$8B97-8(exterior-tiles2-047)]
 $8B98 DEFB $B6,$B6,$B7,$A6,$9E,$FC,$F0,$C1 ; #HTML[#UDGARRAY1,7,4,1;$8B98-$8B9F-8(exterior-tiles2-048)]
 $8BA0 DEFB $7F,$7C,$70,$41,$00,$00,$40,$02 ; #HTML[#UDGARRAY1,7,4,1;$8BA0-$8BA7-8(exterior-tiles2-049)]
 $8BA8 DEFB $70,$F3,$CF,$3F,$FF,$DF,$FD,$FF ; #HTML[#UDGARRAY1,7,4,1;$8BA8-$8BAF-8(exterior-tiles2-050)]
 $8BB0 DEFB $B7,$B6,$B6,$B6,$B6,$B6,$B6,$B6 ; #HTML[#UDGARRAY1,7,4,1;$8BB0-$8BB7-8(exterior-tiles2-051)]
 $8BB8 DEFB $0F,$CF,$F7,$FF,$FF,$BF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8BB8-$8BBF-8(exterior-tiles2-052)]
 $8BC0 DEFB $F0,$F0,$F0,$D0,$F0,$F0,$F0,$FC ; #HTML[#UDGARRAY1,7,4,1;$8BC0-$8BC7-8(exterior-tiles2-053)]
 $8BC8 DEFB $00,$01,$0E,$37,$B7,$D7,$F7,$F7 ; #HTML[#UDGARRAY1,7,4,1;$8BC8-$8BCF-8(exterior-tiles2-054)]
 $8BD0 DEFB $F6,$B4,$F0,$C0,$01,$40,$00,$06 ; #HTML[#UDGARRAY1,7,4,1;$8BD0-$8BD7-8(exterior-tiles2-055)]
 $8BD8 DEFB $00,$00,$00,$00,$00,$00,$00,$0C ; #HTML[#UDGARRAY1,7,4,1;$8BD8-$8BDF-8(exterior-tiles2-056)]
 $8BE0 DEFB $00,$C0,$F0,$3C,$7F,$B3,$87,$8B ; #HTML[#UDGARRAY1,7,4,1;$8BE0-$8BE7-8(exterior-tiles2-057)]
 $8BE8 DEFB $00,$03,$0F,$3C,$FE,$CD,$E1,$D1 ; #HTML[#UDGARRAY1,7,4,1;$8BE8-$8BEF-8(exterior-tiles2-058)]
 $8BF0 DEFB $0F,$0B,$0D,$0D,$0E,$0E,$06,$0E ; #HTML[#UDGARRAY1,7,4,1;$8BF0-$8BF7-8(exterior-tiles2-059)]
 $8BF8 DEFB $0E,$0E,$0E,$0E,$0E,$0E,$0E,$0E ; #HTML[#UDGARRAY1,7,4,1;$8BF8-$8BFF-8(exterior-tiles2-060)]
 $8C00 DEFB $7F,$B3,$87,$8B,$88,$88,$88,$88 ; #HTML[#UDGARRAY1,7,4,1;$8C00-$8C07-8(exterior-tiles2-061)]
 $8C08 DEFB $00,$C0,$70,$F0,$F0,$D0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8C08-$8C0F-8(exterior-tiles2-062)]
 $8C10 DEFB $0E,$0A,$0E,$0E,$0E,$0E,$0D,$0D ; #HTML[#UDGARRAY1,7,4,1;$8C10-$8C17-8(exterior-tiles2-063)]
 $8C18 DEFB $88,$88,$88,$88,$88,$48,$70,$74 ; #HTML[#UDGARRAY1,7,4,1;$8C18-$8C1F-8(exterior-tiles2-064)]
 $8C20 DEFB $37,$F7,$F3,$DF,$FF,$3D,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8C20-$8C27-8(exterior-tiles2-065)]
 $8C28 DEFB $08,$48,$70,$74,$36,$F6,$F2,$DE ; #HTML[#UDGARRAY1,7,4,1;$8C28-$8C2F-8(exterior-tiles2-066)]
 $8C30 DEFB $60,$D0,$B0,$B0,$70,$70,$70,$70 ; #HTML[#UDGARRAY1,7,4,1;$8C30-$8C37-8(exterior-tiles2-067)]
 $8C38 DEFB $70,$70,$50,$70,$70,$70,$70,$70 ; #HTML[#UDGARRAY1,7,4,1;$8C38-$8C3F-8(exterior-tiles2-068)]
 $8C40 DEFB $11,$11,$11,$11,$11,$11,$11,$11 ; #HTML[#UDGARRAY1,7,4,1;$8C40-$8C47-8(exterior-tiles2-069)]
 $8C48 DEFB $FE,$CD,$E1,$D1,$11,$11,$11,$11 ; #HTML[#UDGARRAY1,7,4,1;$8C48-$8C4F-8(exterior-tiles2-070)]
 $8C50 DEFB $00,$03,$07,$0D,$0F,$0F,$0F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8C50-$8C57-8(exterior-tiles2-071)]
 $8C58 DEFB $11,$11,$11,$11,$11,$12,$0E,$2E ; #HTML[#UDGARRAY1,7,4,1;$8C58-$8C5F-8(exterior-tiles2-072)]
 $8C60 DEFB $70,$50,$70,$70,$70,$70,$B0,$B0 ; #HTML[#UDGARRAY1,7,4,1;$8C60-$8C67-8(exterior-tiles2-073)]
 $8C68 DEFB $10,$12,$0E,$2E,$6C,$6F,$4F,$7B ; #HTML[#UDGARRAY1,7,4,1;$8C68-$8C6F-8(exterior-tiles2-074)]
 $8C70 DEFB $EC,$EF,$CF,$FB,$FF,$BC,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8C70-$8C77-8(exterior-tiles2-075)]
 $8C78 DEFB $D0,$F0,$F0,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8C78-$8C7F-8(exterior-tiles2-076)]
 $8C80 DEFB $0F,$0F,$0F,$0F,$0F,$0C,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8C80-$8C87-8(exterior-tiles2-077)]
 $8C88 DEFB $00,$00,$0C,$13,$14,$14,$08,$08 ; #HTML[#UDGARRAY1,7,4,1;$8C88-$8C8F-8(exterior-tiles2-078)]
 $8C90 DEFB $00,$00,$00,$00,$C0,$30,$10,$6C ; #HTML[#UDGARRAY1,7,4,1;$8C90-$8C97-8(exterior-tiles2-079)]
 $8C98 DEFB $FE,$FE,$7C,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8C98-$8C9F-8(exterior-tiles2-080)]
 $8CA0 DEFB $13,$0C,$30,$C3,$0C,$32,$C0,$20 ; #HTML[#UDGARRAY1,7,4,1;$8CA0-$8CA7-8(exterior-tiles2-081)]
 $8CA8 DEFB $00,$01,$01,$02,$12,$04,$34,$CB ; #HTML[#UDGARRAY1,7,4,1;$8CA8-$8CAF-8(exterior-tiles2-082)]
 $8CB0 DEFB $00,$00,$00,$00,$00,$00,$01,$00 ; #HTML[#UDGARRAY1,7,4,1;$8CB0-$8CB7-8(exterior-tiles2-083)]
 $8CB8 DEFB $08,$14,$D0,$20,$20,$20,$20,$20 ; #HTML[#UDGARRAY1,7,4,1;$8CB8-$8CBF-8(exterior-tiles2-084)]
 $8CC0 DEFB $00,$00,$00,$00,$03,$0C,$08,$36 ; #HTML[#UDGARRAY1,7,4,1;$8CC0-$8CC7-8(exterior-tiles2-085)]
 $8CC8 DEFB $7F,$7F,$3E,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8CC8-$8CCF-8(exterior-tiles2-086)]
 $8CD0 DEFB $00,$00,$30,$C8,$28,$28,$10,$10 ; #HTML[#UDGARRAY1,7,4,1;$8CD0-$8CD7-8(exterior-tiles2-087)]
 $8CD8 DEFB $00,$00,$00,$00,$00,$00,$80,$00 ; #HTML[#UDGARRAY1,7,4,1;$8CD8-$8CDF-8(exterior-tiles2-088)]
 $8CE0 DEFB $C8,$30,$0C,$C3,$30,$4C,$03,$04 ; #HTML[#UDGARRAY1,7,4,1;$8CE0-$8CE7-8(exterior-tiles2-089)]
 $8CE8 DEFB $00,$80,$80,$40,$48,$20,$2C,$D3 ; #HTML[#UDGARRAY1,7,4,1;$8CE8-$8CEF-8(exterior-tiles2-090)]
 $8CF0 DEFB $10,$28,$0B,$04,$04,$04,$04,$04 ; #HTML[#UDGARRAY1,7,4,1;$8CF0-$8CF7-8(exterior-tiles2-091)]
 $8CF8 DEFB $0B,$0F,$0F,$03,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8CF8-$8CFF-8(exterior-tiles2-092)]
 $8D00 DEFB $E0,$F0,$B0,$F0,$F0,$30,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8D00-$8D07-8(exterior-tiles2-093)]
 $8D08 DEFB $88,$88,$88,$88,$88,$88,$88,$88 ; #HTML[#UDGARRAY1,7,4,1;$8D08-$8D0F-8(exterior-tiles2-094)]
 $8D10 DEFB $08,$06,$0B,$1C,$13,$3B,$1B,$2B ; #HTML[#UDGARRAY1,7,4,1;$8D10-$8D17-8(exterior-tiles2-095)]
 $8D18 DEFB $00,$00,$00,$04,$18,$CC,$72,$36 ; #HTML[#UDGARRAY1,7,4,1;$8D18-$8D1F-8(exterior-tiles2-096)]
 $8D20 DEFB $4B,$09,$01,$00,$00,$C0,$F0,$3C ; #HTML[#UDGARRAY1,7,4,1;$8D20-$8D27-8(exterior-tiles2-097)]
 $8D28 DEFB $67,$DF,$CE,$8A,$12,$24,$04,$00 ; #HTML[#UDGARRAY1,7,4,1;$8D28-$8D2F-8(exterior-tiles2-098)]
 $8D30 DEFB $00,$00,$00,$00,$00,$C0,$F0,$3C ; #HTML[#UDGARRAY1,7,4,1;$8D30-$8D37-8(exterior-tiles2-099)]
 $8D38 DEFB $00,$80,$80,$30,$F0,$F3,$CF,$3C ; #HTML[#UDGARRAY1,7,4,1;$8D38-$8D3F-8(exterior-tiles2-100)]
 $8D40 DEFB $00,$00,$00,$00,$00,$02,$0E,$3E ; #HTML[#UDGARRAY1,7,4,1;$8D40-$8D47-8(exterior-tiles2-101)]
 $8D48 DEFB $00,$00,$00,$00,$00,$40,$70,$7C ; #HTML[#UDGARRAY1,7,4,1;$8D48-$8D4F-8(exterior-tiles2-102)]
 $8D50 DEFB $FF,$DF,$FD,$FF,$FF,$FC,$70,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8D50-$8D57-8(exterior-tiles2-103)]
 $8D58 DEFB $70,$F0,$F0,$F0,$D0,$F0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8D58-$8D5F-8(exterior-tiles2-104)]
 $8D60 DEFB $0F,$8F,$8F,$4F,$4B,$2F,$2F,$D7 ; #HTML[#UDGARRAY1,7,4,1;$8D60-$8D67-8(exterior-tiles2-105)]
 $8D68 DEFB $BC,$FD,$F5,$FA,$FA,$D4,$F4,$EB ; #HTML[#UDGARRAY1,7,4,1;$8D68-$8D6F-8(exterior-tiles2-106)]
 $8D70 DEFB $13,$28,$2B,$35,$35,$35,$35,$3B ; #HTML[#UDGARRAY1,7,4,1;$8D70-$8D77-8(exterior-tiles2-107)]
 $8D78 DEFB $C8,$14,$D0,$A0,$20,$A0,$A0,$D0 ; #HTML[#UDGARRAY1,7,4,1;$8D78-$8D7F-8(exterior-tiles2-108)]
 $8D80 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8D80-$8D87-8(exterior-tiles2-109)]
 $8D88 DEFB $00,$C0,$F0,$FC,$3C,$0C,$30,$3C ; #HTML[#UDGARRAY1,7,4,1;$8D88-$8D8F-8(exterior-tiles2-110)]
 $8D90 DEFB $00,$03,$43,$73,$38,$CB,$F3,$FC ; #HTML[#UDGARRAY1,7,4,1;$8D90-$8D97-8(exterior-tiles2-111)]
 $8D98 DEFB $00,$00,$C0,$F0,$F0,$30,$C0,$D0 ; #HTML[#UDGARRAY1,7,4,1;$8D98-$8D9F-8(exterior-tiles2-112)]
 $8DA0 DEFB $0D,$01,$0C,$0F,$0F,$03,$0C,$0F ; #HTML[#UDGARRAY1,7,4,1;$8DA0-$8DA7-8(exterior-tiles2-113)]
 $8DA8 DEFB $3C,$CC,$E0,$2C,$CF,$C3,$CC,$0F ; #HTML[#UDGARRAY1,7,4,1;$8DA8-$8DAF-8(exterior-tiles2-114)]
 $8DB0 DEFB $1C,$CE,$F2,$FC,$3C,$4C,$70,$38 ; #HTML[#UDGARRAY1,7,4,1;$8DB0-$8DB7-8(exterior-tiles2-115)]
 $8DB8 DEFB $00,$00,$00,$00,$00,$C0,$F0,$FC ; #HTML[#UDGARRAY1,7,4,1;$8DB8-$8DBF-8(exterior-tiles2-116)]
 $8DC0 DEFB $03,$00,$03,$03,$03,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8DC0-$8DC7-8(exterior-tiles2-117)]
 $8DC8 DEFB $4F,$73,$38,$CB,$F3,$F0,$30,$00 ; #HTML[#UDGARRAY1,7,4,1;$8DC8-$8DCF-8(exterior-tiles2-118)]
 $8DD0 DEFB $CB,$C3,$CC,$0F,$CF,$D3,$1C,$0C ; #HTML[#UDGARRAY1,7,4,1;$8DD0-$8DD7-8(exterior-tiles2-119)]
 $8DD8 DEFB $3C,$CC,$C0,$00,$C0,$C0,$C0,$00 ; #HTML[#UDGARRAY1,7,4,1;$8DD8-$8DDF-8(exterior-tiles2-120)]
 $8DE0 DEFB $00,$C0,$70,$EC,$ED,$EB,$EF,$EF ; #HTML[#UDGARRAY1,7,4,1;$8DE0-$8DE7-8(exterior-tiles2-121)]
 $8DE8 DEFB $EF,$2D,$0F,$03,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8DE8-$8DEF-8(exterior-tiles2-122)]
 $8DF0 DEFB $FE,$FC,$70,$C6,$30,$F3,$CF,$0C ; #HTML[#UDGARRAY1,7,4,1;$8DF0-$8DF7-8(exterior-tiles2-123)]
 $8DF8 DEFB $00,$0C,$3C,$FC,$F3,$4F,$0C,$03 ; #HTML[#UDGARRAY1,7,4,1;$8DF8-$8DFF-8(exterior-tiles2-124)]
 $8E00 DEFB $3C,$FC,$F3,$CF,$0C,$02,$0E,$3E ; #HTML[#UDGARRAY1,7,4,1;$8E00-$8E07-8(exterior-tiles2-125)]
 $8E08 DEFB $0F,$3F,$3C,$33,$0B,$38,$70,$40 ; #HTML[#UDGARRAY1,7,4,1;$8E08-$8E0F-8(exterior-tiles2-126)]
 $8E10 DEFB $04,$1C,$D3,$CF,$3F,$3C,$30,$00 ; #HTML[#UDGARRAY1,7,4,1;$8E10-$8E17-8(exterior-tiles2-127)]
 $8E18 DEFB $FF,$DF,$FF,$FF,$FB,$3F,$0D,$01 ; #HTML[#UDGARRAY1,7,4,1;$8E18-$8E1F-8(exterior-tiles2-128)]
 $8E20 DEFB $03,$03,$0C,$0F,$0F,$13,$1C,$0E ; #HTML[#UDGARRAY1,7,4,1;$8E20-$8E27-8(exterior-tiles2-129)]
 $8E28 DEFB $32,$3C,$3F,$0F,$13,$1C,$0E,$02 ; #HTML[#UDGARRAY1,7,4,1;$8E28-$8E2F-8(exterior-tiles2-130)]
 $8E30 DEFB $30,$C0,$B0,$FC,$FF,$DF,$EF,$FF ; #HTML[#UDGARRAY1,7,4,1;$8E30-$8E37-8(exterior-tiles2-131)]
 $8E38 DEFB $F0,$F0,$F0,$F0,$B0,$F0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8E38-$8E3F-8(exterior-tiles2-132)]
 $8E40 DEFB $30,$C0,$F0,$EC,$FC,$F4,$3C,$CC ; #HTML[#UDGARRAY1,7,4,1;$8E40-$8E47-8(exterior-tiles2-133)]
 $8E48 DEFB $FC,$EC,$3C,$CC,$F0,$D0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8E48-$8E4F-8(exterior-tiles2-134)]
 $8E50 DEFB $30,$C0,$F0,$BC,$FC,$FC,$EC,$DC ; #HTML[#UDGARRAY1,7,4,1;$8E50-$8E57-8(exterior-tiles2-135)]
 $8E58 DEFB $08,$48,$70,$74,$37,$F7,$F3,$FF ; #HTML[#UDGARRAY1,7,4,1;$8E58-$8E5F-8(exterior-tiles2-136)]
 $8E60 DEFB $30,$F0,$F0,$F0,$F0,$F0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8E60-$8E67-8(exterior-tiles2-137)]
 $8E68 DEFB $2C,$4D,$15,$15,$14,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8E68-$8E6F-8(exterior-tiles2-138)]
 $8E70 DEFB $C0,$30,$F0,$F0,$F0,$C3,$2F,$EF ; #HTML[#UDGARRAY1,7,4,1;$8E70-$8E77-8(exterior-tiles2-139)]
 $8E78 DEFB $EF,$6F,$EB,$EF,$EF,$AC,$E3,$EF ; #HTML[#UDGARRAY1,7,4,1;$8E78-$8E7F-8(exterior-tiles2-140)]
 $8E80 DEFB $CF,$2F,$EB,$EF,$AF,$ED,$CF,$33 ; #HTML[#UDGARRAY1,7,4,1;$8E80-$8E87-8(exterior-tiles2-141)]
 $8E88 DEFB $EC,$3F,$0F,$03,$00,$00,$80,$00 ; #HTML[#UDGARRAY1,7,4,1;$8E88-$8E8F-8(exterior-tiles2-142)]
 $8E90 DEFB $6D,$2D,$CD,$F1,$CC,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8E90-$8E97-8(exterior-tiles2-143)]
 $8E98 DEFB $B6,$B6,$B6,$B6,$B6,$36,$C6,$F2 ; #HTML[#UDGARRAY1,7,4,1;$8E98-$8E9F-8(exterior-tiles2-144)]
 $8EA0 DEFB $B0,$F3,$CF,$33,$E8,$E8,$A8,$EC ; #HTML[#UDGARRAY1,7,4,1;$8EA0-$8EA7-8(exterior-tiles2-145)]
 $8EA8 DEFB $08,$10,$C0,$70,$FC,$3B,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8EA8-$8EAF-8(exterior-tiles2-146)]
 $8EB0 DEFB $00,$00,$00,$00,$00,$00,$C0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8EB0-$8EB7-8(exterior-tiles2-147)]
 $8EB8 DEFB $C3,$08,$C2,$F0,$EC,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8EB8-$8EBF-8(exterior-tiles2-148)]
 $8EC0 DEFB $00,$C0,$30,$0C,$93,$00,$C0,$F2 ; #HTML[#UDGARRAY1,7,4,1;$8EC0-$8EC7-8(exterior-tiles2-149)]
 $8EC8 DEFB $EC,$3F,$0F,$03,$00,$C0,$30,$4C ; #HTML[#UDGARRAY1,7,4,1;$8EC8-$8ECF-8(exterior-tiles2-150)]
 $8ED0 DEFB $03,$10,$C4,$B0,$FC,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8ED0-$8ED7-8(exterior-tiles2-151)]
 $8ED8 DEFB $0E,$0D,$01,$0A,$3A,$05,$35,$CB ; #HTML[#UDGARRAY1,7,4,1;$8ED8-$8EDF-8(exterior-tiles2-152)]
 $8EE0 DEFB $2B,$17,$D4,$23,$2F,$2D,$2F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8EE0-$8EE7-8(exterior-tiles2-153)]
 $8EE8 DEFB $00,$10,$C0,$71,$FC,$3B,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$8EE8-$8EEF-8(exterior-tiles2-154)]
 $8EF0 DEFB $0F,$0C,$03,$0F,$3F,$3F,$2F,$3F ; #HTML[#UDGARRAY1,7,4,1;$8EF0-$8EF7-8(exterior-tiles2-155)]
 $8EF8 DEFB $3D,$3F,$3C,$33,$0F,$0D,$0F,$0F ; #HTML[#UDGARRAY1,7,4,1;$8EF8-$8EFF-8(exterior-tiles2-156)]
 $8F00 DEFB $0F,$0C,$03,$0F,$3F,$2F,$3C,$33 ; #HTML[#UDGARRAY1,7,4,1;$8F00-$8F07-8(exterior-tiles2-157)]
 $8F08 DEFB $0F,$0F,$0D,$0F,$0F,$0F,$0F,$0B ; #HTML[#UDGARRAY1,7,4,1;$8F08-$8F0F-8(exterior-tiles2-158)]
 $8F10 DEFB $0F,$0F,$0D,$0F,$0F,$0F,$CF,$F3 ; #HTML[#UDGARRAY1,7,4,1;$8F10-$8F17-8(exterior-tiles2-159)]
 $8F18 DEFB $00,$02,$20,$00,$00,$08,$C0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8F18-$8F1F-8(exterior-tiles2-160)]
 $8F20 DEFB $FC,$3F,$CF,$F3,$EC,$FC,$BC,$FC ; #HTML[#UDGARRAY1,7,4,1;$8F20-$8F27-8(exterior-tiles2-161)]
 $8F28 DEFB $3F,$DC,$F3,$CD,$3F,$2F,$3C,$33 ; #HTML[#UDGARRAY1,7,4,1;$8F28-$8F2F-8(exterior-tiles2-162)]
 $8F30 DEFB $00,$00,$00,$00,$03,$0C,$C1,$F0 ; #HTML[#UDGARRAY1,7,4,1;$8F30-$8F37-8(exterior-tiles2-163)]
 $8F38 DEFB $03,$0C,$30,$C0,$01,$20,$00,$04 ; #HTML[#UDGARRAY1,7,4,1;$8F38-$8F3F-8(exterior-tiles2-164)]
 $8F40 DEFB $00,$00,$00,$00,$03,$0C,$30,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8F40-$8F47-8(exterior-tiles2-165)]
 $8F48 DEFB $00,$00,$00,$00,$03,$0F,$3F,$7C ; #HTML[#UDGARRAY1,7,4,1;$8F48-$8F4F-8(exterior-tiles2-166)]
 $8F50 DEFB $03,$0D,$3F,$FC,$B0,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8F50-$8F57-8(exterior-tiles2-167)]
 $8F58 DEFB $F0,$C0,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8F58-$8F5F-8(exterior-tiles2-168)]
 $8F60 DEFB $0F,$03,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8F60-$8F67-8(exterior-tiles2-169)]
 $8F68 DEFB $C0,$B0,$FC,$3F,$0D,$03,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8F68-$8F6F-8(exterior-tiles2-170)]
 $8F70 DEFB $00,$00,$00,$00,$C0,$F0,$EC,$3F ; #HTML[#UDGARRAY1,7,4,1;$8F70-$8F77-8(exterior-tiles2-171)]
 $8F78 DEFB $00,$00,$00,$00,$C0,$30,$0C,$43 ; #HTML[#UDGARRAY1,7,4,1;$8F78-$8F7F-8(exterior-tiles2-172)]
 $8F80 DEFB $C0,$30,$0C,$43,$00,$02,$20,$00 ; #HTML[#UDGARRAY1,7,4,1;$8F80-$8F87-8(exterior-tiles2-173)]
 $8F88 DEFB $00,$00,$00,$00,$C0,$30,$03,$8F ; #HTML[#UDGARRAY1,7,4,1;$8F88-$8F8F-8(exterior-tiles2-174)]
 $8F90 DEFB $00,$40,$03,$0D,$3F,$FC,$B0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8F90-$8F97-8(exterior-tiles2-175)]
 $8F98 DEFB $3F,$DC,$F0,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8F98-$8F9F-8(exterior-tiles2-176)]
 $8FA0 DEFB $00,$10,$00,$00,$02,$80,$03,$0F ; #HTML[#UDGARRAY1,7,4,1;$8FA0-$8FA7-8(exterior-tiles2-177)]
 $8FA8 DEFB $00,$42,$00,$08,$03,$4C,$33,$CC ; #HTML[#UDGARRAY1,7,4,1;$8FA8-$8FAF-8(exterior-tiles2-178)]
 $8FB0 DEFB $43,$0C,$33,$CC,$30,$C7,$09,$0E ; #HTML[#UDGARRAY1,7,4,1;$8FB0-$8FB7-8(exterior-tiles2-179)]
 $8FB8 DEFB $08,$C0,$30,$CC,$33,$0C,$83,$00 ; #HTML[#UDGARRAY1,7,4,1;$8FB8-$8FBF-8(exterior-tiles2-180)]
 $8FC0 DEFB $00,$00,$44,$00,$00,$C2,$30,$EC ; #HTML[#UDGARRAY1,7,4,1;$8FC0-$8FC7-8(exterior-tiles2-181)]
 $8FC8 DEFB $33,$8C,$03,$10,$00,$00,$40,$02 ; #HTML[#UDGARRAY1,7,4,1;$8FC8-$8FCF-8(exterior-tiles2-182)]
 $8FD0 DEFB $00,$C1,$30,$CC,$33,$0C,$23,$00 ; #HTML[#UDGARRAY1,7,4,1;$8FD0-$8FD7-8(exterior-tiles2-183)]
 $8FD8 DEFB $70,$90,$E3,$0C,$33,$CC,$32,$C0 ; #HTML[#UDGARRAY1,7,4,1;$8FD8-$8FDF-8(exterior-tiles2-184)]
 $8FE0 DEFB $33,$CC,$30,$C0,$00,$11,$00,$20 ; #HTML[#UDGARRAY1,7,4,1;$8FE0-$8FE7-8(exterior-tiles2-185)]
 $8FE8 DEFB $00,$00,$00,$00,$03,$0C,$33,$CD ; #HTML[#UDGARRAY1,7,4,1;$8FE8-$8FEF-8(exterior-tiles2-186)]
 $8FF0 DEFB $2F,$6E,$2F,$6F,$63,$4F,$6F,$2C ; #HTML[#UDGARRAY1,7,4,1;$8FF0-$8FF7-8(exterior-tiles2-187)]
 $8FF8 DEFB $03,$0C,$30,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$8FF8-$8FFF-8(exterior-tiles2-188)]
 $9000 DEFB $70,$40,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9000-$9007-8(exterior-tiles2-189)]
 $9008 DEFB $02,$40,$03,$0F,$3B,$7C,$70,$40 ; #HTML[#UDGARRAY1,7,4,1;$9008-$900F-8(exterior-tiles2-190)]
 $9010 DEFB $00,$00,$00,$00,$03,$0C,$30,$40 ; #HTML[#UDGARRAY1,7,4,1;$9010-$9017-8(exterior-tiles2-191)]
 $9018 DEFB $30,$F0,$B0,$F0,$F0,$D0,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$9018-$901F-8(exterior-tiles2-192)]
 $9020 DEFB $03,$0C,$30,$C0,$08,$20,$2C,$D3 ; #HTML[#UDGARRAY1,7,4,1;$9020-$9027-8(exterior-tiles2-193)]
 $9028 DEFB $F0,$D0,$F0,$F0,$F0,$B0,$F0,$CC ; #HTML[#UDGARRAY1,7,4,1;$9028-$902F-8(exterior-tiles2-194)]
 $9030 DEFB $FF,$3C,$03,$8D,$3F,$DC,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9030-$9037-8(exterior-tiles2-195)]
 $9038 DEFB $2F,$CF,$F7,$FF,$DF,$FF,$EF,$FD ; #HTML[#UDGARRAY1,7,4,1;$9038-$903F-8(exterior-tiles2-196)]
 $9040 DEFB $2F,$CB,$2F,$EF,$AF,$ED,$EF,$EF ; #HTML[#UDGARRAY1,7,4,1;$9040-$9047-8(exterior-tiles2-197)]
 $9048 DEFB $EF,$AF,$EF,$E3,$EC,$2F,$CD,$EF ; #HTML[#UDGARRAY1,7,4,1;$9048-$904F-8(exterior-tiles2-198)]
 $9050 DEFB $C0,$E0,$E0,$EC,$E7,$E3,$2F,$CF ; #HTML[#UDGARRAY1,7,4,1;$9050-$9057-8(exterior-tiles2-199)]
 $9058 DEFB $C0,$30,$CC,$F3,$F0,$F0,$CC,$3C ; #HTML[#UDGARRAY1,7,4,1;$9058-$905F-8(exterior-tiles2-200)]
 $9060 DEFB $10,$08,$0B,$04,$C4,$34,$C4,$CB ; #HTML[#UDGARRAY1,7,4,1;$9060-$9067-8(exterior-tiles2-201)]
 $9068 DEFB $D6,$D6,$D6,$D6,$D2,$D0,$D4,$03 ; #HTML[#UDGARRAY1,7,4,1;$9068-$906F-8(exterior-tiles2-202)]
 $9070 DEFB $C0,$30,$CC,$93,$54,$D6,$D6,$D6 ; #HTML[#UDGARRAY1,7,4,1;$9070-$9077-8(exterior-tiles2-203)]
 $9078 DEFB $D6,$D2,$D4,$D6,$D6,$56,$96,$C6 ; #HTML[#UDGARRAY1,7,4,1;$9078-$907F-8(exterior-tiles2-204)]
 $9080 DEFB $F0,$DC,$CF,$D3,$D4,$D6,$56,$96 ; #HTML[#UDGARRAY1,7,4,1;$9080-$9087-8(exterior-tiles2-205)]
 $9088 DEFB $D4,$D6,$D6,$D2,$D4,$56,$96,$C6 ; #HTML[#UDGARRAY1,7,4,1;$9088-$908F-8(exterior-tiles2-206)]
 $9090 DEFB $00,$00,$00,$00,$01,$03,$05,$0F ; #HTML[#UDGARRAY1,7,4,1;$9090-$9097-8(exterior-tiles2-207)]
 $9098 DEFB $CB,$2B,$ED,$ED,$6D,$2D,$0D,$33 ; #HTML[#UDGARRAY1,7,4,1;$9098-$909F-8(exterior-tiles2-208)]
 $90A0 DEFB $D6,$D6,$D6,$D6,$D6,$D6,$C6,$D2 ; #HTML[#UDGARRAY1,7,4,1;$90A0-$90A7-8(exterior-tiles2-209)]
 $90A8 DEFB $1C,$0F,$03,$00,$10,$00,$00,$02 ; #HTML[#UDGARRAY1,7,4,1;$90A8-$90AF-8(exterior-tiles2-210)]
 $90B0 DEFB $56,$16,$C6,$F2,$3C,$0B,$04,$03 ; #HTML[#UDGARRAY1,7,4,1;$90B0-$90B7-8(exterior-tiles2-211)]
 $90B8 DEFB $D6,$D2,$D4,$83,$4C,$32,$C8,$2C ; #HTML[#UDGARRAY1,7,4,1;$90B8-$90BF-8(exterior-tiles2-212)]
 $90C0 DEFB $D6,$D6,$16,$C6,$F2,$3C,$CF,$D3 ; #HTML[#UDGARRAY1,7,4,1;$90C0-$90C7-8(exterior-tiles2-213)]
 $90C8 DEFB $0F,$0C,$03,$0F,$3F,$2F,$3C,$33 ; #HTML[#UDGARRAY1,7,4,1;$90C8-$90CF-8(exterior-tiles2-214)]
 $90D0 DEFB $CB,$0B,$0D,$0D,$8D,$ED,$4D,$33 ; #HTML[#UDGARRAY1,7,4,1;$90D0-$90D7-8(exterior-tiles2-215)]
 $90D8 DEFB $0B,$0F,$2F,$CD,$32,$4C,$03,$04 ; #HTML[#UDGARRAY1,7,4,1;$90D8-$90DF-8(exterior-tiles2-216)]
 $90E0 DEFB $23,$CF,$33,$4C,$53,$5C,$2F,$23 ; #HTML[#UDGARRAY1,7,4,1;$90E0-$90E7-8(exterior-tiles2-217)]
 $90E8 DEFB $D3,$D0,$B0,$B0,$B3,$B7,$B3,$CC ; #HTML[#UDGARRAY1,7,4,1;$90E8-$90EF-8(exterior-tiles2-218)]
 $90F0 DEFB $D3,$D4,$B6,$B7,$B7,$B4,$F0,$EC ; #HTML[#UDGARRAY1,7,4,1;$90F0-$90F7-8(exterior-tiles2-219)]
 $90F8 DEFB $4C,$32,$C0,$20,$04,$03,$0C,$32 ; #HTML[#UDGARRAY1,7,4,1;$90F8-$90FF-8(exterior-tiles3-000)]
 $9100 DEFB $18,$3C,$78,$B4,$E0,$CC,$A3,$44 ; #HTML[#UDGARRAY1,7,4,1;$9100-$9107-8(exterior-tiles3-001)]
 $9108 DEFB $40,$08,$08,$00,$00,$00,$20,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9108-$910F-8(exterior-tiles3-002)]
 $9110 DEFB $1E,$2C,$7B,$64,$98,$B0,$D0,$CC ; #HTML[#UDGARRAY1,7,4,1;$9110-$9117-8(exterior-tiles3-003)]
 $9118 DEFB $00,$00,$00,$00,$80,$C0,$A0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$9118-$911F-8(exterior-tiles3-004)]
 $9120 DEFB $32,$4C,$03,$04,$00,$00,$20,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9120-$9127-8(exterior-tiles3-005)]
 $9128 DEFB $00,$00,$20,$C0,$32,$4C,$03,$04 ; #HTML[#UDGARRAY1,7,4,1;$9128-$912F-8(exterior-tiles3-006)]
 $9130 DEFB $32,$4C,$03,$04,$01,$03,$25,$CF ; #HTML[#UDGARRAY1,7,4,1;$9130-$9137-8(exterior-tiles3-007)]
 $9138 DEFB $D3,$D0,$B0,$B0,$B0,$B0,$B0,$CC ; #HTML[#UDGARRAY1,7,4,1;$9138-$913F-8(exterior-tiles3-008)]
 $9140 DEFB $20,$C0,$30,$4C,$43,$40,$20,$20 ; #HTML[#UDGARRAY1,7,4,1;$9140-$9147-8(exterior-tiles3-009)]
 $9148 DEFB $32,$4C,$03,$04,$20,$C0,$30,$4C ; #HTML[#UDGARRAY1,7,4,1;$9148-$914F-8(exterior-tiles3-010)]
 $9150 DEFB $43,$40,$20,$20,$20,$C0,$30,$4C ; #HTML[#UDGARRAY1,7,4,1;$9150-$9157-8(exterior-tiles3-011)]
 $9158 DEFB $20,$C0,$30,$4C,$42,$40,$20,$20 ; #HTML[#UDGARRAY1,7,4,1;$9158-$915F-8(exterior-tiles3-012)]
 $9160 DEFB $03,$00,$40,$40,$20,$04,$04,$00 ; #HTML[#UDGARRAY1,7,4,1;$9160-$9167-8(exterior-tiles3-013)]
 $9168 DEFB $20,$C0,$30,$4C,$02,$10,$08,$48 ; #HTML[#UDGARRAY1,7,4,1;$9168-$916F-8(exterior-tiles3-014)]
 $9170 DEFB $20,$C0,$30,$4C,$03,$00,$30,$00 ; #HTML[#UDGARRAY1,7,4,1;$9170-$9177-8(exterior-tiles3-015)]
 $9178 DEFB $D3,$D0,$B0,$B0,$B0,$B0,$B0,$EC ; #HTML[#UDGARRAY1,7,4,1;$9178-$917F-8(exterior-tiles3-016)]
 $9180 DEFB $63,$00,$00,$00,$04,$24,$14,$00 ; #HTML[#UDGARRAY1,7,4,1;$9180-$9187-8(exterior-tiles3-017)]
 $9188 DEFB $40,$40,$01,$09,$08,$04,$64,$00 ; #HTML[#UDGARRAY1,7,4,1;$9188-$918F-8(exterior-tiles3-018)]
 $9190 DEFB $00,$04,$05,$42,$22,$20,$08,$00 ; #HTML[#UDGARRAY1,7,4,1;$9190-$9197-8(exterior-tiles3-019)]
 $9198 DEFB $00,$12,$02,$40,$40,$24,$28,$08 ; #HTML[#UDGARRAY1,7,4,1;$9198-$919F-8(exterior-tiles3-020)]
 $91A0 DEFB $C2,$02,$04,$20,$20,$10,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$91A0-$91A7-8(exterior-tiles3-021)]
 $91A8 DEFB $40,$08,$0A,$04,$04,$40,$40,$20 ; #HTML[#UDGARRAY1,7,4,1;$91A8-$91AF-8(exterior-tiles3-022)]
 $91B0 DEFB $00,$20,$10,$00,$00,$08,$08,$00 ; #HTML[#UDGARRAY1,7,4,1;$91B0-$91B7-8(exterior-tiles3-023)]
 $91B8 DEFB $40,$00,$00,$10,$10,$00,$04,$03 ; #HTML[#UDGARRAY1,7,4,1;$91B8-$91BF-8(exterior-tiles3-024)]
 $91C0 DEFB $18,$3C,$1E,$2D,$07,$33,$C5,$22 ; #HTML[#UDGARRAY1,7,4,1;$91C0-$91C7-8(exterior-tiles3-025)]
 $91C8 DEFB $0C,$30,$C0,$20,$80,$C0,$A4,$F3 ; #HTML[#UDGARRAY1,7,4,1;$91C8-$91CF-8(exterior-tiles3-026)]
 $91D0 DEFB $00,$00,$04,$03,$4C,$32,$C0,$20 ; #HTML[#UDGARRAY1,7,4,1;$91D0-$91D7-8(exterior-tiles3-027)]
 $91D8 DEFB $4C,$32,$C0,$20,$00,$00,$04,$03 ; #HTML[#UDGARRAY1,7,4,1;$91D8-$91DF-8(exterior-tiles3-028)]
 $91E0 DEFB $78,$34,$DE,$26,$19,$0D,$0B,$33 ; #HTML[#UDGARRAY1,7,4,1;$91E0-$91E7-8(exterior-tiles3-029)]
 $91E8 DEFB $04,$03,$0C,$32,$C2,$02,$04,$04 ; #HTML[#UDGARRAY1,7,4,1;$91E8-$91EF-8(exterior-tiles3-030)]
 $91F0 DEFB $CB,$0B,$0D,$0D,$0D,$0D,$0D,$33 ; #HTML[#UDGARRAY1,7,4,1;$91F0-$91F7-8(exterior-tiles3-031)]
 $91F8 DEFB $C2,$02,$04,$04,$04,$03,$0C,$32 ; #HTML[#UDGARRAY1,7,4,1;$91F8-$91FF-8(exterior-tiles3-032)]
 $9200 DEFB $C0,$00,$00,$08,$04,$44,$40,$00 ; #HTML[#UDGARRAY1,7,4,1;$9200-$9207-8(exterior-tiles3-033)]
 $9208 DEFB $04,$03,$0C,$32,$C0,$00,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$9208-$920F-8(exterior-tiles3-034)]
 $9210 DEFB $C6,$00,$10,$12,$0A,$48,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9210-$9217-8(exterior-tiles3-035)]
 $9218 DEFB $04,$03,$0C,$30,$40,$00,$0C,$00 ; #HTML[#UDGARRAY1,7,4,1;$9218-$921F-8(exterior-tiles3-036)]
 $9220 DEFB $04,$03,$0C,$32,$42,$02,$04,$04 ; #HTML[#UDGARRAY1,7,4,1;$9220-$9227-8(exterior-tiles3-037)]
 $9228 DEFB $00,$01,$00,$30,$00,$02,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9228-$922F-8(exterior-tiles3-038)]
 $9230 DEFB $02,$00,$00,$00,$40,$00,$0C,$00 ; #HTML[#UDGARRAY1,7,4,1;$9230-$9237-8(exterior-tiles3-039)]
 $9238 DEFB $02,$80,$00,$08,$04,$00,$60,$00 ; #HTML[#UDGARRAY1,7,4,1;$9238-$923F-8(exterior-tiles3-040)]
 $9240 DEFB $00,$00,$20,$01,$00,$00,$00,$20 ; #HTML[#UDGARRAY1,7,4,1;$9240-$9247-8(exterior-tiles3-041)]
 $9248 DEFB $23,$C3,$33,$4A,$02,$02,$02,$03 ; #HTML[#UDGARRAY1,7,4,1;$9248-$924F-8(exterior-tiles3-042)]
 $9250 DEFB $44,$43,$4C,$D2,$C0,$C0,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9250-$9257-8(exterior-tiles3-043)]
 $9258 DEFB $23,$C3,$33,$4A,$42,$42,$22,$22 ; #HTML[#UDGARRAY1,7,4,1;$9258-$925F-8(exterior-tiles3-044)]
 $9260 DEFB $44,$43,$4C,$D2,$C2,$C2,$C4,$C4 ; #HTML[#UDGARRAY1,7,4,1;$9260-$9267-8(exterior-tiles3-045)]
 $9268 DEFB $03,$03,$C2,$33,$0B,$03,$02,$02 ; #HTML[#UDGARRAY1,7,4,1;$9268-$926F-8(exterior-tiles3-046)]
 $9270 DEFB $40,$C0,$C3,$CC,$D0,$C0,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9270-$9277-8(exterior-tiles3-047)]
 $9278 DEFB $01,$03,$22,$C3,$33,$4B,$02,$03 ; #HTML[#UDGARRAY1,7,4,1;$9278-$927F-8(exterior-tiles3-048)]
 $9280 DEFB $80,$C0,$C4,$C3,$4C,$D2,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9280-$9287-8(exterior-tiles3-049)]
 $9288 DEFB $1E,$3C,$7B,$64,$F8,$C0,$B0,$BC ; #HTML[#UDGARRAY1,7,4,1;$9288-$928F-8(exterior-tiles3-050)]
 $9290 DEFB $BF,$CF,$B3,$B4,$B7,$D6,$D6,$D6 ; #HTML[#UDGARRAY1,7,4,1;$9290-$9297-8(exterior-tiles3-051)]
 $9298 DEFB $B7,$AE,$AF,$AF,$AF,$AF,$AF,$B7 ; #HTML[#UDGARRAY1,7,4,1;$9298-$929F-8(exterior-tiles3-052)]
 $92A0 DEFB $D7,$D6,$D7,$B7,$B7,$B7,$B7,$D7 ; #HTML[#UDGARRAY1,7,4,1;$92A0-$92A7-8(exterior-tiles3-053)]
 $92A8 DEFB $67,$06,$02,$40,$40,$00,$04,$00 ; #HTML[#UDGARRAY1,7,4,1;$92A8-$92AF-8(exterior-tiles3-054)]
 $92B0 DEFB $32,$4C,$03,$04,$00,$C0,$F0,$FC ; #HTML[#UDGARRAY1,7,4,1;$92B0-$92B7-8(exterior-tiles3-055)]
 $92B8 DEFB $00,$C0,$70,$FC,$3F,$CD,$F3,$FC ; #HTML[#UDGARRAY1,7,4,1;$92B8-$92BF-8(exterior-tiles3-056)]
 $92C0 DEFB $00,$C0,$F0,$DC,$3E,$CE,$F2,$F4 ; #HTML[#UDGARRAY1,7,4,1;$92C0-$92C7-8(exterior-tiles3-057)]
 $92C8 DEFB $2E,$CE,$2E,$4E,$4E,$4E,$2E,$2E ; #HTML[#UDGARRAY1,7,4,1;$92C8-$92CF-8(exterior-tiles3-058)]
 $92D0 DEFB $43,$40,$20,$20,$20,$A0,$D0,$FC ; #HTML[#UDGARRAY1,7,4,1;$92D0-$92D7-8(exterior-tiles3-059)]
 $92D8 DEFB $2E,$AE,$D6,$F6,$36,$0E,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$92D8-$92DF-8(exterior-tiles3-060)]
 $92E0 DEFB $3F,$0F,$03,$40,$40,$20,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$92E0-$92E7-8(exterior-tiles3-061)]
 $92E8 DEFB $20,$A0,$D0,$FC,$3F,$0F,$03,$40 ; #HTML[#UDGARRAY1,7,4,1;$92E8-$92EF-8(exterior-tiles3-062)]
 $92F0 DEFB $36,$CE,$2E,$4E,$4E,$4E,$2E,$2E ; #HTML[#UDGARRAY1,7,4,1;$92F0-$92F7-8(exterior-tiles3-063)]
 $92F8 DEFB $37,$CF,$F3,$FC,$3F,$CF,$33,$4C ; #HTML[#UDGARRAY1,7,4,1;$92F8-$92FF-8(exterior-tiles3-064)]
 $9300 DEFB $B3,$B0,$B0,$B0,$B0,$B0,$B0,$BC ; #HTML[#UDGARRAY1,7,4,1;$9300-$9307-8(exterior-tiles3-065)]
 $9308 DEFB $B3,$B0,$B0,$B0,$B0,$B0,$B0,$AC ; #HTML[#UDGARRAY1,7,4,1;$9308-$930F-8(exterior-tiles3-066)]
 $9310 DEFB $3F,$CF,$33,$4C,$43,$40,$20,$20 ; #HTML[#UDGARRAY1,7,4,1;$9310-$9317-8(exterior-tiles3-067)]
 $9318 DEFB $3F,$8F,$B3,$BC,$BF,$BF,$B3,$AC ; #HTML[#UDGARRAY1,7,4,1;$9318-$931F-8(exterior-tiles3-068)]
 $9320 DEFB $21,$C1,$31,$4D,$41,$41,$21,$21 ; #HTML[#UDGARRAY1,7,4,1;$9320-$9327-8(exterior-tiles3-069)]
 $9328 DEFB $21,$A1,$D1,$FD,$3F,$0F,$03,$00 ; #HTML[#UDGARRAY1,7,4,1;$9328-$932F-8(exterior-tiles3-070)]
 $9330 DEFB $3F,$CF,$33,$4D,$41,$41,$21,$21 ; #HTML[#UDGARRAY1,7,4,1;$9330-$9337-8(exterior-tiles3-071)]
 $9338 DEFB $00,$00,$00,$00,$92,$CC,$A3,$F0 ; #HTML[#UDGARRAY1,7,4,1;$9338-$933F-8(exterior-tiles3-072)]
 $9340 DEFB $20,$C0,$30,$4C,$43,$40,$24,$03 ; #HTML[#UDGARRAY1,7,4,1;$9340-$9347-8(exterior-tiles3-073)]
 $9348 DEFB $4C,$30,$C0,$2C,$03,$40,$44,$03 ; #HTML[#UDGARRAY1,7,4,1;$9348-$934F-8(exterior-tiles3-074)]
 $9350 DEFB $4C,$30,$C0,$0C,$00,$13,$0C,$32 ; #HTML[#UDGARRAY1,7,4,1;$9350-$9357-8(exterior-tiles3-075)]
 $9358 DEFB $44,$43,$0C,$32,$C2,$02,$34,$04 ; #HTML[#UDGARRAY1,7,4,1;$9358-$935F-8(exterior-tiles3-076)]
 $9360 DEFB $C2,$02,$34,$04,$44,$43,$0C,$32 ; #HTML[#UDGARRAY1,7,4,1;$9360-$9367-8(exterior-tiles3-077)]
 $9368 DEFB $CB,$0B,$2D,$0D,$4D,$4D,$0D,$33 ; #HTML[#UDGARRAY1,7,4,1;$9368-$936F-8(exterior-tiles3-078)]
 $9370 DEFB $20,$C0,$30,$4C,$43,$40,$04,$03 ; #HTML[#UDGARRAY1,7,4,1;$9370-$9377-8(exterior-tiles3-079)]
 $9378 DEFB $43,$40,$04,$03,$4C,$32,$C0,$2C ; #HTML[#UDGARRAY1,7,4,1;$9378-$937F-8(exterior-tiles3-080)]
 $9380 DEFB $03,$40,$44,$03,$4C,$32,$C0,$2C ; #HTML[#UDGARRAY1,7,4,1;$9380-$9387-8(exterior-tiles3-081)]
 $9388 DEFB $D3,$D0,$B4,$03,$4C,$32,$C0,$20 ; #HTML[#UDGARRAY1,7,4,1;$9388-$938F-8(exterior-tiles3-082)]
 $9390 DEFB $C3,$00,$04,$03,$4C,$32,$C0,$20 ; #HTML[#UDGARRAY1,7,4,1;$9390-$9397-8(exterior-tiles3-083)]
 $9398 DEFB $00,$00,$20,$20,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9398-$939F-8(exterior-tiles3-084)]
 $93A0 DEFB $00,$00,$00,$18,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$93A0-$93A7-8(exterior-tiles3-085)]
 $93A8 DEFB $00,$08,$04,$00,$00,$00,$00,$20 ; #HTML[#UDGARRAY1,7,4,1;$93A8-$93AF-8(exterior-tiles3-086)]
 $93B0 DEFB $10,$00,$00,$00,$00,$02,$04,$00 ; #HTML[#UDGARRAY1,7,4,1;$93B0-$93B7-8(exterior-tiles3-087)]
 $93B8 DEFB $04,$03,$0C,$32,$42,$02,$24,$C0 ; #HTML[#UDGARRAY1,7,4,1;$93B8-$93BF-8(exterior-tiles3-088)]
 $93C0 DEFB $04,$03,$0C,$32,$C0,$00,$20,$C0 ; #HTML[#UDGARRAY1,7,4,1;$93C0-$93C7-8(exterior-tiles3-089)]
 $93C8 DEFB $00,$60,$94,$F3,$B4,$B2,$D0,$D0 ; #HTML[#UDGARRAY1,7,4,1;$93C8-$93CF-8(exterior-tiles3-090)]
 $93D0 DEFB $32,$4C,$03,$34,$41,$03,$25,$CF ; #HTML[#UDGARRAY1,7,4,1;$93D0-$93D7-8(exterior-tiles3-091)]
 $93D8 DEFB $CB,$0B,$2D,$CD,$32,$4C,$03,$34 ; #HTML[#UDGARRAY1,7,4,1;$93D8-$93DF-8(exterior-tiles3-092)]
 $93E0 DEFB $C2,$02,$22,$C0,$32,$4C,$03,$34 ; #HTML[#UDGARRAY1,7,4,1;$93E0-$93E7-8(exterior-tiles3-093)]
 $93E8 DEFB $C0,$02,$20,$C0,$32,$4C,$03,$04 ; #HTML[#UDGARRAY1,7,4,1;$93E8-$93EF-8(exterior-tiles3-094)]
 $93F0 DEFB $32,$4C,$03,$34,$C0,$02,$22,$C0 ; #HTML[#UDGARRAY1,7,4,1;$93F0-$93F7-8(exterior-tiles3-095)]
 $93F8 DEFB $20,$C2,$30,$4C,$43,$40,$2C,$20 ; #HTML[#UDGARRAY1,7,4,1;$93F8-$93FF-8(exterior-tiles3-096)]
 $9400 DEFB $D3,$D0,$B4,$B2,$B2,$B2,$B0,$CC ; #HTML[#UDGARRAY1,7,4,1;$9400-$9407-8(exterior-tiles3-097)]
 $9408 DEFB $32,$4C,$03,$04,$20,$C2,$30,$4C ; #HTML[#UDGARRAY1,7,4,1;$9408-$940F-8(exterior-tiles3-098)]
 $9410 DEFB $0A,$CE,$32,$4C,$42,$4C,$2E,$26 ; #HTML[#UDGARRAY1,7,4,1;$9410-$9417-8(exterior-tiles3-099)]
 $9418 DEFB $0C,$00,$20,$C0,$32,$4C,$03,$34 ; #HTML[#UDGARRAY1,7,4,1;$9418-$941F-8(exterior-tiles3-100)]
 $9420 DEFB $F2,$CC,$D3,$D4,$B0,$B0,$B0,$CC ; #HTML[#UDGARRAY1,7,4,1;$9420-$9427-8(exterior-tiles3-101)]
 $9428 DEFB $22,$C2,$30,$4C,$43,$40,$2C,$22 ; #HTML[#UDGARRAY1,7,4,1;$9428-$942F-8(exterior-tiles3-102)]
 $9430 DEFB $22,$C2,$30,$4C,$43,$40,$20,$20 ; #HTML[#UDGARRAY1,7,4,1;$9430-$9437-8(exterior-tiles3-103)]
 $9438 DEFB $43,$40,$2C,$22,$22,$C2,$30,$4C ; #HTML[#UDGARRAY1,7,4,1;$9438-$943F-8(exterior-tiles3-104)]
 $9440 DEFB $00,$21,$10,$10,$03,$0C,$33,$CC ; #HTML[#UDGARRAY1,7,4,1;$9440-$9447-8(exterior-tiles3-105)]
 $9448 DEFB $40,$8C,$30,$C4,$30,$C0,$0E,$12 ; #HTML[#UDGARRAY1,7,4,1;$9448-$944F-8(exterior-tiles3-106)]
 $9450 DEFB $33,$0C,$03,$40,$44,$44,$20,$00 ; #HTML[#UDGARRAY1,7,4,1;$9450-$9457-8(exterior-tiles3-107)]
 $9458 DEFB $0C,$C0,$03,$C0,$30,$02,$0A,$04 ; #HTML[#UDGARRAY1,7,4,1;$9458-$945F-8(exterior-tiles3-108)]
 $9460 DEFB $00,$40,$E0,$00,$C2,$E0,$C0,$00 ; #HTML[#UDGARRAY1,7,4,1;$9460-$9467-8(exterior-tiles3-109)]
 $9468 DEFB $31,$CD,$32,$0D,$3E,$19,$02,$02 ; #HTML[#UDGARRAY1,7,4,1;$9468-$946F-8(exterior-tiles3-110)]
 $9470 DEFB $8C,$B3,$4C,$B0,$7C,$99,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9470-$9477-8(exterior-tiles3-111)]
 $9478 DEFB $00,$02,$07,$00,$43,$07,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$9478-$947F-8(exterior-tiles3-112)]
 $9480 DEFB $D9,$DB,$2A,$CB,$33,$4B,$B2,$DB ; #HTML[#UDGARRAY1,7,4,1;$9480-$9487-8(exterior-tiles3-113)]
 $9488 DEFB $9B,$DB,$D4,$D3,$4C,$D2,$CD,$DB ; #HTML[#UDGARRAY1,7,4,1;$9488-$948F-8(exterior-tiles3-114)]
 $9490 DEFB $3B,$CB,$33,$CA,$E2,$EA,$EA,$EA ; #HTML[#UDGARRAY1,7,4,1;$9490-$9497-8(exterior-tiles3-115)]
 $9498 DEFB $5C,$53,$4C,$D3,$C7,$D7,$D7,$D7 ; #HTML[#UDGARRAY1,7,4,1;$9498-$949F-8(exterior-tiles3-116)]
 $94A0 DEFB $31,$CD,$32,$CC,$BE,$D8,$E0,$F8 ; #HTML[#UDGARRAY1,7,4,1;$94A0-$94A7-8(exterior-tiles3-117)]
 $94A8 DEFB $8C,$B3,$4C,$33,$7D,$1B,$07,$1F ; #HTML[#UDGARRAY1,7,4,1;$94A8-$94AF-8(exterior-tiles3-118)]
 $94B0 DEFB $32,$4C,$33,$34,$3A,$1A,$2A,$C8 ; #HTML[#UDGARRAY1,7,4,1;$94B0-$94B7-8(exterior-tiles3-119)]
 $94B8 DEFB $32,$4C,$33,$14,$2A,$CA,$32,$4C ; #HTML[#UDGARRAY1,7,4,1;$94B8-$94BF-8(exterior-tiles3-120)]
 $94C0 DEFB $53,$54,$26,$26,$2A,$CA,$32,$4C ; #HTML[#UDGARRAY1,7,4,1;$94C0-$94C7-8(exterior-tiles3-121)]
 $94C8 DEFB $3B,$C3,$33,$0B,$02,$02,$03,$01 ; #HTML[#UDGARRAY1,7,4,1;$94C8-$94CF-8(exterior-tiles3-122)]
 $94D0 DEFB $D8,$D8,$D8,$D8,$E8,$E8,$E8,$E8 ; #HTML[#UDGARRAY1,7,4,1;$94D0-$94D7-8(exterior-tiles3-123)]
 $94D8 DEFB $1B,$1B,$1B,$1B,$17,$17,$17,$17 ; #HTML[#UDGARRAY1,7,4,1;$94D8-$94DF-8(exterior-tiles3-124)]
 $94E0 DEFB $5C,$43,$4C,$50,$C0,$C0,$C0,$80 ; #HTML[#UDGARRAY1,7,4,1;$94E0-$94E7-8(exterior-tiles3-125)]
 $94E8 DEFB $4C,$32,$CC,$2C,$5C,$58,$54,$13 ; #HTML[#UDGARRAY1,7,4,1;$94E8-$94EF-8(exterior-tiles3-126)]
 $94F0 DEFB $4C,$32,$CC,$28,$54,$53,$4C,$32 ; #HTML[#UDGARRAY1,7,4,1;$94F0-$94F7-8(exterior-tiles3-127)]
 $94F8 DEFB $CA,$2A,$64,$64,$54,$53,$4C,$32 ; #HTML[#UDGARRAY1,7,4,1;$94F8-$94FF-8(exterior-tiles3-128)]
 $9500 DEFB $36,$36,$36,$36,$3A,$1A,$2A,$C8 ; #HTML[#UDGARRAY1,7,4,1;$9500-$9507-8(exterior-tiles3-129)]
 $9508 DEFB $6C,$6C,$6C,$6C,$5C,$58,$54,$13 ; #HTML[#UDGARRAY1,7,4,1;$9508-$950F-8(exterior-tiles3-130)]
 $9510 DEFB $0B,$43,$02,$C2,$F3,$3D,$CE,$03 ; #HTML[#UDGARRAY1,7,4,1;$9510-$9517-8(exterior-tiles3-131)]
 $9518 DEFB $42,$50,$C0,$C3,$CF,$BC,$70,$CC ; #HTML[#UDGARRAY1,7,4,1;$9518-$951F-8(exterior-tiles3-132)]
 $9520 DEFB $C0,$0C,$30,$C3,$0C,$33,$CC,$30 ; #HTML[#UDGARRAY1,7,4,1;$9520-$9527-8(exterior-tiles3-133)]
 $9528 DEFB $01,$0D,$20,$C3,$0C,$33,$CC,$30 ; #HTML[#UDGARRAY1,7,4,1;$9528-$952F-8(exterior-tiles3-134)]
 $9530 DEFB $00,$21,$10,$10,$03,$0C,$32,$CD ; #HTML[#UDGARRAY1,7,4,1;$9530-$9537-8(exterior-tiles3-135)]
 $9538 DEFB $13,$1C,$1C,$1C,$1D,$1D,$1C,$2C ; #HTML[#UDGARRAY1,7,4,1;$9538-$953F-8(exterior-tiles3-136)]
 $9540 DEFB $CC,$3C,$6C,$6C,$5C,$5C,$5C,$5C ; #HTML[#UDGARRAY1,7,4,1;$9540-$9547-8(exterior-tiles3-137)]
 $9548 DEFB $03,$30,$08,$C3,$30,$CC,$33,$0C ; #HTML[#UDGARRAY1,7,4,1;$9548-$954F-8(exterior-tiles3-138)]
 $9550 DEFB $82,$80,$08,$C2,$30,$CC,$33,$0C ; #HTML[#UDGARRAY1,7,4,1;$9550-$9557-8(exterior-tiles3-139)]
 $9558 DEFB $F0,$3C,$0F,$03,$08,$83,$20,$0C ; #HTML[#UDGARRAY1,7,4,1;$9558-$955F-8(exterior-tiles3-140)]
 $9560 DEFB $F0,$3C,$8F,$83,$88,$83,$A0,$8C ; #HTML[#UDGARRAY1,7,4,1;$9560-$9567-8(exterior-tiles3-141)]
 $9568 DEFB $0F,$3C,$F1,$C1,$01,$01,$C1,$09 ; #HTML[#UDGARRAY1,7,4,1;$9568-$956F-8(exterior-tiles3-142)]
 $9570 DEFB $30,$CC,$33,$4C,$E3,$80,$08,$00 ; #HTML[#UDGARRAY1,7,4,1;$9570-$9577-8(exterior-tiles3-143)]
 $9578 DEFB $33,$3C,$36,$36,$3A,$3A,$3A,$3A ; #HTML[#UDGARRAY1,7,4,1;$9578-$957F-8(exterior-tiles3-144)]
 $9580 DEFB $C0,$30,$4C,$03,$10,$02,$40,$03 ; #HTML[#UDGARRAY1,7,4,1;$9580-$9587-8(exterior-tiles3-145)]
 $9588 DEFB $0C,$33,$CC,$32,$C7,$01,$20,$00 ; #HTML[#UDGARRAY1,7,4,1;$9588-$958F-8(exterior-tiles3-146)]
 $9590 DEFB $C8,$38,$38,$38,$B8,$B8,$38,$34 ; #HTML[#UDGARRAY1,7,4,1;$9590-$9597-8(exterior-tiles3-147)]
 $9598 DEFB $07,$40,$08,$20,$C0,$04,$30,$C3 ; #HTML[#UDGARRAY1,7,4,1;$9598-$959F-8(exterior-tiles3-148)]
 $95A0 DEFB $C0,$F0,$1C,$83,$0C,$33,$CC,$30 ; #HTML[#UDGARRAY1,7,4,1;$95A0-$95A7-8(exterior-tiles3-149)]
 $95A8 DEFB $00,$00,$00,$C0,$F3,$3C,$8F,$03 ; #HTML[#UDGARRAY1,7,4,1;$95A8-$95AF-8(exterior-tiles3-150)]
 $95B0 DEFB $03,$0F,$38,$C1,$30,$8C,$33,$0C ; #HTML[#UDGARRAY1,7,4,1;$95B0-$95B7-8(exterior-tiles3-151)]
 $95B8 DEFB $03,$0C,$30,$C2,$10,$00,$08,$C1 ; #HTML[#UDGARRAY1,7,4,1;$95B8-$95BF-8(exterior-tiles3-152)]
 $95C0 DEFB $E0,$02,$10,$0C,$01,$30,$04,$C3 ; #HTML[#UDGARRAY1,7,4,1;$95C0-$95C7-8(exterior-tiles3-153)]
 $95C8 DEFB $02,$02,$00,$10,$C0,$30,$4C,$B3 ; #HTML[#UDGARRAY1,7,4,1;$95C8-$95CF-8(exterior-tiles3-154)]
 $95D0 DEFB $06,$38,$C0,$10,$C0,$32,$0C,$03 ; #HTML[#UDGARRAY1,7,4,1;$95D0-$95D7-8(exterior-tiles3-155)]
 $95D8 DEFB $60,$1C,$03,$08,$03,$4C,$30,$C0 ; #HTML[#UDGARRAY1,7,4,1;$95D8-$95DF-8(exterior-tiles3-156)]
 $95E0 DEFB $C0,$30,$0C,$E3,$18,$07,$20,$00 ; #HTML[#UDGARRAY1,7,4,1;$95E0-$95E7-8(exterior-tiles3-157)]
 $95E8 DEFB $00,$04,$04,$00,$C1,$30,$CC,$3B ; #HTML[#UDGARRAY1,7,4,1;$95E8-$95EF-8(exterior-tiles3-158)]
 $95F0 DEFB $03,$0C,$30,$C7,$18,$E0,$04,$00 ; #HTML[#UDGARRAY1,7,4,1;$95F0-$95F7-8(exterior-tiles3-159)]
 $95F8 DEFB $00,$22,$20,$00,$03,$0C,$33,$DC ; #HTML[#UDGARRAY1,7,4,1;$95F8-$95FF-8(exterior-tiles3-160)]
 $9600 DEFB $36,$36,$36,$36,$3A,$3A,$3A,$3A ; #HTML[#UDGARRAY1,7,4,1;$9600-$9607-8(exterior-tiles3-161)]
 $9608 DEFB $36,$32,$34,$33,$4C,$32,$C8,$2A ; #HTML[#UDGARRAY1,7,4,1;$9608-$960F-8(exterior-tiles3-162)]
 $9610 DEFB $34,$33,$0C,$32,$CA,$3A,$34,$34 ; #HTML[#UDGARRAY1,7,4,1;$9610-$9617-8(exterior-tiles3-163)]
 $9618 DEFB $D9,$DB,$DA,$DB,$EB,$EB,$EA,$A3 ; #HTML[#UDGARRAY1,7,4,1;$9618-$961F-8(exterior-tiles3-164)]
 $9620 DEFB $4D,$33,$CA,$2B,$CB,$EB,$EA,$A3 ; #HTML[#UDGARRAY1,7,4,1;$9620-$9627-8(exterior-tiles3-165)]
 $9628 DEFB $4D,$33,$CB,$2A,$CA,$E2,$CC,$B2 ; #HTML[#UDGARRAY1,7,4,1;$9628-$962F-8(exterior-tiles3-166)]
 $9630 DEFB $C3,$03,$03,$03,$02,$02,$0B,$33 ; #HTML[#UDGARRAY1,7,4,1;$9630-$9637-8(exterior-tiles3-167)]
 $9638 DEFB $CB,$1B,$DB,$DA,$EA,$E2,$CC,$32 ; #HTML[#UDGARRAY1,7,4,1;$9638-$963F-8(exterior-tiles3-168)]
 $9640 DEFB $30,$C3,$00,$33,$CF,$3C,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9640-$9647-8(exterior-tiles3-169)]
 $9648 DEFB $00,$30,$42,$04,$10,$C3,$08,$03 ; #HTML[#UDGARRAY1,7,4,1;$9648-$964F-8(exterior-tiles3-170)]
 $9650 DEFB $0F,$3C,$F0,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9650-$9657-8(exterior-tiles3-171)]
 $9658 DEFB $09,$C3,$31,$0D,$C3,$11,$0D,$C3 ; #HTML[#UDGARRAY1,7,4,1;$9658-$965F-8(exterior-tiles3-172)]
 $9660 DEFB $90,$C2,$8C,$B0,$C3,$84,$B0,$80 ; #HTML[#UDGARRAY1,7,4,1;$9660-$9667-8(exterior-tiles3-173)]
 $9668 DEFB $08,$30,$C2,$04,$30,$80,$08,$20 ; #HTML[#UDGARRAY1,7,4,1;$9668-$966F-8(exterior-tiles3-174)]
 $9670 DEFB $00,$C0,$30,$00,$C0,$30,$0C,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9670-$9677-8(exterior-tiles3-175)]
 $9678 DEFB $20,$0C,$C0,$30,$08,$43,$30,$0C ; #HTML[#UDGARRAY1,7,4,1;$9678-$967F-8(exterior-tiles3-176)]
 $9680 DEFB $C3,$31,$0D,$81,$31,$0D,$43,$31 ; #HTML[#UDGARRAY1,7,4,1;$9680-$9687-8(exterior-tiles3-177)]
 $9688 DEFB $C3,$84,$B0,$C3,$8C,$90,$C3,$8C ; #HTML[#UDGARRAY1,7,4,1;$9688-$968F-8(exterior-tiles3-178)]
 $9690 DEFB $CB,$0B,$0D,$0D,$0D,$CD,$CD,$33 ; #HTML[#UDGARRAY1,7,4,1;$9690-$9697-8(exterior-tiles3-179)]
 $9698 DEFB $CB,$2B,$ED,$ED,$ED,$2D,$0D,$37 ; #HTML[#UDGARRAY1,7,4,1;$9698-$969F-8(exterior-tiles3-180)]
 $96A0 DEFB $F4,$33,$0C,$32,$C2,$02,$04,$04 ; #HTML[#UDGARRAY1,7,4,1;$96A0-$96A7-8(exterior-tiles3-181)]
 $96A8 DEFB $04,$C3,$CC,$32,$0A,$3A,$F5,$F5 ; #HTML[#UDGARRAY1,7,4,1;$96A8-$96AF-8(exterior-tiles3-182)]
 $96B0 DEFB $C2,$02,$04,$04,$04,$43,$4C,$32 ; #HTML[#UDGARRAY1,7,4,1;$96B0-$96B7-8(exterior-tiles3-183)]
 $96B8 DEFB $CA,$3A,$75,$75,$74,$33,$0C,$32 ; #HTML[#UDGARRAY1,7,4,1;$96B8-$96BF-8(exterior-tiles3-184)]
 $96C0 DEFB $4C,$32,$CD,$2B,$D4,$33,$0C,$32 ; #HTML[#UDGARRAY1,7,4,1;$96C0-$96C7-8(exterior-tiles3-185)]
 $96C8 DEFB $4C,$32,$C0,$20,$00,$C0,$F4,$B3 ; #HTML[#UDGARRAY1,7,4,1;$96C8-$96CF-8(exterior-tiles3-186)]
 $96D0 DEFB $5F,$3B,$04,$03,$4C,$32,$C0,$20 ; #HTML[#UDGARRAY1,7,4,1;$96D0-$96D7-8(exterior-tiles3-187)]
 $96D8 DEFB $00,$40,$74,$33,$4C,$32,$CD,$2F ; #HTML[#UDGARRAY1,7,4,1;$96D8-$96DF-8(exterior-tiles3-188)]
 $96E0 DEFB $D6,$D6,$D6,$D6,$D6,$D2,$D4,$93 ; #HTML[#UDGARRAY1,7,4,1;$96E0-$96E7-8(exterior-tiles3-189)]
 $96E8 DEFB $CB,$2B,$CD,$ED,$2D,$0D,$0D,$33 ; #HTML[#UDGARRAY1,7,4,1;$96E8-$96EF-8(exterior-tiles3-190)]
 $96F0 DEFB $00,$00,$00,$00,$06,$0B,$0F,$0D ; #HTML[#UDGARRAY1,7,4,1;$96F0-$96F7-8(exterior-tiles3-191)]
 $96F8 DEFB $4F,$37,$CD,$2F,$0B,$0F,$0D,$0F ; #HTML[#UDGARRAY1,7,4,1;$96F8-$96FF-8(exterior-tiles3-192)]
 $9700 DEFB $00,$00,$00,$00,$60,$D0,$F0,$B0 ; #HTML[#UDGARRAY1,7,4,1;$9700-$9707-8(exterior-tiles3-193)]
 $9708 DEFB $F2,$AC,$F3,$F4,$D0,$F0,$F0,$B0 ; #HTML[#UDGARRAY1,7,4,1;$9708-$970F-8(exterior-tiles3-194)]
 $9710 DEFB $D3,$D0,$B0,$B0,$B3,$B7,$B3,$CC ; #HTML[#UDGARRAY1,7,4,1;$9710-$9717-8(exterior-tiles3-195)]
 $9718 DEFB $22,$CE,$32,$4C,$52,$5C,$AE,$2E ; #HTML[#UDGARRAY1,7,4,1;$9718-$971F-8(exterior-tiles3-196)]
 $9720 DEFB $D3,$D4,$B7,$B7,$B7,$B4,$B0,$CC ; #HTML[#UDGARRAY1,7,4,1;$9720-$9727-8(exterior-tiles3-197)]
 $9728 DEFB $2E,$CC,$30,$4C,$43,$40,$20,$20 ; #HTML[#UDGARRAY1,7,4,1;$9728-$972F-8(exterior-tiles3-198)]
 $9730 DEFB $43,$40,$20,$20,$23,$CF,$33,$4C ; #HTML[#UDGARRAY1,7,4,1;$9730-$9737-8(exterior-tiles3-199)]
 $9738 DEFB $53,$5C,$AF,$AF,$2F,$CC,$30,$4C ; #HTML[#UDGARRAY1,7,4,1;$9738-$973F-8(exterior-tiles3-200)]
 $9740 DEFB $0B,$0F,$2F,$CD,$32,$4C,$13,$14 ; #HTML[#UDGARRAY1,7,4,1;$9740-$9747-8(exterior-tiles3-201)]
 $9748 DEFB $7F,$7F,$3E,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9748-$974F-8(exterior-tiles3-202)]
 $9750 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9750-$9757-8(exterior-tiles3-203)]
 $9758 DEFB $4F,$73,$38,$CB,$F3,$F0,$30,$00 ; #HTML[#UDGARRAY1,7,4,1;$9758-$975F-8(exterior-tiles3-204)]
 $9760 DEFB $3C,$CC,$C0,$00,$C0,$C0,$C0,$00 ; #HTML[#UDGARRAY1,7,4,1;$9760-$9767-8(exterior-tiles3-205)]
; Interior tiles. 194 tiles.
@label=interior_tiles
 $9768 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9768-$976F-8(interior-tiles-000)]
 $9770 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9770-$9777-8(interior-tiles-001)]
 $9778 DEFB $00,$00,$00,$30,$40,$02,$0C,$80 ; #HTML[#UDGARRAY1,7,4,1;$9778-$977F-8(interior-tiles-002)]
 $9780 DEFB $00,$00,$00,$00,$00,$04,$08,$04 ; #HTML[#UDGARRAY1,7,4,1;$9780-$9787-8(interior-tiles-003)]
 $9788 DEFB $30,$FC,$3F,$CF,$C3,$C0,$C8,$C6 ; #HTML[#UDGARRAY1,7,4,1;$9788-$978F-8(interior-tiles-004)]
 $9790 DEFB $10,$60,$00,$C6,$F0,$FC,$3F,$0C ; #HTML[#UDGARRAY1,7,4,1;$9790-$9797-8(interior-tiles-005)]
 $9798 DEFB $00,$98,$62,$08,$20,$80,$04,$00 ; #HTML[#UDGARRAY1,7,4,1;$9798-$979F-8(interior-tiles-006)]
 $97A0 DEFB $24,$81,$00,$08,$01,$40,$20,$01 ; #HTML[#UDGARRAY1,7,4,1;$97A0-$97A7-8(interior-tiles-007)]
 $97A8 DEFB $40,$30,$00,$4C,$30,$00,$86,$08 ; #HTML[#UDGARRAY1,7,4,1;$97A8-$97AF-8(interior-tiles-008)]
 $97B0 DEFB $C8,$C0,$C2,$CC,$F0,$C0,$0C,$01 ; #HTML[#UDGARRAY1,7,4,1;$97B0-$97B7-8(interior-tiles-009)]
 $97B8 DEFB $23,$83,$03,$13,$03,$83,$43,$03 ; #HTML[#UDGARRAY1,7,4,1;$97B8-$97BF-8(interior-tiles-010)]
 $97C0 DEFB $00,$18,$00,$40,$02,$08,$20,$80 ; #HTML[#UDGARRAY1,7,4,1;$97C0-$97C7-8(interior-tiles-011)]
 $97C8 DEFB $03,$13,$03,$03,$43,$0C,$30,$80 ; #HTML[#UDGARRAY1,7,4,1;$97C8-$97CF-8(interior-tiles-012)]
 $97D0 DEFB $02,$08,$20,$80,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$97D0-$97D7-8(interior-tiles-013)]
 $97D8 DEFB $08,$40,$00,$20,$00,$04,$40,$00 ; #HTML[#UDGARRAY1,7,4,1;$97D8-$97DF-8(interior-tiles-014)]
 $97E0 DEFB $40,$04,$02,$4C,$30,$00,$C3,$08 ; #HTML[#UDGARRAY1,7,4,1;$97E0-$97E7-8(interior-tiles-015)]
 $97E8 DEFB $00,$00,$03,$44,$8C,$1E,$0C,$40 ; #HTML[#UDGARRAY1,7,4,1;$97E8-$97EF-8(interior-tiles-016)]
 $97F0 DEFB $08,$06,$00,$63,$0F,$3F,$FC,$30 ; #HTML[#UDGARRAY1,7,4,1;$97F0-$97F7-8(interior-tiles-017)]
 $97F8 DEFB $0C,$3F,$FC,$F3,$C3,$0B,$23,$C3 ; #HTML[#UDGARRAY1,7,4,1;$97F8-$97FF-8(interior-tiles-018)]
 $9800 DEFB $40,$10,$04,$01,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9800-$9807-8(interior-tiles-019)]
 $9808 DEFB $00,$00,$C0,$22,$31,$78,$30,$02 ; #HTML[#UDGARRAY1,7,4,1;$9808-$980F-8(interior-tiles-020)]
 $9810 DEFB $C4,$C1,$C0,$D0,$C0,$C1,$C2,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9810-$9817-8(interior-tiles-021)]
 $9818 DEFB $13,$0B,$43,$33,$0F,$03,$20,$80 ; #HTML[#UDGARRAY1,7,4,1;$9818-$981F-8(interior-tiles-022)]
 $9820 DEFB $06,$20,$40,$34,$08,$03,$C0,$30 ; #HTML[#UDGARRAY1,7,4,1;$9820-$9827-8(interior-tiles-023)]
 $9828 DEFB $C0,$C8,$C0,$C0,$C2,$30,$0C,$01 ; #HTML[#UDGARRAY1,7,4,1;$9828-$982F-8(interior-tiles-024)]
 $9830 DEFB $00,$19,$46,$10,$04,$01,$20,$00 ; #HTML[#UDGARRAY1,7,4,1;$9830-$9837-8(interior-tiles-025)]
 $9838 DEFB $00,$00,$18,$00,$42,$10,$04,$01 ; #HTML[#UDGARRAY1,7,4,1;$9838-$983F-8(interior-tiles-026)]
 $9840 DEFB $81,$9B,$62,$01,$80,$23,$4F,$0B ; #HTML[#UDGARRAY1,7,4,1;$9840-$9847-8(interior-tiles-027)]
 $9848 DEFB $C3,$13,$03,$C3,$F3,$FC,$3F,$0C ; #HTML[#UDGARRAY1,7,4,1;$9848-$984F-8(interior-tiles-028)]
 $9850 DEFB $C8,$C4,$C0,$C3,$CF,$3F,$FC,$30 ; #HTML[#UDGARRAY1,7,4,1;$9850-$9857-8(interior-tiles-029)]
 $9858 DEFB $30,$FC,$3F,$CF,$C3,$C0,$98,$7E ; #HTML[#UDGARRAY1,7,4,1;$9858-$985F-8(interior-tiles-030)]
 $9860 DEFB $73,$4F,$77,$38,$16,$03,$40,$04 ; #HTML[#UDGARRAY1,7,4,1;$9860-$9867-8(interior-tiles-031)]
 $9868 DEFB $FF,$7E,$9C,$E8,$F2,$00,$20,$80 ; #HTML[#UDGARRAY1,7,4,1;$9868-$986F-8(interior-tiles-032)]
 $9870 DEFB $1B,$5F,$0E,$C5,$1F,$33,$6D,$7D ; #HTML[#UDGARRAY1,7,4,1;$9870-$9877-8(interior-tiles-033)]
 $9878 DEFB $72,$FB,$FF,$DB,$67,$FD,$9F,$6D ; #HTML[#UDGARRAY1,7,4,1;$9878-$987F-8(interior-tiles-034)]
 $9880 DEFB $BB,$7B,$7B,$63,$C3,$CC,$10,$00 ; #HTML[#UDGARRAY1,7,4,1;$9880-$9887-8(interior-tiles-035)]
 $9888 DEFB $C3,$CB,$63,$E3,$D3,$FB,$BB,$CB ; #HTML[#UDGARRAY1,7,4,1;$9888-$988F-8(interior-tiles-036)]
 $9890 DEFB $00,$00,$00,$03,$0F,$3C,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9890-$9897-8(interior-tiles-037)]
 $9898 DEFB $0F,$3C,$F0,$C0,$00,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$9898-$989F-8(interior-tiles-038)]
 $98A0 DEFB $C0,$C0,$C0,$C0,$C0,$C0,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$98A0-$98A7-8(interior-tiles-039)]
 $98A8 DEFB $C0,$C0,$C0,$C0,$C0,$C3,$CC,$F0 ; #HTML[#UDGARRAY1,7,4,1;$98A8-$98AF-8(interior-tiles-040)]
 $98B0 DEFB $80,$83,$8C,$B0,$C0,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$98B0-$98B7-8(interior-tiles-041)]
 $98B8 DEFB $00,$80,$80,$80,$80,$83,$8C,$B0 ; #HTML[#UDGARRAY1,7,4,1;$98B8-$98BF-8(interior-tiles-042)]
 $98C0 DEFB $C0,$81,$82,$82,$80,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$98C0-$98C7-8(interior-tiles-043)]
 $98C8 DEFB $C0,$A0,$A0,$80,$83,$8F,$BF,$BC ; #HTML[#UDGARRAY1,7,4,1;$98C8-$98CF-8(interior-tiles-044)]
 $98D0 DEFB $C0,$C0,$C0,$C0,$40,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$98D0-$98D7-8(interior-tiles-045)]
 $98D8 DEFB $C3,$CF,$DF,$DC,$F0,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$98D8-$98DF-8(interior-tiles-046)]
 $98E0 DEFB $70,$C0,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$98E0-$98E7-8(interior-tiles-047)]
 $98E8 DEFB $83,$8F,$BF,$BC,$70,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$98E8-$98EF-8(interior-tiles-048)]
 $98F0 DEFB $C0,$C1,$C2,$C2,$C0,$C0,$C0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$98F0-$98F7-8(interior-tiles-049)]
 $98F8 DEFB $00,$00,$00,$00,$00,$00,$00,$03 ; #HTML[#UDGARRAY1,7,4,1;$98F8-$98FF-8(interior-tiles-050)]
 $9900 DEFB $43,$13,$07,$03,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9900-$9907-8(interior-tiles-051)]
 $9908 DEFB $0F,$3C,$F0,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9908-$990F-8(interior-tiles-052)]
 $9910 DEFB $00,$00,$00,$C0,$F0,$3C,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$9910-$9917-8(interior-tiles-053)]
 $9918 DEFB $00,$00,$00,$00,$00,$00,$00,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9918-$991F-8(interior-tiles-054)]
 $9920 DEFB $F0,$3C,$0F,$03,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9920-$9927-8(interior-tiles-055)]
 $9928 DEFB $03,$03,$03,$03,$03,$03,$03,$03 ; #HTML[#UDGARRAY1,7,4,1;$9928-$992F-8(interior-tiles-056)]
 $9930 DEFB $00,$00,$00,$00,$02,$08,$20,$80 ; #HTML[#UDGARRAY1,7,4,1;$9930-$9937-8(interior-tiles-057)]
 $9938 DEFB $00,$00,$00,$00,$40,$10,$04,$01 ; #HTML[#UDGARRAY1,7,4,1;$9938-$993F-8(interior-tiles-058)]
 $9940 DEFB $C2,$C8,$E0,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9940-$9947-8(interior-tiles-059)]
 $9948 DEFB $03,$03,$03,$03,$02,$08,$20,$80 ; #HTML[#UDGARRAY1,7,4,1;$9948-$994F-8(interior-tiles-060)]
 $9950 DEFB $C0,$C0,$C0,$C0,$40,$10,$04,$01 ; #HTML[#UDGARRAY1,7,4,1;$9950-$9957-8(interior-tiles-061)]
 $9958 DEFB $00,$00,$00,$00,$01,$03,$06,$05 ; #HTML[#UDGARRAY1,7,4,1;$9958-$995F-8(interior-tiles-062)]
 $9960 DEFB $01,$07,$1C,$73,$CF,$3F,$7F,$BC ; #HTML[#UDGARRAY1,7,4,1;$9960-$9967-8(interior-tiles-063)]
 $9968 DEFB $8F,$1C,$D0,$E0,$E0,$C0,$3C,$FF ; #HTML[#UDGARRAY1,7,4,1;$9968-$996F-8(interior-tiles-064)]
 $9970 DEFB $05,$35,$F4,$C5,$05,$05,$04,$04 ; #HTML[#UDGARRAY1,7,4,1;$9970-$9977-8(interior-tiles-065)]
 $9978 DEFB $D3,$CF,$DF,$3F,$CC,$F3,$FC,$3F ; #HTML[#UDGARRAY1,7,4,1;$9978-$997F-8(interior-tiles-066)]
 $9980 DEFB $FC,$F3,$CF,$3F,$FF,$FF,$FF,$3F ; #HTML[#UDGARRAY1,7,4,1;$9980-$9987-8(interior-tiles-067)]
 $9988 DEFB $C0,$F0,$FC,$FF,$FF,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$9988-$998F-8(interior-tiles-068)]
 $9990 DEFB $00,$00,$00,$00,$C0,$F0,$FC,$F9 ; #HTML[#UDGARRAY1,7,4,1;$9990-$9997-8(interior-tiles-069)]
 $9998 DEFB $0F,$03,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9998-$999F-8(interior-tiles-070)]
 $99A0 DEFB $CF,$F3,$FC,$3F,$0F,$03,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$99A0-$99A7-8(interior-tiles-071)]
 $99A8 DEFB $FF,$FF,$FE,$39,$D7,$EC,$EB,$28 ; #HTML[#UDGARRAY1,7,4,1;$99A8-$99AF-8(interior-tiles-072)]
 $99B0 DEFB $E7,$9D,$71,$CD,$31,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$99B0-$99B7-8(interior-tiles-073)]
 $99B8 DEFB $08,$08,$08,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$99B8-$99BF-8(interior-tiles-074)]
 $99C0 DEFB $00,$1C,$7F,$1F,$67,$59,$46,$59 ; #HTML[#UDGARRAY1,7,4,1;$99C0-$99C7-8(interior-tiles-075)]
 $99C8 DEFB $00,$00,$00,$C0,$F0,$FC,$70,$8C ; #HTML[#UDGARRAY1,7,4,1;$99C8-$99CF-8(interior-tiles-076)]
 $99D0 DEFB $56,$5E,$46,$58,$56,$5E,$46,$58 ; #HTML[#UDGARRAY1,7,4,1;$99D0-$99D7-8(interior-tiles-077)]
 $99D8 DEFB $BC,$BC,$BC,$BC,$BC,$BC,$BC,$BC ; #HTML[#UDGARRAY1,7,4,1;$99D8-$99DF-8(interior-tiles-078)]
 $99E0 DEFB $56,$5E,$66,$18,$06,$01,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$99E0-$99E7-8(interior-tiles-079)]
 $99E8 DEFB $BC,$BC,$BD,$BD,$BC,$B8,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$99E8-$99EF-8(interior-tiles-080)]
 $99F0 DEFB $18,$7E,$1F,$67,$59,$46,$5B,$5B ; #HTML[#UDGARRAY1,7,4,1;$99F0-$99F7-8(interior-tiles-081)]
 $99F8 DEFB $00,$00,$80,$E0,$F8,$7E,$9F,$66 ; #HTML[#UDGARRAY1,7,4,1;$99F8-$99FF-8(interior-tiles-082)]
 $9A00 DEFB $00,$00,$00,$00,$00,$00,$80,$00 ; #HTML[#UDGARRAY1,7,4,1;$9A00-$9A07-8(interior-tiles-083)]
 $9A08 DEFB $5B,$5B,$5B,$5B,$5B,$5B,$5B,$5B ; #HTML[#UDGARRAY1,7,4,1;$9A08-$9A0F-8(interior-tiles-084)]
 $9A10 DEFB $19,$6B,$6B,$6B,$6B,$6B,$6B,$6B ; #HTML[#UDGARRAY1,7,4,1;$9A10-$9A17-8(interior-tiles-085)]
 $9A18 DEFB $80,$80,$80,$80,$80,$80,$80,$80 ; #HTML[#UDGARRAY1,7,4,1;$9A18-$9A1F-8(interior-tiles-086)]
 $9A20 DEFB $6B,$6B,$6B,$6B,$6B,$6B,$6B,$6B ; #HTML[#UDGARRAY1,7,4,1;$9A20-$9A27-8(interior-tiles-087)]
 $9A28 DEFB $63,$1B,$07,$01,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9A28-$9A2F-8(interior-tiles-088)]
 $9A30 DEFB $6B,$6B,$6B,$8B,$6B,$1B,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$9A30-$9A37-8(interior-tiles-089)]
 $9A38 DEFB $80,$80,$80,$80,$B0,$BC,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$9A38-$9A3F-8(interior-tiles-090)]
 $9A40 DEFB $03,$03,$03,$C3,$F3,$3F,$0F,$03 ; #HTML[#UDGARRAY1,7,4,1;$9A40-$9A47-8(interior-tiles-091)]
 $9A48 DEFB $00,$00,$00,$00,$00,$00,$03,$0F ; #HTML[#UDGARRAY1,7,4,1;$9A48-$9A4F-8(interior-tiles-092)]
 $9A50 DEFB $00,$00,$03,$0F,$3F,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$9A50-$9A57-8(interior-tiles-093)]
 $9A58 DEFB $30,$FC,$FF,$FF,$FF,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$9A58-$9A5F-8(interior-tiles-094)]
 $9A60 DEFB $00,$00,$00,$C0,$F0,$FC,$FF,$FC ; #HTML[#UDGARRAY1,7,4,1;$9A60-$9A67-8(interior-tiles-095)]
 $9A68 DEFB $3F,$0F,$03,$0C,$0B,$08,$08,$08 ; #HTML[#UDGARRAY1,7,4,1;$9A68-$9A6F-8(interior-tiles-096)]
 $9A70 DEFB $FF,$FF,$FF,$FF,$3F,$CF,$33,$0C ; #HTML[#UDGARRAY1,7,4,1;$9A70-$9A77-8(interior-tiles-097)]
 $9A78 DEFB $FF,$FF,$FF,$FC,$F3,$CC,$30,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9A78-$9A7F-8(interior-tiles-098)]
 $9A80 DEFB $F0,$CC,$34,$C4,$04,$04,$04,$04 ; #HTML[#UDGARRAY1,7,4,1;$9A80-$9A87-8(interior-tiles-099)]
 $9A88 DEFB $3F,$FF,$FF,$FF,$FF,$FF,$FF,$FF ; #HTML[#UDGARRAY1,7,4,1;$9A88-$9A8F-8(interior-tiles-100)]
 $9A90 DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FC ; #HTML[#UDGARRAY1,7,4,1;$9A90-$9A97-8(interior-tiles-101)]
 $9A98 DEFB $F3,$CC,$30,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9A98-$9A9F-8(interior-tiles-102)]
 $9AA0 DEFB $00,$00,$00,$00,$00,$00,$0C,$34 ; #HTML[#UDGARRAY1,7,4,1;$9AA0-$9AA7-8(interior-tiles-103)]
 $9AA8 DEFB $CC,$B4,$C4,$84,$84,$80,$8F,$3F ; #HTML[#UDGARRAY1,7,4,1;$9AA8-$9AAF-8(interior-tiles-104)]
 $9AB0 DEFB $FF,$3F,$8F,$80,$82,$82,$82,$82 ; #HTML[#UDGARRAY1,7,4,1;$9AB0-$9AB7-8(interior-tiles-105)]
 $9AB8 DEFB $02,$02,$02,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9AB8-$9ABF-8(interior-tiles-106)]
 $9AC0 DEFB $F0,$C0,$10,$10,$10,$10,$10,$10 ; #HTML[#UDGARRAY1,7,4,1;$9AC0-$9AC7-8(interior-tiles-107)]
 $9AC8 DEFB $8F,$1C,$E0,$30,$D0,$E0,$D4,$BB ; #HTML[#UDGARRAY1,7,4,1;$9AC8-$9ACF-8(interior-tiles-108)]
 $9AD0 DEFB $7D,$DD,$BB,$FB,$F7,$CF,$FD,$3E ; #HTML[#UDGARRAY1,7,4,1;$9AD0-$9AD7-8(interior-tiles-109)]
 $9AD8 DEFB $C0,$70,$BC,$DF,$DF,$E9,$EE,$FE ; #HTML[#UDGARRAY1,7,4,1;$9AD8-$9ADF-8(interior-tiles-110)]
 $9AE0 DEFB $73,$8D,$FE,$39,$C7,$EC,$EB,$28 ; #HTML[#UDGARRAY1,7,4,1;$9AE0-$9AE7-8(interior-tiles-111)]
 $9AE8 DEFB $01,$07,$1C,$70,$CD,$3B,$7B,$BC ; #HTML[#UDGARRAY1,7,4,1;$9AE8-$9AEF-8(interior-tiles-112)]
 $9AF0 DEFB $43,$5B,$3D,$3D,$5A,$42,$5B,$5B ; #HTML[#UDGARRAY1,7,4,1;$9AF0-$9AF7-8(interior-tiles-113)]
 $9AF8 DEFB $19,$6B,$0B,$6B,$F3,$F3,$6B,$0B ; #HTML[#UDGARRAY1,7,4,1;$9AF8-$9AFF-8(interior-tiles-114)]
 $9B00 DEFB $00,$00,$00,$00,$00,$00,$C0,$B0 ; #HTML[#UDGARRAY1,7,4,1;$9B00-$9B07-8(interior-tiles-115)]
 $9B08 DEFB $CC,$B4,$8C,$84,$84,$04,$C4,$F0 ; #HTML[#UDGARRAY1,7,4,1;$9B08-$9B0F-8(interior-tiles-116)]
 $9B10 DEFB $3F,$0F,$23,$20,$21,$21,$21,$21 ; #HTML[#UDGARRAY1,7,4,1;$9B10-$9B17-8(interior-tiles-117)]
 $9B18 DEFB $FC,$F0,$C4,$04,$04,$04,$04,$04 ; #HTML[#UDGARRAY1,7,4,1;$9B18-$9B1F-8(interior-tiles-118)]
 $9B20 DEFB $01,$01,$01,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9B20-$9B27-8(interior-tiles-119)]
 $9B28 DEFB $00,$00,$03,$0F,$3F,$FC,$F3,$CC ; #HTML[#UDGARRAY1,7,4,1;$9B28-$9B2F-8(interior-tiles-120)]
 $9B30 DEFB $00,$C0,$F0,$C0,$30,$D0,$10,$D0 ; #HTML[#UDGARRAY1,7,4,1;$9B30-$9B37-8(interior-tiles-121)]
 $9B38 DEFB $03,$0C,$0E,$0E,$0E,$0E,$0E,$0E ; #HTML[#UDGARRAY1,7,4,1;$9B38-$9B3F-8(interior-tiles-122)]
 $9B40 DEFB $33,$CB,$BB,$BB,$BB,$BB,$BB,$BB ; #HTML[#UDGARRAY1,7,4,1;$9B40-$9B47-8(interior-tiles-123)]
 $9B48 DEFB $D0,$D0,$D0,$50,$50,$D0,$D0,$D0 ; #HTML[#UDGARRAY1,7,4,1;$9B48-$9B4F-8(interior-tiles-124)]
 $9B50 DEFB $0E,$0E,$0E,$0E,$0E,$0E,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$9B50-$9B57-8(interior-tiles-125)]
 $9B58 DEFB $BB,$B8,$B3,$8C,$B0,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9B58-$9B5F-8(interior-tiles-126)]
 $9B60 DEFB $30,$C0,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9B60-$9B67-8(interior-tiles-127)]
 $9B68 DEFB $70,$D8,$66,$3D,$0D,$03,$01,$00 ; #HTML[#UDGARRAY1,7,4,1;$9B68-$9B6F-8(interior-tiles-128)]
 $9B70 DEFB $00,$00,$00,$80,$40,$A0,$E0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$9B70-$9B77-8(interior-tiles-129)]
 $9B78 DEFB $F0,$60,$90,$F0,$B0,$B0,$B0,$B0 ; #HTML[#UDGARRAY1,7,4,1;$9B78-$9B7F-8(interior-tiles-130)]
 $9B80 DEFB $30,$FC,$3F,$0C,$00,$F0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9B80-$9B87-8(interior-tiles-131)]
 $9B88 DEFB $0F,$3C,$F0,$C0,$08,$08,$88,$88 ; #HTML[#UDGARRAY1,7,4,1;$9B88-$9B8F-8(interior-tiles-132)]
 $9B90 DEFB $C8,$C8,$C8,$C8,$C8,$C8,$C8,$C8 ; #HTML[#UDGARRAY1,7,4,1;$9B90-$9B97-8(interior-tiles-133)]
 $9B98 DEFB $88,$88,$88,$88,$88,$88,$88,$88 ; #HTML[#UDGARRAY1,7,4,1;$9B98-$9B9F-8(interior-tiles-134)]
 $9BA0 DEFB $88,$88,$88,$88,$83,$8F,$3F,$FC ; #HTML[#UDGARRAY1,7,4,1;$9BA0-$9BA7-8(interior-tiles-135)]
 $9BA8 DEFB $00,$00,$00,$04,$1E,$3C,$12,$2E ; #HTML[#UDGARRAY1,7,4,1;$9BA8-$9BAF-8(interior-tiles-136)]
 $9BB0 DEFB $00,$00,$00,$00,$00,$00,$30,$FC ; #HTML[#UDGARRAY1,7,4,1;$9BB0-$9BB7-8(interior-tiles-137)]
 $9BB8 DEFB $2E,$2D,$13,$EC,$30,$08,$08,$00 ; #HTML[#UDGARRAY1,7,4,1;$9BB8-$9BBF-8(interior-tiles-138)]
 $9BC0 DEFB $F0,$C0,$20,$20,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9BC0-$9BC7-8(interior-tiles-139)]
 $9BC8 DEFB $01,$07,$1F,$7F,$1F,$67,$79,$5E ; #HTML[#UDGARRAY1,7,4,1;$9BC8-$9BCF-8(interior-tiles-140)]
 $9BD0 DEFB $80,$60,$98,$E6,$98,$66,$9E,$7E ; #HTML[#UDGARRAY1,7,4,1;$9BD0-$9BD7-8(interior-tiles-141)]
 $9BD8 DEFB $5F,$5B,$57,$5F,$67,$1B,$07,$01 ; #HTML[#UDGARRAY1,7,4,1;$9BD8-$9BDF-8(interior-tiles-142)]
 $9BE0 DEFB $7E,$7A,$72,$76,$7E,$78,$60,$80 ; #HTML[#UDGARRAY1,7,4,1;$9BE0-$9BE7-8(interior-tiles-143)]
 $9BE8 DEFB $06,$1A,$6E,$7A,$5E,$76,$58,$63 ; #HTML[#UDGARRAY1,7,4,1;$9BE8-$9BEF-8(interior-tiles-144)]
 $9BF0 DEFB $C0,$C0,$C0,$C3,$CF,$FC,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9BF0-$9BF7-8(interior-tiles-145)]
 $9BF8 DEFB $C0,$B0,$8C,$E4,$9C,$C4,$34,$0C ; #HTML[#UDGARRAY1,7,4,1;$9BF8-$9BFF-8(interior-tiles-146)]
 $9C00 DEFB $F0,$C0,$30,$D0,$10,$10,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9C00-$9C07-8(interior-tiles-147)]
 $9C08 DEFB $00,$00,$03,$0F,$3F,$FF,$FF,$FC ; #HTML[#UDGARRAY1,7,4,1;$9C08-$9C0F-8(interior-tiles-148)]
 $9C10 DEFB $00,$00,$00,$C0,$F0,$C0,$20,$E0 ; #HTML[#UDGARRAY1,7,4,1;$9C10-$9C17-8(interior-tiles-149)]
 $9C18 DEFB $20,$20,$00,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9C18-$9C1F-8(interior-tiles-150)]
 $9C20 DEFB $3F,$FF,$FF,$FC,$F3,$CD,$31,$C1 ; #HTML[#UDGARRAY1,7,4,1;$9C20-$9C27-8(interior-tiles-151)]
 $9C28 DEFB $3F,$0F,$33,$2C,$23,$22,$02,$02 ; #HTML[#UDGARRAY1,7,4,1;$9C28-$9C2F-8(interior-tiles-152)]
 $9C30 DEFB $F0,$3C,$0F,$C3,$F0,$C0,$20,$E0 ; #HTML[#UDGARRAY1,7,4,1;$9C30-$9C37-8(interior-tiles-153)]
 $9C38 DEFB $00,$00,$00,$0C,$3F,$FC,$F3,$CD ; #HTML[#UDGARRAY1,7,4,1;$9C38-$9C3F-8(interior-tiles-154)]
 $9C40 DEFB $31,$CD,$B5,$B1,$8D,$B5,$B1,$8D ; #HTML[#UDGARRAY1,7,4,1;$9C40-$9C47-8(interior-tiles-155)]
 $9C48 DEFB $B5,$BD,$B3,$8C,$B0,$C0,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9C48-$9C4F-8(interior-tiles-156)]
 $9C50 DEFB $0E,$2E,$EE,$CE,$0E,$0E,$02,$00 ; #HTML[#UDGARRAY1,7,4,1;$9C50-$9C57-8(interior-tiles-157)]
 $9C58 DEFB $5E,$52,$5E,$5E,$46,$58,$5E,$52 ; #HTML[#UDGARRAY1,7,4,1;$9C58-$9C5F-8(interior-tiles-158)]
 $9C60 DEFB $5E,$56,$5E,$46,$58,$5E,$52,$5E ; #HTML[#UDGARRAY1,7,4,1;$9C60-$9C67-8(interior-tiles-159)]
 $9C68 DEFB $00,$00,$00,$C0,$F0,$FC,$FF,$F3 ; #HTML[#UDGARRAY1,7,4,1;$9C68-$9C6F-8(interior-tiles-160)]
 $9C70 DEFB $FF,$FF,$FC,$F3,$CF,$3F,$CF,$F3 ; #HTML[#UDGARRAY1,7,4,1;$9C70-$9C77-8(interior-tiles-161)]
 $9C78 DEFB $CC,$3F,$FF,$FF,$FF,$FF,$FC,$F3 ; #HTML[#UDGARRAY1,7,4,1;$9C78-$9C7F-8(interior-tiles-162)]
 $9C80 DEFB $F0,$3C,$CF,$F3,$CF,$3C,$F3,$CB ; #HTML[#UDGARRAY1,7,4,1;$9C80-$9C87-8(interior-tiles-163)]
 $9C88 DEFB $3C,$4F,$73,$7C,$7F,$3E,$0E,$02 ; #HTML[#UDGARRAY1,7,4,1;$9C88-$9C8F-8(interior-tiles-164)]
 $9C90 DEFB $CF,$3C,$F3,$CF,$3F,$DF,$DC,$D0 ; #HTML[#UDGARRAY1,7,4,1;$9C90-$9C97-8(interior-tiles-165)]
 $9C98 DEFB $3B,$FB,$FB,$F3,$C3,$03,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9C98-$9C9F-8(interior-tiles-166)]
 $9CA0 DEFB $00,$00,$00,$C0,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9CA0-$9CA7-8(interior-tiles-167)]
 $9CA8 DEFB $C0,$F0,$3C,$4F,$43,$60,$1A,$C6 ; #HTML[#UDGARRAY1,7,4,1;$9CA8-$9CAF-8(interior-tiles-168)]
 $9CB0 DEFB $00,$00,$03,$01,$39,$11,$19,$15 ; #HTML[#UDGARRAY1,7,4,1;$9CB0-$9CB7-8(interior-tiles-169)]
 $9CB8 DEFB $00,$00,$80,$00,$80,$40,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9CB8-$9CBF-8(interior-tiles-170)]
 $9CC0 DEFB $10,$10,$01,$07,$1F,$27,$39,$3E ; #HTML[#UDGARRAY1,7,4,1;$9CC0-$9CC7-8(interior-tiles-171)]
 $9CC8 DEFB $18,$6E,$EF,$EF,$EF,$96,$F9,$67 ; #HTML[#UDGARRAY1,7,4,1;$9CC8-$9CCF-8(interior-tiles-172)]
 $9CD0 DEFB $00,$00,$80,$E0,$90,$70,$F0,$F0 ; #HTML[#UDGARRAY1,7,4,1;$9CD0-$9CD7-8(interior-tiles-173)]
 $9CD8 DEFB $3F,$3F,$1F,$07,$01,$02,$1B,$06 ; #HTML[#UDGARRAY1,7,4,1;$9CD8-$9CDF-8(interior-tiles-174)]
 $9CE0 DEFB $9F,$FF,$BF,$BE,$B8,$60,$00,$03 ; #HTML[#UDGARRAY1,7,4,1;$9CE0-$9CE7-8(interior-tiles-175)]
 $9CE8 DEFB $F0,$E0,$80,$03,$0F,$3C,$F0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9CE8-$9CEF-8(interior-tiles-176)]
 $9CF0 DEFB $0C,$3C,$F4,$E8,$68,$88,$88,$94 ; #HTML[#UDGARRAY1,7,4,1;$9CF0-$9CF7-8(interior-tiles-177)]
 $9CF8 DEFB $00,$00,$00,$03,$0F,$3E,$36,$28 ; #HTML[#UDGARRAY1,7,4,1;$9CF8-$9CFF-8(interior-tiles-178)]
 $9D00 DEFB $28,$09,$08,$14,$04,$08,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9D00-$9D07-8(interior-tiles-179)]
 $9D08 DEFB $84,$48,$40,$80,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9D08-$9D0F-8(interior-tiles-180)]
 $9D10 DEFB $C0,$60,$80,$00,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9D10-$9D17-8(interior-tiles-181)]
 $9D18 DEFB $00,$00,$00,$03,$0F,$3C,$FC,$CB ; #HTML[#UDGARRAY1,7,4,1;$9D18-$9D1F-8(interior-tiles-182)]
 $9D20 DEFB $88,$60,$19,$06,$00,$00,$00,$00 ; #HTML[#UDGARRAY1,7,4,1;$9D20-$9D27-8(interior-tiles-183)]
 $9D28 DEFB $FF,$FF,$FF,$FE,$FD,$FB,$FB,$F9 ; #HTML[#UDGARRAY1,7,4,1;$9D28-$9D2F-8(interior-tiles-184)]
 $9D30 DEFB $FF,$FF,$FF,$1C,$E3,$EC,$80,$E0 ; #HTML[#UDGARRAY1,7,4,1;$9D30-$9D37-8(interior-tiles-185)]
 $9D38 DEFB $F2,$C8,$37,$8F,$6F,$7D,$3D,$1B ; #HTML[#UDGARRAY1,7,4,1;$9D38-$9D3F-8(interior-tiles-186)]
 $9D40 DEFB $00,$F0,$F8,$E8,$E8,$D8,$D3,$CF ; #HTML[#UDGARRAY1,7,4,1;$9D40-$9D47-8(interior-tiles-187)]
 $9D48 DEFB $27,$78,$7F,$5F,$0F,$F0,$FF,$FC ; #HTML[#UDGARRAY1,7,4,1;$9D48-$9D4F-8(interior-tiles-188)]
 $9D50 DEFB $2F,$EF,$EF,$DC,$33,$CD,$31,$C1 ; #HTML[#UDGARRAY1,7,4,1;$9D50-$9D57-8(interior-tiles-189)]
 $9D58 DEFB $00,$00,$00,$C0,$F1,$FB,$FB,$F9 ; #HTML[#UDGARRAY1,7,4,1;$9D58-$9D5F-8(interior-tiles-190)]
 $9D60 DEFB $00,$00,$00,$00,$E0,$E0,$80,$E0 ; #HTML[#UDGARRAY1,7,4,1;$9D60-$9D67-8(interior-tiles-191)]
 $9D68 DEFB $00,$F0,$F8,$E8,$E8,$D8,$D0,$C0 ; #HTML[#UDGARRAY1,7,4,1;$9D68-$9D6F-8(interior-tiles-192)]
 $9D70 DEFB $20,$EC,$EF,$DF,$33,$CD,$31,$C1 ; #HTML[#UDGARRAY1,7,4,1;$9D70-$9D77-8(interior-tiles-193)]

; Main loop setup.
;
; Used by the routine at #R$F163.
; .
; There seems to be litle point in this: enter_room terminates with 'goto
; main_loop' so it never returns. In fact, the single calling routine (main)
; might just as well goto enter_room instead of goto main_loop_setup.
@label=main_loop_setup
c$9D78 CALL $68F4    ; enter_room(); // returns by goto main_loop

; Main game loop.
;
; Used by the routine at #R$691A.
@label=main_loop
c$9D7B CALL $9DCF    ; main_loop: for (;;) <% check_morale();
 $9D7E CALL $9DE5    ;   keyscan_break();
 $9D81 CALL $7D48    ;   message_display();
 $9D84 CALL $9E07    ;   process_player_input();
 $9D87 CALL $9F21    ;   in_permitted_area();
 $9D8A CALL $BB98    ;   restore_tiles();
 $9D8D CALL $C6A0    ;   move_characters();
 $9D90 CALL $C892    ;   follow_suspicious_character();
 $9D93 CALL $C47E    ;   purge_invisible_characters();
 $9D96 CALL $C41C    ;   spawn_characters();
 $9D99 CALL $DB9E    ;   mark_nearby_items();
 $9D9C CALL $A09E    ;   ring_bell();
 $9D9F CALL $B5CE    ;   called_from_main_loop_9();
 $9DA2 CALL $AAB2    ;   move_map();
 $9DA5 CALL $7D48    ;   message_display();
 $9DA8 CALL $A09E    ;   ring_bell();
 $9DAB CALL $B866    ;   plot_sprites();
 $9DAE CALL $EED3    ;   plot_game_window();
 $9DB1 CALL $A09E    ;   ring_bell();
 $9DB4 LD A,($A146)  ; {  if (day_or_night != 0) nighttime();
 $9DB7 AND A         ;
 $9DB8 CALL NZ,$ADBD ; }
 $9DBB LD A,($68A0)  ; {  if (room_index != 0) interior_delay_loop();
 $9DBE AND A         ;
 $9DBF CALL NZ,$A095 ; }
 $9DC2 CALL $A035    ;   wave_morale_flag();
 $9DC5 LD A,($A12F)  ; {  if ((game_counter & 63) == 0)
 $9DC8 AND $3F       ; dispatch_timed_event();
 $9DCA CALL Z,$A1A0  ; }
 $9DCD JR $9D7B      ; %>

; Check morale level, report if (near) zero and inhibit player control.
;
; Used by the routine at #R$9D7B.
@label=check_morale
c$9DCF LD A,($A13C)  ; {if (morale >= 2) return;
 $9DD2 CP $02        ;
 $9DD4 RET NC        ; }
 $9DD5 LD BC,$0F00   ; {queue_message_for_display(message_MORALE_IS_ZERO);
 $9DD8 CALL $7D15    ; }
; Inhibit user input.
 $9DDB LD A,$FF      ; {morale_exhausted = 0xFF;
 $9DDD LD ($A13B),A  ; }
; Immediately take automatic control of hero.
 $9DE0 XOR A         ; {automatic_player_counter = 0;
 $9DE1 LD ($A139),A  ; }
 $9DE4 RET           ; return;

; Check for BREAK keypress.
;
; Used by the routine at #R$9D7B.
; .
; If pressed then clear the screen and confirm with the player that they want
; to reset the game. Reset if requested.
@label=keyscan_break
c$9DE5 LD BC,$FEFE   ; {if (!(shift_pressed && space_pressed)) return;
 $9DE8 IN A,(C)      ;
 $9DEA AND $01       ;
 $9DEC RET NZ        ;
 $9DED LD B,$7F      ;
 $9DEF IN A,(C)      ;
 $9DF1 AND $01       ;
 $9DF3 RET NZ        ; }
 $9DF4 CALL $A50B    ; screen_reset();
 $9DF7 CALL $EFFC    ; user_confirm();
 $9DFA JP Z,$B75A    ; if (Z) reset_game();
 $9DFD LD A,($68A0)  ; {if (room_index == 0) <% reset_outdoors(); return; %> // exit via
 $9E00 AND A         ;
 $9E01 JP Z,$B2FC    ; }
 $9E04 JP $68F4      ; else enter_room(); // doesn't return (jumps to main_loop)

; Process player input.
;
; Used by the routine at #R$9D7B.
;
; .
;
@label=process_player_input
; Morale exhausted? If so then don't allow input.
; .
; Note the combined read of in_solitary and morale_exhausted as a word.
c$9E07 LD HL,($A13A) ; {if (in_solitary || morale_exhausted) return;
 $9E0A XOR A         ;
 $9E0B OR H          ;
 $9E0C OR L          ;
 $9E0D RET NZ        ; }
 $9E0E LD A,($8001)  ; {if ($8001 & (vischar_FLAGS_PICKING_LOCK | vischar_FLAGS_CUTTING_WIRE)) <%
 $9E11 AND $03       ;
 $9E13 JR Z,$9E22    ; }
; Hero is picking a lock, or cutting through a wire fence.
; .
; Postpone automatic control for 31 turns.
 $9E15 LD HL,$A139   ; {  automatic_player_counter = 31;
 $9E18 LD (HL),$1F   ; }
 $9E1A CP $01        ; {  if ($8001 == vischar_FLAGS_PICKING_LOCK) goto picking_lock; // exit via
 $9E1C JP Z,$9E98    ; }
 $9E1F JP $9EB2      ;   else goto cutting_wire; %> // exit via
*$9E22 CALL $F075    ; A = input_routine(); // lives at same address as static_tiles_plot_direction
 $9E25 LD HL,$A139   ; {- // subsumed into following code
 $9E28 CP $00        ; }
 $9E2A JP NZ,$9E34   ; if (A == input_NONE) <%
; No input.
 $9E2D LD A,(HL)     ; {  if (automatic_player_counter == 0) return;
 $9E2E AND A         ;
 $9E2F RET Z         ; }
; No user input: count down.
 $9E30 DEC (HL)      ;   automatic_player_counter--;
 $9E31 XOR A         ;   A = 0; %>
 $9E32 JR $9E8F      ; else <%
; Input received.
; .
; Postpone automatic control for 31 turns.
*$9E34 LD (HL),$1F   ;   automatic_player_counter = 31;
 $9E36 PUSH AF       ;   ... (push af) ...
 $9E37 LD A,($A13F)  ; {  if (hero_in_bed == 0) <%
 $9E3A AND A         ;
 $9E3B JR NZ,$9E5C   ; }
 $9E3D LD A,($A137)  ; {    if (!hero_in_breakfast) goto not_bed_or_breakfast;
 $9E40 AND A         ;
 $9E41 JR Z,$9E85    ; }
; Hero was at breakfast.
 $9E43 LD HL,$002B   ; {    (word) $8002 = 0x002B; // set target location?
 $9E46 LD ($8002),HL ; }
 $9E49 LD HL,$800F   ; {    (word) $800F = 0x0034; // set X pos
 $9E4C LD (HL),$34   ; }
 $9E4E INC L         ; {    (word) $8011 = 0x003E; // set Y pos
 $9E4F INC L         ;
 $9E50 LD (HL),$3E   ; }
 $9E52 LD HL,$6F58   ; {    roomdef_25_breakfast.bench_G = interiorobject_EMPTY_BENCH;
 $9E55 LD (HL),$0D   ; }
 $9E57 LD HL,$A137   ;     HL = &hero_in_breakfast; %>
 $9E5A JR $9E7D      ;   else <%
; Hero was in bed.
*$9E5C LD HL,$012C   ; {    (word) $8002 = 0x012C; // set target location?
 $9E5F LD ($8002),HL ; }
 $9E62 LD HL,$2E2E   ; {    (word) $8004 = 0x2E2E; // another position?
@nowarn
 $9E65 LD ($8004),HL ; }
 $9E68 LD H,$00      ; {    (word) $800F = 0x002E; // set X pos
 $9E6A LD ($800F),HL ; }
 $9E6D LD ($8011),HL ;     (word) $8011 = 0x002E; // set Y pos
 $9E70 LD A,$18      ; {    $8013 = 24; // set height
 $9E72 LD ($8013),A  ; }
 $9E75 LD HL,$6C61   ; {    roomdef_2_hut2_left.bed = interiorobject_EMPTY_BED;
 $9E78 LD (HL),$09   ;}
 $9E7A LD HL,$A13F   ;     HL = &hero_in_bed; %>
*$9E7D LD (HL),$00   ;   *HL = 0;
 $9E7F CALL $6A35    ;   setup_room();
 $9E82 CALL $6B42    ;   plot_interior_tiles();
*$9E85 POP AF        ; not_bed_or_breakfast: // ... (pop af -- restores user input value stored at $9E36)
 $9E86 CP $09        ; {  if (A >= input_FIRE) <%
 $9E88 JR C,$9E8F    ; }
 $9E8A CALL $7AC9    ;     process_player_input_fire();
 $9E8D LD A,$80      ;     A = input_KICK; %> %>
; If input state has changed then kick a sprite update.
@nowarn
*$9E8F LD HL,$800D   ; {if ($800D == A) return; // tunnel related?
 $9E92 CP (HL)       ;
 $9E93 RET Z         ; }
 $9E94 OR $80        ; {$800D = A | input_KICK;
 $9E96 LD (HL),A     ; }
 $9E97 RET           ; return;

; Locks the player out until the lock is picked.
;
; Used by the routine at #R$9E07.
@label=picking_lock
c$9E98 LD HL,$A12F   ; {if (player_locked_out_until != game_counter) return;
 $9E9B LD A,($A145)  ;
 $9E9E CP (HL)       ;
 $9E9F RET NZ        ; }
; Countdown reached: Unlock the door.
 $9EA0 LD HL,($A143) ; {*ptr_to_door_being_lockpicked &= ~door_LOCKED;
 $9EA3 RES 7,(HL)    ; }
 $9EA5 LD B,$06      ; {queue_message_for_display(message_IT_IS_OPEN);
 $9EA7 CALL $7D15    ; }
; This entry point is used by the routine at #R$9EB2.
@label=clear_lockpick_wirecut_flags_and_return
*$9EAA LD HL,$8001   ; {clear_lockpick_wirecut_flags_and_return: $8001 &= ~(vischar_FLAGS_PICKING_LOCK | vischar_FLAGS_CUTTING_WIRE);
 $9EAD LD A,(HL)     ;
 $9EAE AND $FC       ;
 $9EB0 LD (HL),A     ; }
 $9EB1 RET           ; return;

; Locks the player out until the wire is snipped.
;
; Used by the routine at #R$9E07.
@label=cutting_wire
c$9EB2 LD HL,$A12F   ; {A = player_locked_out_until - game_counter;
 $9EB5 LD A,($A145)  ;
 $9EB8 SUB (HL)      ; }
 $9EB9 JR Z,$9ED0    ; if (A) <%
 $9EBB CP $04        ; {  if (A < 4)
 $9EBD RET NC        ; }
@nowarn
 $9EBE LD A,($800E)  ; {$800D = cutting_wire_new_inputs[$800E & vischar_DIRECTION_MASK]; // change direction
@nowarn
 $9EC1 LD HL,$9EE0   ;
 $9EC4 AND $03       ;
 $9EC6 ADD A,L       ;
 $9EC7 LD L,A        ;
 $9EC8 JR NC,$9ECB   ;
 $9ECA INC H         ;
*$9ECB LD A,(HL)     ;
@nowarn
 $9ECC LD ($800D),A  ; }
 $9ECF RET           ;   return; %>
; Countdown reached zero: Snip the wire.
; .
; Bug: A is always zero here, so $800E is always set to zero.
@nowarn
*$9ED0 LD HL,$800E   ; {else <% $800E = A & vischar_DIRECTION_MASK; // set direction
; LD A,(HL) missing here?
 $9ED3 AND $03       ;
 $9ED5 LD (HL),A     ; }
 $9ED6 DEC L         ; {  $800D = input_KICK;
 $9ED7 LD (HL),$80   ; }
 $9ED9 LD A,$18      ; {  $8013 = 24; // set height
 $9EDB LD ($8013),A  ; }
 $9EDE JR $9EAA      ;   goto clear_lockpick_wirecut_flags_and_return; %>
; New inputs table.
@label=cutting_wire_new_inputs
 $9EE0 DEFB $84      ; input_UP   + input_LEFT  + input_KICK
 $9EE1 DEFB $87      ; input_UP   + input_RIGHT + input_KICK
 $9EE2 DEFB $88      ; input_DOWN + input_RIGHT + input_KICK
 $9EE3 DEFB $85      ; input_DOWN + input_LEFT  + input_KICK

; Maps bytes to pointers in $9EF9.
@label=byte_to_pointer
b$9EE4 DEFB $2A,$F9,$9E                 ; byte_to_offset { 42, &byte_9EF9[0] }
 $9EE7 DEFB $05,$FC,$9E                 ; byte_to_offset {  5, &byte_9EFC[0] }
 $9EEA DEFB $0E,$01,$9F                 ; byte_to_offset { 14, &byte_9F01[0] }
 $9EED DEFB $10,$08,$9F                 ; byte_to_offset { 16, &byte_9F08[0] }
 $9EF0 DEFB $2C,$0E,$9F                 ; byte_to_offset { 44, &byte_9F0E[0] }
 $9EF3 DEFB $2B,$11,$9F                 ; byte_to_offset { 43, &byte_9F11[0] }
 $9EF6 DEFB $2D,$13,$9F                 ; byte_to_offset { 45, &byte_9F13[0] }
; Variable-length arrays, 0xFF terminated.
 $9EF9 DEFB $82,$82,$FF                 ; byte_9EF9 = { 0x82,0x82,0xFF }
 $9EFC DEFB $83,$01,$01,$01,$FF         ; byte_9EFC = { 0x83,0x01,0x01,0x01,0xFF }
 $9F01 DEFB $01,$01,$01,$00,$02,$02,$FF ; byte_9F01 = { 0x01,0x01,0x01,0x00,0x02,0x02,0xFF }
 $9F08 DEFB $01,$01,$95,$97,$99,$FF     ; byte_9F08 = { 0x01,0x01,0x95,0x97,0x99,0xFF }
 $9F0E DEFB $83,$82,$FF                 ; byte_9F0E = { 0x83,0x82,0xFF }
 $9F11 DEFB $99,$FF                     ; byte_9F11 = { 0x99,0xFF }
 $9F13 DEFB $01,$FF                     ; byte_9F13 = { 0x01,0xFF }

; Boundings of the three main exterior areas.
@label=permitted_bounds
b$9F15 DEFB $56,$5E,$3D,$48 ; Corridor to yard.
 $9F19 DEFB $4E,$84,$47,$74 ; Hut area.
 $9F1D DEFB $4F,$69,$2F,$3F ; Yard area.

; In permitted area.
;
; Used by the routine at #R$9D7B.
@label=in_permitted_area
c$9F21 LD HL,$800F   ; HL = $800F; // position on X axis
 $9F24 LD DE,$81B8   ; DE = &hero_map_position.x;
 $9F27 LD A,($68A0)  ; {if (room_index == 0) <% // outdoors
 $9F2A AND A         ;
 $9F2B JP NZ,$9F49   ; }
; Outdoors.
 $9F2E CALL $E542    ;   pos_to_tinypos(HL,DE);
 $9F31 LD HL,($8018) ; {  if (($8018) >= 0x06C8 || ($801A) >= 0x0448) goto escaped; %>
 $9F34 LD DE,$06C8   ;
 $9F37 SBC HL,DE     ;
 $9F39 JP NC,$A51C   ;
 $9F3C LD HL,($801A) ;
 $9F3F LD DE,$0448   ;
 $9F42 SBC HL,DE     ;
 $9F44 JP NC,$A51C   ; }
 $9F47 JR $9F51      ; else <%
; Indoors.
*$9F49 LDI           ;   *DE++ = *HL++;
 $9F4B INC L         ;   HL++;
 $9F4C LDI           ;   *DE++ = *HL++;
 $9F4E INC L         ;   HL++;
 $9F4F LDI           ;   *DE++ = *HL++; %>
; Red flag if picking a lock, or cutting wire.
*$9F51 LD A,($8001)  ; {A = ($8001) & (vischar_FLAGS_PICKING_LOCK | vischar_FLAGS_CUTTING_WIRE);}
 $9F54 AND $03       ;
 $9F56 JP NZ,$9FF8   ; if (A) goto set_flag_red;
; At night, home room is the only safe place.
 $9F59 LD A,($A13D)  ; {if (clock >= 100) <% // night time
 $9F5C CP $64        ;
 $9F5E JR C,$9F6B    ; }
 $9F60 LD A,($68A0)  ; {  if (room_index == room_2_HUT2LEFT) goto set_flag_green; else goto set_flag_red; %>
 $9F63 CP $02        ;
 $9F65 JP Z,$9FDE    ;
 $9F68 JP $9FF8      ; }
*$9F6B LD A,($A13A)  ; {if (in_solitary) goto set_flag_green;
 $9F6E AND A         ;
 $9F6F JP NZ,$9FDE   ; }
 $9F72 LD HL,$8002   ; HL = $8002; // target location
 $9F75 LD A,(HL)     ; {A = *HL++;
 $9F76 INC L         ; }
 $9F77 LD C,(HL)     ; C = *HL;
 $9F78 BIT 7,A       ; {if (A & vischar_BYTE2_BIT7) C++;
 $9F7A JR Z,$9F7D    ;
 $9F7C INC C         ; }
*$9F7D CP $FF        ; {if (A == 0xFF) <%
 $9F7F JR NZ,$9F93   ; }
 $9F81 LD A,(HL)     ; {  A = *HL & 0xF8;
 $9F82 AND $F8       ; }
 $9F84 CP $08        ; {  if (A == 8) A = 1; else A = 2;
 $9F86 LD A,$01      ;
 $9F88 JR Z,$9F8C    ;
 $9F8A LD A,$02      ; }
*$9F8C CALL $A007    ;   in_permitted_area_end_bit();
 $9F8F JR Z,$9FDE    ; {  if (Z) goto set_flag_green; else goto set_flag_red;
 $9F91 JR $9FF8      ; %>}
*$9F93 AND $7F       ; else <% A &= 0x7F;
 $9F95 LD HL,$9EE4   ;   HL = &byte_to_pointer[0]; // table mapping bytes to offsets
 $9F98 LD B,$07      ;   B = 7; // 7 iterations
*$9F9A CP (HL)       ; {  do <% if (A == *HL++) goto found;
 $9F9B INC HL        ;
 $9F9C JR Z,$9FA4    ; }
 $9F9E INC HL        ; {    HL += 2;
 $9F9F INC HL        ; }
 $9FA0 DJNZ $9F9A    ;   %> while (--B);
 $9FA2 JR $9FDE      ;   goto set_flag_green; %>
*$9FA4 LD E,(HL)     ; {found: E = *HL++; // fetch offset
 $9FA5 INC HL        ; }
 $9FA6 LD D,(HL)     ; D = *HL;
 $9FA7 PUSH DE
 $9FA8 POP HL        ; // HL = DE;
 $9FA9 LD B,$00      ; B = 0;
 $9FAB ADD HL,BC     ; HL += BC;
 $9FAC LD A,(HL)     ; A = *HL;
 $9FAD PUSH DE
 $9FAE CALL $A007    ; in_permitted_area_end_bit();
 $9FB1 POP HL
 $9FB2 JR Z,$9FDE    ; JR Z,set_flag_green;
 $9FB4 LD A,($8002)  ; A = $8002;
 $9FB7 BIT 7,A       ; {if (A & vischar_BYTE2_BIT7) HL++;
 $9FB9 JR Z,$9FBC    ;
 $9FBB INC HL        ; }
*$9FBC LD BC,$0000   ; BC = 0; // counter?
*$9FBF PUSH BC       ; for (;;) <%
 $9FC0 PUSH HL
 $9FC1 ADD HL,BC     ;   HL += BC;
 $9FC2 LD A,(HL)     ;   A = *HL;
 $9FC3 CP $FF        ; {  if (A == 255) goto pop_and_set_flag_red; // hit end
 $9FC5 JR Z,$9FDA    ; of list}
 $9FC7 CALL $A007    ;   in_permitted_area_end_bit();
 $9FCA POP HL
 $9FCB POP BC
 $9FCC JR Z,$9FD1    ;   if (Z) goto set_target_then_set_flag_green; // if (Z) break; equivalent?
 $9FCE INC C         ;   BC++;
 $9FCF JR $9FBF      ; %>
*$9FD1 LD A,($8002)  ; {set_target_then_set_flag_green: B = $8002;
 $9FD4 LD B,A        ; }
 $9FD5 CALL $A33F    ; set_hero_target_location(); // uses B, C
 $9FD8 JR $9FDE      ; goto set_flag_green;
*$9FDA POP BC        ; pop_and_set_flag_red:
 $9FDB POP HL
 $9FDC JR $9FF8      ; goto set_flag_red;
; Green flag code path.
*$9FDE XOR A         ; set_flag_green: A = 0; // red_flag = 0
 $9FDF LD C,$44      ; C = attribute_BRIGHT_GREEN_OVER_BLACK;
*$9FE1 LD ($A138),A  ; flag_select: red_flag = A;
 $9FE4 LD A,C        ; A = C;
 $9FE5 LD HL,$5842   ; HL = $5842; // first morale flag attribute byte
 $9FE8 CP (HL)       ; {if (A == *HL) return; // flag already correct colour
 $9FE9 RET Z         ; }
 $9FEA CP $44        ; {if (A == attribute_BRIGHT_GREEN_OVER_BLACK) <%
 $9FEC JP NZ,$A071   ; }
 $9FEF LD A,$FF      ; {  bell = bell_STOP; // silence bell
 $9FF1 LD ($A130),A  ; }
 $9FF4 LD A,C        ;   A = C; %>
 $9FF5 JP $A071      ; goto set_morale_flag_screen_attributes; // exit via
; Red flag code path.
*$9FF8 LD C,$42      ; set_flag_red: C = attribute_BRIGHT_RED_OVER_BLACK;
 $9FFA LD A,($5842)  ; A = ($5842); // first morale flag attribute byte
 $9FFD CP C          ; {if (A == C) return; // flag already red
 $9FFE RET Z         ; }
 $9FFF XOR A         ; {($800D) = 0; // "tunnel related" thing
@nowarn
 $A000 LD ($800D),A  ; }
 $A003 LD A,$FF      ; A = 255; // red_flag
 $A005 JR $9FE1      ; goto flag_select;

; In permitted area (end bit).
;
; Used by the routine at #R$9F21.
;
; I:A Room index + flag in bit 7.
@label=in_permitted_area_end_bit
c$A007 LD HL,$68A0   ; HL = &room_index;
 $A00A BIT 7,A       ; {if (A & (1<<7)) return *HL == A & 0x7F; // return with flags
 $A00C JR Z,$A012    ;
 $A00E AND $7F       ;
 $A010 CP (HL)       ;
 $A011 RET           ; }
*$A012 EX AF,AF'     ; {if (*HL) return; // return with flags NZ
 $A013 LD A,(HL)     ;
 $A014 AND A         ;
 $A015 RET NZ        ; }
 $A016 LD DE,$81B8   ; DE = &hero_map_position.x;
 $A019 EX AF,AF'
; FALL THROUGH to within_camp_bounds.

; Is the specified position within the bounds of the indexed area?
;
; Used by the routine at #R$CB98.
;
; I:A Index (0..2) into permitted_bounds[] table.
; I:HL Pointer to position.
@label=within_camp_bounds
c$A01A ADD A,A       ; {HL = &permitted_bounds[A * 4];
 $A01B ADD A,A       ;
 $A01C LD C,A        ;
 $A01D LD B,$00      ;
 $A01F LD HL,$9F15   ;
 $A022 ADD HL,BC     ; }
 $A023 LD B,$02      ; B = 2;
*$A025 LD A,(DE)     ; do <% A = *DE++;
 $A026 CP (HL)       ; {  if (A < HL[0]) return; // return with flags NZ
 $A027 RET C         ; }
 $A028 INC HL        ; {  if (A >= HL[1]) <% A |= 1; return; %> // return with flags NZ
 $A029 CP (HL)       ;
 $A02A JR C,$A02F    ;
 $A02C OR $01        ;
 $A02E RET           ;
*$A02F INC DE        ; }
 $A030 INC HL        ;   HL += 2;
 $A031 DJNZ $A025    ; %> while (--B);
 $A033 AND B         ; A &= B;
 $A034 RET           ; return; // return with flags Z

; Wave the morale flag.
;
; Used by the routines at #R$9D7B and #R$F4B7.
@label=wave_morale_flag
c$A035 LD HL,$A12F   ; HL = &game_counter;
 $A038 INC (HL)      ; (*HL)++;
; Wave the flag on every other turn.
 $A039 LD A,(HL)     ; {if (*HL & 1) return;
 $A03A AND $01       ;
 $A03C RET NZ        ; }
 $A03D PUSH HL
 $A03E LD A,($A13C)  ; A = morale;
 $A041 LD HL,$A140   ; HL = &displayed_morale;
 $A044 CP (HL)       ; {if (A != *HL) <%
 $A045 JR Z,$A05D    ; }
 $A047 JP NC,$A053   ;   if (A < *HL) <%
; Decreasing morale.
 $A04A DEC (HL)      ;     (*HL)--;
 $A04B LD HL,($A141) ;     HL = moraleflag_screen_address;
 $A04E CALL $7CE9    ;     get_next_scanline(); %>
 $A051 JR $A05A      ;   else <%
; Increasing morale.
*$A053 INC (HL)      ;     (*HL)++;
 $A054 LD HL,($A141) ;     HL = moraleflag_screen_address;
 $A057 CALL $A082    ;     get_prev_scanline(); %>
*$A05A LD ($A141),HL ;   moraleflag_screen_address = HL; %>
*$A05D LD DE,$DA6B   ; DE = bitmap_flag_down;
 $A060 POP HL
 $A061 BIT 1,(HL)    ; {if (*HL & 2) DE = bitmap_flag_up;
 $A063 JR Z,$A068    ;
 $A065 LD DE,$DA29   ; }
*$A068 LD HL,($A141) ; {HL = moraleflag_screen_address;
 $A06B LD BC,$0319   ; }
 $A06E JP $7CBE      ; plot_bitmap(0x0319); return; // dimensions: 24 x 25 // args-BC // exit via

; Set the screen attributes of the morale flag.
;
; Used by the routines at #R$9F21 and #R$F163.
;
; I:A Screen attributes to use.
@label=set_morale_flag_screen_attributes
c$A071 LD HL,$5842   ; HL = $5842; // first attribute byte
 $A074 LD DE,$001E   ; DE = $001E; // skip
 $A077 LD B,$13      ; B  = $13; // height of flag
*$A079 LD (HL),A     ; {do <% *HL++ = A;
 $A07A INC L         ; }
 $A07B LD (HL),A     ; {  *HL = A;
 $A07C INC L         ;
 $A07D LD (HL),A     ; }
 $A07E ADD HL,DE     ;   HL += DE;
 $A07F DJNZ $A079    ; %> while (--B);
 $A081 RET           ; return;

; Given a screen address, returns the same position on the previous scanline.
;
; Used by the routine at #R$A035.
;
; I:HL Original screen address.
; O:HL Updated screen address.
@label=get_prev_scanline
c$A082 LD A,H        ; {if ((H & 7) != 0) <%
 $A083 AND $07       ;
 $A085 JR Z,$A089    ; }
; NNN bits.
; .
; Step back one scanline.
 $A087 DEC H         ;   HL -= 256; %>
 $A088 RET           ; else <%
; Complicated.
*$A089 LD DE,$06E0   ; {  if (L < 32) HL -= 32; else HL += 0x06E0; %>
 $A08C LD A,L        ;
 $A08D CP $20        ;
 $A08F JR NC,$A093   ;
 $A091 LD D,$FF      ;
*$A093 ADD HL,DE     ; }
 $A094 RET           ; return;

; Delay loop called only when the hero is indoors.
;
; Used by the routine at #R$9D7B.
@label=interior_delay_loop
c$A095 LD BC,$0FFF   ; BC = 0xFFF;
*$A098 DEC BC        ; {while (--BC) ;
 $A099 LD A,C        ;
 $A09A OR B          ;
 $A09B JR NZ,$A098   ; }
 $A09D RET           ; return;

; Ring the alarm bell.
;
; Used by the routine at #R$9D7B.
; .
; Called three times from main_loop.
@label=ring_bell
c$A09E LD HL,$A130   ; HL = &bell;
 $A0A1 LD A,(HL)     ; A = *HL;
 $A0A2 CP $FF        ; {if (A == bell_STOP) return; // not ringing
 $A0A4 RET Z         ; }
 $A0A5 AND A         ; {if (A != bell_RING_PERPETUAL) <%
 $A0A6 JR Z,$A0B0    ; }
; Decrement the ring counter.
 $A0A8 DEC A         ; {  *HL = --A;
 $A0A9 LD (HL),A     ; }
 $A0AA JR NZ,$A0B0   ;   if (A == 0) <%
; Counter hit zero - stop ringing.
 $A0AC LD A,$FF      ; {    *HL = bell_STOP;
 $A0AE LD (HL),A     ; }
 $A0AF RET           ;     return; %> %>
; Fetch visible state of bell.
*$A0B0 LD A,($518E)  ; A = screenaddr_bell_ringer;
 $A0B3 CP $3F        ; {if (A != 63) <%
 $A0B5 JP Z,$A0C6    ; }
@rfix-begin
; Bug: Pointless jump to adjacent instruction.
 $A0B8 JP $A0BB
@rfix-end
; Plot ringer "on".
*$A0BB LD DE,$A153   ;   DE = bell_ringer_bitmap_on;
 $A0BE CALL $A0C9    ;   plot_ringer();
 $A0C1 LD BC,$2530   ; {  play_speaker(sound_BELL_RINGER); return; %> // args=BC // exit via
 $A0C4 JR $A11D      ; }
; Plot ringer "off".
*$A0C6 LD DE,$A147   ; else <% DE = bell_ringer_bitmap_off;
; FALL THROUGH to plot_ringer.

; Plot ringer.
;
; Used by the routine at #R$A09E.
;
; I:HL Source bitmap.
@label=plot_ringer
c$A0C9 LD HL,$518E   ; HL = screenaddr_bell_ringer;
 $A0CC LD BC,$010C   ; {plot_bitmap(0x010C); return; %> // dimensions: 8 x 12 // args=BC // exit via
 $A0CF JP $7CBE      ; }

; Increase morale.
;
; Used by the routines at #R$A0E9 and #R$A0F2.
;
; I:B Amount to increase morale by. (Preserved)
@label=increase_morale
c$A0D2 LD A,($A13C)  ; {A = morale + B;
 $A0D5 ADD A,B       ; }
 $A0D6 CP $70        ; {if (A >= morale_MAX) A = morale_MAX;
 $A0D8 JR C,$A0DC    ;
 $A0DA LD A,$70      ; }
; FALL THROUGH into set_morale_from_A.

; Set morale from A.
;
; Used by the routines at #R$A0D2 and #R$A0E0.
;
; I:A Morale.
@label=set_morale_from_A
c$A0DC LD ($A13C),A  ; morale = A;
 $A0DF RET           ; return;

; Decrease morale.
;
; Used by the routines at #R$A1D3, #R$AE78, #R$CB98 and #R$CD31.
;
; I:B Amount to decrease morale by. (Preserved)
@label=decrease_morale
c$A0E0 LD A,($A13C)  ; {A = morale - B;
 $A0E3 SUB B         ; }
 $A0E4 JR NC,$A0DC   ; {if (A < morale_MIN) A = morale_MIN;
 $A0E6 XOR A         ; }
 $A0E7 JR $A0DC      ; goto set_morale_from_A;

; Increase morale by 10, score by 50.
;
; Used by the routines at #R$B107, #R$B387, #R$B3C4, #R$B3E1, #R$B3F6, #R$B4B8
; and #R$EFCB.
@label=increase_morale_by_10_score_by_50
c$A0E9 LD B,$0A      ; {increase_morale(10);
 $A0EB CALL $A0D2    ; }
 $A0EE LD B,$32      ; {increase_score(50); return; // exit via
 $A0F0 JR $A0F9      ; }

; Increase morale by 5, score by 5.
;
; Used by the routine at #R$7B36.
@label=increase_morale_by_5_score_by_5
c$A0F2 LD B,$05      ; {increase_morale(5);
 $A0F4 CALL $A0D2    ; }
 $A0F7 JR $A0F9      ; increase_score(5); return; // exit via

; Increases the score then plots it.
;
; Used by the routines at #R$68F4, #R$A0E9 and #R$A0F2.
;
; I:B Amount to increase score by.
;
; Increment the score digit-wise until delta is zero.
@label=increase_score
c$A0F9 LD A,$0A      ; A = 10;
 $A0FB LD HL,$A136   ; HL = &score_digits + 4;
*$A0FE PUSH HL       ; do <% tmp = HL;
@label=increase_score_increment_score
*$A0FF INC (HL)      ;   increment_score: (*HL)++;
 $A100 CP (HL)       ; {  if (*HL == A) <% *HL-- = 0; goto increment_score; %>
 $A101 JR NZ,$A108   ;
 $A103 LD (HL),$00   ;
 $A105 DEC HL        ;
 $A106 JR $A0FF      ; }
*$A108 POP HL        ;   HL = tmp;
 $A109 DJNZ $A0FE    ; %> while (--B);
; FALL THROUGH into plot_score.

; Draws the current score to screen.
;
; Used by the routines at #R$B75A and #R$F163.
@label=plot_score
c$A10B LD HL,$A132   ; HL = &score_digits;
 $A10E LD DE,$5094   ; DE = &score; // screen address of score
 $A111 LD B,$05      ; B = 5;
*$A113 PUSH BC       ; do <%
 $A114 CALL $7D2F    ;   plot_glyph(); // HL -> glyph, DE -> destination
 $A117 INC HL        ;   HL++;
 $A118 INC DE        ;   DE++;
 $A119 POP BC
 $A11A DJNZ $A113    ; %> while (--B);
 $A11C RET           ; return;

; Plays a sound.
;
; Used by the routines at #R$7B36, #R$7B8B, #R$A09E, #R$C4E0 and #R$CA81.
;
; I:B Number of iterations to play for.
; I:C Delay inbetween each iteration.
@label=play_speaker
c$A11D LD A,C        ; {delay = C; // Self-modify delay loop at $A126.
 $A11E LD ($A126),A  ; }
 $A121 LD A,$10      ; A = 16; // Initial speaker bit.
*$A123 OUT ($FE),A   ; {do <% OUT ($FE),A // Play.
 $A125 LD C,$37      ; }
*$A127 DEC C         ; {  C = delay; while (C--) ;
 $A128 JR NZ,$A127   ; }
 $A12A XOR $10       ;   A ^= 16; // Toggle speaker bit.
 $A12C DJNZ $A123    ; %> while (--B);
 $A12E RET           ; return;

; Game counter.
;
; Counts 00..FF then wraps.
; .
; Read-only by main_loop, picking_lock, cutting_wire, action_wiresnips,
; action_lockpick.
; .
; Write/read-write by wave_morale_flag.
@label=game_counter
g$A12F DEFB $00      ; game_counter

; Bell.
;
; #TABLE(default,centre)
; { =h Value | =h Meaning }
; { 0 | Ring indefinitely }
; { 255 | Don't ring }
; { N | Ring for N calls }
; TABLE#
; .
; Read-only by follow_suspicious_character.
; .
; Write/read-write by in_permitted_area, ring_bell, event_wake_up,
; event_go_to_roll_call, event_go_to_breakfast_time, event_breakfast_time,
; event_go_to_exercise_time, event_exercise_time, event_go_to_time_for_bed,
; searchlight_caught, solitary, guards_follow_suspicious_character,
; event_roll_call.
@label=bell
g$A130 DEFB $FF      ; bell

; Unreferenced byte.
g$A131 DEFB $0A      ; unused_A131

; Score digits.
;
; Read-only by plot_score.
; .
; Write/read-write by increase_score, reset_game.
@label=score_digits
g$A132 DEFB $00,$00,$00,$00,$00 ; score_digits

; Hero at breakfast flag.
;
; Write/read-write by process_player_input, breakfast_time,
; hero_sit_sleep_common.
@label=hero_in_breakfast
g$A137 DEFB $00      ; hero_in_breakfast

; Red flag flag.
;
; #TABLE(default,centre)
; { =h Value | =h Meaning }
; { 0 | Not naughty }
; { 255 | Naughty }
; TABLE#
; .
; Read-only by follow_suspicious_character, guards_follow_suspicious_character.
; .
; Write/read-write by in_permitted_area.
@label=red_flag
g$A138 DEFB $00      ; red_flag

; Automatic player counter.
;
; Countdown until CPU control of the player is assumed. When it becomes zero,
; control is assumed. It's usually set to 31 by input events.
; .
; Read-only by touch, follow_suspicious_character, character_behaviour.
; .
; Write/read-write by check_morale, process_player_input,
; charevnt_handler_10_hero_released_from_solitary, solitary.
@label=automatic_player_counter
g$A139 DEFB $00      ; automatic_player_counter

; 'In solitary' flag.
;
; Stops set_hero_target_location working.
; .
; Used to set flag colour.
; .
; Read-only by process_player_input, in_permitted_area,
; set_hero_target_location, follow_suspicious_character.
; .
; Write/read-write by charevnt_handler_4_solitary_ends, solitary.
@label=in_solitary
g$A13A DEFB $00      ; in_solitary

; 'Morale exhausted' flag.
;
; Inhibits user input when non-zero.
; .
; Set by check_morale.
; .
; Reset by reset_game.
; .
; Read-only by process_player_input.
; .
; Write/read-write by check_morale.
@label=morale_exhausted
g$A13B DEFB $00      ; morale_exhausted

; Morale 'score'.
;
; Ranges morale_MIN..morale_MAX.
; .
; Read-only by check_morale, wave_morale_flag.
; .
; Write/read-write by increase_morale, decrease_morale, reset_game.
@label=morale
g$A13C DEFB $70      ; morale

; Game clock.
;
; Ranges 0..139.
; .
; Read-only by in_permitted_area.
; .
; Write/read-write by dispatch_timed_event, reset_map_and_characters.
@label=clock
g$A13D DEFB $07      ; clock

; Mystery flag.
;
; In byte_A13E_is_nonzero etc.: when non-zero, character_index is valid. Else
; IY points to character_struct.
; .
; Read-only by charevnt_handler_3_check_var_A13E,
; charevnt_handler_5_check_var_A13E_anotherone.
; .
; Write/read-write by sub_A3BB, spawn_character, move_characters,
; follow_suspicious_character, sub_A3BB.
@label=entered_move_characters
g$A13E DEFB $00      ; entered_move_characters

; Hero in bed flag.
;
; Read-only by event_night_time,
; .
; Write/read-write by process_player_input, wake_up, hero_sit_sleep_common.
@label=hero_in_bed
g$A13F DEFB $FF      ; hero_in_bed

; Displayed morale.
;
; This lags behind actual morale while the flag moves slowly to its target.
; .
; Write/read-write by wave_morale_flag.
@label=displayed_morale
g$A140 DEFB $00      ; displayed_morale

; Pointer to the screen address where the morale flag was last plotted.
;
; Write/read-write by wave_morale_flag.
@label=moraleflag_screen_address
g$A141 DEFW $5002    ; moraleflag_screen_address

; Address of door (in locked_doors[]) in which bit 7 is cleared when picked.
;
; Read-only by picking_lock.
; .
; Write/read-write by action_lockpick.
@label=ptr_to_door_being_lockpicked
g$A143 DEFW $0000    ; ptr_to_door_being_lockpicked

; Game time until player control is restored.
;
; e.g. when picking a lock or cutting wire.
; .
; Read-only by picking_lock, cutting_wire.
; .
; Write/read-write by action_wiresnips, action_lockpick.
@label=player_locked_out_until
g$A145 DEFB $00      ; player_locked_out_until

; Day or night flag.
;
; #TABLE(default,centre)
; { =h Value | =h Meaning }
; { 0 | Daytime }
; { 255 | Nighttime }
; TABLE#
; .
; Read-only by main_loop, choose_game_window_attributes.
; .
; Write/read-write by set_day_or_night, reset_map_and_characters.
@label=day_or_night
g$A146 DEFB $00      ; day_or_night

; Bell ringer bitmaps.
;
; 8x12 pixels.
@label=bell_ringer_bitmap_off
b$A147 DEFB $E7      ; {bell_ringer_bitmap_off
 $A148 DEFB $E7
 $A149 DEFB $83
 $A14A DEFB $83
 $A14B DEFB $43
 $A14C DEFB $41
 $A14D DEFB $20
 $A14E DEFB $10
 $A14F DEFB $08
 $A150 DEFB $04
 $A151 DEFB $02
 $A152 DEFB $02      ; }
@label=bell_ringer_bitmap_on
 $A153 DEFB $3F      ; {bell_ringer_bitmap_on
 $A154 DEFB $3F
 $A155 DEFB $27
 $A156 DEFB $13
 $A157 DEFB $13
 $A158 DEFB $09
 $A159 DEFB $08
 $A15A DEFB $04
 $A15B DEFB $04
 $A15C DEFB $02
 $A15D DEFB $02
 $A15E DEFB $01      ; }

; Set game window attributes.
;
; Used by the routines at #R$7B36, #R$7B8B, #R$A1D3, #R$A50B, #R$B83B and
; #R$F350.
; .
; Starting at $5847, set 23 columns of 16 rows to A.
;
; I:A Attribute byte.
@label=set_game_window_attributes
c$A15F LD HL,$5847   ; HL = $5847 // attributes base // $5800 + $47
 $A162 LD C,$10      ; C = 16 // rows
 $A164 LD DE,$0009   ; DE = 32 - 23 // skip
*$A167 LD B,$17      ; do <% B = 23 // columns
*$A169 LD (HL),A     ; {do *HL++ = A;
 $A16A INC L         ; }
 $A16B DJNZ $A169    ; while (--B);
 $A16D ADD HL,DE     ; HL += DE;
 $A16E DEC C         ; C--;
 $A16F JP NZ,$A167   ; %> while (C != 0);
 $A172 RET           ; return;

; Timed events.
;
; Array of 15 event structures.
@label=timed_events
b$A173 DEFB $00,$D3,$A1 ; {   0, event_another_day_dawns },
 $A176 DEFB $08,$E7,$A1 ; {   8, event_wake_up },
 $A179 DEFB $0C,$28,$A2 ; {  12, event_new_red_cross_parcel },
 $A17C DEFB $10,$F0,$A1 ; {  16, event_go_to_roll_call },
 $A17F DEFB $14,$9A,$EF ; {  20, event_roll_call },
 $A182 DEFB $15,$F9,$A1 ; {  21, event_go_to_breakfast_time },
 $A185 DEFB $24,$02,$A2 ; {  36, event_breakfast_time },
 $A188 DEFB $2E,$06,$A2 ; {  46, event_go_to_exercise_time },
 $A18B DEFB $40,$15,$A2 ; {  64, event_exercise_time },
 $A18E DEFB $4A,$F0,$A1 ; {  74, event_go_to_roll_call },
 $A191 DEFB $4E,$9A,$EF ; {  78, event_roll_call },
 $A194 DEFB $4F,$19,$A2 ; {  79, event_go_to_time_for_bed },
 $A197 DEFB $62,$64,$A2 ; {  98, event_time_for_bed },
 $A19A DEFB $64,$C3,$A1 ; { 100, event_night_time },
 $A19D DEFB $82,$6A,$A2 ; { 130, event_search_light },

; Dispatch timed events.
;
; Used by the routine at #R$9D7B.
; .
; Dispatches time-based game events like parcels, meals, exercise and roll
; calls.
;
; .
;
; Increment the clock, wrapping at 140.
@label=dispatch_timed_event
c$A1A0 LD HL,$A13D   ; HL = &clock;
 $A1A3 LD A,(HL)     ; {A = *HL + 1;
 $A1A4 INC A         ; }
 $A1A5 CP $8C        ; {if (A == 140) A = 0;
 $A1A7 JR NZ,$A1AA   ;
 $A1A9 XOR A         ; }
*$A1AA LD (HL),A     ; *HL = A;
; Dispatch the event for that time.
 $A1AB LD HL,$A173   ; HL = &timed_events[0];
 $A1AE LD B,$0F      ; B = 15; // 15 iterations
*$A1B0 CP (HL)       ; {do <% if (A == *HL++) goto found;
 $A1B1 INC HL        ;
 $A1B2 JR Z,$A1B9    ; }
 $A1B4 INC HL        ; {  HL += 2;
 $A1B5 INC HL        ; }
 $A1B6 DJNZ $A1B0    ; %> while (--B);
 $A1B8 RET           ; return;
*$A1B9 LD A,(HL)     ; {found: L = *HL++;
 $A1BA INC HL        ; }
 $A1BB LD H,(HL)     ; {H = *HL;
 $A1BC LD L,A        ; }
 $A1BD LD A,$28      ; A = bell_RING_40_TIMES;
 $A1BF LD BC,$A130   ; BC = &bell;
 $A1C2 JP (HL)       ; goto *HL; // fantasy syntax

; Event: night time.
@label=event_night_time
c$A1C3 LD A,($A13F)  ; {if (hero_in_bed == 0)
 $A1C6 AND A         ; set_hero_target_location(location_012C);
 $A1C7 JR NZ,$A1CF   ;
 $A1C9 LD BC,$2C01   ;
 $A1CC CALL $A33F    ; }
*$A1CF LD A,$FF      ; A = 0xFF;
 $A1D1 JR $A1DE      ; goto set_attrs;

; Event: another day dawns.
@label=event_another_day_dawns
c$A1D3 LD B,$13      ; {queue_message_for_display(message_ANOTHER_DAY_DAWNS);
 $A1D5 CALL $7D15    ; }
 $A1D8 LD B,$19      ; {decrease_morale(25);
 $A1DA CALL $A0E0    ; }
 $A1DD XOR A         ; A = 0;
; This entry point is used by the routine at #R$A1C3.
*$A1DE LD ($A146),A  ; set_attrs: day_or_night = A;
 $A1E1 CALL $AB6B    ; choose_game_window_attributes();
 $A1E4 JP $A15F      ; set_game_window_attributes(); return; // exit via

; Event: wake up.
@label=event_wake_up
c$A1E7 LD (BC),A     ; *BC = A; // bell = bell_RING_40_TIMES;
 $A1E8 LD B,$01      ; {queue_message_for_display(message_TIME_TO_WAKE_UP);
 $A1EA CALL $7D15    ; }
 $A1ED JP $A289      ; wake_up(); return; // exit via

; Event: go to roll call.
@label=event_go_to_roll_call
c$A1F0 LD (BC),A     ; *BC = A; // bell = bell_RING_40_TIMES;
 $A1F1 LD B,$08      ; {queue_message_for_display(message_ROLL_CALL);
 $A1F3 CALL $7D15    ; }
 $A1F6 JP $A4FD      ; go_to_roll_call(); return; // exit via

; Event: go to breakfast time.
@label=event_go_to_breakfast_time
c$A1F9 LD (BC),A     ; *BC = A; // bell = bell_RING_40_TIMES;
 $A1FA LD B,$02      ; {queue_message_for_display(message_BREAKFAST_TIME);
 $A1FC CALL $7D15    ; }
 $A1FF JP $A4C5      ; set_location_0x0010(); return; // exit via

; Event: breakfast time.
@label=event_breakfast_time
c$A202 LD (BC),A     ; *BC = A; // bell = bell_RING_40_TIMES;
 $A203 JP $A2E2      ; breakfast_time(); return; // exit via

; Event: go to exercise time.
@label=event_go_to_exercise_time
c$A206 LD (BC),A     ; *BC = A; // bell = bell_RING_40_TIMES;
 $A207 LD B,$03      ; {queue_message_for_display(message_EXERCISE_TIME);
 $A209 CALL $7D15    ; }
; Unlock the gates.
 $A20C LD HL,$0100   ; {locked_doors[0] = 0x00; locked_doors[1] = 0x01;
 $A20F LD ($F05D),HL ; }
 $A212 JP $A4A9      ; set_location_0x000E(); return; // exit via

; Event: exercise time.
@label=event_exercise_time
c$A215 LD (BC),A     ; *BC = A; // bell = bell_RING_40_TIMES;
 $A216 JP $A4B7      ; set_location_0x048E(); return; // exit via

; Event: go to time for bed.
@label=event_go_to_time_for_bed
c$A219 LD (BC),A     ; *BC = A; // bell = bell_RING_40_TIMES;
; Lock the gates.
 $A21A LD HL,$8180   ; {locked_doors[0] = 0x80; locked_doors[1] = 0x81;
 $A21D LD ($F05D),HL ; }
 $A220 LD B,$04      ; {queue_message_for_display(message_TIME_FOR_BED);
 $A222 CALL $7D15    ; }
 $A225 JP $A351      ; go_to_time_for_bed(); return; // exit via

; Event: new red cross parcel.
;
; .
;
; .
;
; Don't deliver a new red cross parcel while the previous one still exists.
@label=event_new_red_cross_parcel
c$A228 LD A,($771D)     ; {if ((item_structs[item_RED_CROSS_PARCEL].room & itemstruct_ROOM_MASK) != itemstruct_ROOM_MASK) return;
 $A22B AND $3F          ;
 $A22D CP $3F           ;
 $A22F RET NZ           ; }
; Select the contents of the next parcel; choosing the first item from the list
; which does not already exist.
@nowarn
 $A230 LD DE,$A25F      ; DE = &red_cross_parcel_contents_list[0];
 $A233 LD B,$04         ; B = 4; // length of above
*$A235 LD A,(DE)        ; do <% A = *DE;
 $A236 CALL $7C26       ;   HL = item_to_itemstruct(A);
 $A239 INC HL           ;   HL++;
 $A23A LD A,(HL)        ; {  if ((*HL & itemstruct_ROOM_MASK) == itemstruct_ROOM_MASK) goto found;
 $A23B AND $3F          ;
 $A23D CP $3F           ;
 $A23F JR Z,$A245       ; }
 $A241 INC DE           ;   DE++;
 $A242 DJNZ $A235       ; %> while (--B);
 $A244 RET              ; return;
*$A245 LD A,(DE)        ; {found: red_cross_parcel_current_contents = *DE;
 $A246 LD ($A263),A     ; }
 $A249 LD DE,$771D      ; {memcpy(&item_structs[item_RED_CROSS_PARCEL].room,
@nowarn
 $A24C LD HL,$A259      ; red_cross_parcel_reset_data, 6);
 $A24F LD BC,$0006      ;
 $A252 LDIR             ; }
 $A254 LD B,$09         ; {queue_message_for_display(message_RED_CROSS_PARCEL);
 $A256 JP $7D15         ; return; // exit via}
; Red cross parcel reset data (room, tinypos, target).
@label=red_cross_parcel_reset_data
 $A259 DEFB $14         ; item_RED_CROSS_PARCEL
 $A25A DEFB $2C,$2C,$0C ; 44,44,12
 $A25D DEFW $F480       ; 0xF480
; Red cross parcel contents list.
@label=red_cross_parcel_contents_list
 $A25F DEFB $0E         ; item_PURSE
 $A260 DEFB $00         ; item_WIRESNIPS
 $A261 DEFB $05         ; item_BRIBE
 $A262 DEFB $0F         ; item_COMPASS

; Current contents of red cross parcel.
@label=red_cross_parcel_current_contents
g$A263 DEFB $FF      ; red_cross_parcel_current_contents

; Event: time for bed.
@label=event_time_for_bed
c$A264 LD A,$A6      ; A = 0xA6;
 $A266 LD C,$03      ; C = 3;
 $A268 JR $A26E      ; goto $A26E;

; Event: search light.
@label=event_search_light
c$A26A LD A,$26      ; A = 0x26;
 $A26C LD C,$00      ; C = 0;
; This entry point is used by the routine at #R$A264.
; .
; Common end of event_time_for_bed and event_search_light.
*$A26E EX AF,AF'
 $A26F LD A,$0C      ; Adash = 12;
 $A271 LD B,$04      ; B = 4; // 4 iterations
*$A273 PUSH AF       ; do <%
 $A274 CALL $A38C    ;   set_character_location();
 $A277 POP AF
 $A278 INC A         ;   Adash++;
 $A279 EX AF,AF'
 $A27A INC A         ;   A++;
 $A27B EX AF,AF'
 $A27C DJNZ $A273    ; %> while (--B);
 $A27E RET           ; return;

; List of non-player characters: six prisoners and four guards.
;
; Read-only by set_prisoners_and_guards_location,
; set_prisoners_and_guards_location_B.
@label=prisoners_and_guards
b$A27F DEFB $0C      ; character_12_GUARD_12
 $A280 DEFB $0D      ; character_13_GUARD_13
 $A281 DEFB $14      ; character_20_PRISONER_1
 $A282 DEFB $15      ; character_21_PRISONER_2
 $A283 DEFB $16      ; character_22_PRISONER_3
 $A284 DEFB $0E      ; character_14_GUARD_14
 $A285 DEFB $0F      ; character_15_GUARD_15
 $A286 DEFB $17      ; character_23_PRISONER_4
 $A287 DEFB $18      ; character_24_PRISONER_5
 $A288 DEFB $19      ; character_25_PRISONER_6

; Wake up.
;
; Used by the routine at #R$A1E7.
@label=wake_up
c$A289 LD A,($A13F)  ; {if (hero_in_bed) <% // odd that this jumps into a point which sets hero_in_bed to zero when it's already zero
 $A28C AND A         ;
 $A28D JP Z,$A299    ; }
; Hero gets out of bed.
 $A290 LD HL,$800F   ; {  $800F = 46; // hero's X position
 $A293 LD (HL),$2E   ; }
 $A295 INC L         ; {  $8011 = 46; %> // hero's Y position
 $A296 INC L         ;
 $A297 LD (HL),$2E   ; }
*$A299 XOR A         ; {hero_in_bed = 0;
 $A29A LD ($A13F),A  ; }
 $A29D LD BC,$2A00   ; {set_hero_target_location(location_002A);
 $A2A0 CALL $A33F    ; }
; Position all six prisoners.
 $A2A3 LD HL,$769F   ; HL = &characterstruct_20.room;
 $A2A6 LD DE,$0007
 $A2A9 LD A,$03
 $A2AB LD B,$03      ; B = 3; // 3 iterations
*$A2AD LD (HL),A     ; do <% *HL = room_3_HUT2RIGHT;
 $A2AE ADD HL,DE     ;   HL += 7; // characterstruct stride
 $A2AF DJNZ $A2AD    ; %> while (--B);
 $A2B1 LD A,$05
 $A2B3 LD B,$03      ; B = 3; // 3 iterations
*$A2B5 LD (HL),A     ; do <% *HL = room_5_HUT3RIGHT;
 $A2B6 ADD HL,DE     ;   HL += 7; // characterstruct stride
 $A2B7 DJNZ $A2B5    ; %> while (--B);
 $A2B9 LD A,$05      ; A = 5; // incremented by set_prisoners_and_guards_location_B
 $A2BB EX AF,AF'
 $A2BC LD C,$00      ; C = 0; // BC = 0
 $A2BE CALL $A373    ; set_prisoners_and_guards_location_B();
; Update all the bed objects to be empty.
 $A2C1 LD A,$09
 $A2C3 LD HL,$6B79   ; HL = &beds[0];
@bfix-begin
; Bug: Seven iterations are specified here BUT there are only six beds in the
; 'beds' array. This results in a spurious write to ROM location $1A42.
 $A2C6 LD B,$07      ; B = 7; // 7 iterations
@bfix+else
 $A2C6 LD B,$06      ; B = 6; // 6 iterations
@bfix+end
*$A2C8 LD E,(HL)     ; {do <% E = *HL++;
 $A2C9 INC HL        ; }
 $A2CA LD D,(HL)     ; {  D = *HL++;
 $A2CB INC HL        ; }
 $A2CC LD (DE),A     ;   *DE = interiorobject_EMPTY_BED;
 $A2CD DJNZ $A2C8    ; %> while (--B);
; Update the hero's bed object to be empty and redraw if required.
 $A2CF LD HL,$6C61   ; {room_2_hut2_left.bed = interiorobject_EMPTY_BED;
 $A2D2 LD (HL),A     ; }
 $A2D3 LD A,($68A0)  ; {if (room_index == room_0_OUTDOORS || room_index >= room_6) return;
 $A2D6 AND A         ;
 $A2D7 RET Z         ;
 $A2D8 CP $06        ;
 $A2DA RET NC        ; }
 $A2DB CALL $6A35    ; setup_room();
 $A2DE CALL $6B42    ; plot_interior_tiles();
 $A2E1 RET           ; return;

; Breakfast time.
;
; Used by the routine at #R$A202.
@label=breakfast_time
c$A2E2 LD A,($A137)  ; {if (hero_in_breakfast) <%
 $A2E5 AND A         ;
 $A2E6 JP Z,$A2F2    ; }
 $A2E9 LD HL,$800F   ; {  $800F = 52; // hero X position
 $A2EC LD (HL),$34   ; }
 $A2EE INC L         ; {  $8011 = 62; %> // hero Y position
 $A2EF INC L         ;
 $A2F0 LD (HL),$3E   ; }
*$A2F2 XOR A         ; {hero_in_breakfast = 0;
 $A2F3 LD ($A137),A  ; }
 $A2F6 LD BC,$9003   ; {set_hero_target_location(location_0390);
 $A2F9 CALL $A33F    ; }
 $A2FC LD HL,$769F   ; HL = &characterstruct_20.room; // character_20_PRISONER_1
 $A2FF LD DE,$0007
 $A302 LD A,$19
 $A304 LD B,$03      ; B = 3; // 3 iterations
*$A306 LD (HL),A     ; do <% *HL = room_25_BREAKFAST;
 $A307 ADD HL,DE     ;   HL += 7; // stride
 $A308 DJNZ $A306    ; %> while (--B);
 $A30A LD A,$17
 $A30C LD B,$03      ; B = 3; // 3 iterations
*$A30E LD (HL),A     ; do <% *HL = room_23_BREAKFAST;
 $A30F ADD HL,DE     ;   HL += 7; // stride
 $A310 DJNZ $A30E    ; %> while (--B);
 $A312 LD A,$90      ; A = 144; // incremented by set_prisoners_and_guards_location_B
 $A314 EX AF,AF'
 $A315 LD C,$03      ; C = 3;
 $A317 CALL $A373    ; set_prisoners_and_guards_location_B();
 $A31A LD A,$0D
; Update all the benches to be empty.
 $A31C LD ($6F17),A  ; roomdef_23_breakfast.bench_A = interiorobject_EMPTY_BENCH;
 $A31F LD ($6F1A),A  ; roomdef_23_breakfast.bench_B = interiorobject_EMPTY_BENCH;
 $A322 LD ($6F1D),A  ; roomdef_23_breakfast.bench_C = interiorobject_EMPTY_BENCH;
 $A325 LD ($6F4F),A  ; roomdef_25_breakfast.bench_D = interiorobject_EMPTY_BENCH;
 $A328 LD ($6F52),A  ; roomdef_25_breakfast.bench_E = interiorobject_EMPTY_BENCH;
 $A32B LD ($6F55),A  ; roomdef_25_breakfast.bench_F = interiorobject_EMPTY_BENCH;
 $A32E LD ($6F58),A  ; roomdef_25_breakfast.bench_G = interiorobject_EMPTY_BENCH;
 $A331 LD A,($68A0)  ; {if (room_index == room_0_OUTDOORS || room_index >= room_29_SECOND_TUNNEL_START) return;
 $A334 AND A         ;
 $A335 RET Z         ;
 $A336 CP $1D        ;
 $A338 RET NC        ; }
 $A339 CALL $6A35    ; setup_room();
 $A33C JP $6B42      ; plot_interior_tiles(); return; // exit via // note that this differs to wake_up's ending

; Set the hero's target location.
;
; Used by the routines at #R$9F21, #R$A1C3, #R$A289, #R$A2E2, #R$A351, #R$A3F8,
; #R$A4A9, #R$A4B7, #R$A4C5, #R$A4D8 and #R$A4FD.
; .
;
; I:BC Target location (B = x, C = y).
@label=set_hero_target_location
c$A33F LD A,($A13A)  ; {if (in_solitary) return;
 $A342 AND A         ;
 $A343 RET NZ        ; }
; This entry point is used by the routine at #R$C7C6.
*$A344 LD HL,$8001   ; {$8001 &= ~vischar_FLAGS_DOOR_THING;
 $A347 RES 6,(HL)    ; }
 $A349 INC L         ; {$8002 = B;
 $A34A LD (HL),B     ; }
 $A34B INC L         ; {$8003 = C;
 $A34C LD (HL),C     ; }
 $A34D CALL $A3BB    ; sub_A3BB();
 $A350 RET           ; return;

; Go to time for bed.
;
; Used by the routine at #R$A219.
@label=go_to_time_for_bed
c$A351 LD BC,$8502   ; {set_hero_target_location(location_0285);
 $A354 CALL $A33F    ; }
 $A357 LD A,$85      ; Adash = 133;
 $A359 EX AF,AF'
 $A35A LD C,$02      ; C = 2;
 $A35C JP $A373      ; set_prisoners_and_guards_location_B(); return; // exit via

; Set the location of the prisoners_and_guards.
;
; Used by the routine at #R$A4FD.
; .
; Set a different location for each character.
;
; O:A' Counter incremented.
@label=set_prisoners_and_guards_location
c$A35F LD HL,$A27F   ; HL = &prisoners_and_guards[0];
 $A362 LD B,$0A      ; B = 10;
*$A364 PUSH HL       ; do <%
 $A365 PUSH BC
 $A366 LD A,(HL)     ;   A = *HL;
 $A367 CALL $A38C    ;   set_character_location();
 $A36A EX AF,AF'     ; {
 $A36B INC A         ;   Adash++;
 $A36C EX AF,AF'     ; }
 $A36D POP BC
 $A36E POP HL
 $A36F INC HL        ;   HL++;
 $A370 DJNZ $A364    ; %> while (--B);
 $A372 RET           ; return;

; Set the location of the prisoners_and_guards.
;
; Used by the routines at #R$A289, #R$A2E2, #R$A351, #R$A4A9, #R$A4B7 and
; #R$A4C5.
; .
; Set the same location for each half of the group.
;
; O:A' Counter incremented.
@label=set_prisoners_and_guards_location_B
c$A373 LD HL,$A27F   ; HL = &prisoners_and_guards[0];
 $A376 LD B,$0A      ; B = 10;
*$A378 PUSH HL       ; do <%
 $A379 PUSH BC
 $A37A LD A,(HL)     ;   A = *HL;
 $A37B CALL $A38C    ;   set_character_location();
 $A37E POP BC
; When this is 6, the character being processed is character_22_PRISONER_3 and
; the next is character_14_GUARD_14, the start of the second half of the list.
 $A37F LD A,B        ; {  if (B == 6) Adash++; // array index 6 is character
 $A380 CP $06        ; 22
 $A382 JR NZ,$A387   ;
 $A384 EX AF,AF'
 $A385 INC A         ;
 $A386 EX AF,AF'     ; }
*$A387 POP HL
 $A388 INC HL        ;   HL++;
 $A389 DJNZ $A378    ; %> while (--B);
 $A38B RET           ; return;

; Set location of a character.
;
; Used by the routines at #R$A26A, #R$A35F and #R$A373.
; .
; Finds a charstruct, or a vischar, and stores a location in its target.
;
; I:A Character index.
; I:A' Location low.
; I:C Location high.
@label=set_character_location
c$A38C CALL $C7B9    ; HL = get_character_struct(A);
 $A38F BIT 6,(HL)    ; {if ((*HL & characterstruct_FLAG_DISABLED) == 0) goto not_set; // disabled?
 $A391 JP Z,$A3AA    ; }
 $A394 PUSH BC
 $A395 LD A,(HL)     ; {A = *HL & characterstruct_BYTE0_MASK;
 $A396 AND $1F       ; }
; Search non-player characters to see if this character is already on-screen.
 $A398 LD B,$07      ; B = 7; // 7 iterations
 $A39A LD DE,$0020   ; DE = 32; // stride
@nowarn
 $A39D LD HL,$8020   ; HL = $8020; // iterate over non-player characters
*$A3A0 CP (HL)       ; {do <% if (A == *HL) goto found;
 $A3A1 JR Z,$A3B3    ; }
 $A3A3 ADD HL,DE     ;   HL += DE;
 $A3A4 DJNZ $A3A0    ; %> while (--B);
 $A3A6 POP BC
 $A3A7 JR $A3B2      ; goto exit;
 $A3A9 DEFB $19      ; Unreferenced byte.
*$A3AA INC HL        ; {not_set: HL += 5; // HL = charstruct->target
 $A3AB INC HL        ;
 $A3AC INC HL        ;
 $A3AD INC HL        ;
 $A3AE INC HL        ; }
 $A3AF CALL $A3ED    ; store_location();
*$A3B2 RET           ; exit: return;
*$A3B3 POP BC        ; found:
 $A3B4 INC L         ; HL++;
 $A3B5 RES 6,(HL)    ; {*HL++ &= ~vischar_FLAGS_DOOR_THING;
 $A3B7 INC L         ; }
 $A3B8 CALL $A3ED    ; store_location(); // HL = vischar->target
; FALL THROUGH into sub_A3BB.

; Not yet understood.
;
; Used by the routine at #R$A33F.
@label=sub_A3BB
c$A3BB XOR A         ; {entered_move_characters = 0;
 $A3BC LD ($A13E),A  ; }
 $A3BF PUSH BC
 $A3C0 PUSH HL
 $A3C1 DEC L         ; HL--;
 $A3C2 CALL $C651    ; get_next_target();
 $A3C5 POP DE        ; // DE = the HL stored at $A3C0
 $A3C6 INC E         ; DE++;
 $A3C7 LDI           ; *DE++ = *HL++; BC--;
 $A3C9 LDI           ; *DE++ = *HL++; BC--;
 $A3CB CP $FF        ; {if (A == 255) <%
 $A3CD JP NZ,$A3DF   ; }
 $A3D0 LD A,E        ; {  DE -= 6;
 $A3D1 SUB $06       ;
 $A3D3 LD E,A        ; }
 $A3D4 PUSH DE       ; {  IY = DE;
 $A3D5 POP IY        ; }
 $A3D7 EX DE,HL
 $A3D8 INC L         ; {  HL += 2;
 $A3D9 INC L         ; }
 $A3DA CALL $CB23    ;   get_next_target_and_handle_it();
 $A3DD POP BC        ;   // could have just ended the block here
 $A3DE RET           ;   return; %>
*$A3DF CP $80        ; {else if (A == 128) <%
 $A3E1 JP NZ,$A3EB   ; }
 $A3E4 LD A,E        ; {  DE -= 5;
 $A3E5 SUB $05       ;
 $A3E7 LD E,A        ; }
 $A3E8 EX DE,HL
 $A3E9 SET 6,(HL)    ;   *HL |= vischar_FLAGS_DOOR_THING; %> // sampled HL=$8001
*$A3EB POP BC
 $A3EC RET           ; return;

; Store an xy_t at the specified address.
;
; Used by the routine at #R$A38C.
;
; I:A' Low byte.
; I:C  High byte.
; I:HL Pointer to target.
@label=store_location
c$A3ED EX AF,AF'     ; {
 $A3EE LD (HL),A     ; *HL++ = Adash;
 $A3EF EX AF,AF'     ;
 $A3F0 INC HL        ; }
 $A3F1 LD (HL),C     ; *HL = C;
 $A3F2 RET           ; return;

; entered_move_characters is non-zero.
;
; Used by the routine at #R$C7C6.
;
; I:HL Pointer to location.
@label=byte_A13E_is_nonzero
c$A3F3 LD A,($8217)  ; A = character_index;
 $A3F6 JR $A404      ; goto byte_A13E_common;

; entered_move_characters is zero.
;
; Used by the routine at #R$C7C6.
; .
; Gets hit when hero enters hut at end of day.
;
; I:HL Pointer to location.
@label=byte_A13E_is_zero
c$A3F8 LD A,(IY+$00) ; A = IY[0]; // IY=$8000 // must be a character index
 $A3FB AND A         ; {if (A != 0) goto byte_A13E_common;
 $A3FC JR NZ,$A404   ; }
 $A3FE LD BC,$2C00   ; { set_hero_target_location(location_002C); // exit via
 $A401 JP $A33F      ; }

; Common end of above two routines.
;
; Used by the routines at #R$A3F3 and #R$A3F8.
@label=byte_A13E_common
c$A404 INC HL        ; {HL[1] = 0; // HL=$766B,$7672 characterstruct + 5 (characterstruct + 6 when zeroed)
 $A405 LD (HL),$00   ; }
 $A407 CP $13        ; {if (A > 19) <%
 $A409 JP Z,$A413    ;
 $A40C JP C,$A413    ; }
 $A40F SUB $0D       ;   A -= 13; %> // 20.. => 7..
 $A411 JR $A41D      ; else <%
*$A413 BIT 0,A       ; {  old_A = A; A = 13; if (old_A & (1<<0)) <% // tmp introduced to avoid interleaving
 $A415 LD A,$0D      ;
 $A417 JR Z,$A41D    ; }
 $A419 LD (HL),$01   ;     HL[1] = 1; // HL=$7681,$7673 // characterstruct_N + 6
 $A41B OR $80        ;     A |= 0x80; %> %>
*$A41D DEC HL        ; {HL[0] = A; // characterstruct_N + 5
 $A41E LD (HL),A     ; }
 $A41F RET           ; return;

; Character sits.
;
; Used by the routine at #R$C7C6.
;
; I:A Character.
; I:HL Pointer to location.
@label=character_sits
c$A420 PUSH AF
 $A421 EX DE,HL
 $A422 SUB $12       ; A -= 18; // first three characters
 $A424 LD HL,$6F4F   ; HL = &roomdef_25_breakfast.bench_D;
 $A427 CP $03        ; {if (A >= 3) <% // second three characters
 $A429 JR C,$A430    ; }
 $A42B LD HL,$6F17   ;   HL = &roomdef_23_breakfast.bench_A;
 $A42E SUB $03       ;   A -= 3; %>
; Poke object.
*$A430 LD C,A        ; {HL += A * 3;
 $A431 ADD A,A       ;
 $A432 ADD A,C       ;
 $A433 LD B,$00      ;
 $A435 LD C,A        ;
 $A436 ADD HL,BC     ; }
 $A437 LD (HL),$05   ; *HL = interiorobject_PRISONER_SAT_MID_TABLE;
 $A439 POP AF
 $A43A LD C,$19      ; C = room_25_BREAKFAST;
 $A43C CP $15        ; {if (A >= character_21_PRISONER_2) C = room_23_BREAKFAST;
 $A43E JR C,$A462    ;
 $A440 LD C,$17      ; }
 $A442 JR $A462      ; goto character_sit_sleep_common;

; Character sleeps.
;
; Used by the routine at #R$C7C6.
;
; I:A Character.
; I:HL Pointer to location.
@label=character_sleeps
c$A444 PUSH AF
 $A445 SUB $07       ; {A -= 7;
 $A447 ADD A,A       ; }
 $A448 EX DE,HL
; Poke object.
 $A449 LD C,A        ; {BC = beds[A];
 $A44A LD B,$00      ;
 $A44C LD HL,$6B79   ;
 $A44F ADD HL,BC     ;
 $A450 LD C,(HL)     ;
 $A451 INC HL        ;
 $A452 LD B,(HL)     ; }
 $A453 LD A,$17      ; {*BC = interiorobject_OCCUPIED_BED;
 $A455 LD (BC),A     ; }
 $A456 POP AF
 $A457 CP $0A        ; {if (A < character_10_GUARD_10)
 $A459 JP NC,$A460   ; }
 $A45C LD C,$03      ;   C = room_3_hut2_right;
 $A45E JR $A462      ; else
*$A460 LD C,$05      ;   C = room_5_hut3_right;
; FALL THROUGH into character_sit_sleep_common.

; Common end of character sits/sleeps.
;
; Used by the routines at #R$A420 and #R$A444.
;
; .
;
; I:C Room.
; .
; I:DE Pointer to location.
@label=character_sit_sleep_common
c$A462 EX DE,HL
 $A463 LD (HL),$00   ; *HL = 0;  // $8022, $76B8, $76BF, $76A3  (can be vischar OR characterstruct - weird)
 $A465 EX AF,AF'
 $A466 LD A,($68A0)  ; {if (room_index != C) <%
 $A469 CP C          ;
 $A46A JR Z,$A473    ; }
 $A46C DEC HL        ; {  HL -= 4;
 $A46D DEC HL        ;
 $A46E DEC HL        ;
 $A46F DEC HL        ; }
 $A470 LD (HL),$FF   ;   *HL = 255;
 $A472 RET           ;   return; %>
; Force a refresh.
*$A473 LD A,L        ; {HL += 26;
 $A474 ADD A,$1A     ;
 $A476 LD L,A        ; }
 $A477 LD (HL),$FF   ; *HL = 255;
; FALL THROUGH into select_room_and_plot.

; Select room and plot.
;
; Used by the routine at #R$A491.
@label=select_room_and_plot
c$A479 CALL $6A35    ; select_room_and_plot: setup_room();
 $A47C JP $6B42      ; plot_interior_tiles(); return;

; The hero sits.
;
; Used by the routine at #R$C7C6.
@label=hero_sits
c$A47F LD HL,$6F58   ; {roomdef_25_breakfast.bench_G = interiorobject_PRISONER_SAT_DOWN_END_TABLE;
 $A482 LD (HL),$13   ; }
 $A484 LD HL,$A137   ; HL = &hero_in_breakfast;
 $A487 JR $A491      ; goto hero_sit_sleep_common;

; The hero sleeps.
;
; Used by the routines at #R$B75A and #R$C7C6.
@label=hero_sleeps
c$A489 LD HL,$6C61   ; {roomdef_2_hut2_left.bed = interiorobject_OCCUPIED_BED;
 $A48C LD (HL),$17   ; }
 $A48E LD HL,$A13F   ; HL = &hero_in_bed;
; FALL THROUGH into hero_sit_sleep_common.

; Common end of hero_sits/sleeps.
;
; Used by the routine at #R$A47F.
;
; I:HL Pointer to hero_in_breakfast or hero_in_bed.
@label=hero_sit_sleep_common
c$A491 LD (HL),$FF   ; *HL = 0xFF; // set in breakfast, or in bed
 $A493 XOR A         ; A = 0;
 $A494 LD HL,$8002   ; {$8002 = A; // target location? bottom byte only?
 $A497 LD (HL),A     ; }
; Set hero's position to zero.
 $A498 LD HL,$800F   ; {memset($800F, 0, 4);
 $A49B LD B,$04      ;
*$A49D LD (HL),A     ;
 $A49E INC L         ;
 $A49F DJNZ $A49D    ; }
 $A4A1 LD HL,$8000   ; HL = $8000;
 $A4A4 CALL $B71B    ; calc_vischar_screenpos_from_mi_pos(); // reset hero
 $A4A7 JR $A479      ; goto select_room_and_plot;

; Set location 0x000E.
;
; Used by the routine at #R$A206.
@label=set_location_0x000E
c$A4A9 LD BC,$0E00   ; {set_hero_target_location(0x000E);
 $A4AC CALL $A33F    ; }
 $A4AF LD A,$0E      ; A = 0x0E;
 $A4B1 EX AF,AF'
 $A4B2 LD C,$00      ; C = 0;
 $A4B4 JP $A373      ; set_prisoners_and_guards_location_B(); return; // exit via

; Set location 0x048E.
;
; Used by the routine at #R$A215.
@label=set_location_0x048E
c$A4B7 LD BC,$8E04   ; {set_hero_target_location(0x048E);
 $A4BA CALL $A33F    ; }
 $A4BD LD A,$8E      ; A = 0x8E;
 $A4BF EX AF,AF'
 $A4C0 LD C,$04      ; C = 4;
 $A4C2 JP $A373      ; set_prisoners_and_guards_location_B(); return; // exit via

; Set location 0x0010.
;
; Used by the routine at #R$A1F9.
@label=set_location_0x0010
c$A4C5 LD BC,$1000   ; {set_hero_target_location(0x0010);
 $A4C8 CALL $A33F    ; }
 $A4CB LD A,$10      ; A = 0x10;
 $A4CD EX AF,AF'
 $A4CE LD C,$00      ; C = 0;
 $A4D0 JP $A373      ; set_prisoners_and_guards_location_B(); return; // exit via

; entered_move_characters is non-zero (another one).
;
; Used by the routine at #R$C7C6.
; .
; Something character related [very similar to the routine at $A3F3].
@label=byte_A13E_is_nonzero_anotherone
c$A4D3 LD A,($8217)  ; A = character_index;
 $A4D6 JR $A4E4      ; goto $A4E4;

; entered_move_characters is zero (another one).
;
; Used by the routine at #R$C7C6.
; .
; Sets a target location 0x002B. Seems to get hit around breakfasting time. If
; I nobble this it stops him sitting for breakfast.
@label=byte_A13E_is_zero_anotherone
c$A4D8 LD A,(IY+$00) ; A = IY[0]; // must be a character index
 $A4DB AND A         ; {if (A != 0) goto byte_A13E_anotherone_common;
 $A4DC JR NZ,$A4E4   ; }
 $A4DE LD BC,$2B00   ; { set_hero_target_location(location_002B); // exit via
 $A4E1 JP $A33F      ; }

; Common end of above two routines.
;
; Used by the routines at #R$A4D3 and #R$A4D8.
;
; I:A Character.
; I:HL Pointer to location.
@label=byte_A13E_anotherone_common
c$A4E4 INC HL        ; {HL[1] = 0;
 $A4E5 LD (HL),$00   ; }
 $A4E7 CP $13        ; {if (A > 19) <% // change this to 20 and character_21? stands in place of a guard
 $A4E9 JP Z,$A4F3    ;
 $A4EC JP C,$A4F3    ; }
 $A4EF SUB $02       ;   tmp_A = A - 2; %> // seems to affect position at table 20.. => 18..
 $A4F1 JR $A4FA      ; else <%
*$A4F3 BIT 0,A
 $A4F5 LD A,$18      ;   tmp_A = 24; // interleaved // guard character?
 $A4F7 JR Z,$A4FA    ; {  if (A & (1<<0)) tmp_A++; %>
 $A4F9 INC A         ; }
*$A4FA DEC HL        ; {HL[0] = tmp_A;
 $A4FB LD (HL),A     ; }
 $A4FC RET           ; return;

; Go to roll call.
;
; Used by the routine at #R$A1F0.
@label=go_to_roll_call
c$A4FD LD A,$1A      ; A = 26;
 $A4FF EX AF,AF'
 $A500 LD C,$00      ; C = 0;
 $A502 CALL $A35F    ; set_prisoners_and_guards_location();
 $A505 LD BC,$2D00   ; {set_hero_target_location(location_002D);
 $A508 JP $A33F      ; }

; Screen reset.
;
; Used by the routines at #R$9DE5 and #R$A51C.
@label=screen_reset
c$A50B CALL $6A27    ; wipe_visible_tiles();
 $A50E CALL $6B42    ; plot_interior_tiles();
 $A511 CALL $ABA0    ; zoombox();
 $A514 CALL $EED3    ; plot_game_window();
 $A517 LD A,$07      ; A = attribute_WHITE_OVER_BLACK;
 $A519 JP $A15F      ; set_game_window_attributes(); return; // exit via

; Hero has escaped.
;
; Used by the routine at #R$9F21.
; .
; Print 'well done' message then test to see if the correct objects were used
; in the escape attempt.
@label=escaped
c$A51C CALL $A50B    ; screen_reset();
; Print standard prefix messages.
 $A51F LD HL,$A5CE   ; HL = &escape_strings[0];
 $A522 CALL $A5BF    ; screenlocstring_plot(); // WELL DONE
 $A525 CALL $A5BF    ; screenlocstring_plot(); // YOU HAVE ESCAPED
 $A528 CALL $A5BF    ; screenlocstring_plot(); // FROM THE CAMP
; Form escape items bitfield.
 $A52B LD C,$00      ; C = 0; // zero flag
 $A52D LD HL,$8215   ; HL = &items_held[0];
 $A530 CALL $A59C    ; join_item_to_escapeitem();
 $A533 INC HL        ; HL++; // &items_held[1];
 $A534 CALL $A59C    ; join_item_to_escapeitem();
; Print item-tailored messages.
 $A537 LD A,C        ; A = C;
 $A538 CP $05        ; {if (A == escapeitem_COMPASS + escapeitem_PURSE) goto success;
 $A53A JR Z,$A540    ; }
 $A53C CP $03        ; {else if (A != escapeitem_COMPASS + escapeitem_PAPERS) goto captured;
 $A53E JR NZ,$A54E   ; }
@label=escaped_success
@nowarn
*$A540 LD HL,$A5FD   ; success: HL = &escape_strings[3];
 $A543 CALL $A5BF    ; screenlocstring_plot(); // AND WILL CROSS THE
 $A546 CALL $A5BF    ; screenlocstring_plot(); // BORDER SUCCESSFULLY
 $A549 LD A,$FF      ; A = 0xFF; // success - reset game
 $A54B PUSH AF
 $A54C JR $A56E      ; goto press_any_key;
@label=escaped_captured
*$A54E PUSH AF       ; captured:
@nowarn
 $A54F LD HL,$A628   ; HL = &escape_strings[5];
 $A552 CALL $A5BF    ; screenlocstring_plot(); // BUT WERE RECAPTURED
 $A555 POP AF
 $A556 PUSH AF
 $A557 CP $08        ; {if (A >= escapeitem_UNIFORM) goto plot; // at least a uniform => 'but were recaptured' // bug? plotting twice
 $A559 JR NC,$A56B   ; }
@nowarn
 $A55B LD HL,$A652   ; HL = &escape_strings[7];
 $A55E AND A         ; {if (A == 0) goto plot; // no objects => 'totally unprepared'
 $A55F JR Z,$A56B    ; }
@nowarn
 $A561 LD HL,$A667   ; HL = &escape_strings[8];
 $A564 BIT 0,A       ; {if ((A & escapeitem_COMPASS) == 0) goto plot; // no compass => 'totally lost'
 $A566 JR Z,$A56B    ; }
@nowarn
 $A568 LD HL,$A676   ; HL = &escape_strings[9];
@label=escaped_plot
*$A56B CALL $A5BF    ; plot: screenlocstring_plot();
@nowarn
@label=escaped_press_any_key
*$A56E LD HL,$A68E   ; press_any_key: HL = &escape_strings[10];
 $A571 CALL $A5BF    ; screenlocstring_plot(); // PRESS ANY KEY
; Wait for a keypress.
*$A574 CALL $A58C    ; {do <% keyscan_all(); %> while (!Z); // down press
 $A577 JR NZ,$A574   ; }
*$A579 CALL $A58C    ; {do <% keyscan_all(); %> while (Z); // up press
 $A57C JR Z,$A579    ; }
 $A57E POP AF
; Reset the game, or send the hero to solitary.
 $A57F CP $FF        ; {if (A == 0xFF || A >= escapeitem_UNIFORM) <% reset_game(); return; %> // exit via
 $A581 JP Z,$B75A    ;
 $A584 CP $08        ;
 $A586 JP NC,$B75A   ; }
 $A589 JP $CB98      ; solitary(); return; // exit via

; Key scan of all ports.
;
; Used by the routine at #R$A51C.
;
; O:A Pressed key.
@label=keyscan_all
c$A58C LD BC,$FEFE   ; BC = $FEFE;
*$A58F IN A,(C)      ; do <%
 $A591 CPL           ; {  A = ~A & 0x1F;
 $A592 AND $1F       ; }
 $A594 RET NZ        ;   if (A) return;
 $A595 RLC B         ;   RLC B
 $A597 JP C,$A58F    ; %> while (carry);
 $A59A XOR A         ; A = 0;
 $A59B RET           ; return;

; Call item_to_escapeitem then merge result with a previous escapeitem.
;
; Used by the routine at #R$A51C.
;
; I:C  Previous return value.
; I:HL Pointer to (single) item slot.
; O:C  Previous return value + escapeitem_ flag.
@label=join_item_to_escapeitem
c$A59C LD A,(HL)     ; A = *HL;
 $A59D CALL $A5A3    ; item_to_escapeitem();
 $A5A0 ADD A,C       ; {C += A;
 $A5A1 LD C,A        ; }
 $A5A2 RET           ; return;

; Return a bitmask indicating the presence of items required for escape.
;
; Used by the routine at #R$A59C.
;
; I:A Item.
; O:A Bitfield.
@label=item_to_escapeitem
c$A5A3 CP $0F        ; {if (A == item_COMPASS) <% A = escapeitem_COMPASS; return;
 $A5A5 JR NZ,$A5AA   ; %>
 $A5A7 LD A,$01      ;
 $A5A9 RET           ; }
*$A5AA CP $03        ; {if (A == item_PAPERS)  <% A = escapeitem_PAPERS; return;
 $A5AC JR NZ,$A5B1   ; %>
 $A5AE LD A,$02      ;
 $A5B0 RET           ; }
*$A5B1 CP $0E        ; {if (A == item_PURSE)   <% A = escapeitem_PURSE; return;
 $A5B3 JR NZ,$A5B8   ; %>
 $A5B5 LD A,$04      ;
 $A5B7 RET           ; }
*$A5B8 CP $06        ; {if (A == item_UNIFORM) <% A = escapeitem_UNIFORM; return;
 $A5BA LD A,$08      ; %>
 $A5BC RET Z         ; }
 $A5BD XOR A         ; A = 0; // have no required objects
 $A5BE RET           ; return;

; Plot a screenlocstring.
;
; Used by the routines at #R$A51C, #R$EFFC and #R$F1E0.
;
; I:HL Pointer to screenlocstring.
; O:HL Pointer to byte after screenlocstring.
@label=screenlocstring_plot
c$A5BF LD E,(HL)     ; {E = *HL++; // read screen address into DE
 $A5C0 INC HL        ; }
 $A5C1 LD D,(HL)     ; {D = *HL++;
 $A5C2 INC HL        ; }
 $A5C3 LD B,(HL)     ; {B = *HL++; // iterations / nbytes
 $A5C4 INC HL        ; }
*$A5C5 PUSH BC       ; do <%
 $A5C6 CALL $7D2F    ;   plot_glyph();
 $A5C9 INC HL        ;   HL++;
 $A5CA POP BC
 $A5CB DJNZ $A5C5    ; %> while (--B);
 $A5CD RET           ; return;

; Escape messages.
@label=escape_strings
t$A5CE DEFB $6E,$40,$09,$1F,$0E,$15,$15,$23,$0D,$00,$17,$0E                                                 ; "WELL DONE"  [/ #HTML[#CALL:decode_screenlocstring($A5CE)]]
 $A5DA DEFB $AA,$40,$10,$21,$00,$1D,$23,$11,$0A,$1E,$0E,$23,$0E,$1B,$0C,$0A,$18,$0E,$0D                     ; "YOU HAVE ESCAPED"  #HTML[/ #CALL:decode_screenlocstring($A5DA)]
 $A5ED DEFB $CC,$40,$0D,$0F,$1A,$00,$16,$23,$1C,$11,$0E,$23,$0C,$0A,$16,$18                                 ; "FROM THE CAMP"  #HTML[/ #CALL:decode_screenlocstring($A5ED)]
 $A5FD DEFB $09,$48,$12,$0A,$17,$0D,$23,$1F,$12,$15,$15,$23,$0C,$1A,$00,$1B,$1B,$23,$1C,$11,$0E             ; "AND WILL CROSS THE"  #HTML[/ #CALL:decode_screenlocstring($A5FD)]
 $A612 DEFB $29,$48,$13,$0B,$00,$1A,$0D,$0E,$1A,$23,$1B,$1D,$0C,$0C,$0E,$1B,$1B,$0F,$1D,$15,$15,$21         ; "BORDER SUCCESSFULLY"  #HTML[/ #CALL:decode_screenlocstring($A612)]
 $A628 DEFB $09,$48,$13,$0B,$1D,$1C,$23,$1F,$0E,$1A,$0E,$23,$1A,$0E,$0C,$0A,$18,$1C,$1D,$1A,$0E,$0D         ; "BUT WERE RECAPTURED"  #HTML[/ #CALL:decode_screenlocstring($A628)]
 $A63E DEFB $2A,$48,$11,$0A,$17,$0D,$23,$1B,$11,$00,$1C,$23,$0A,$1B,$23,$0A,$23,$1B,$18,$21                 ; "AND SHOT AS A SPY"  #HTML[/ #CALL:decode_screenlocstring($A63E)]
 $A652 DEFB $29,$48,$12,$1C,$00,$1C,$0A,$15,$15,$21,$23,$1D,$17,$18,$1A,$0E,$18,$0A,$1A,$0E,$0D             ; "TOTALLY UNPREPARED"  #HTML[/ #CALL:decode_screenlocstring($A652)]
 $A667 DEFB $2C,$48,$0C,$1C,$00,$1C,$0A,$15,$15,$21,$23,$15,$00,$1B,$1C                                     ; "TOTALLY LOST"  #HTML[/ #CALL:decode_screenlocstring($A667)]
 $A676 DEFB $28,$48,$15,$0D,$1D,$0E,$23,$1C,$00,$23,$15,$0A,$0C,$14,$23,$00,$0F,$23,$18,$0A,$18,$0E,$1A,$1B ; "DUE TO LACK OF PAPERS"  #HTML[/ #CALL:decode_screenlocstring($A676)]
 $A68E DEFB $0D,$50,$0D,$18,$1A,$0E,$1B,$1B,$23,$0A,$17,$21,$23,$14,$0E,$21                                 ; "PRESS ANY KEY"  #HTML[/ #CALL:decode_screenlocstring($A68E)]

; Bitmap font definition.
;
; 0..9, A..Z (omitting O), space, full stop
; .
; #UDGTABLE
; { #FONT$A69E,35,7,2{0,0,560,16}(font) }
; TABLE#
@label=bitmap_font
b$A69E DEFB $00,$7C,$FE,$EE,$EE,$EE,$FE,$7C ; 0
 $A6A6 DEFB $00,$1E,$3E,$6E,$0E,$0E,$0E,$0E ; 1
 $A6AE DEFB $00,$7C,$FE,$CE,$1C,$70,$FE,$FE ; 2
 $A6B6 DEFB $00,$FC,$FE,$0E,$3C,$0E,$FE,$FC ; 3
 $A6BE DEFB $00,$0E,$1E,$3E,$6E,$FE,$0E,$0E ; 4
 $A6C6 DEFB $00,$FC,$C0,$FC,$7E,$0E,$FE,$FC ; 5
 $A6CE DEFB $00,$38,$60,$FC,$FE,$C6,$FE,$7C ; 6
 $A6D6 DEFB $00,$FE,$0E,$0E,$1C,$1C,$38,$38 ; 7
 $A6DE DEFB $00,$7C,$EE,$EE,$7C,$EE,$EE,$7C ; 8
 $A6E6 DEFB $00,$7C,$FE,$C6,$FE,$7E,$0C,$38 ; 9
 $A6EE DEFB $00,$38,$7C,$7C,$EE,$EE,$FE,$EE ; A
 $A6F6 DEFB $00,$FC,$EE,$EE,$FC,$EE,$EE,$FC ; B
 $A6FE DEFB $00,$1E,$7E,$FE,$F0,$FE,$7E,$1E ; C
 $A706 DEFB $00,$F0,$FC,$EE,$EE,$EE,$FC,$F0 ; D
 $A70E DEFB $00,$FE,$FE,$E0,$FE,$E0,$FE,$FE ; E
 $A716 DEFB $00,$FE,$FE,$E0,$FC,$E0,$E0,$E0 ; F
 $A71E DEFB $00,$1E,$7E,$F0,$EE,$F2,$7E,$1E ; G
 $A726 DEFB $00,$EE,$EE,$EE,$FE,$EE,$EE,$EE ; H
 $A72E DEFB $00,$38,$38,$38,$38,$38,$38,$38 ; I
 $A736 DEFB $00,$FE,$38,$38,$38,$38,$F8,$F0 ; J
 $A73E DEFB $00,$EE,$EE,$FC,$F8,$FC,$EE,$EE ; K
 $A746 DEFB $00,$E0,$E0,$E0,$E0,$E0,$FE,$FE ; L
 $A74E DEFB $00,$6C,$FE,$FE,$D6,$D6,$C6,$C6 ; M
 $A756 DEFB $00,$E6,$F6,$FE,$FE,$EE,$E6,$E6 ; N
 $A75E DEFB $00,$FC,$EE,$EE,$EE,$FC,$E0,$E0 ; P
 $A766 DEFB $00,$7C,$FE,$EE,$EE,$EE,$FC,$7E ; Q
 $A76E DEFB $00,$FC,$EE,$EE,$FC,$F8,$EC,$EE ; R
 $A776 DEFB $00,$7E,$FE,$F0,$7C,$1E,$FE,$FC ; S
 $A77E DEFB $00,$FE,$FE,$38,$38,$38,$38,$38 ; T
 $A786 DEFB $00,$EE,$EE,$EE,$EE,$EE,$FE,$7C ; U
 $A78E DEFB $00,$EE,$EE,$EE,$EE,$6C,$7C,$38 ; V
 $A796 DEFB $00,$C6,$C6,$C6,$D6,$FE,$EE,$C6 ; W
 $A79E DEFB $00,$C6,$EE,$7C,$38,$7C,$EE,$C6 ; X
 $A7A6 DEFB $00,$C6,$EE,$7C,$38,$38,$38,$38 ; Y
 $A7AE DEFB $00,$FE,$FE,$0E,$38,$E0,$FE,$FE ; Z
 $A7B6 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; SPACE
 $A7BE DEFB $00,$00,$00,$00,$00,$00,$30,$30 ; FULL STOP

; An index used only by move_map().
@label=move_map_y
g$A7C6 DEFB $00      ; move_map_y

; Game window plotting offset.
@label=game_window_offset
g$A7C7 DEFW $0000    ; game_window_offset

; Get supertiles.
;
; Used by the routines at #R$A9E4, #R$AA05, #R$AA26, #R$AA4B, #R$AA6C, #R$AA8D
; and #R$B2FC.
; .
; Uses map_position to copy supertile indices from map into the buffer at
; $FF58.
;
; .
;
; Get vertical offset.
@label=get_supertiles
c$A7C9 LD A,($81BC)  ; {A = (map_position >> 8) & 0xFC; // A = 0, 4, 8, 12, ...
 $A7CC AND $FC       ; }
; Multiply A by 13.5. (A is a multiple of 4, so this goes 0, 54, 108, 162, ...)
 $A7CE LD L,A        ; {HL = &map_tiles[-54] + (A + (A >> 1)) * 9; // must be skipping the first row.
 $A7CF LD H,$00      ;
 $A7D1 RRA           ;
 $A7D2 AND $7F       ;
 $A7D4 ADD A,L       ;
 $A7D5 LD L,A        ;
 $A7D6 JR NC,$A7D9   ;
 $A7D8 INC H         ;
*$A7D9 LD E,L        ;
 $A7DA LD D,H        ;
 $A7DB ADD HL,HL     ;
 $A7DC ADD HL,HL     ;
 $A7DD ADD HL,HL     ;
 $A7DE ADD HL,DE     ;
 $A7DF LD DE,$BCB8   ;
 $A7E2 ADD HL,DE     ; }
; Add horizontal offset.
 $A7E3 LD A,($81BB)  ; {HL += (map_position & 0xFF) >> 2;
 $A7E6 RRA           ;
 $A7E7 RRA           ;
 $A7E8 AND $3F       ;
 $A7EA LD E,A        ;
 $A7EB LD D,$00      ;
 $A7ED ADD HL,DE     ; }
; Populate map_buf with 7x5 array of supertile refs.
 $A7EE LD A,$05      ; A = 5; // 5 iterations
 $A7F0 LD DE,$FF58   ; DE = &map_buf[0];
*$A7F3 LDI           ; {do <% memcpy(DE, HL, 7); DE += 7;
 $A7F5 LDI           ;
 $A7F7 LDI           ;
 $A7F9 LDI           ;
 $A7FB LDI           ;
 $A7FD LDI           ;
 $A7FF LDI           ; }
 $A801 LD BC,$002F   ; {  HL += 54; // stride - width of map
 $A804 ADD HL,BC     ; }
 $A805 DEC A         ; {%> while (--A);
 $A806 JP NZ,$A7F3   ; }
 $A809 RET           ; return;

; Plot the complete bottommost row of tiles.
;
; Used by the routines at #R$AA26 and #R$AA4B.
@label=plot_bottommost_tiles
@nowarn
c$A80A LD DE,$F278   ; DE = &tile_buf[24 * 16];
 $A80D EXX
@nowarn
 $A80E LD HL,$FF74   ; HLdash = &map_buf[28];
 $A811 LD A,($81BC)  ; A = map_position >> 8; // map_position hi
@nowarn
 $A814 LD DE,$FE90   ; DEdash = &window_buf[24 * 16 * 8];
 $A817 JR $A826      ; goto plot_horizontal_tiles_common;

; Plot the complete topmost row of tiles.
;
; Used by the routines at #R$AA6C and #R$AA8D.
@label=plot_topmost_tiles
c$A819 LD DE,$F0F8   ; DE = &state->tile_buf[0];
 $A81C EXX
 $A81D LD HL,$FF58   ; HLdash = &state->map_buf[0];
 $A820 LD A,($81BC)  ; A = map_position >> 8; // map_position hi
 $A823 LD DE,$F290   ; DEdash = &state->window_buf[0];

; Plotting supertiles.
;
; Used by the routine at #R$A80A.
@label=plot_horizontal_tiles_common
c$A826 AND $03       ; {A = (A & 3) * 4;
 $A828 ADD A,A       ;
 $A829 ADD A,A       ; }
 $A82A LD ($A86A),A  ; ($A86A) = A; // self modify
 $A82D LD C,A        ; Cdash = A;
 $A82E LD A,($81BB)  ; {A = (map_position[0] & 3) + Cdash;
 $A831 AND $03       ;
 $A833 ADD A,C       ; }
 $A834 EX AF,AF'
 $A835 LD A,(HL)     ; Adash = *HLdash;
 $A836 EXX
; Initial edge.
 $A837 LD L,A        ; {HL = &super_tiles[0] + Adash * 16;
 $A838 LD H,$00      ;
 $A83A ADD HL,HL     ;
 $A83B ADD HL,HL     ;
 $A83C ADD HL,HL     ;
 $A83D ADD HL,HL     ;
 $A83E LD A,$5B      ;
 $A840 ADD A,H       ;
 $A841 LD H,A        ; }
 $A842 EX AF,AF'
 $A843 ADD A,L       ; A += L;
 $A844 LD L,A        ; L = A;
 $A845 NEG           ; {A = -A & 3;
 $A847 AND $03       ; }
 $A849 JR NZ,$A84D   ; {if (A == 0) A = 4;
 $A84B LD A,$04      ; }
*$A84D LD B,A        ; B = A; // 1..4 iterations
*$A84E LD A,(HL)     ; do <% A = *HL; // A = tile index
 $A84F LD (DE),A     ;   *DE = A;
 $A850 CALL $A9AD    ;   plot_tile();
 $A853 INC L         ;   HL++;
 $A854 INC DE        ;   DE++;
 $A855 DJNZ $A84E    ; %> while (--B);
 $A857 EXX
 $A858 INC HL        ; HLdash++;
; Middle loop.
 $A859 LD B,$05      ; Bdash = 5; // 5 iterations
*$A85B PUSH BC       ; do <% PUSH BCdash
 $A85C LD A,(HL)     ;   A = *HLdash;
 $A85D EXX
 $A85E LD L,A        ; {  HL = &super_tiles[A];
 $A85F LD H,$00      ;
 $A861 ADD HL,HL     ;
 $A862 ADD HL,HL     ;
 $A863 ADD HL,HL     ;
 $A864 ADD HL,HL     ;
 $A865 LD BC,$5B00   ;
 $A868 ADD HL,BC     ; }
 $A869 LD A,$00      ;   A = 0; // self modified by $A82A
 $A86B ADD A,L       ; {  L += A;
 $A86C LD L,A        ; }
 $A86D LD B,$04      ;   B = 4; // 4 iterations
*$A86F LD A,(HL)     ;   do <% A = *HL;
 $A870 LD (DE),A     ;     *DE = A;
 $A871 CALL $A9AD    ;     plot_tile();
 $A874 INC HL        ;     HL++;
 $A875 INC DE        ;     DE++;
 $A876 DJNZ $A86F    ;   %> while (--B);
 $A878 EXX
 $A879 INC HL        ;   HLdash++;
 $A87A POP BC        ;   POP BCdash
 $A87B DJNZ $A85B    ; %> while (--Bdash);
; Trailing edge.
 $A87D LD A,C        ; A = Cdash; // assigned but never used?
 $A87E EX AF,AF'     ; // unpaired?
 $A87F LD A,(HL)     ; A = *HLdash;
 $A880 EXX
 $A881 LD L,A        ; {HL = &super_tiles[A];
 $A882 LD H,$00      ;
 $A884 ADD HL,HL     ;
 $A885 ADD HL,HL     ;
 $A886 ADD HL,HL     ;
 $A887 ADD HL,HL     ;
 $A888 LD BC,$5B00   ;
 $A88B ADD HL,BC     ; }
 $A88C LD A,($A86A)  ; A = ($A86A); // read self modified
 $A88F ADD A,L       ; {L += A;
 $A890 LD L,A        ; }
 $A891 LD A,($81BB)  ; {A = map_position[0] & 3; // map_position lo
 $A894 AND $03       ; }
 $A896 RET Z         ; if (A == 0) return;
 $A897 LD B,A        ; B = A;
*$A898 LD A,(HL)     ; do <% A = *HL;
 $A899 LD (DE),A     ;   *DE = A;
 $A89A CALL $A9AD    ;   plot_tile();
 $A89D INC L         ;   HL++;
 $A89E INC DE        ;   DE++;
 $A89F DJNZ $A898    ; %> while (--B);
 $A8A1 RET           ; return;

; Plot all tiles.
;
; Used by the routines at #R$7B36 and #R$B2FC.
; .
; Note: Exits with banked registers active.
@label=plot_all_tiles
c$A8A2 LD DE,$F0F8   ; DE = &tile_buf[0]; // visible tiles array
 $A8A5 EXX
 $A8A6 LD HL,$FF58   ; HLdash = &map_buf[0]; // 7x5 supertile refs
 $A8A9 LD DE,$F290   ; DEdash = &window_buf[0]; // screen buffer start address
 $A8AC LD A,($81BB)  ; A = map_position[0];
 $A8AF LD B,$18      ; Bdash = 24; // 24 iterations (screen rows?)
*$A8B1 PUSH BC       ; do <% PUSH BCdash
 $A8B2 PUSH DE       ;   PUSH DEdash
 $A8B3 PUSH HL       ;   PUSH HLdash
 $A8B4 PUSH AF       ;   PUSH AFdash
 $A8B5 EXX
 $A8B6 PUSH DE
 $A8B7 EXX
 $A8B8 CALL $A8F4    ;   plot_vertical_tiles_common();
 $A8BB EXX
 $A8BC POP DE
 $A8BD INC DE        ;   DE++;
 $A8BE EXX
 $A8BF POP AF
 $A8C0 POP HL        ;   POP HLdash
 $A8C1 INC A         ; {  Cdash = ++A;
 $A8C2 LD C,A        ; }
 $A8C3 AND $03       ; {  if ((A & 3) == 0) HLdash++;
 $A8C5 JR NZ,$A8C8   ;
 $A8C7 INC HL        ; }
*$A8C8 LD A,C        ;   A = Cdash;
 $A8C9 POP DE        ;   POP DEdash
 $A8CA INC DE        ;   DEdash++;
 $A8CB POP BC        ;   POP BCdash
 $A8CC DJNZ $A8B1    ; %> while (--Bdash);
 $A8CE RET           ; return;

; Plot the complete rightmost column of tiles.
;
; Used by the routines at #R$A9E4 and #R$AA8D.
@label=plot_rightmost_tiles
@nowarn
c$A8CF LD DE,$F10F   ; DE = &tile_buf[23];
 $A8D2 EXX           ; // unpaired
 $A8D3 LD HL,$FF5E   ; HL = &map_buf[6];
 $A8D6 LD DE,$F2A7   ; DE = &window_buf[23];
 $A8D9 LD A,($81BB)  ; {A = map_position[0] & 3; // map_position lo
 $A8DC AND $03       ; }
 $A8DE JR NZ,$A8E1   ; {if (A == 0) HL--;
 $A8E0 DEC HL        ; }
*$A8E1 LD A,($81BB)  ; {A = map_position[0] - 1; // map_position lo
 $A8E4 DEC A         ; }
 $A8E5 JR $A8F4      ; goto plot_vertical_tiles_common;

; Plot the complete leftmost column of tiles.
;
; Used by the routines at #R$AA05 and #R$AA26.
@label=plot_leftmost_tiles
c$A8E7 LD DE,$F0F8   ; DE = &tile_buf[0]; // visible tiles array
 $A8EA EXX
 $A8EB LD HL,$FF58   ; HLdash = &map_buf[0]; // 7x5 supertile refs
 $A8EE LD DE,$F290   ; DEdash = &window_buf[0]; // screen buffer start address
 $A8F1 LD A,($81BB)  ; A = map_position[0]; // map_position lo

; Plotting vertical tiles (common part).
;
; Used by the routines at #R$A8A2 and #R$A8CF.
@label=plot_vertical_tiles_common
c$A8F4 AND $03       ; A &= 3;
 $A8F6 LD ($A94D),A  ; ($A94C + 1) = A; // self modify
 $A8F9 LD C,A        ; Cdash = A;
 $A8FA LD A,($81BC)  ; {A = ((map_position >> 8) & 3) * 4 + Cdash;
 $A8FD AND $03       ;
 $A8FF ADD A,A       ;
 $A900 ADD A,A       ;
 $A901 ADD A,C       ; }
 $A902 EX AF,AF'
; Initial edge.
 $A903 LD A,(HL)     ; Adash = *HLdash;
 $A904 EXX
 $A905 LD L,A        ; {HL = &super_tiles[0] + Adash * 16; // supertiles
 $A906 LD H,$00      ;
 $A908 ADD HL,HL     ;
 $A909 ADD HL,HL     ;
 $A90A ADD HL,HL     ;
 $A90B ADD HL,HL     ;
 $A90C LD A,$5B      ;
 $A90E ADD A,H       ;
 $A90F LD H,A        ; }
 $A910 EX AF,AF'
 $A911 ADD A,L       ; A += L;
 $A912 LD L,A        ; L = A;
 $A913 RRA           ; RRA
 $A914 RRA           ; RRA
 $A915 AND $03       ; {A = -(A & 3) & 3;
 $A917 NEG           ;
 $A919 AND $03       ; }
 $A91B JR NZ,$A91F   ; {if (A == 0) A = 4;
 $A91D LD A,$04      ; }
*$A91F EX DE,HL
 $A920 LD BC,$0018   ; BC = 24; // 24 iterations (screen rows?)
*$A923 PUSH AF       ; do <%
 $A924 LD A,(DE)     ;   A = *DE;
 $A925 LD (HL),A     ;   *HL = A;
 $A926 CALL $A9A0    ;   plot_tile_then_advance();
 $A929 LD A,$04      ; {  DE += 4; // stride
 $A92B ADD A,E       ;
 $A92C LD E,A        ; }
 $A92D ADD HL,BC     ;   HL += BC;
 $A92E POP AF
 $A92F DEC A         ; {%> while (--A);
 $A930 JP NZ,$A923   ; }
 $A933 EX DE,HL
 $A934 EXX
 $A935 LD A,L        ; {HL += 7;
 $A936 ADD A,$07     ;
 $A938 LD L,A        ;
 $A939 JR NC,$A93C   ;
 $A93B INC H         ; }
; Middle loop.
*$A93C LD B,$03      ; B = 3; // 3 iterations
*$A93E PUSH BC       ; do <%
 $A93F LD A,(HL)     ;   A = *HL;
 $A940 EXX
 $A941 LD L,A        ; {  HL = &super_tiles[0] + A * 16; // supertiles
 $A942 LD H,$00      ;
 $A944 ADD HL,HL     ;
 $A945 ADD HL,HL     ;
 $A946 ADD HL,HL     ;
 $A947 ADD HL,HL     ;
 $A948 LD BC,$5B00   ;
 $A94B ADD HL,BC     ; }
@label=supertile_plot_vertical_common_iters
 $A94C LD A,$00      ;   A = 0; // self modified by $A8F6
 $A94E ADD A,L       ;   A += L;
 $A94F LD L,A        ;   L = A;
 $A950 LD BC,$0018   ;   BC = 24; // stride
 $A953 EX DE,HL
 $A954 LD A,$04      ;   A = 4;
*$A956 PUSH AF       ;   do <%
 $A957 LD A,(DE)     ;     A = *DE;
 $A958 LD (HL),A     ;     *HL = A;
 $A959 CALL $A9A0    ;     plot_tile_then_advance();
 $A95C ADD HL,BC     ;     HL += BC;
 $A95D LD A,$04      ; {    DE += 4; // stride
 $A95F ADD A,E       ;
 $A960 LD E,A        ; }
 $A961 POP AF
 $A962 DEC A         ; {  %> while (--A);
 $A963 JP NZ,$A956   ; }
 $A966 EX DE,HL
 $A967 EXX
 $A968 LD A,L        ; {  HL += 7;
 $A969 ADD A,$07     ;
 $A96B LD L,A        ;
 $A96C JR NC,$A96F   ;
 $A96E INC H         ; }
*$A96F POP BC
 $A970 DJNZ $A93E    ; %> while (--B);
; Trailing edge.
 $A972 LD A,(HL)     ; A = *HL;
 $A973 EXX
 $A974 LD L,A        ; {HL = &super_tiles[0] + A * 16; // supertiles
 $A975 LD H,$00      ;
 $A977 ADD HL,HL     ;
 $A978 ADD HL,HL     ;
 $A979 ADD HL,HL     ;
 $A97A ADD HL,HL     ;
 $A97B LD BC,$5B00   ;
 $A97E ADD HL,BC     ; }
 $A97F LD A,($A94D)  ; {HL += ($A94C + 1); // read self modified
 $A982 ADD A,L       ;
 $A983 LD L,A        ; }
 $A984 LD A,($81BC)  ; {A = ((map_position >> 8) & 3) + 1;
 $A987 AND $03       ;
 $A989 INC A         ; }
 $A98A LD BC,$0018   ; BC = 24;
 $A98D EX DE,HL
*$A98E PUSH AF       ; do <%
 $A98F LD A,(DE)     ;   A = *DE;
 $A990 LD (HL),A     ;   *HL = A;
 $A991 CALL $A9A0    ;   plot_tile_then_advance();
 $A994 LD A,$04      ;   A = 4;
 $A996 ADD A,E       ;   A += E;
 $A997 LD E,A        ;   E = A;
 $A998 ADD HL,BC     ;   HL += BC;
 $A999 POP AF
 $A99A DEC A         ; {%> while (--A);
 $A99B JP NZ,$A98E   ; }
 $A99E EX DE,HL
 $A99F RET           ; return;

; Call plot_tile then advance DE' by a row.
;
; Used by the routine at #R$A8F4.
@label=plot_tile_then_advance
c$A9A0 CALL $A9AD    ; plot_tile();
 $A9A3 EXX
 $A9A4 LD A,E        ; {DEdash += 0xBF;
 $A9A5 ADD A,$BF     ;
 $A9A7 LD E,A        ;
 $A9A8 JR NC,$A9AB   ;
 $A9AA INC D         ; }
*$A9AB EXX
 $A9AC RET           ; return;

; Plot a tile then increment DE' by 1.
;
; Used by the routines at #R$A826 and #R$A9A0.
;
; I:A Tile index
; I:DE' Output buffer start address.
; I:HL' Pointer to supertile index (used to select the correct tile group).
@label=plot_tile
c$A9AD EXX
 $A9AE EX AF,AF'
 $A9AF LD A,(HL)     ; Adash = *HLdash; // get supertile index
 $A9B0 LD BC,$8590   ; BCdash = &exterior_tiles[0];
 $A9B3 CP $2D        ; {if (Adash < 45) goto chosen;
 $A9B5 JR C,$A9C5    ; }
 $A9B7 LD BC,$8A18   ; BCdash = &exterior_tiles[145]; // set 2
 $A9BA CP $8B        ; {if (Adash < 139 || Adash >= 204) goto chosen;
 $A9BC JR C,$A9C5    ;
 $A9BE CP $CC        ;
 $A9C0 JR NC,$A9C5   ; }
 $A9C2 LD BC,$90F8   ; BCdash = &exterior_tiles[145 + 220]; // set 3
@label=plot_tile_chosen
*$A9C5 PUSH HL       ; chosen: PUSH HLdash;
 $A9C6 EX AF,AF'
 $A9C7 LD L,A        ; {HLdash = A * 8 + BCdash;
 $A9C8 LD H,$00      ;
 $A9CA ADD HL,HL     ;
 $A9CB ADD HL,HL     ;
 $A9CC ADD HL,HL     ;
 $A9CD ADD HL,BC     ; }
 $A9CE PUSH DE       ; PUSH DEdash;
 $A9CF EX DE,HL      ; EX DEdash,HLdash;
 $A9D0 LD BC,$0018   ; BCdash = 24;
 $A9D3 LD A,$08      ; A = 8; // 8 iterations
@label=plot_tile_loop
*$A9D5 EX AF,AF'     ; do <%
 $A9D6 LD A,(DE)     ;   Adash = *DEdash;
 $A9D7 LD (HL),A     ;   *HLdash = Adash;
 $A9D8 ADD HL,BC     ;   HLdash += BCdash; // stride
 $A9D9 INC E         ;   E++;
 $A9DA EX AF,AF'
 $A9DB DEC A         ;   A--;
 $A9DC JP NZ,$A9D5   ; %> while (A);
 $A9DF POP DE        ; POP DEdash;
 $A9E0 INC DE        ; DEdash++;
 $A9E1 POP HL        ; POP HLdash;
 $A9E2 EXX
 $A9E3 RET           ; return;

; Shunt the map left.
;
; Used by the routine at #R$AAB2.
@label=shunt_map_left
c$A9E4 LD HL,$81BB   ; HL = &map_position;
 $A9E7 INC (HL)      ; (*HL)++;
 $A9E8 CALL $A7C9    ; get_supertiles();
 $A9EB LD HL,$F0F9   ; HL = &tile_buf[1];
 $A9EE LD DE,$F0F8   ; DE = &tile_buf[0];
 $A9F1 LD BC,$0197   ; BC = tile_buf_length - 1;
 $A9F4 LDIR
@nowarn
 $A9F6 LD HL,$F291   ; HL = &window_buf[1];
 $A9F9 LD DE,$F290   ; DE = &window_buf[0];
 $A9FC LD BC,$0CBF   ; BC = window_buf_length - 1;
 $A9FF LDIR
 $AA01 CALL $A8CF    ; plot_rightmost_tiles();
 $AA04 RET           ; return;

; Shunt the map right.
;
; Used by the routine at #R$AAB2.
@label=shunt_map_right
c$AA05 LD HL,$81BB   ; HL = &map_position;
 $AA08 DEC (HL)      ; (*HL)--;
 $AA09 CALL $A7C9    ; get_supertiles();
@nowarn
 $AA0C LD HL,$F28E   ; HL = &tile_buf[0];
 $AA0F LD DE,$F28F   ; DE = &tile_buf[1];
 $AA12 LD BC,$0197   ; BC = tile_buf_length - 1;
 $AA15 LDDR
 $AA17 LD HL,$FF4F   ; HL = &window_buf[0];
 $AA1A LD DE,$FF50   ; DE = &window_buf[1];
 $AA1D LD BC,$0CC0   ; BC = window_buf_length; // Bug: One byte too long.
 $AA20 LDDR
 $AA22 CALL $A8E7    ; plot_leftmost_tiles();
 $AA25 RET           ; return;

; Shunt the map up-right.
;
; Used by the routine at #R$AAB2.
@label=shunt_map_up_right
c$AA26 DEC L         ; L--;
 $AA27 INC H         ; H++;
 $AA28 LD ($81BB),HL ; map_position = HL;
 $AA2B CALL $A7C9    ; get_supertiles();
 $AA2E LD HL,$F110   ; HL = &tile_buf[24];
 $AA31 LD DE,$F0F9   ; DE = &tile_buf[1];
 $AA34 LD BC,$0180   ; BC = tile_buf_length - 24;
 $AA37 LDIR
@nowarn
 $AA39 LD HL,$F350   ; HL = &window_buf[24 * 8];
@nowarn
 $AA3C LD DE,$F291   ; DE = &window_buf[1];
 $AA3F LD BC,$0C00   ; BC = window_buf_length - 24 * 8;
 $AA42 LDIR
 $AA44 CALL $A80A    ; plot_bottommost_tiles();
 $AA47 CALL $A8E7    ; plot_leftmost_tiles();
 $AA4A RET           ; return;

; Shunt the map up.
;
; Used by the routine at #R$AAB2.
@label=shunt_map_up
c$AA4B LD HL,$81BC   ; HL = &map_position[1];
 $AA4E INC (HL)      ; (*HL)++;
 $AA4F CALL $A7C9    ; get_supertiles();
 $AA52 LD HL,$F110   ; HL = &tile_buf[24];
 $AA55 LD DE,$F0F8   ; DE = &tile_buf[0];
 $AA58 LD BC,$0180   ; BC = tile_buf_length - 24;
 $AA5B LDIR
@nowarn
 $AA5D LD HL,$F350   ; HL = &window_buf[24 * 8];
 $AA60 LD DE,$F290   ; DE = &window_buf[0];
 $AA63 LD BC,$0C00   ; BC = window_buf_length - 24 * 8;
 $AA66 LDIR
 $AA68 CALL $A80A    ; plot_bottommost_tiles();
 $AA6B RET           ; return;

; Shunt the map down.
;
; Used by the routine at #R$AAB2.
@label=shunt_map_down
c$AA6C LD HL,$81BC   ; HL = &map_position[1];
 $AA6F DEC (HL)      ; (*HL)--;
 $AA70 CALL $A7C9    ; get_supertiles();
@nowarn
 $AA73 LD HL,$F277   ; HL = &tile_buf[0];
 $AA76 LD DE,$F28F   ; DE = &tile_buf[24];
 $AA79 LD BC,$0180   ; BC = tile_buf_length - 24;
 $AA7C LDDR
 $AA7E LD HL,$FE8F   ; HL = &window_buf[0];
 $AA81 LD DE,$FF4F   ; DE = &window_buf[24 * 8];
 $AA84 LD BC,$0C00   ; BC = window_buf_length - 24 * 8;
 $AA87 LDDR
 $AA89 CALL $A819    ; plot_topmost_tiles();
 $AA8C RET           ; return;

; Shunt the map down left.
;
; Used by the routine at #R$AAB2.
@label=shunt_map_down_left
c$AA8D INC L         ; L++;
 $AA8E DEC H         ; H--;
 $AA8F LD ($81BB),HL ; map_position = HL;
 $AA92 CALL $A7C9    ; get_supertiles();
@nowarn
 $AA95 LD HL,$F277   ; HL = &tile_buf[1];
@nowarn
 $AA98 LD DE,$F28E   ; DE = &tile_buf[24];
 $AA9B LD BC,$017F   ; BC = tile_buf_length - 24 - 1;
 $AA9E LDDR
 $AAA0 LD HL,$FE8F   ; HL = &window_buf[1];
 $AAA3 LD DE,$FF4E   ; DE = &window_buf[24 * 8];
 $AAA6 LD BC,$0BFF   ; BC = window_buf_length - 24 * 8 - 1;
 $AAA9 LDDR
 $AAAB CALL $A819    ; plot_topmost_tiles();
 $AAAE CALL $A8CF    ; plot_rightmost_tiles();
 $AAB1 RET           ; return;

; Moves the map when the hero walks.
;
; Used by the routines at #R$6939 and #R$9D7B.
;
; O:HL == map_position
@label=move_map
c$AAB2 LD A,($68A0)  ; {if (room_index) return; // Can't move the map when indoors.
 $AAB5 AND A         ;
 $AAB6 RET NZ        ; }
 $AAB7 LD HL,$8007   ; {if ($8007 & vischar_BYTE7_TOUCHING) return; // don't move the map if touch() is entered?
 $AABA BIT 6,(HL)    ;
 $AABC RET NZ        ; }
 $AABD LD HL,$800A   ; HL = $800A;
 $AAC0 LD E,(HL)     ; {E = *HL++;
 $AAC1 INC L         ; }
 $AAC2 LD D,(HL)     ; {D = *HL++;
 $AAC3 INC L         ; }
 $AAC4 LD C,(HL)     ; C = *HL; // $800C
 $AAC5 INC DE        ; {DE += 3;
 $AAC6 INC DE        ;
 $AAC7 INC DE        ; }
 $AAC8 LD A,(DE)     ; A = *DE;
 $AAC9 CP $FF        ; {if (A == 255) return; // don't move
 $AACB RET Z         ; }
 $AACC BIT 7,C       ; {if (C & vischar_ANIMINDEX_BIT7) A ^= 2; // exchange up and down
 $AACE JR Z,$AAD2    ;
 $AAD0 XOR $02       ; }
*$AAD2 PUSH AF
 $AAD3 ADD A,A       ; {HL = &move_map_jump_table[A];
 $AAD4 LD C,A        ;
 $AAD5 LD B,$00      ;
@nowarn
 $AAD7 LD HL,$AB31   ;
 $AADA ADD HL,BC     ; }
 $AADB LD A,(HL)     ; {A = *HL++; // ie. HL = (word at HL); HL += 2;
 $AADC INC HL        ; }
 $AADD LD H,(HL)     ; H = *HL;
 $AADE LD L,A        ; L = A;
 $AADF POP AF
 $AAE0 PUSH HL
 $AAE1 PUSH AF
@keep
 $AAE2 LD BC,$7C00   ; B, C = 0x7C, 0x00;
 $AAE5 CP $02        ; {if (A >= 2) B = 0x00; // bottom of the map clamp
 $AAE7 JR C,$AAEB    ;
 $AAE9 LD B,$00      ; }
*$AAEB CP $01        ; {if (A != 1 && A != 2) C = 0xC0; // left of the map clamp
 $AAED JR Z,$AAF5    ;
 $AAEF CP $02        ;
 $AAF1 JR Z,$AAF5    ;
 $AAF3 LD C,$C0      ; }
*$AAF5 LD HL,($81BB) ; HL = map_position;
 $AAF8 LD A,L        ; {if (L == C || H == B) <%
 $AAF9 CP C          ;
 $AAFA JR NZ,$AAFF   ; }
*$AAFC POP AF        ;   popret:
 $AAFD POP HL
 $AAFE RET           ; {  return; %>
*$AAFF LD A,H        ;
 $AB00 CP B          ;
 $AB01 JR Z,$AAFC    ; }
 $AB03 POP AF
 $AB04 LD HL,$A7C6   ; HL = &move_map_y; // screen offset of some sort?
 $AB07 CP $02        ; {if (A < 2) <%
 $AB09 JR NC,$AB0F   ; }
 $AB0B LD A,(HL)     ; {  A = *HL + 1; %>
 $AB0C INC A         ; }
 $AB0D JR $AB11      ; else <%
*$AB0F LD A,(HL)     ; {  A = *HL - 1; %>
 $AB10 DEC A         ; }
*$AB11 AND $03       ; A &= 3;
 $AB13 LD (HL),A     ; *HL = A;
 $AB14 EX DE,HL
 $AB15 LD HL,$0000   ; HL = 0x0000;
 $AB18 AND A         ; {if (A == 0) goto $AB2A;
 $AB19 JR Z,$AB2A    ; }
 $AB1B LD L,$60      ; L = 0x60;
 $AB1D CP $02        ; {if (A == 2) goto $AB2A;
 $AB1F JR Z,$AB2A    ; }
 $AB21 LD HL,$FF30   ; HL = 0xFF30;
 $AB24 CP $01        ; {if (A == 1) goto $AB2A;
 $AB26 JR Z,$AB2A    ; }
 $AB28 LD L,$90      ; L = 0x90;
*$AB2A LD ($A7C7),HL ; game_window_offset = HL;
 $AB2D LD HL,($81BB) ; HL = map_position;
 $AB30 RET           ; return; // pops and calls move_map_* routine pushed at $AAE0
; move_map jump table.
@label=move_map_jump_table
 $AB31 DEFW $AB39    ; move_map_up_left
 $AB33 DEFW $AB44    ; move_map_up_right
 $AB35 DEFW $AB4F    ; move_map_down_right
 $AB37 DEFW $AB5A    ; move_map_down_left
; Called when player moves down-right (map is shifted up-left).
@label=move_map_up_left
 $AB39 LD A,(DE)     ; A = *DE;
 $AB3A AND A         ; {if (A == 0) goto shunt_map_up;
 $AB3B JP Z,$AA4B    ; }
 $AB3E BIT 0,A       ; {if ((A & 1) == 0) return;
 $AB40 RET Z         ; }
 $AB41 JP $A9E4      ; goto shunt_map_left;
; Called when player moves down-left (map is shifted up-right).
@label=move_map_up_right
 $AB44 LD A,(DE)     ; A = *DE;
 $AB45 AND A         ; {if (A == 0) goto shunt_map_up_right;
 $AB46 JP Z,$AA26    ; }
 $AB49 CP $02        ; {if (A != 2) return;
 $AB4B RET NZ        ; }
 $AB4C JP $AA05      ; goto shunt_map_right;
; Called when player moves up-left (map is shifted down-right).
@label=move_map_down_right
 $AB4F LD A,(DE)     ; A = *DE;
 $AB50 CP $03        ; {if (A == 3) goto shunt_map_down;
 $AB52 JP Z,$AA6C    ; }
 $AB55 RRA           ; {if ((A & 1) == 0) goto shunt_map_right;
 $AB56 JP NC,$AA05   ; }
 $AB59 RET           ; return;
; Called when player moves up-right (map is shifted down-left).
@label=move_map_down_left
 $AB5A LD A,(DE)     ; A = *DE;
 $AB5B CP $01        ; {if (A == 1) goto shunt_map_left;
 $AB5D JP Z,$A9E4    ; }
 $AB60 CP $03        ; {if (A == 3) goto shunt_map_down_left;
 $AB62 JP Z,$AA8D    ; }
 $AB65 RET           ; return;

; Zoombox stuff.
@label=zoombox_x
g$AB66 DEFB $0C      ; zoombox_x
@label=zoombox_horizontal_count
 $AB67 DEFB $01      ; zoombox_horizontal_count
@label=zoombox_y
 $AB68 DEFB $08      ; zoombox_y
@label=zoombox_vertical_count
 $AB69 DEFB $01      ; zoombox_vertical_count

; Game window current attribute byte.
@label=game_window_attribute
g$AB6A DEFB $07      ; game_window_attribute

; Choose game window attributes.
;
; Used by the routines at #R$7B36, #R$7B8B, #R$A1D3, #R$ABA0, #R$B3F6 and
; #R$B83B.
;
; O:A Chosen attribute.
@label=choose_game_window_attributes
c$AB6B LD A,($68A0)  ; {if (room_index < room_29_SECOND_TUNNEL_START) <%
 $AB6E CP $1D        ;
 $AB70 JR NC,$AB89   ; }
; The hero is outside, or in a room, but not in a tunnel.
 $AB72 LD A,($A146)  ;   A = day_or_night;
 $AB75 LD C,$07      ;   C = attribute_WHITE_OVER_BLACK;
 $AB77 AND A         ; {  if (A == 0) goto set_attribute_from_C;
 $AB78 JR Z,$AB84    ; }
 $AB7A LD A,($68A0)  ;   A = room_index;
 $AB7D LD C,$41      ;   C = attribute_BRIGHT_BLUE_OVER_BLACK;
 $AB7F AND A         ; {  if (A == 0) goto set_attribute_from_C;
 $AB80 JR Z,$AB84    ; }
 $AB82 LD C,$05      ;   C = attribute_CYAN_OVER_BLACK;
*$AB84 LD A,C        ;   set_attribute_from_C: A = C;
*$AB85 LD ($AB6A),A  ;   set_attribute_from_A: game_window_attribute = A;
 $AB88 RET           ;   return; %>
; The hero is in a tunnel.
*$AB89 LD C,$02      ; else <% C = attribute_RED_OVER_BLACK;
 $AB8B LD HL,($8215) ;   HL = items_held;
; If the hero holds a torch - draw the room.
 $AB8E LD A,$04      ; {  if (L == item_TORCH || H == item_TORCH) goto set_attribute_from_C;
 $AB90 CP L          ;
 $AB91 JR Z,$AB84    ;
 $AB93 CP H          ;
 $AB94 JR Z,$AB84    ; }
; The hero holds no torch - draw nothing.
 $AB96 CALL $6A27    ;   wipe_visible_tiles();
 $AB99 CALL $6B42    ;   plot_interior_tiles();
 $AB9C LD A,$01      ;   A = attribute_BLUE_OVER_BLACK;
 $AB9E JR $AB85      ;   goto set_attribute_from_A; %>

; Zoombox.
;
; Used by the routines at #R$68F4, #R$A50B and #R$B2FC.
@label=zoombox
c$ABA0 LD A,$0C      ; {zoombox_x = 12;
 $ABA2 LD ($AB66),A  ; }
 $ABA5 LD A,$08      ; {zoombox_y = 8;
@nowarn
 $ABA7 LD ($AB68),A  ; }
 $ABAA CALL $AB6B    ; choose_game_window_attributes();
 $ABAD LD H,A        ; H = A;
 $ABAE LD L,A        ; L = A;
 $ABAF LD ($5932),HL ; ($5932) = HL; // set 2 attrs
 $ABB2 LD ($5952),HL ; ($5952) = HL; // set 2 attrs
 $ABB5 XOR A         ; {zoombox_horizontal_count = 0;
 $ABB6 LD ($AB67),A  ; }
 $ABB9 LD ($AB69),A  ; zoombox_vertical_count = 0;
*$ABBC LD HL,$AB66   ; do <% HL = &zoombox_x;
 $ABBF LD A,(HL)     ;   A = *HL;
 $ABC0 CP $01        ; {  if (A != 1) <%
 $ABC2 JP Z,$ABCA    ; }
 $ABC5 DEC (HL)      ;     (*HL)--;
 $ABC6 DEC A         ;     A--;
 $ABC7 INC HL        ;     HL++;
 $ABC8 INC (HL)      ;     (*HL)++;
 $ABC9 DEC HL        ;     HL--; %>
*$ABCA INC HL        ;   HL++;
 $ABCB ADD A,(HL)    ;   A += *HL;
 $ABCC CP $16        ; {  if (A < 22) (*HL)++;
 $ABCE JP NC,$ABD2   ;
 $ABD1 INC (HL)      ; }
*$ABD2 INC HL        ;   HL++;
 $ABD3 LD A,(HL)     ;   A = *HL;
 $ABD4 CP $01        ; {  if (A != 1) <%
 $ABD6 JP Z,$ABDE    ; }
 $ABD9 DEC (HL)      ;     (*HL)--;
 $ABDA DEC A         ;     A--;
 $ABDB INC HL        ;     HL++;
 $ABDC INC (HL)      ;     (*HL)++;
 $ABDD DEC HL        ;     HL--; %>
*$ABDE INC HL        ;   HL++;
 $ABDF ADD A,(HL)    ;   A += *HL;
 $ABE0 CP $0F        ; {  if (A < 15) (*HL)++;
 $ABE2 JP NC,$ABE6   ;
 $ABE5 INC (HL)      ; }
*$ABE6 CALL $ABF9    ;   zoombox_fill();
 $ABE9 CALL $AC6F    ;   zoombox_draw_border();
 $ABEC LD HL,$AB67   ; {  A = zoombox_vertical_count + zoombox_horizontal_count;
 $ABEF LD A,($AB69)  ;
 $ABF2 ADD A,(HL)    ; }
 $ABF3 CP $23        ; {%> while (A < 35);
 $ABF5 JP C,$ABBC    ; }
 $ABF8 RET           ; return;

; Zoombox. partial copy of window buffer contents?
;
; Used by the routine at #R$ABA0.
@label=zoombox_fill
c$ABF9 LD A,($AB68)  ; A = zoombox_y;
 $ABFC LD H,A        ; { DE = zoombox_y * 128
 $ABFD XOR A         ;
 $ABFE SRL H         ;
 $AC00 RRA           ;
 $AC01 LD E,A        ;
 $AC02 LD D,H        ; }
 $AC03 SRL H         ; { HL = zoombox_y * 64
 $AC05 RRA           ;
 $AC06 LD L,A        ; }
 $AC07 ADD HL,DE     ; {HL += DE + zoombox_x;
 $AC08 LD A,($AB66)  ;
 $AC0B ADD A,L       ;
 $AC0C LD L,A        ;
 $AC0D JR NC,$AC10   ;
 $AC0F INC H         ; }
@nowarn
*$AC10 LD DE,$F291   ; DE = &state->window_buf[1];
 $AC13 ADD HL,DE     ; HL += DE;
 $AC14 EX DE,HL
@nowarn
 $AC15 LD A,($AB68)  ; {HL = game_window_start_addresses[zoombox_y * 8]; // ie. * 16
 $AC18 ADD A,A       ;
 $AC19 ADD A,A       ;
 $AC1A ADD A,A       ;
 $AC1B ADD A,A       ;
 $AC1C LD HL,$EDD3   ;
 $AC1F ADD A,L       ;
 $AC20 LD L,A        ;
 $AC21 JR NC,$AC24   ;
 $AC23 INC H         ;
*$AC24 LD A,(HL)     ;
 $AC25 INC HL        ;
 $AC26 LD H,(HL)     ;
 $AC27 LD L,A        ; }
 $AC28 LD A,($AB66)  ; {HL += zoombox_x;
 $AC2B ADD A,L       ;
 $AC2C LD L,A        ; }
 $AC2D EX DE,HL
 $AC2E LD A,($AB67)  ; A = zoombox_horizontal_count;
 $AC31 LD ($AC55),A  ; ($AC55) = A; // self modify
 $AC34 NEG           ; {A = -A + 24;
 $AC36 ADD A,$18     ; }
 $AC38 LD ($AC4D),A  ; ($AC4D) = A; // self modify
 $AC3B LD A,($AB69)  ; A = zoombox_vertical_count;
 $AC3E LD B,A        ; B = A; // iterations
*$AC3F PUSH BC       ; do <%
 $AC40 PUSH DE
 $AC41 LD A,$08      ;   A = 8; // 8 iterations
*$AC43 EX AF,AF'     ;   do <%
 $AC44 LD A,($AB67)  ; {    BC = zoombox_horizontal_count;
 $AC47 LD C,A        ;
 $AC48 LD B,$00      ; }
 $AC4A LDIR          ;
 $AC4C LD A,$00      ;     Adash = 0; // self modified
 $AC4E ADD A,L       ; {    HL += Adash;
 $AC4F LD L,A        ;
 $AC50 JR NC,$AC53   ;
 $AC52 INC H         ; }
*$AC53 LD A,E        ;     Adash = E;
 $AC54 SUB $00       ;     Adash -= 0; // self modified
 $AC56 LD E,A        ;     E = Adash;
 $AC57 INC D         ;     D++;
 $AC58 EX AF,AF'
 $AC59 DEC A         ; {  %> while (--A);
 $AC5A JP NZ,$AC43   ; }
 $AC5D POP DE
 $AC5E EX DE,HL
 $AC5F LD BC,$0020   ;   BC = 0x0020;
 $AC62 LD A,L        ; {  if (L >= 224) B = 0x07;
 $AC63 CP $E0        ;
 $AC65 JR C,$AC69    ;
 $AC67 LD B,$07      ; }
*$AC69 ADD HL,BC     ;   HL += BC;
 $AC6A EX DE,HL
 $AC6B POP BC
 $AC6C DJNZ $AC3F    ; %> while (--B);
 $AC6E RET           ; return;

; Draw zoombox border.
;
; Used by the routine at #R$ABA0.
@label=zoombox_draw_border
@nowarn
c$AC6F LD A,($AB68)  ; {HL = game_window_start_addresses[(zoombox_y - 1) * 8]; // ie. * 16
 $AC72 DEC A         ;
 $AC73 ADD A,A       ;
 $AC74 ADD A,A       ;
 $AC75 ADD A,A       ;
 $AC76 ADD A,A       ;
 $AC77 LD HL,$EDD3   ;
 $AC7A ADD A,L       ;
 $AC7B LD L,A        ;
 $AC7C JR NC,$AC7F   ;
 $AC7E INC H         ;
*$AC7F LD A,(HL)     ;
 $AC80 INC HL        ;
 $AC81 LD H,(HL)     ;
 $AC82 LD L,A        ; }
; Top left.
 $AC83 LD A,($AB66)  ; {HL += zoombox_x - 1;
 $AC86 DEC A         ;
 $AC87 ADD A,L       ;
 $AC88 LD L,A        ; }
 $AC89 LD A,$00      ; {zoombox_draw_tile(zoombox_tile_TL);
 $AC8B CALL $ACFC    ; }
 $AC8E INC L         ; HL++;
; Horizontal, moving right.
 $AC8F LD A,($AB67)  ; {B = zoombox_horizontal_count; // iterations
 $AC92 LD B,A        ; }
*$AC93 LD A,$01      ; {do <% zoombox_draw_tile(zoombox_tile_HZ);
 $AC95 CALL $ACFC    ; }
 $AC98 INC L         ;   HL++;
 $AC99 DJNZ $AC93    ; %> while (--B);
; Top right.
 $AC9B LD A,$02      ; {zoombox_draw_tile(zoombox_tile_TR);
 $AC9D CALL $ACFC    ; }
 $ACA0 LD DE,$0020   ; DE = 32;
 $ACA3 LD A,L        ; {if (L >= 224) D = 0x07;
 $ACA4 CP $E0        ;
 $ACA6 JR C,$ACAA    ;
 $ACA8 LD D,$07      ; }
*$ACAA ADD HL,DE     ; HL += DE;
; Vertical, moving down.
 $ACAB LD A,($AB69)  ; {B = zoombox_vertical_count; // iterations
 $ACAE LD B,A        ; }
*$ACAF LD A,$03      ; {do <% zoombox_draw_tile(zoombox_tile_VT);
 $ACB1 CALL $ACFC    ; }
 $ACB4 LD DE,$0020   ;   DE = 32;
 $ACB7 LD A,L        ; {  if (L >= 224) D = 0x07;
 $ACB8 CP $E0        ;
 $ACBA JR C,$ACBE    ;
 $ACBC LD D,$07      ; }
*$ACBE ADD HL,DE     ;   HL += DE;
 $ACBF DJNZ $ACAF    ; %> while (--B);
; Bottom right.
 $ACC1 LD A,$04      ; {zoombox_draw_tile(zoombox_tile_BR);
 $ACC3 CALL $ACFC    ; }
 $ACC6 DEC L         ; HL--;
; Horizontal, moving left.
 $ACC7 LD A,($AB67)  ; {B = zoombox_horizontal_count; // iterations
 $ACCA LD B,A        ; }
*$ACCB LD A,$01      ; {do <% zoombox_draw_tile(zoombox_tile_HZ);
 $ACCD CALL $ACFC    ; }
 $ACD0 DEC L         ;   HL--;
 $ACD1 DJNZ $ACCB    ; %> while (--B);
; Bottom left.
 $ACD3 LD A,$05      ; {zoombox_draw_tile(zoombox_tile_BL);
 $ACD5 CALL $ACFC    ; }
 $ACD8 LD DE,$FFE0   ; DE = 0xFFE0;
 $ACDB LD A,L        ; {if (L < 32) DE = 0xF8E0;
 $ACDC CP $20        ;
 $ACDE JR NC,$ACE3   ;
 $ACE0 LD DE,$F8E0   ; }
*$ACE3 ADD HL,DE     ; HL += DE;
; Vertical, moving up.
 $ACE4 LD A,($AB69)  ; {B = zoombox_vertical_count; // iterations
 $ACE7 LD B,A        ; }
*$ACE8 LD A,$03      ; {do <% zoombox_draw_tile(zoombox_tile_VT);
 $ACEA CALL $ACFC    ; }
 $ACED LD DE,$FFE0   ;   DE = 0xFFE0;
 $ACF0 LD A,L        ; {  if (L < 32) DE = 0xF8E0;
 $ACF1 CP $20        ;
 $ACF3 JR NC,$ACF8   ;
 $ACF5 LD DE,$F8E0   ; }
*$ACF8 ADD HL,DE     ;   HL += DE;
 $ACF9 DJNZ $ACE8    ; %> while (--B);
 $ACFB RET           ; return;

; Draw a single zoombox border tile.
;
; Used by the routine at #R$AC6F.
;
; I:A Index of tile to draw.
; I:BC (preserved)
; I:HL Destination address.
@label=zoombox_draw_tile
c$ACFC PUSH BC
 $ACFD PUSH AF
 $ACFE PUSH HL
 $ACFF EX DE,HL
 $AD00 LD L,A        ; {HL = &zoombox_tiles[A];
 $AD01 LD H,$00      ;
 $AD03 ADD HL,HL     ;
 $AD04 ADD HL,HL     ;
 $AD05 ADD HL,HL     ;
 $AD06 LD BC,$AF5E   ;
 $AD09 ADD HL,BC     ; }
 $AD0A LD B,$08      ; B = 8; // 8 iterations
*$AD0C LD A,(HL)     ; {do <% *DE = *HL++;
 $AD0D LD (DE),A     ; }
 $AD0E INC D         ; {  DE += 256;
 $AD0F INC HL        ; }
 $AD10 DJNZ $AD0C    ; %> while (--B);
 $AD12 LD A,D        ; {A = D - 1; // ie. (DE - 256) >> 8
 $AD13 DEC A         ; }
 $AD14 LD H,$58      ; H = 0x58; // attributes
 $AD16 LD L,E        ; L = E;
 $AD17 CP $48        ; {if (A >= 0x48) <% H++;
 $AD19 JR C,$AD21    ;
 $AD1B INC H         ; }
 $AD1C CP $50        ; {  if (A >= 0x50) H++; %>
 $AD1E JR C,$AD21    ;
 $AD20 INC H         ; }
*$AD21 LD A,($AB6A)  ; {*HL = game_window_attribute;
 $AD24 LD (HL),A     ; }
 $AD25 POP HL
 $AD26 POP AF
 $AD27 POP BC
 $AD28 RET           ; return;

; Searchlight movement data.
@label=searchlight_movements
w$AD29 DEFB $24, $52, $2C, $02, $00 ; x, y, step, direction, counter
 $AD2E DEFW $AD54   ; searchlight_path_2
 $AD30 DEFB $78, $52, $18, $01, $00 ; x, y, step, direction, counter
 $AD35 DEFW $AD43   ; searchlight_path_1
 $AD37 DEFB $3C, $4C, $20, $02, $00 ; x, y, step, direction, counter
 $AD3C DEFW $AD3E   ; searchlight_path_0
@label=searchlight_path_0
 $AD3E DEFB $20, $02, $20, $01, $FF
@label=searchlight_path_1
 $AD43 DEFB $18, $01, $0C, $00, $18, $03, $0C, $00, $20, $01, $14, $00, $20, $03, $2C, $02, $FF
@label=searchlight_path_2
 $AD54 DEFB $2C, $02, $2A, $01, $FF

; Decides searchlight movement.
;
; Used by the routine at #R$ADBD.
;
; I:HL Pointer to a searchlight movement data.
@label=searchlight_movement
c$AD59 LD E,(HL)     ; {E = *HL++;
 $AD5A INC HL        ; }
 $AD5B LD D,(HL)     ; {D = *HL++;
 $AD5C INC HL        ; }
 $AD5D DEC (HL)      ; (*HL)--;
 $AD5E JP NZ,$AD99   ; if (Z) <%
 $AD61 INC HL        ; {  HL += 2;
 $AD62 INC HL        ; }
 $AD63 LD A,(HL)     ;   A = *HL; // sampled HL=$AD3B,$AD34,$AD2D
 $AD64 BIT 7,A       ; {  if (A & (1<<7)) <% // sign
 $AD66 JP Z,$AD76    ; }
 $AD69 AND $7F       ;     A &= 0x7F;
 $AD6B JP NZ,$AD72   ;     if (A == 0) <%
 $AD6E RES 7,(HL)    ;       *HL &= ~(1<<7); %> // clear sign bit when magnitude hits zero
 $AD70 JR $AD74      ;     else <%
*$AD72 DEC (HL)      ;       (*HL)--; // count down
 $AD73 DEC A         ;       A--; %> %> // just a copy
*$AD74 JR $AD78      ;   else <%
*$AD76 INC A         ;     A++; // count up
 $AD77 LD (HL),A     ;     *HL = A; %>
*$AD78 INC HL        ;   HL++;
 $AD79 LD C,(HL)     ; {  C = *HL++;
 $AD7A INC HL        ; }
 $AD7B LD B,(HL)     ;   B = *HL;
 $AD7C DEC HL        ; {  HL -= 2;
 $AD7D DEC HL        ; }
 $AD7E ADD A,A       ; {  BC += A * 2;
 $AD7F ADD A,C       ;
 $AD80 LD C,A        ;
 $AD81 JR NC,$AD84   ;
 $AD83 INC B         ; }
*$AD84 LD A,(BC)     ;   A = *BC;
 $AD85 CP $FF        ; {  if (A == 0xFF) <% // end of list?
 $AD87 JP NZ,$AD90   ; }
 $AD8A DEC (HL)      ;     (*HL)--; // overshot? count down counter byte
 $AD8B SET 7,(HL)    ;     *HL |= 1<<7; // go negative
 $AD8D DEC BC        ; {    BC -= 2;
 $AD8E DEC BC        ; }
 $AD8F LD A,(BC)     ;     A = *BC; %>/* This is a flaw in original code: A is fetched but never used again. */
*$AD90 DEC HL        ; {  HL -= 2;
 $AD91 DEC HL        ; }
; Copy counter + direction_t.
 $AD92 LD A,(BC)     ; {  *HL++ = *BC++;
 $AD93 LD (HL),A     ;
 $AD94 INC HL        ;
 $AD95 INC BC        ; }
 $AD96 LD A,(BC)     ; {  *HL = *BC;
 $AD97 LD (HL),A     ; }
 $AD98 RET           ;   return; %>
*$AD99 INC HL        ; else <% HL++;
 $AD9A LD A,(HL)     ; {  A = *HL++;
 $AD9B INC HL        ; }
 $AD9C BIT 7,(HL)    ; {  if (*HL & (1<<7)) A ^= 2; // if -ve, toggle up-down
 $AD9E JR Z,$ADA2    ;
 $ADA0 XOR $02       ; }
*$ADA2 CP $02        ; {  if (A < 2) D -= 2;
 $ADA4 JR NC,$ADA8   ;
 $ADA6 DEC D         ;
 $ADA7 DEC D         ; }
*$ADA8 INC D         ;   D++;
 $ADA9 AND A         ; {  if (A != 0 && A != 3) <% E += 2; %> else <% E -= 2
 $ADAA JR Z,$ADB4    ; %>;
 $ADAC CP $03        ;
 $ADAE JR Z,$ADB4    ;
 $ADB0 INC E         ;
 $ADB1 INC E         ;
 $ADB2 JR $ADB6      ;
*$ADB4 DEC E         ;
 $ADB5 DEC E         ; }
*$ADB6 DEC HL        ; {  HL -= 3;
 $ADB7 DEC HL        ;
 $ADB8 DEC HL        ; }
 $ADB9 LD (HL),D     ; {  *HL-- = D;
 $ADBA DEC HL        ; }
 $ADBB LD (HL),E     ;   *HL = E;
 $ADBC RET           ;   return; %>

; Turns white screen elements light blue and tracks the hero with a
; searchlight.
;
; Used by the routine at #R$9D7B.
@label=nighttime
c$ADBD LD HL,$81BD   ; HL = &searchlight_state;
 $ADC0 LD A,(HL)     ; {if (*HL == searchlight_STATE_SEARCHING) goto not_tracking;
 $ADC1 CP $FF        ;
 $ADC3 JP Z,$AE0D    ; }
 $ADC6 LD A,($68A0)  ; {if (room_index) <% // hero is indoors
 $ADC9 AND A         ;
 $ADCA JR Z,$ADCF    ; }
; If the hero goes indoors then the searchlight loses track.
 $ADCC LD (HL),$FF   ;   *HL = searchlight_STATE_SEARCHING;
 $ADCE RET           ;   return; %>
; The hero is outdoors.
; .
; If the searchlight previously caught the hero, then track him.
*$ADCF LD A,(HL)     ; {if (*HL == searchlight_STATE_CAUGHT) <%
 $ADD0 CP $1F        ;
 $ADD2 JP NZ,$AE00   ; }
 $ADD5 LD HL,($81BB) ;   HL = map_position;
 $ADD8 LD A,L        ; {  E = L + 4;
 $ADD9 ADD A,$04     ;
 $ADDB LD E,A        ; }
 $ADDC LD D,H        ;   D = H;
 $ADDD LD HL,($AE76) ;   HL = searchlight_caught_coord;
 $ADE0 LD A,L        ; {  if (L == E) <%
 $ADE1 CP E          ;
 $ADE2 JR NZ,$ADE9   ; }
 $ADE4 LD A,H        ; {    if (H == D) return; %> // If the highlight doesn't need to move, quit.
 $ADE5 CP D          ;
 $ADE6 RET Z         ; }
 $ADE7 JR $ADF1      ;   else <%
; Move searchlight left/right to focus on the hero.
*$ADE9 JP NC,$ADEF   ;     if (L < E) <%
 $ADEC INC A         ;       L++; %>
 $ADED JR $ADF0      ;     else <%
*$ADEF DEC A         ;       L--; %>
*$ADF0 LD L,A        ;   %>
; Move searchlight up/down to focus on the hero.
*$ADF1 LD A,H        ; {  if (H != D) <%
 $ADF2 CP D          ;
 $ADF3 JR Z,$ADFD    ; }
 $ADF5 JP NC,$ADFB   ;     if (H < D) <%
 $ADF8 INC A         ;       H++; %>
 $ADF9 JR $ADFC      ;     else <%
*$ADFB DEC A         ;       H--; %>
*$ADFC LD H,A        ;   %>
*$ADFD LD ($AE76),HL ;   searchlight_caught_coord = HL; %>
*$AE00 LD DE,($81BB) ; DE = map_position;
 $AE04 LD HL,$AE77   ; HL = $AE77; // &searchlight_caught_coord + 1 byte; // compensating for HL--; jumped into
 $AE07 LD B,$01      ; B = 1; // 1 iteration
 $AE09 PUSH BC
 $AE0A PUSH HL
 $AE0B JR $AE3F      ; goto $AE3F;
*$AE0D LD HL,$AD29   ; not_tracking: HL = &searchlight_movements[0];
 $AE10 LD B,$03      ; B = 3; // 3 iterations == three searchlights
*$AE12 PUSH BC       ; do <%
 $AE13 PUSH HL
 $AE14 CALL $AD59    ;   searchlight_movement();
 $AE17 POP HL
 $AE18 PUSH HL
 $AE19 CALL $AE78    ;   searchlight_caught();
 $AE1C POP HL
 $AE1D PUSH HL
 $AE1E LD DE,($81BB) ;   DE = map_position;
; if (E + 23 < x || x + 16 < E) goto next;
; .
; if (D + 16 < y || y + 16 < D) goto next;
 $AE22 LD A,E        ; {  if (E + 23 < *HL) goto next;
 $AE23 ADD A,$17     ;
 $AE25 CP (HL)       ;
 $AE26 JP C,$AE6C    ; }
 $AE29 LD A,(HL)     ; {  if (*HL + 16 < E) goto next;
 $AE2A ADD A,$10     ;
 $AE2C CP E          ;
 $AE2D JP C,$AE6C    ; }
 $AE30 INC HL        ;   HL++;
 $AE31 LD A,D        ; {  if (D + 16 < *HL) goto next;
 $AE32 ADD A,$10     ;
 $AE34 CP (HL)       ;
 $AE35 JP C,$AE6C    ; }
 $AE38 LD A,(HL)     ; {  if (*HL + 16 < D) goto next;
 $AE39 ADD A,$10     ;
 $AE3B CP D          ;
 $AE3C JP C,$AE6C    ; }
*$AE3F XOR A         ;   A = 0;
 $AE40 EX AF,AF'
 $AE41 DEC HL        ;   HL--;
 $AE42 LD B,$00      ;   B = 0x00;
 $AE44 LD A,(HL)     ; {  if (*HL - E < 0) <%
 $AE45 SUB E         ;
 $AE46 JP NC,$AE4E   ; }
 $AE49 LD B,$FF      ;     B = 0xFF;
 $AE4B EX AF,AF'
 $AE4C CPL           ;     A = ~A;
 $AE4D EX AF,AF'     ;     %>
*$AE4E LD C,A        ;   C = Adash;
 $AE4F INC HL        ; {  Adash = *++HL;
 $AE50 LD A,(HL)     ; }
 $AE51 LD H,$00      ;   H = 0x00;
 $AE53 SUB D         ;   Adash -= D;
 $AE54 JP NC,$AE59   ; {  if (Adash < 0) H = 0xFF; // -ve
 $AE57 LD H,$FF      ; }
*$AE59 LD L,A        ;   L = Adash;
; HL must be row, BC must be column
 $AE5A ADD HL,HL     ; {  HL *= 32;
 $AE5B ADD HL,HL     ;
 $AE5C ADD HL,HL     ;
 $AE5D ADD HL,HL     ;
 $AE5E ADD HL,HL     ; }
 $AE5F ADD HL,BC     ;   HL += BC;
 $AE60 LD BC,$5846   ; {  HL += 0x5846; // address of top-left game window attribute
 $AE63 ADD HL,BC     ; }
 $AE64 EX DE,HL
 $AE65 EX AF,AF'
 $AE66 LD ($AE75),A  ;   searchlight_related = A;
 $AE69 CALL $AEB8    ;   searchlight_plot();
*$AE6C POP HL        ;   next:
 $AE6D POP BC
 $AE6E LD DE,$0007   ; {  HL += 7;
 $AE71 ADD HL,DE     ; }
 $AE72 DJNZ $AE12    ; %> while (--B);
 $AE74 RET           ; return;

; Searchlight stuff
;
; (<- nighttime, searchlight_plot)
@label=searchlight_related
g$AE75 DEFB $00
; Coordinates of searchlight when hero is caught.
@label=searchlight_caught_coord
 $AE76 DEFW $0000

; Is the hero is caught in the searchlight?
;
; Used by the routine at #R$ADBD.
;
; I:HL Pointer to searchlight movement data.
@label=searchlight_caught
c$AE78 LD DE,($81BB) ; DE = map_position;
 $AE7C LD A,E        ; {if (HL[0] + 5 >= E + 12 || HL[0] + 10 < E + 10) return;
 $AE7D ADD A,$0C     ;
 $AE7F LD B,A        ;
 $AE80 LD A,(HL)     ;
 $AE81 ADD A,$05     ;
 $AE83 CP B          ;
 $AE84 RET NC        ;
 $AE85 ADD A,$05     ;
 $AE87 DEC B         ;
 $AE88 DEC B         ;
 $AE89 CP B          ;
 $AE8A RET C         ; }
 $AE8B INC HL        ; {if (HL[1] + 5 >= D + 10 || D + 6 >= HL[1] + 12) return;
 $AE8C LD A,D        ;
 $AE8D ADD A,$0A     ;
 $AE8F LD B,A        ;
 $AE90 LD A,(HL)     ;
 $AE91 ADD A,$05     ;
 $AE93 CP B          ;
 $AE94 RET NC        ;
 $AE95 ADD A,$07     ;
 $AE97 LD C,A        ;
 $AE98 LD A,B        ;
 $AE99 SUB $04       ;
 $AE9B CP C          ;
 $AE9C RET NC        ; }
; It seems odd to not do this (cheaper) test sooner.
 $AE9D LD A,($81BD)  ; {if (searchlight_state == searchlight_STATE_CAUGHT) return;
 $AEA0 CP $1F        ;
 $AEA2 RET Z         ; }
 $AEA3 LD A,$1F      ; {searchlight_state = searchlight_STATE_CAUGHT;
 $AEA5 LD ($81BD),A  ; }
 $AEA8 LD D,(HL)     ; {D = HL[0];
 $AEA9 DEC HL        ; }
 $AEAA LD E,(HL)     ; E = HL[1];
 $AEAB LD ($AE76),DE ; searchlight_caught_coord = DE;
 $AEAF XOR A         ; {bell = bell_RING_PERPETUAL;
 $AEB0 LD ($A130),A  ; }
 $AEB3 LD B,$0A      ; {decrease_morale(10); // exit via
 $AEB5 JP $A0E0      ; }

; Searchlight plotter.
;
; Used by the routine at #R$ADBD.
;
; I:DE Pointer to screen attributes.
@label=searchlight_plot
c$AEB8 EXX
@nowarn
 $AEB9 LD DE,$AF3E                          ; DEdash = &searchlight_shape[0];
 $AEBC LD C,$10                             ; Cdash = 16; // iterations  / width?
*$AEBE EXX                                  ; do <%
 $AEBF LD A,($AE75)                         ;   A = searchlight_related;
@nowarn
 $AEC2 LD HL,$5A40                          ;   HL = 0x5A40; // screen attribute address (column 0 + bottom of game window)
 $AEC5 AND A                                ; {  if (A != 0 && (E & 31) >= 22) L = 32;
 $AEC6 JP Z,$AED2                           ;
 $AEC9 LD A,E                               ;
 $AECA AND $1F                              ;
 $AECC CP $16                               ;
 $AECE JR C,$AED2                           ;
 $AED0 LD L,$20                             ; }
*$AED2 SBC HL,DE                            ;
 $AED4 RET C                                ;   RET C  // if (HL < DE) return; // what about carry?
 $AED5 PUSH DE
@nowarn
 $AED6 LD HL,$5840                          ;   HL = 0x5840; // screen attribute address (column 0 + top of game window)
 $AED9 AND A                                ; {  if (A != 0 && (E & 31) >= 7) L = 32;
 $AEDA JP Z,$AEE6                           ;
 $AEDD LD A,E                               ;
 $AEDE AND $1F                              ;
 $AEE0 CP $07                               ;
 $AEE2 JR C,$AEE6                           ;
 $AEE4 LD L,$20                             ; }
*$AEE6 SBC HL,DE                            ;
 $AEE8 JR C,$AEF0                           ;   JR C,$AEF0  // if (HL < DE) goto $AEF0;
 $AEEA EXX
 $AEEB INC DE                               ; {  DEdash += 2;
 $AEEC INC DE                               ; }
 $AEED EXX
 $AEEE JR $AF32                             ;   goto nextrow;
*$AEF0 EX DE,HL
 $AEF1 EXX
 $AEF2 LD B,$02                             ;   Bdash = 2;
*$AEF4 LD A,(DE)                            ;   do <% A = *DEdash;
 $AEF5 EXX
 $AEF6 LD DE,$071E                          ;     DE = 0x071E;
 $AEF9 LD C,A                               ;     C = A;
 $AEFA LD B,$08                             ;     B = 8;
*$AEFC LD A,($AE75)                         ;     do <% A = searchlight_related;
 $AEFF AND A                                ;       if (A != 0) ...
 $AF00 LD A,L                               ;       A = L; // interleaved
 $AF01 JP Z,$AF0C                           ;         ... goto $AF0C;
 $AF04 AND $1F                              ; {      if ((A & 31) >= 22) goto $AF1B;
 $AF06 CP $16                               ;
 $AF08 JR NC,$AF1B                          ; }
 $AF0A JR $AF18                             ;       goto $AF18;
*$AF0C AND $1F                              ; {      if ((A & 31) < E) goto $AF18;
 $AF0E CP E                                 ;
 $AF0F JR C,$AF18                           ; }
 $AF11 EXX
*$AF12 INC DE                               ; {      do <% DEdash++; %> while (--Bdash);
 $AF13 DJNZ $AF12                           ; }
 $AF15 EXX
 $AF16 JR $AF32                             ;       goto nextrow;
*$AF18 CP D                                 ; {      if (A < D) <%
 $AF19 JR NC,$AF1F                          ; }
*$AF1B RL C                                 ;         RL C %> // looks like bit extraction ...
 $AF1D JR $AF2A                             ;       else <%
*$AF1F RL C                                 ;         RL C
 $AF21 JP NC,$AF28                          ;         if (carry) <%
 $AF24 LD (HL),$06                          ;           *HL = attribute_YELLOW_OVER_BLACK; %>
 $AF26 JR $AF2A                             ;         else <%
*$AF28 LD (HL),$41                          ;           *HL = attribute_BRIGHT_BLUE_OVER_BLACK; %> %>
*$AF2A INC HL                               ;       HL++;
 $AF2B DJNZ $AEFC                           ;     %> while (--B);
 $AF2D EXX
 $AF2E INC DE                               ;     DEdash++;
 $AF2F DJNZ $AEF4                           ;   %> while (--Bdash);
 $AF31 EXX
*$AF32 POP HL                               ;   nextrow:
 $AF33 LD DE,$0020                          ; {  HL += 32;
 $AF36 ADD HL,DE                            ; }
 $AF37 EX DE,HL
 $AF38 EXX
 $AF39 DEC C                                ; {%> while (--Cdash);
 $AF3A JP NZ,$AEBE                          ; }
 $AF3D RET                                  ; return;
; Searchlight circle shape.
@label=searchlight_shape
 $AF3E DEFB $00,$00 ; {searchlight_shape
 $AF40 DEFB $00,$00 ;
 $AF42 DEFB $00,$00 ;
 $AF44 DEFB $01,$80 ;
 $AF46 DEFB $07,$E0 ;
 $AF48 DEFB $0F,$F0 ;
 $AF4A DEFB $0F,$F0 ;
 $AF4C DEFB $1F,$F8 ;
 $AF4E DEFB $1F,$F8 ;
 $AF50 DEFB $0F,$F0 ;
 $AF52 DEFB $0F,$F0 ;
 $AF54 DEFB $07,$E0 ;
 $AF56 DEFB $01,$80 ;
 $AF58 DEFB $00,$00 ;
 $AF5A DEFB $00,$00 ;
 $AF5C DEFB $00,$00 ; }

; Zoombox tiles.
@label=zoombox_tiles
b$AF5E DEFB $00,$00,$00,$03,$04,$08,$08,$08 ; zoombox_tile_wire_tl
 $AF66 DEFB $00,$20,$18,$F4,$2F,$18,$04,$00 ; zoombox_tile_wire_hz
 $AF6E DEFB $00,$00,$00,$00,$E0,$10,$08,$08 ; zoombox_tile_wire_tr
 $AF76 DEFB $08,$08,$1A,$2C,$34,$58,$10,$10 ; zoombox_tile_wire_vt
 $AF7E DEFB $10,$10,$10,$20,$C0,$00,$00,$00 ; zoombox_tile_wire_br
 $AF86 DEFB $10,$10,$08,$07,$00,$00,$00,$00 ; zoombox_tile_wire_bl

; Bribed character.
@label=bribed_character
g$AF8E DEFB $FF      ; bribed_character

; Stuff is touching. Also assigns saved_pos to specified vischar's pos and sets
; the sprite_index.
;
; Used by the routine at #R$B5CE.
;
; I:A' Flip flag + sprite offset.
; I:IY Pointer to visible character block.
@label=touch
c$AF8F EX AF,AF'
 $AF90 LD ($81AA),A   ; touch_stashed_A = A;
 $AF93 SET 6,(IY+$07) ; {IY[7] |= vischar_BYTE7_TOUCHING | vischar_BYTE7_LOCATABLE; // wild guess: clamp character in position?
 $AF97 SET 7,(IY+$07) ; }
 $AF9B PUSH IY        ; {HL = IY;
 $AF9D POP HL         ; }
 $AF9E LD A,L
; If hero is player controlled, then check for door transitions.
 $AF9F AND A          ; {if (L == 0 && automatic_player_counter > 0) door_handling(); // L == 0 => HL == 0x8000
 $AFA0 PUSH AF        ;
 $AFA1 JR NZ,$AFAA    ;
 $AFA3 LD A,($A139)   ;
 $AFA6 AND A          ;
 $AFA7 CALL NZ,$B1F5  ;
*$AFAA POP AF         ; }
; If non-player character or hero is not cutting the fence.
 $AFAB AND A          ; {if (L || (($8001 & (vischar_FLAGS_PICKING_LOCK | vischar_FLAGS_CUTTING_WIRE)) != vischar_FLAGS_CUTTING_WIRE)) <% if (bounds_check()) return 1;
 $AFAC JR NZ,$AFB5    ;
 $AFAE LD A,($8001)   ;
 $AFB1 AND $03        ; %>
 $AFB3 CP $02         ;
*$AFB5 CALL NZ,$B14C  ;
 $AFB8 RET NZ         ; }
; Cutting wire only from here onwards?
 $AFB9 LD A,(IY+$00)  ; A = IY[0]; // $8000,$8020,$8040,$8060
 $AFBC CP $1A         ; {if (A <= character_25_PRISONER_6) <% // a character index
 $AFBE JR NC,$AFC4    ; }
 $AFC0 CALL $AFDF     ;   collision();
 $AFC3 RET NZ         ;   if (!Z) return; %>
; noncolliding characters and items only at this point
*$AFC4 RES 6,(IY+$07) ; IY[7] &= ~vischar_BYTE7_TOUCHING; // clear counter_and_flag
 $AFC8 LD HL,$81A4    ; {memcpy(IY + 15, &saved_pos_x, 6); // $800F // vischar
 $AFCB PUSH IY        ; pos = saved_pos
 $AFCD POP DE         ;
 $AFCE LD A,$0F       ;
 $AFD0 ADD A,E        ;
 $AFD1 LD E,A         ;
 $AFD2 LD BC,$0006    ;
 $AFD5 LDIR           ; }
 $AFD7 LD A,($81AA)   ; {IY[0x17] = touch_stashed_A; // left/right flip flag / sprite offset
 $AFDA LD (IY+$17),A  ; }
 $AFDD XOR A          ; A = 0;
 $AFDE RET            ; return 0;

; (unknown) Definitely something to do with moving objects around. Collisions?
;
; Used by the routines at #R$AF8F and #R$C4E0.
@label=collision
c$AFDF LD HL,$8001     ; HL = $8001; // &vischar[0].byte1;
 $AFE2 LD B,$08        ; B = 8; // 8 iterations
*$AFE4 BIT 7,(HL)      ; {do <% if (*HL & vischar_FLAGS_NO_COLLIDE) goto next;
 $AFE6 JP NZ,$B0FE     ; // $8001, $8021, ...}
 $AFE9 PUSH BC
 $AFEA PUSH HL
 $AFEB LD A,$0E        ; {  HL += 0x0E; // $800F etc. - X axis position
 $AFED ADD A,L         ;
 $AFEE LD L,A          ; }
; --------
 $AFEF LD C,(HL)       ; {  C = *HL++;
 $AFF0 INC L           ; }
 $AFF1 LD B,(HL)       ;   B = *HL;
 $AFF2 EX DE,HL
 $AFF3 LD HL,($81A4)   ;   HL = saved_pos_x;
 $AFF6 LD A,$04        ; {  BC += 4;
 $AFF8 ADD A,C         ;
 $AFF9 LD C,A          ;
 $AFFA JR NC,$AFFE     ;
 $AFFC INC B           ;
 $AFFD AND A           ; }
*$AFFE SBC HL,BC       ; {  if (HL != BC) <%
 $B000 JR Z,$B014      ; }
 $B002 JP NC,$B0FC     ;     if (HL > BC) goto pop_next;
 $B005 SUB $08         ; {    BC -= 8; // ie -4 over original
 $B007 LD C,A          ;
 $B008 JR NC,$B00C     ;
 $B00A DEC B           ;
 $B00B AND A           ; }
*$B00C LD HL,($81A4)   ; {    HL = saved_pos_x;
 $B00F SBC HL,BC       ; }
 $B011 JP C,$B0FC      ;     if (HL < BC) goto pop_next; %>
*$B014 EX DE,HL
 $B015 INC L           ;   HL++;
; --------
 $B016 LD C,(HL)       ; {  C = *HL++;
 $B017 INC L           ; }
 $B018 LD B,(HL)       ;   B = *HL;
 $B019 EX DE,HL
 $B01A LD HL,($81A6)   ;   HL = saved_pos_y;
 $B01D LD A,$04        ; {  BC += 4;
 $B01F ADD A,C         ;
 $B020 LD C,A          ;
 $B021 JR NC,$B025     ;
 $B023 INC B           ;
 $B024 AND A           ; }
*$B025 SBC HL,BC       ; {  if (HL != BC) <%
 $B027 JR Z,$B03B      ; }
 $B029 JP NC,$B0FC     ;     if (HL > BC) goto pop_next;
 $B02C SUB $08         ; {    BC -= 8;
 $B02E LD C,A          ;
 $B02F JR NC,$B033     ;
 $B031 DEC B           ;
 $B032 AND A           ; }
*$B033 LD HL,($81A6)   ; {    HL = saved_pos_y;
 $B036 SBC HL,BC       ; }
 $B038 JP C,$B0FC      ;     if (HL < BC) goto pop_next; %>
*$B03B EX DE,HL
 $B03C INC L           ;   HL++;
; --------
 $B03D LD C,(HL)       ;   C = *HL;
 $B03E LD A,($81A8)    ; {  A = saved_height - C;
 $B041 SUB C           ; }
 $B042 JR NC,$B046     ;   if (A < 0) <%
 $B044 NEG             ;     A = -A; %>
*$B046 CP $18          ; {  if (A >= 24) goto pop_next;
 $B048 JP NC,$B0FC     ; }
; If specified vischar character has a bribe pending...
 $B04B LD A,(IY+$01)   ; {  A = IY[1] & 0x0F; // sampled IY=$8020,$8040,$8060,$8000 // but this is *not* vischar_FLAGS_MASK, which is 0x1F
 $B04E AND $0F         ; }
 $B050 CP $01          ; {  if (A == 1) <%
 $B052 JR NZ,$B071     ; }
; and current vischar is not the hero...
 $B054 POP HL
 $B055 PUSH HL         ;     // sampled HL=$8021,$8041,$8061,$80A1
 $B056 DEC L           ;     HL--;
 $B057 LD A,L          ; {    if ((HL & 0xFF) == 0) <% // ie. $8000
 $B058 AND A           ;
 $B059 JR NZ,$B071     ; }
 $B05B LD A,($AF8E)    ; {      if (bribed_character == IY[0]) <%
 $B05E CP (IY+$00)     ;
 $B061 JR NZ,$B068     ; }
 $B063 CALL $B107      ;         accept_bribe(); %>
 $B066 JR $B071        ;       else <%
; A hostile catches the hero!
*$B068 POP HL
 $B069 POP BC
 $B06A PUSH IY         ; {        HL = IY + 1;
 $B06C POP HL          ;
 $B06D INC L           ; }
 $B06E JP $CB98        ;         solitary(); return; // exit via %> %> %>
*$B071 POP HL
 $B072 DEC L           ;   HL--;
 $B073 LD A,(HL)       ;   A = *HL; // sampled HL=$80C0,$8040,$8000,$8020,$8060 // vischar_BYTE0
 $B074 CP $1A          ; {  if (A >= 26) <%
 $B076 JR C,$B0B9      ; }
 $B078 PUSH HL
 $B079 EX AF,AF'
 $B07A LD A,$11        ; {    HL += 17;
 $B07C ADD A,L         ;
 $B07D LD L,A          ; }
 $B07E EX AF,AF'       ;     tmpA = A;
 $B07F LD BC,$0723     ;     B = 7; C = 35;
 $B082 CP $1C
 $B084 LD A,(IY+$0E)   ;     A = IY[14]; // interleaved
 $B087 JR NZ,$B08F     ;     if (tmpA == 28) <%
 $B089 DEC L           ; {      L -= 2;
 $B08A DEC L           ; }
 $B08B LD C,$36        ;       C = 54;
 $B08D XOR $01         ;       A ^= 1; %>
*$B08F AND A           ; {    if (A == 0) <%
 $B090 JR NZ,$B09D     ; }
 $B092 LD A,(HL)       ;       A = *HL;
 $B093 CP C            ; {      if (A != C) <%
 $B094 JR Z,$B0B8      ; }
 $B096 JR C,$B09A      ; {        if (C > A) (*HL) -= 2; // decrement by -2 then execute +1 anyway to avoid branch
 $B098 DEC (HL)        ;
 $B099 DEC (HL)        ; }
*$B09A INC (HL)        ;         (*HL)++; %> %>
 $B09B JR $B0B8        ; {    else if (A == 1) <%
*$B09D CP $01          ;
 $B09F JR NZ,$B0A9     ; }
 $B0A1 LD A,C          ; {      A = C + B;
 $B0A2 ADD A,B         ; }
 $B0A3 CP (HL)         ; {      if (A != *HL) (*HL)++; %>
 $B0A4 JR Z,$B0B8      ;
 $B0A6 INC (HL)        ; }
 $B0A7 JR $B0B8        ; {    else if (A == 2) <%
*$B0A9 CP $02          ;
 $B0AB JR NZ,$B0B2     ; }
 $B0AD LD A,C          ; {      A = C - B;
 $B0AE SUB B           ; }
 $B0AF LD (HL),A       ;       *HL = A; %>
 $B0B0 JR $B0B8        ;     else <%
*$B0B2 LD A,C          ; {      A = C - B;
 $B0B3 SUB B           ; }
 $B0B4 CP (HL)         ; {      if (A != *HL) (*HL)--; %>
 $B0B5 JR Z,$B0B8      ;
 $B0B7 DEC (HL)        ; }
*$B0B8 POP HL
*$B0B9 POP BC          ;     %>
 $B0BA LD A,L          ; {  HL += 13;
 $B0BB ADD A,$0D       ;
 $B0BD LD L,A          ; }
 $B0BE LD A,(HL)       ; {  A = *HL & ~input_KICK; // mask off kick flag // sampled HL=$806D,$804D,$802D,$808D,$800D}
 $B0BF AND $7F         ;
 $B0C1 JR Z,$B0DB      ;   if (A) <%
 $B0C3 INC L           ;     HL++;
 $B0C4 LD A,(HL)       ; {    A = *HL ^ 2; // swap direction: top <=> bottom
 $B0C5 XOR $02         ; }
 $B0C7 CP (IY+$0E)     ; {    if (A != IY[14]) <%
 $B0CA JR Z,$B0DB      ; }
 $B0CC LD (IY+$0D),$80 ;       IY[13] = input_KICK;
*$B0D0 LD A,(IY+$07)   ; {      IY[7] = (IY[7] & vischar_BYTE7_MASK_HI) | 5; // preserve flags and set 5? // sampled IY=$8000,$80E0
 $B0D3 AND $F0         ;
 $B0D5 OR $05          ;
 $B0D7 LD (IY+$07),A   ; }
 $B0DA RET NZ          ;       if (!Z) return; /* odd */ %> %>
*$B0DB LD C,(IY+$0E)   ; {  BC = IY[14]; // sampled IY=$8000,$8040,$80E0
 $B0DE LD B,$00        ; }
@nowarn
 $B0E0 LD HL,$B0F8     ; {  IY[13] = collision_new_inputs[BC];
 $B0E3 ADD HL,BC       ;
 $B0E4 LD A,(HL)       ;
 $B0E5 LD (IY+$0D),A   ; }
 $B0E8 BIT 0,C         ; {  if ((C & 1) == 0) <%
 $B0EA JR NZ,$B0F2     ; }
 $B0EC RES 5,(IY+$07)  ;     IY[7] &= ~vischar_BYTE7_IMPEDED;
 $B0F0 JR $B0D0        ;     goto $B0D0; %>
*$B0F2 SET 5,(IY+$07)  ;   else <% IY[7] |= vischar_BYTE7_IMPEDED;
 $B0F6 JR $B0D0        ;     goto $B0D0; %>
; New inputs.
@label=collision_new_inputs
 $B0F8 DEFB $85        ; input_DOWN + input_LEFT  + input_KICK
 $B0F9 DEFB $84        ; input_UP   + input_LEFT  + input_KICK
 $B0FA DEFB $87        ; input_UP   + input_RIGHT + input_KICK
 $B0FB DEFB $88        ; input_DOWN + input_RIGHT + input_KICK
*$B0FC POP HL          ;   pop_next:
 $B0FD POP BC
*$B0FE LD A,L          ; {  next: HL += 32;
 $B0FF ADD A,$20       ;
 $B101 LD L,A          ; }
 $B102 DEC B           ; {%> while (--B);
 $B103 JP NZ,$AFE4     ; }
 $B106 RET             ; return; // return with Z set

; Character accepts the bribe.
;
; Used by the routines at #R$AFDF and #R$CA81.
;
; I:IY Pointer to visible character.
@label=accept_bribe
c$B107 CALL $A0E9      ; increase_morale_by_10_score_by_50();
 $B10A LD (IY+$01),$00 ; IY[1] = 0;
 $B10E PUSH IY         ; {HL = IY + 2;
 $B110 POP HL          ;
 $B111 INC L           ;
 $B112 INC L           ; }
 $B113 CALL $CB23      ; get_next_target_and_handle_it();
 $B116 LD DE,$8215     ; DE = &items_held[0];
 $B119 LD A,(DE)       ; {if (*DE != item_BRIBE && *++DE != item_BRIBE) return; // have no bribes
 $B11A CP $05          ;
 $B11C JR Z,$B123      ;
 $B11E INC DE          ;
 $B11F LD A,(DE)       ;
 $B120 CP $05          ;
 $B122 RET NZ          ; }
; We have a bribe, take it away.
*$B123 LD A,$FF        ; {*DE = item_NONE;
 $B125 LD (DE),A       ; }
 $B126 AND $3F         ; {item_structs[item_BRIBE].room = itemstruct_ROOM_MASK;
 $B128 LD ($76EC),A    ; }
 $B12B CALL $7C33      ; draw_all_items();
 $B12E LD B,$07        ; B = 7; // 7 iterations
; Iterate over hostile + visible non-player characters.
@nowarn
 $B130 LD HL,$8020     ; HL = $8020;
*$B133 LD A,(HL)       ; {do <% if (HL[0] <= character_19_GUARD_DOG_4) <% // Hostile characters only.
 $B134 CP $14          ;
 $B136 JR NC,$B13C     ; }
 $B138 INC L           ; {    HL[1] = vischar_FLAGS_SAW_BRIBE; %> // hostile will look for bribed character?
 $B139 LD (HL),$04     ;
 $B13B DEC L           ; }
*$B13C LD A,L          ; {  HL += 32;
 $B13D ADD A,$20       ;
 $B13F LD L,A          ; }
 $B140 DJNZ $B133      ; %> while (--B);
 $B142 LD B,$11        ; {queue_message_for_display(message_HE_TAKES_THE_BRIBE);
 $B144 CALL $7D15      ; }
 $B147 LD B,$12        ; queue_message_for_display(message_AND_ACTS_AS_DECOY);
 $B149 JP $7D15        ; return; // exit via

; Check the character is inside of permitted areas.
;
; Used by the routines at #R$AF8F and #R$C4E0.
;
; I:IY Pointer to visible character.
@label=bounds_check
c$B14C LD A,($68A0)  ; {if (room_index) <% interior_bounds_check(); return; %>
 $B14F AND A         ;
 $B150 JP NZ,$B29F   ; }
 $B153 LD B,$18      ; B = 24; // 24 iterations
 $B155 LD DE,$B53E   ; DE = &walls[0];
*$B158 PUSH BC       ; do <%
 $B159 PUSH DE
 $B15A LD A,(DE)     ; {
 $B15B CALL $B1C7    ; }
 $B15E INC BC        ; {  if ((saved_pos_x >= DE[0] * 8 + 2) &&
 $B15F INC BC        ;
 $B160 LD HL,($81A4) ;
 $B163 SBC HL,BC     ;
 $B165 JR C,$B1BA    ; }
 $B167 INC DE        ; {
 $B168 LD A,(DE)     ;
 $B169 CALL $B1C7    ; }
 $B16C INC BC        ; {      (saved_pos_x <  DE[1] * 8 + 4) &&
 $B16D INC BC        ;
 $B16E INC BC        ;
 $B16F INC BC        ;
 $B170 LD HL,($81A4) ;
 $B173 SBC HL,BC     ;
 $B175 JR NC,$B1BA   ; }
 $B177 INC DE        ; {
 $B178 LD A,(DE)     ;
 $B179 CALL $B1C7    ; }
 $B17C LD HL,($81A6) ; {      (saved_pos_y >= DE[2] * 8)     &&
 $B17F SBC HL,BC     ;
 $B181 JR C,$B1BA    ; }
 $B183 INC DE        ; {
 $B184 LD A,(DE)     ;
 $B185 CALL $B1C7    ; }
 $B188 INC BC        ; {      (saved_pos_y <  DE[3] * 8 + 4) &&
 $B189 INC BC        ;
 $B18A INC BC        ;
 $B18B INC BC        ;
 $B18C LD HL,($81A6) ;
 $B18F SBC HL,BC     ;
 $B191 JR NC,$B1BA   ; }
 $B193 INC DE        ; {
 $B194 LD A,(DE)     ;
 $B195 CALL $B1C7    ; }
 $B198 LD HL,($81A8) ; {      (saved_height >= DE[4] * 8)     &&
 $B19B SBC HL,BC     ;
 $B19D JR C,$B1BA    ; }
 $B19F INC DE        ; {
 $B1A0 LD A,(DE)     ;
 $B1A1 CALL $B1C7    ; }
 $B1A4 INC BC        ; {      (saved_height <  DE[5] * 8 + 2)) <%
 $B1A5 INC BC        ;
 $B1A6 LD HL,($81A8) ;
 $B1A9 SBC HL,BC     ;
 $B1AB JR NC,$B1BA   ; }
; Found it.
 $B1AD POP DE
 $B1AE POP BC
 $B1AF LD A,(IY+$07) ; {    IY[7] ^= vischar_BYTE7_IMPEDED; // sampled IY=$80A0,$8080,$8060
 $B1B2 XOR $20       ;
 $B1B4 LD (IY+$07),A ; }
 $B1B7 OR $01        ;     A |= 1; // return NZ
 $B1B9 RET           ;     return; %>
*$B1BA POP DE
 $B1BB POP BC
 $B1BC LD HL,$0006   ; {  DE += 6;
 $B1BF ADD HL,DE     ;
 $B1C0 EX DE,HL      ; }
 $B1C1 DEC B         ; {%> while (--B);
 $B1C2 JP NZ,$B158   ; }
 $B1C5 AND B         ; A &= B; // return Z
 $B1C6 RET           ; return;

; Multiplies A by 8, returning the result in BC.
;
; Used by the routines at #R$B14C, #R$C4E0, #R$CA11, #R$CA49 and #R$DBEB.
;
; I:A  Argument.
; O:BC Result of (A << 3).
@label=multiply_by_8
c$B1C7 LD B,$00      ; B = 0;
 $B1C9 ADD A,A       ; A <<= 1;
 $B1CA RL B          ; B = (B << 1) + carry;
 $B1CC ADD A,A       ; A <<= 1;
 $B1CD RL B          ; B = (B << 1) + carry;
 $B1CF ADD A,A       ; A <<= 1;
 $B1D0 RL B          ; B = (B << 1) + carry;
 $B1D2 LD C,A        ; C = A;
 $B1D3 RET           ; return;

; Locate current door, queuing a message if it's locked.
;
; Used by the routines at #R$B1F5 and #R$B32D.
;
; O:F Z set if door open.
@label=is_door_locked
c$B1D4 LD E,$7F      ; {C = current_door & ~door_LOCKED; // probably door_REVERSE
 $B1D6 LD A,($68A1)  ;
 $B1D9 AND E         ;
 $B1DA LD C,A        ; }
 $B1DB LD HL,$F05D   ; HL = &locked_doors[0];
 $B1DE LD B,$09      ; B = 9; // 9 iterations
*$B1E0 LD A,(HL)     ; {do <% if (*HL & ~door_LOCKED == C) <%
 $B1E1 AND E         ;
 $B1E2 CP C          ;
 $B1E3 JR NZ,$B1F0   ; }
 $B1E5 BIT 7,(HL)    ; {    if ((*HL & door_LOCKED) == 0) return; // Door is open.
 $B1E7 RET Z         ;
 $B1E8 LD B,$05      ; }
 $B1EA CALL $7D15    ; queue_message_for_display(message_THE_DOOR_IS_LOCKED);
 $B1ED OR $01        ;     A |= 1; // set NZ // Door is locked.
 $B1EF RET           ;     return; %>
*$B1F0 INC HL        ;   HL++;
 $B1F1 DJNZ $B1E0    ; %> while (--B);
 $B1F3 AND B         ; A &= B; // set Z (B is zero) // Door is open.
 $B1F4 RET           ; return;

; Door handling.
;
; Used by the routine at #R$AF8F.
;
; I:IY Pointer to visible character.
@label=door_handling
c$B1F5 LD A,($68A0)  ; A = room_index;
; Interior doors are handled by another routine.
 $B1F8 AND A         ; {if (A) goto door_handling_interior; // exit via
 $B1F9 JP NZ,$B32D   ; }
; Select start position in doors[] based on the direction the hero is
; facing.
 $B1FC LD HL,$78D6   ; HL = &doors[0];
 $B1FF LD E,(IY+$0E) ; E = IY[14]; // walk/crawl flag byte
 $B202 LD A,E        ; {if (E >= 2) HL = &door_position[1]; /* BOTTOM_RIGHT or BOTTOM_LEFT */
 $B203 CP $02        ;
 $B205 JR C,$B20A    ;
 $B207 LD HL,$78DA   ; }
*$B20A LD D,$03      ; D = 3;  // mask
 $B20C LD B,$10      ; B = 16; // 16 is the length of what?
*$B20E LD A,(HL)     ; {do <% A = *HL & D;
 $B20F AND D         ; }
 $B210 CP E          ; {  if (A == E) <%
 $B211 JR NZ,$B21E   ; }
 $B213 PUSH BC
 $B214 PUSH HL
 $B215 PUSH DE
 $B216 CALL $B252    ;     door_in_range();
 $B219 POP DE
 $B21A POP HL
 $B21B POP BC
 $B21C JR NC,$B229   ;     if (!C) goto found; %>
*$B21E LD A,$08      ; {  HL += 8; // step forward two entries
 $B220 ADD A,L       ;
 $B221 LD L,A        ;
 $B222 JR NC,$B225   ;
 $B224 INC H         ; }
*$B225 DJNZ $B20E    ; %> while (--B);
 $B227 AND B         ; A &= B; // set Z (B is zero) // seems to exist to set Z, but routine doesn't return anything?
 $B228 RET           ; return;
*$B229 LD A,$10      ; {found: A = 16 - B;
 $B22B SUB B         ; }
 $B22C LD ($68A1),A  ; current_door = A;
 $B22F EXX
 $B230 CALL $B1D4    ; is_door_locked();
 $B233 RET NZ        ; if (!Z) return; // door was locked - return nonzero?
 $B234 EXX
 $B235 LD A,(HL)     ; {IY[28] = (*HL >> 2) & 0x3F; // sampled HL=$792E (in doors[])
 $B236 RRA           ;
 $B237 RRA           ;
 $B238 AND $3F       ;
 $B23A LD (IY+$1C),A ; }
 $B23D LD A,(HL)     ; {if ((*HL & 3) >= 2) <% /* BR or BL */
 $B23E AND $03       ;
 $B240 CP $02        ;
 $B242 JR NC,$B24C   ; }
 $B244 INC HL        ; {  HL += 5; // point at the next door's pos
 $B245 INC HL        ;
 $B246 INC HL        ;
 $B247 INC HL        ;
 $B248 INC HL        ; }
 $B249 JP $68A2      ;   transition(); return; %> // seems to goto reset then jump back to main (icky)
*$B24C DEC HL        ; {else <% HL -= 3; // point at the previous door's pos
 $B24D DEC HL        ;
 $B24E DEC HL        ; }
 $B24F JP $68A2      ;   transition(); return; %>

; Door in range.
;
; Used by the routines at #R$B1F5 and #R$B4D0.
; .
; (saved_X,saved_Y) within (-2,+2) of HL[1..] scaled << 2
;
; I:HL Pointer to (byte before) coord byte pair.
; O:HL Corrupted.
; O:F  C/NC if nomatch/match.
@label=door_in_range
c$B252 INC HL        ; {A = HL[1];
 $B253 LD A,(HL)     ; }
 $B254 EX DE,HL
 $B255 CALL $B295    ; multiply_by_4();
 $B258 LD A,C        ; {if (saved_pos_x < BC - 3 || saved_pos_x >= BC + 3) return; // with C set
 $B259 SUB $03       ;
 $B25B LD C,A        ;
 $B25C JR NC,$B25F   ;
 $B25E DEC B         ;
*$B25F LD HL,($81A4) ;
 $B262 SBC HL,BC     ;
 $B264 RET C         ;
 $B265 LD A,$06      ;
 $B267 ADD A,C       ;
 $B268 LD C,A        ;
 $B269 JR NC,$B26C   ;
 $B26B INC B         ;
*$B26C LD HL,($81A4) ;
 $B26F SBC HL,BC     ;
 $B271 CCF           ;
 $B272 RET C         ; }
 $B273 EX DE,HL
 $B274 INC HL        ; {A = HL[2];
 $B275 LD A,(HL)     ; }
 $B276 CALL $B295    ; multiply_by_4();
 $B279 EX DE,HL
 $B27A LD A,C        ; {if (saved_pos_y < BC - 3 || saved_pos_y >= BC + 3) return; // with C set
 $B27B SUB $03       ;
 $B27D LD C,A        ;
 $B27E JR NC,$B281   ;
 $B280 DEC B         ;
*$B281 LD HL,($81A6) ;
 $B284 SBC HL,BC     ;
 $B286 RET C         ;
 $B287 LD A,$06      ;
 $B289 ADD A,C       ;
 $B28A LD C,A        ;
 $B28B JR NC,$B28E   ;
 $B28D INC B         ;
*$B28E LD HL,($81A6) ;
 $B291 SBC HL,BC     ;
 $B293 CCF           ; }
 $B294 RET           ; return; // C not set

; Multiplies A by 4, returning the result in BC.
;
; Used by the routines at #R$68A2 and #R$B252.
;
; I:A  Argument.
; O:BC Result of (A << 2).
@label=multiply_by_4
c$B295 LD B,$00      ; B = 0;
 $B297 ADD A,A       ; A <<= 1;
 $B298 RL B          ; B = (B << 1) + carry;
 $B29A ADD A,A       ; A <<= 1;
 $B29B RL B          ; B = (B << 1) + carry;
 $B29D LD C,A        ; C = A;
 $B29E RET           ; return;

; Check the character is inside of bounds, when indoors.
;
; Used by the routine at #R$B14C.
;
; I:IY Pointer to visible character.
; O:A  Corrupted.
; O:BC Corrupted.
; O:F  Z clear if boundary hit, set otherwise.
; O:HL Corrupted.
@label=interior_bounds_check
c$B29F LD A,($81BE)  ; {BC = &roomdef_bounds[roomdef_bounds_index];
 $B2A2 ADD A,A       ;
 $B2A3 ADD A,A       ;
 $B2A4 LD BC,$6B85   ;
 $B2A7 ADD A,C       ;
 $B2A8 LD C,A        ;
 $B2A9 JR NC,$B2AC   ;
 $B2AB INC B         ; }
*$B2AC LD HL,$81A4   ; HL = &saved_pos_x;
 $B2AF LD A,(BC)     ; A = *BC;
 $B2B0 CP (HL)       ; {if (A < *HL) goto stop;
 $B2B1 JR C,$B2E7    ; }
 $B2B3 INC BC        ; {A = *++BC + 4;
 $B2B4 LD A,(BC)     ;
 $B2B5 ADD A,$04     ; }
 $B2B7 CP (HL)       ; {if (A >= *HL) goto stop;
 $B2B8 JR NC,$B2E7   ; }
 $B2BA INC HL        ; {HL += 2;
 $B2BB INC HL        ; }
; Bug: This instruction is stray code. DE is incremented but never used.
 $B2BC INC DE        ; DE++;
 $B2BD INC BC        ; {A = *++BC - 4;
 $B2BE LD A,(BC)     ;
 $B2BF SUB $04       ; }
 $B2C1 CP (HL)       ; {if (A < *HL) goto stop;
 $B2C2 JR C,$B2E7    ; }
 $B2C4 INC BC        ; {A = *++BC;
 $B2C5 LD A,(BC)     ; }
 $B2C6 CP (HL)       ; {if (A >= *HL) goto stop;
 $B2C7 JR NC,$B2E7   ; }
 $B2C9 LD HL,$81BF   ; HL = &roomdef_object_bounds[0];
 $B2CC LD B,(HL)     ; {B = *HL; // iterations
 $B2CD LD A,B        ; }
 $B2CE AND A         ; {if (B == 0) return;
 $B2CF RET Z         ; }
 $B2D0 INC HL        ; HL++;
*$B2D1 PUSH BC       ; do <%
 $B2D2 PUSH HL
 $B2D3 LD DE,$81A4   ;     DE = &saved_pos_x;
 $B2D6 LD B,$02      ;     B = 2; // 2 iterations
*$B2D8 LD A,(DE)     ;     do <% A = *DE;
 $B2D9 CP (HL)       ; {    if (A < HL[0] || A >= HL[1]) goto next; // next outer loop iteration
 $B2DA JR C,$B2F2    ;
 $B2DC INC HL        ;
 $B2DD CP (HL)       ;
 $B2DE JR NC,$B2F2   ; }
 $B2E0 INC DE        ; {    DE += 2;
 $B2E1 INC DE        ; }
 $B2E2 INC HL        ;     HL += 2; // increment moved - hope it's still correct
 $B2E3 DJNZ $B2D8    ;   %> while (--B);
; Found.
 $B2E5 POP HL
 $B2E6 POP BC
*$B2E7 LD A,(IY+$07) ; {stop: IY[7] ^= vischar_BYTE7_IMPEDED; // stop character?
 $B2EA XOR $20       ;
 $B2EC LD (IY+$07),A ; }
 $B2EF OR $01        ;   A |= 1;
 $B2F1 RET           ;   return; // return NZ
; Next iteration.
*$B2F2 POP HL        ; next:
 $B2F3 LD DE,$0004   ; {  HL += 4;
 $B2F6 ADD HL,DE     ; }
 $B2F7 POP BC
 $B2F8 DJNZ $B2D1    ; %> while (--B);
; Not found.
 $B2FA AND B         ; A &= B; // B is zero here
 $B2FB RET           ; return; // return Z

; Reset the hero's position, redraw the scene, then zoombox it onto the screen.
;
; Used by the routines at #R$68A2 and #R$9DE5.
;
; .
;
; Reset hero.
@label=reset_outdoors
c$B2FC LD HL,$8000   ; HL = $8000;
 $B2FF CALL $B71B    ; calc_vischar_screenpos_from_mi_pos();
; Centre the screen on the hero.
 $B302 LD HL,$8018   ; HL = $8018; // (vischar.screenpos.x)
 $B305 LD A,(HL)     ; {A = *HL++;
 $B306 INC L         ; }
 $B307 LD C,(HL)     ; C = *HL;
 $B308 CALL $E555    ; divide_by_8(C,A);
 $B30B SUB $0B       ; {map_position.x = A - 11; // 11 would be screen width minus half of character width?
 $B30D LD ($81BB),A  ; }
 $B310 INC L         ; HL++;
 $B311 LD A,(HL)     ; {A = *HL++;
 $B312 INC L         ; }
 $B313 LD C,(HL)     ; C = *HL;
 $B314 CALL $E555    ; divide_by_8(C,A);
 $B317 SUB $06       ; {map_position.y = A - 6; // 6 would be screen height minus half of character height?
 $B319 LD ($81BC),A  ; }
 $B31C XOR A         ; {room_index = room_0_OUTDOORS;
 $B31D LD ($68A0),A  ; }
 $B320 CALL $A7C9    ; get_supertiles();
 $B323 CALL $A8A2    ; plot_all_tiles();
 $B326 CALL $6939    ; setup_movable_items();
 $B329 CALL $ABA0    ; zoombox();
 $B32C RET           ; return;

; Door handling (indoors).
;
; Used by the routine at #R$B1F5.
;
; I:IY Pointer to visible character.
@label=door_handling_interior
c$B32D LD HL,$81D6   ; HL = &interior_doors;
*$B330 LD A,(HL)     ; for (;;) <% A = *HL;
 $B331 CP $FF        ; {  if (A == door_NONE) return; /* Reached end of list. */
 $B333 RET Z         ; }
 $B334 EXX
 $B335 LD ($68A1),A  ;   current_door = A;
 $B338 CALL $6A12    ;   HL = get_door();
 $B33B LD A,(HL)     ;   A = *HLdash;
 $B33C LD C,A        ;   Cdash = A;
 $B33D AND $03       ; {  Bdash = A & doorpos_FLAGS_MASK_DIRECTION;
 $B33F LD B,A        ; }
 $B340 LD A,(IY+$0E) ; {  if ((IY->direction & vischar_DIRECTION_MASK) != Bdash) goto next;
 $B343 AND $03       ;
 $B345 CP B          ;
 $B346 JR NZ,$B383   ; }
 $B348 INC HL        ;   HLdash++;
 $B349 EX DE,HL
 $B34A LD HL,$81A4   ;   DEdash = &saved_pos_x; // reusing saved_pos as 8-bit here?
 $B34D LD B,$02      ;   Bdash = 2; // 2 iterations
*$B34F LD A,(DE)     ; {  do <% A = *HLdash - 3;
 $B350 SUB $03       ; }
 $B352 CP (HL)       ; {    if (A >= *DEdash || A + 6 < *DEdash) goto next; // -3 .. +3
 $B353 JR NC,$B383   ;
 $B355 ADD A,$06     ;
 $B357 CP (HL)       ;
 $B358 JR C,$B383    ; }
 $B35A INC HL        ; {    DEdash += 2;
 $B35B INC HL        ; }
 $B35C INC DE        ;     HLdash++;
 $B35D DJNZ $B34F    ;   %> while (--Bdash);
 $B35F INC DE        ;   HLdash++;
 $B360 EX DE,HL
 $B361 PUSH HL       ;   PUSH HLdash
 $B362 PUSH BC       ;   PUSH BCdash
 $B363 CALL $B1D4    ;   is_door_locked();
 $B366 POP BC        ;   POP BCdash
 $B367 POP HL        ;   POP HLdash
 $B368 RET NZ        ;   if (!Z) return; /* The door was locked. */
 $B369 LD A,C        ; {  IY[28] = (Cdash >> 2) & 0x3F;
 $B36A RRA           ;
 $B36B RRA           ;
 $B36C AND $3F       ;
 $B36E LD (IY+$1C),A ; }
 $B371 INC HL        ;   HLdash++;
 $B372 LD A,($68A1)  ; {  if (current_door & door_REVERSE) <% HLdash -= 8; %>
 $B375 BIT 7,A       ;
 $B377 JR Z,$B380    ;
 $B379 LD A,L        ;
 $B37A SUB $08       ;
 $B37C LD L,A        ;
 $B37D JR NC,$B380   ;
 $B37F DEC H         ; }
*$B380 JP $68A2      ;   transition(); return; // exit via // with banked registers...
*$B383 EXX           ;   next:
 $B384 INC HL        ;   HL++;
 $B385 JR $B330      ; %>

; The hero has tried to open the red cross parcel.
@label=action_red_cross_parcel
c$B387 LD A,$3F      ; {item_structs[item_RED_CROSS_PARCEL].room = itemstruct_ROOM_MASK; // room_NONE & 0x3F;
 $B389 LD ($771D),A  ; }
 $B38C LD HL,$8215   ; HL = &items_held;
 $B38F LD A,$0C      ; {if (*HL != item_RED_CROSS_PARCEL) HL++; /* One or the other must be a red cross parcel item, so advance. */
 $B391 CP (HL)       ;
 $B392 JR Z,$B395    ;
 $B394 INC HL        ; }
*$B395 LD (HL),$FF   ; *HL = item_NONE; /* Parcel opened. */
 $B397 CALL $7C33    ; draw_all_items();
 $B39A LD A,($A263)  ; A = red_cross_parcel_current_contents;
 $B39D CALL $7BB5    ; drop_item_tail();
 $B3A0 LD B,$0C      ; {queue_message_for_display(message_YOU_OPEN_THE_BOX);
 $B3A2 CALL $7D15    ; }
 $B3A5 JP $A0E9      ; increase_morale_by_10_score_by_50(); return; // exit via

; The hero tries to bribe a prisoner.
;
; This searches visible friendly characters only and returns the first found.
;
; .
;
; Walk non-player visible characters.
@label=action_bribe
@nowarn
c$B3A8 LD HL,$8020   ; HL = $8020; // iterate over non-player characters
 $B3AB LD B,$07      ; B = 7; // 7 iterations
*$B3AD LD A,(HL)     ; do <% A = *HL;
 $B3AE CP $FF        ; {  if ((A != character_NONE) && (A >= character_20_PRISONER_1)) goto found;
 $B3B0 JR Z,$B3B6    ;
 $B3B2 CP $14        ;
 $B3B4 JR NC,$B3BD   ; }
*$B3B6 LD A,$20      ; {  HL += 32; // sizeof a character struct
 $B3B8 ADD A,L       ;
 $B3B9 LD L,A        ; }
 $B3BA DJNZ $B3AD    ; %> while (--B);
 $B3BC RET           ; return;
*$B3BD LD ($AF8E),A  ; found: bribed_character = A;
 $B3C0 INC L         ; {HL[1] = vischar_FLAGS_BRIBE_PENDING; // $8021 etc. // flag
 $B3C1 LD (HL),$01   ; }
 $B3C3 RET           ; return;

; Use poison.
@label=action_poison
c$B3C4 LD HL,($8215) ; Load items_held.
 $B3C7 LD A,$07      ; Load item_FOOD.
 $B3C9 CP L          ; Is 'low' slot item_FOOD?
 $B3CA JR Z,$B3CE    ; Yes - goto have_food.
 $B3CC CP H          ; Is 'high' slot item_FOOD?
 $B3CD RET NZ        ; No - return.
@label=action_poison_have_food
*$B3CE LD HL,$76F9   ; have_food: &item_structs[item_FOOD].item
 $B3D1 BIT 5,(HL)    ; Bit 5 set?
 $B3D3 RET NZ        ; Yes - return.
 $B3D4 SET 5,(HL)    ; Set bit 5.
 $B3D6 LD A,$43      ; {Set item_attribute: FOOD to bright-purple/black.
 $B3D8 LD ($DD70),A  ; }
 $B3DB CALL $7C33    ; draw_all_items()
 $B3DE JP $A0E9      ; goto increase_morale_by_10_score_by_50

; Use uniform.
@label=action_uniform
c$B3E1 LD HL,$8015   ; HL = $8015; // current character sprite set
 $B3E4 LD DE,$CEA6   ; DE = &sprite_guard;
 $B3E7 LD A,(HL)     ; {if (*HL == E) return; // cheap equality test /* Already in uniform. */
 $B3E8 CP E          ;
 $B3E9 RET Z         ; }
 $B3EA LD A,($68A0)  ; {if (room_index >= room_29_SECOND_TUNNEL_START) return; // can't don uniform when in a tunnel
 $B3ED CP $1D        ;
 $B3EF RET NC        ; }
 $B3F0 LD (HL),E     ; *HL++ = E;
 $B3F1 INC L         ; {*HL = D;
 $B3F2 LD (HL),D     ; }
 $B3F3 JP $A0E9      ; increase_morale_by_10_score_by_50(); return;

; Use shovel.
@label=action_shovel
c$B3F6 LD A,($68A0)  ; {if (room_index != room_50_BLOCKED_TUNNEL) return; /* Shovel only works in the blocked tunnel room. */
 $B3F9 CP $32        ;
 $B3FB RET NZ        ; }
 $B3FC LD A,($7077)  ; {if (roomdef_50_blocked_tunnel_boundary[0] == 255) return; /* Blockage is already cleared. */
 $B3FF CP $FF        ;
 $B401 RET Z         ; }
; Release boundary.
 $B402 LD A,$FF      ; {roomdef_50_blocked_tunnel_boundary[0] = 255;
 $B404 LD ($7077),A  ; }
; Remove blockage graphic.
 $B407 INC A         ; {roomdef_50_blocked_tunnel_collapsed_tunnel = 0;
 $B408 LD ($708C),A  ; }
 $B40B CALL $6A35    ; setup_room();
 $B40E CALL $AB6B    ; choose_game_window_attributes();
 $B411 CALL $6B42    ; plot_interior_tiles();
 $B414 JP $A0E9      ; increase_morale_by_10_score_by_50(); return; // exit via

; Use wiresnips.
@label=action_wiresnips
c$B417 LD HL,$B589   ; HL = &walls[12] + 3;
 $B41A LD DE,$81B9   ; DE = &hero_map_position.x;
 $B41D LD B,$04      ; B = 4; // iterations
*$B41F PUSH HL       ; do <% ...
 $B420 LD A,(DE)     ;   A = *DE;
 $B421 CP (HL)       ; {  if (A >= *HL) goto next;
 $B422 JR NC,$B433   ; }
 $B424 DEC HL        ;   HL--;
 $B425 CP (HL)       ; {  if (A < *HL) goto next;
 $B426 JR C,$B433    ; }
 $B428 DEC DE        ;   DE--; // &hero_map_position.y;
 $B429 LD A,(DE)     ;   A = *DE;
 $B42A DEC HL        ;   HL--;
 $B42B CP (HL)       ; {  if (A == *HL) goto set_to_4;
 $B42C JR Z,$B462    ; }
 $B42E DEC A         ;   A--;
 $B42F CP (HL)       ; {  if (A == *HL) goto set_to_6;
 $B430 JR Z,$B46A    ; }
 $B432 INC DE        ;   DE++; // reset to Y
*$B433 POP HL        ; next: ...
 $B434 LD A,L        ; {  HL += 6; // array stride
 $B435 ADD A,$06     ;
 $B437 LD L,A        ;
 $B438 JR NC,$B43B   ;
 $B43A INC H         ; }
*$B43B DJNZ $B41F    ; %> while (--B);
 $B43D DEC DE        ; DE--; // &hero_map_position.y;
 $B43E DEC HL        ; {HL -= 3; // pointing to $B59E
 $B43F DEC HL        ;
 $B440 DEC HL        ; }
 $B441 LD B,$03      ; B = 3; // iterations
*$B443 PUSH HL       ; do <% ...
 $B444 LD A,(DE)     ;   A = *DE;
 $B445 CP (HL)       ; {  if (A < *HL) goto next2;
 $B446 JR C,$B457    ; }
 $B448 INC HL        ;   HL++;
 $B449 CP (HL)       ; {  if (A >= *HL) goto next2;
 $B44A JR NC,$B457   ; }
 $B44C INC DE        ;   DE++;
 $B44D LD A,(DE)     ;   A = *DE;
 $B44E INC HL        ;   HL++;
 $B44F CP (HL)       ; {  if (A == *HL) goto set_to_5;
 $B450 JR Z,$B466    ; }
 $B452 DEC A         ;   A--;
 $B453 CP (HL)       ; {  if (A == *HL) goto set_to_7;
 $B454 JR Z,$B46E    ; }
 $B456 DEC DE        ;   DE--;
*$B457 POP HL        ; next2: ...
 $B458 LD A,L        ; {  HL += 6; // array stride
 $B459 ADD A,$06     ;
 $B45B LD L,A        ;
 $B45C JR NC,$B45F   ;
 $B45E INC H         ; }
*$B45F DJNZ $B443    ; %> while (--B);
 $B461 RET           ; {return;
*$B462 LD A,$04      ;
 $B464 JR $B470      ; }
*$B466 LD A,$05      ; {set_to_5: A = 5; goto action_wiresnips_tail; // crawl TR
 $B468 JR $B470      ; }
*$B46A LD A,$06      ; {set_to_6: A = 6; goto action_wiresnips_tail; // crawl BR
 $B46C JR $B470      ; }
*$B46E LD A,$07      ; set_to_7: A = 7;                             // crawl BL
*$B470 POP HL        ; action_wiresnips_tail: ...
@nowarn
 $B471 LD HL,$800E   ; {$800E = A; // walk/crawl flag
 $B474 LD (HL),A     ; }
 $B475 DEC L         ; {$800D = input_KICK;
 $B476 LD (HL),$80   ; }
 $B478 LD HL,$8001   ; {$8001 = vischar_FLAGS_CUTTING_WIRE;
 $B47B LD (HL),$02   ; }
 $B47D LD A,$0C      ; {$8013 = 12; // set height
 $B47F LD ($8013),A  ; }
 $B482 LD HL,$CE2E   ; {$8015 = sprite_prisoner;
 $B485 LD ($8015),HL ; }
 $B488 LD A,($A12F)  ; {player_locked_out_until = game_counter + 96;
 $B48B ADD A,$60     ;
 $B48D LD ($A145),A  ; }
 $B490 LD B,$0B      ; {queue_message_for_display(message_CUTTING_THE_WIRE);
 $B492 JP $7D15      ; }

; Use lockpick.
@label=action_lockpick
c$B495 CALL $B4D0    ; get_nearest_door();
 $B498 RET NZ        ; if (!Z) return; /* No door nearby. */
 $B499 LD ($A143),HL ; ptr_to_door_being_lockpicked = HL;
 $B49C LD A,($A12F)  ; {player_locked_out_until = game_counter + 255;
 $B49F ADD A,$FF     ;
 $B4A1 LD ($A145),A  ; }
 $B4A4 LD HL,$8001   ; {($8001) = vischar_FLAGS_PICKING_LOCK;
 $B4A7 LD (HL),$01   ; }
 $B4A9 LD B,$0A      ; {queue_message_for_display(message_PICKING_THE_LOCK);
 $B4AB JP $7D15      ; }

; Use red key.
@label=action_red_key
c$B4AE LD A,$16      ; A = room_22_REDKEY;
 $B4B0 JR $B4B8      ; goto action_key;

; Use yellow key.
@label=action_yellow_key
c$B4B2 LD A,$0D      ; A = room_13_CORRIDOR;
 $B4B4 JR $B4B8      ; goto action_key;

; Use green key.
@label=action_green_key
c$B4B6 LD A,$0E      ; A = room_14_TORCH;
; FALL THROUGH into action_key.

; Use a key.
;
; Used by the routines at #R$B4AE and #R$B4B2.
;
; I:A Room number to which the key applies.
@label=action_key
c$B4B8 PUSH AF
 $B4B9 CALL $B4D0    ; get_nearest_door();
 $B4BC POP BC
 $B4BD RET NZ        ; if (!Z) return; /* No door nearby. */
 $B4BE LD A,(HL)     ; {A = *HL & ~door_LOCKED; // mask off locked flag
 $B4BF AND $7F       ; }
 $B4C1 CP B          ; if (A != B) <%
 $B4C2 LD B,$07      ;   B = message_INCORRECT_KEY; %>
 $B4C4 JR NZ,$B4CD   ; else <%
 $B4C6 RES 7,(HL)    ;   *HL &= ~door_LOCKED; /* Unlock. */
 $B4C8 CALL $A0E9    ;   increase_morale_by_10_score_by_50();
 $B4CB LD B,$06      ;   B = message_IT_IS_OPEN; %>
*$B4CD JP $7D15      ; queue_message_for_display(B);

; Return the door in range of the hero.
;
; Used by the routines at #R$B495 and #R$B4B8.
;
; O:HL Pointer to door in locked_doors.
; O:F  Returns NZ if door not found.
@label=get_nearest_door
c$B4D0 LD A,($68A0)  ; {if (room_index == room_0_OUTDOORS) goto outdoors; else goto indoors;
 $B4D3 AND A         ;
 $B4D4 JR Z,$B4D9    ;
 $B4D6 JP $B4FD      ; }
; Bug: Needless jump.
; .
; Outdoors.
*$B4D9 LD B,$05      ; outdoors: B = 5; // 5 iterations
 $B4DB LD HL,$F05D   ; HL = &locked_doors[0];
*$B4DE LD A,(HL)     ; {do <% A = *HL & ~door_LOCKED;
 $B4DF AND $7F       ; }
 $B4E1 EXX
 $B4E2 CALL $6A12    ;   HL = get_door();
 $B4E5 PUSH HL
 $B4E6 CALL $B252    ;   door_in_range();
 $B4E9 POP HL
 $B4EA JR NC,$B4FA   ;   if (!C) goto not_in_range;
 $B4EC INC HL        ; {  HL += 4;
 $B4ED INC HL        ;
 $B4EE INC HL        ;
 $B4EF INC HL        ; }
 $B4F0 CALL $B252    ;   door_in_range();
 $B4F3 JR NC,$B4FA   ;   if (!C) goto not_in_range;
 $B4F5 EXX
 $B4F6 INC HL        ;   HL++;
 $B4F7 DJNZ $B4DE    ; %> while (--B);
 $B4F9 RET           ; return;
*$B4FA EXX           ; not_in_range:
 $B4FB XOR A         ; A = 0;
 $B4FC RET           ; return;
; Indoors.
@nowarn
*$B4FD LD HL,$F05F   ; indoors: HL = &locked_doors[2];
 $B500 LD B,$08      ; B = 8; // 8 iterations // Bug: Ought to be 7 iterations.
*$B502 LD A,(HL)     ; {do <% C = *HL & ~door_LOCKED;
 $B503 AND $7F       ;
 $B505 LD C,A        ; }
; Search interior doors for C.
 $B506 LD DE,$81D6   ;   DE = &interior_doors;
*$B509 LD A,(DE)     ;   for (;;) <% A = *DE;
 $B50A CP $FF        ; {    if (A != door_NONE) <% // door_NONE => end of list
 $B50C JR Z,$B516    ; }
 $B50E AND $7F       ; {      if ((A & ~door_REVERSE) == C) goto found;
 $B510 CP C          ;
 $B511 JR Z,$B51C    ; }
 $B513 INC DE        ; {      DE++; %> %>
 $B514 JR $B509      ; }
*$B516 INC HL        ; next: HL++;
 $B517 DJNZ $B502    ; %> while (--B);
 $B519 OR $01        ; A |= 1;
 $B51B RET           ; return;
*$B51C LD A,(DE)     ; found: A = *DE;
 $B51D EXX
 $B51E CALL $6A12    ; HL = get_door();
 $B521 INC HL        ; HL++;
 $B522 EX DE,HL
; Range check pattern (-2..+3).
 $B523 LD HL,$81A4   ; HL = &saved_pos_x; // note: 16-bit values holding 8-bit values
 $B526 LD B,$02      ; B = 2; // 2 iterations
*$B528 LD A,(DE)     ; {do <% if (*HL <= *DE - 3 || *HL > *DE + 3) goto exx_next;
 $B529 SUB $03       ;
 $B52B CP (HL)       ;
 $B52C JR NC,$B53B   ;
 $B52E ADD A,$06     ;
 $B530 CP (HL)       ;
 $B531 JR C,$B53B    ; }
 $B533 INC HL        ; {  HL += 2;
 $B534 INC HL        ; }
 $B535 INC DE        ;   DE++;
 $B536 DJNZ $B528    ; %> while (--B);
 $B538 EXX
 $B539 XOR A         ; A = 0; // ok
 $B53A RET           ; return;
*$B53B EXX           ; exx_next:
 $B53C JR $B516      ; goto next;

; Wall boundaries.
@label=walls
b$B53E DEFB $6A,$6E,$52,$62,$00,$0B ; 0x6A, 0x6E, 0x52, 0x62, 0, 11 ;  0: hut 1 (leftmost on main map)
 $B544 DEFB $5E,$62,$52,$62,$00,$0B ; 0x5E, 0x62, 0x52, 0x62, 0, 11 ;  1: hut 2
 $B54A DEFB $52,$56,$52,$62,$00,$0B ; 0x52, 0x56, 0x52, 0x62, 0, 11 ;  2: hut 3 (rightmost on main map)
 $B550 DEFB $3E,$5A,$6A,$80,$00,$30 ; 0x3E, 0x5A, 0x6A, 0x80, 0, 48 ;  3: main building
 $B556 DEFB $34,$80,$72,$80,$00,$30 ; 0x34, 0x80, 0x72, 0x80, 0, 48 ;  4: main building
 $B55C DEFB $7E,$98,$5E,$80,$00,$30 ; 0x7E, 0x98, 0x5E, 0x80, 0, 48 ;  5: main building
 $B562 DEFB $82,$98,$5A,$80,$00,$30 ; 0x82, 0x98, 0x5A, 0x80, 0, 48 ;  6: main building
 $B568 DEFB $86,$8C,$46,$80,$00,$0A ; 0x86, 0x8C, 0x46, 0x80, 0, 10 ;  7: west wall
 $B56E DEFB $82,$86,$46,$4A,$00,$12 ; 0x82, 0x86, 0x46, 0x4A, 0, 18 ;  8: west turret wall
 $B574 DEFB $6E,$82,$46,$47,$00,$0A ; 0x6E, 0x82, 0x46, 0x47, 0, 10 ;  9: south wall
 $B57A DEFB $6D,$6F,$45,$49,$00,$12 ; 0x6D, 0x6F, 0x45, 0x49, 0, 18 ; 10: gate wall left
 $B580 DEFB $67,$69,$45,$49,$00,$12 ; 0x67, 0x69, 0x45, 0x49, 0, 18 ; 11: gate wall right
 $B586 DEFB $46,$46,$46,$6A,$00,$08 ; 0x46, 0x46, 0x46, 0x6A, 0, 8  ; 12: fence inner (vertical)
 $B58C DEFB $3E,$3E,$3E,$6A,$00,$08 ; 0x3E, 0x3E, 0x3E, 0x6A, 0, 8  ; 13: fence outer (vertical)
 $B592 DEFB $4E,$4E,$2E,$3E,$00,$08 ; 0x4E, 0x4E, 0x2E, 0x3E, 0, 8  ; 14: fence outer exercise (vertical)
 $B598 DEFB $68,$68,$2E,$45,$00,$08 ; 0x68, 0x68, 0x2E, 0x45, 0, 8  ; 15: fence outer exercise (vertical)
 $B59E DEFB $3E,$68,$3E,$3E,$00,$08 ; 0x3E, 0x68, 0x3E, 0x3E, 0, 8  ; 16: fence inner exercise (horizontal)
 $B5A4 DEFB $4E,$68,$2E,$2E,$00,$08 ; 0x4E, 0x68, 0x2E, 0x2E, 0, 8  ; 17: fence outer exercise (horizontal)
 $B5AA DEFB $46,$67,$46,$46,$00,$08 ; 0x46, 0x67, 0x46, 0x46, 0, 8  ; 18: fence inner (horizontal)
 $B5B0 DEFB $68,$6A,$38,$3A,$00,$08 ; 0x68, 0x6A, 0x38, 0x3A, 0, 8  ; 19: tower outside exercise yard
 $B5B6 DEFB $4E,$50,$2E,$30,$00,$08 ; 0x4E, 0x50, 0x2E, 0x30, 0, 8  ; 20: tower inside exercise yard
 $B5BC DEFB $46,$48,$46,$48,$00,$08 ; 0x46, 0x48, 0x46, 0x48, 0, 8  ; 21: tower at corner of main yard
 $B5C2 DEFB $46,$48,$5E,$60,$00,$08 ; 0x46, 0x48, 0x5E, 0x60, 0, 8  ; 22: tower at north east of main yard
 $B5C8 DEFB $69,$6D,$46,$49,$00,$08 ; 0x69, 0x6D, 0x46, 0x49, 0, 8  ; 23: gate wall middle

; (unknown) called_from_main_loop_9
;
; Used by the routines at #R$6939 and #R$9D7B.
@label=called_from_main_loop_9
c$B5CE LD B,$08        ; iterate over all eight vischars
 $B5D0 LD IY,$8000     ; set IY to first vischar
*$B5D4 LD A,(IY+$01)   ; get vischar.flags
 $B5D7 CP $FF          ; are flags set to vischar_FLAGS_EMPTY_SLOT?
 $B5D9 JP Z,$B6B4      ; if so - continue to next iteration
 $B5DC PUSH BC         ; stack counter
 $B5DD SET 7,(IY+$01)  ; set flag vischar_FLAGS_NO_COLLIDE
 $B5E1 BIT 7,(IY+$0D)  ; test vischar.input & input_KICK
 $B5E5 JP NZ,$B6BE     ; if set goto 'kicked'
 $B5E8 LD H,(IY+$0B)   ; get vischar.anim in HL
 $B5EB LD L,(IY+$0A)   ;
 $B5EE LD A,(IY+$0C)   ; ?anim index vischar.animindex
 $B5F1 AND A           ; test vischar_ANIMINDEX_BIT7  up/down flag ?
 $B5F2 JP P,$B64F      ;
 $B5F5 AND $7F         ; mask off vischar_ANIMINDEX_BIT7
 $B5F7 JP Z,$B6C2      ; if result is zero goto 'end_bit'
 $B5FA INC A           ; { anim = HL + (A + 1) * 4 - 1
 $B5FB ADD A,A         ;
 $B5FC ADD A,A         ;
 $B5FD LD C,A          ;
 $B5FE LD B,$00        ;
 $B600 ADD HL,BC       ;
 $B601 DEC HL          ; }
 $B602 LD A,(HL)       ; A = *HL; // a spriteindex_t
 $B603 EX AF,AF'       ; bank A
 $B604 INC HL          ; HL++
*$B605 EX DE,HL        ; decrement:
 $B606 LD L,(IY+$0F)   ;     L = IY[0x0F]; // X axis
 $B609 LD H,(IY+$10)   ;     H = IY[0x10];
 $B60C LD A,(DE)       ;     A = *DE; // sampled DE=$CF9A,$CF9E,$CFBE,$CFC2,$CFB2,$CFB6,$CFA6,$CFAA (character_related_data)
 $B60D LD C,A          ;     C = A;
 $B60E AND $80         ;     A &= 0x80;
 $B610 JR Z,$B614      ; {    if (A) A = 0xFF;
 $B612 LD A,$FF        ; }
*$B614 LD B,A          ;     B = A;
 $B615 SBC HL,BC       ;     HL -= BC;
 $B617 LD ($81A4),HL   ;     saved_pos_x = HL;
 $B61A INC DE          ;     DE++;
 $B61B LD L,(IY+$11)   ;     L = IY[0x11]; // Y axis
 $B61E LD H,(IY+$12)   ;     H = IY[0x12];
 $B621 LD A,(DE)       ;     A = *DE;
 $B622 LD C,A          ;     C = A;
 $B623 AND $80         ;     A &= 0x80;
 $B625 JR Z,$B629      ; {    if (A) A = 0xFF;
 $B627 LD A,$FF        ; }
*$B629 LD B,A          ;     B = A;
 $B62A SBC HL,BC       ;     HL -= BC;
 $B62C LD ($81A6),HL   ;     saved_pos_y = HL;
 $B62F INC DE          ;     DE++;
 $B630 LD L,(IY+$13)   ;     L = IY[0x13]; // height
 $B633 LD H,(IY+$14)   ;     H = IY[0x14];
 $B636 LD A,(DE)       ;     A = *DE;
 $B637 LD C,A          ;     C = A;
 $B638 AND $80         ;     A &= 0x80;
 $B63A JR Z,$B63E      ; {    if (A) A = 0xFF;
 $B63C LD A,$FF        ; }
*$B63E LD B,A          ;     B = A;
 $B63F SBC HL,BC       ;     HL -= BC;
 $B641 LD ($81A8),HL   ;     saved_height = HL;
 $B644 CALL $AF8F      ;     touch();
 $B647 JP NZ,$B6A8     ;     if (!Z) goto pop_next;
 $B64A DEC (IY+$0C)    ;     IY[0x0C]--;
 $B64D JR $B6A2        ;   %>
*$B64F CP (HL)         ; {  else <% if (A == *HL) goto end_bit;
 $B650 JP Z,$B6C2      ; }
 $B653 INC A           ; {    HL += (A + 1) * 4;
 $B654 ADD A,A         ;
 $B655 ADD A,A         ;
 $B656 LD C,A          ;
 $B657 LD B,$00        ;
 $B659 ADD HL,BC       ; }
*$B65A EX DE,HL        ;     increment:
 $B65B LD A,(DE)       ;     A = *DE;
 $B65C LD L,A          ;     L = A;
 $B65D AND $80         ;     A &= 0x80;
 $B65F JR Z,$B663      ; {    if (A) A = 0xFF;
 $B661 LD A,$FF        ; }
*$B663 LD H,A          ;     H = A;
 $B664 LD C,(IY+$0F)   ;     C = IY[0x0F]; // X axis
 $B667 LD B,(IY+$10)   ;     B = IY[0x10];
 $B66A ADD HL,BC       ;     HL += BC;
 $B66B LD ($81A4),HL   ;     saved_pos_x = HL;
 $B66E INC DE          ;     DE++;
 $B66F LD A,(DE)       ;     A = *DE;
 $B670 LD L,A          ;     L = A;
 $B671 AND $80         ;     A &= 0x80;
 $B673 JR Z,$B677      ; {    if (A) A = 0xFF;
 $B675 LD A,$FF        ; }
*$B677 LD H,A          ;     H = A;
 $B678 LD C,(IY+$11)   ;     C = IY[0x11]; // Y axis
 $B67B LD B,(IY+$12)   ;     B = IY[0x12];
 $B67E ADD HL,BC       ;     HL += BC;
 $B67F LD ($81A6),HL   ;     saved_pos_y = HL;
 $B682 INC DE          ;     DE++;
 $B683 LD A,(DE)       ;     A = *DE;
 $B684 LD L,A          ;     L = A;
 $B685 AND $80         ;     A &= 0x80;
 $B687 JR Z,$B68B      ; {    if (A) A = 0xFF;
 $B689 LD A,$FF        ; }
*$B68B LD H,A          ;     H = A;
 $B68C LD C,(IY+$13)   ;     C = IY[0x13]; // height
 $B68F LD B,(IY+$14)   ;     B = IY[0x14];
 $B692 ADD HL,BC       ;     HL += BC;
 $B693 LD ($81A8),HL   ;     saved_height = HL;
 $B696 INC DE          ;     DE++;
 $B697 LD A,(DE)       ;     A = *DE; // sprite_index
 $B698 EX AF,AF'
 $B699 CALL $AF8F      ;     touch();
 $B69C JP NZ,$B6A8     ;     if (!Z) goto pop_next;
 $B69F INC (IY+$0C)    ;     IY[0x0C]++; %>
*$B6A2 PUSH IY         ; {  HL = IY;
 $B6A4 POP HL          ; }
 $B6A5 CALL $B729      ;   calc_vischar_screenpos();
*$B6A8 POP BC          ;   pop_next:
 $B6A9 LD A,(IY+$01)   ; {  if (IY[1] != vischar_FLAGS_EMPTY_SLOT) IY[1] &= ~vischar_FLAGS_NO_COLLIDE; // $8001
 $B6AC CP $FF          ;
 $B6AE JR Z,$B6B4      ;
 $B6B0 RES 7,(IY+$01)  ; }
*$B6B4 LD DE,$0020     ;   next: DE = 32; // stride
 $B6B7 ADD IY,DE       ;   IY += DE;
 $B6B9 DEC B           ; {%> while (--B);
 $B6BA JP NZ,$B5D4     ; }
 $B6BD RET             ; return;
@label=kicked
*$B6BE RES 7,(IY+$0D)  ; reset input_KICK flag
@label=end_bit
*$B6C2 LD A,(IY+$0E)   ; get vischar.direction
 $B6C5 LD D,A          ; {multiply it by 9
 $B6C6 ADD A,A         ;
 $B6C7 ADD A,A         ;
 $B6C8 ADD A,A         ;
 $B6C9 ADD A,D         ; }
 $B6CA ADD A,(IY+$0D)  ; add vischar.input to it
 $B6CD LD E,A          ;
 $B6CE LD D,$00        ;
 $B6D0 LD HL,$CDAA     ; add it to byte_CDAA
 $B6D3 ADD HL,DE       ;
 $B6D4 LD A,(HL)       ; fetch the (table entry)
 $B6D5 LD C,A          ;
 $B6D6 LD L,(IY+$08)   ; HL = vischar.animbase
 $B6D9 LD H,(IY+$09)   ;
 $B6DC ADD A,A         ; double A (and in doing so discard the top bit!)
 $B6DD LD E,A          ;
 $B6DE ADD HL,DE       ; (D is still zero from above)
 $B6DF LD E,(HL)       ; { vischar.anim = *HL
 $B6E0 INC HL          ;
 $B6E1 LD (IY+$0A),E   ;
 $B6E4 LD D,(HL)       ;
 $B6E5 LD (IY+$0B),D   ; }
 $B6E8 BIT 7,C         ; {if ((C & (1<<7)) == 0) <%
 $B6EA JR NZ,$B6FC     ; }
 $B6EC LD (IY+$0C),$00 ; vischar.animindex = 0
 $B6F0 INC DE          ; {  DE += 2;
 $B6F1 INC DE          ; }
 $B6F2 LD A,(DE)       ; { vischar.direction = *DE;
 $B6F3 LD (IY+$0E),A   ; }
 $B6F6 INC DE          ; {  DE += 2; // point to groups of four
 $B6F7 INC DE          ; }
 $B6F8 EX DE,HL
 $B6F9 JP $B65A        ; goto increment
; else
*$B6FC LD A,(DE)       ; A = *DE; // count of four-byte groups
 $B6FD LD C,A          ;   C = A;
 $B6FE OR $80          ; {  vischar.animindex = A | vischar_ANIMINDEX_BIT7;
 $B700 LD (IY+$0C),A   ; }
 $B703 INC DE          ; {  vischar.direction = *++DE;
 $B704 LD A,(DE)       ;
 $B705 LD (IY+$0E),A   ; }
 $B708 INC DE          ; {  DE += 3; // point to groups of four
 $B709 INC DE          ;
 $B70A INC DE          ; }
 $B70B PUSH DE
 $B70C EX DE,HL
 $B70D LD A,C          ; {  HL += C * 4 - 1;
 $B70E ADD A,A         ;
 $B70F ADD A,A         ;
 $B710 DEC A           ;
 $B711 LD B,$00        ;
 $B713 LD C,A          ;
 $B714 ADD HL,BC       ; }
 $B715 LD A,(HL)       ;   A = *HL;
 $B716 EX AF,AF'
 $B717 POP HL
 $B718 JP $B605        ; goto decrement

; Reset position.
;
; Used by the routines at #R$68F4, #R$697D, #R$A491, #R$B2FC and #R$C4E0.
;
; I:HL Pointer to visible character.
@label=calc_vischar_screenpos_from_mi_pos
c$B71B PUSH HL
; Save a copy of the vischar's position + offset.
 $B71C LD A,$0F      ; {memcpy(&saved_pos_x, HL + 0x0F, 6);
 $B71E ADD A,L       ;
 $B71F LD L,A        ;
 $B720 LD DE,$81A4   ;
 $B723 LD BC,$0006   ;
 $B726 LDIR          ; }
 $B728 POP HL
; FALL THROUGH into calc_vischar_screenpos.

; Calculate screen position for vischars from saved_pos.
;
; Used by the routine at #R$B5CE.
; .
; Similar to drop_item_tail_interior.
;
; I:HL Pointer to visible character.
@label=calc_vischar_screenpos
c$B729 EX DE,HL
 $B72A LD A,$18      ; {HL += 0x18; // vischar->scrx/y
 $B72C ADD A,E       ;
 $B72D LD E,A        ; }
 $B72E LD HL,($81A6) ; {DE = saved_pos_y + 0x0200;
 $B731 LD BC,$0200   ;
 $B734 ADD HL,BC     ; }
 $B735 LD BC,($81A4)
 $B739 AND A
 $B73A SBC HL,BC     ; {DE = (DE - saved_pos_x) * 2;
 $B73C ADD HL,HL     ; }
 $B73D EX DE,HL
 $B73E LD (HL),E     ; {*HL++ = E;
 $B73F INC L         ; }
 $B740 LD (HL),D     ; {*HL++ = D;
 $B741 INC L         ; }
 $B742 EX DE,HL
 $B743 LD HL,$0800   ; {DE = 0x0800 - saved_pos_x - saved_height - saved_pos_y;
 $B746 AND A         ;
 $B747 SBC HL,BC     ;
 $B749 LD BC,($81A8) ;
 $B74D SBC HL,BC     ;
 $B74F LD BC,($81A6) ;
 $B753 SBC HL,BC     ; }
 $B755 EX DE,HL
 $B756 LD (HL),E     ; {*HL++ = E;
 $B757 INC L         ; }
 $B758 LD (HL),D     ; *HL = D;
 $B759 RET           ; return;

; Reset the game.
;
; Used by the routines at #R$9DE5, #R$A51C and #R$F163.
;
; .
;
; Cause discovery of all items.
@label=reset_game
c$B75A LD BC,$1000   ; B = item__LIMIT; C = 0;
*$B75D PUSH BC       ; do <%
 $B75E CALL $CD31    ;   item_discovered(C); // pass C as C
 $B761 POP BC
 $B762 INC C         ;   C++;
 $B763 DJNZ $B75D    ; %> while (--B);
; Reset message queue.
 $B765 LD HL,$7CFE   ; {message_queue_pointer = message_queue + 2;
 $B768 LD ($7D11),HL ; }
 $B76B CALL $B79B    ; reset_map_and_characters();
 $B76E XOR A         ; {$8001 = 0; // vischars[0].flags = 0
 $B76F LD ($8001),A  ; }
; Reset score digits, hero_in_breakfast, red_flag, automatic_player_counter, in_solitary, morale_exhausted.
 $B772 LD HL,$A132   ; HL = &score_digits[0];
 $B775 LD B,$0A      ; B = 10; // iterations
*$B777 LD (HL),A     ; {do <% *HL++ = 0;
 $B778 INC HL        ; }
 $B779 DJNZ $B777    ; %> while (--B); // could do a memset
; Reset morale.
 $B77B LD (HL),$70   ; morale = morale_MAX;
 $B77D CALL $A10B    ; plot_score();
; Reset and redraw items.
 $B780 LD HL,$FFFF   ; {items_held = item_NONE | (item_NONE << 8);
 $B783 LD ($8215),HL ; }
 $B786 CALL $7C33    ; draw_all_items();
; Reset the hero's sprite.
 $B789 LD HL,$CE2E   ; {$8015 = sprite_prisoner;
 $B78C LD ($8015),HL ; }
 $B78F LD A,$02      ; {room_index = room_2_HUT2LEFT;
 $B791 LD ($68A0),A  ; }
; Put the hero to bed.
 $B794 CALL $A489    ; hero_sleeps();
 $B797 CALL $68F4    ; enter_room();
 $B79A RET           ; return;

; Resets all visible characters, clock, day_or_night flag, general flags,
; collapsed tunnel objects, locks the gates, resets all beds, clears the mess
; halls and resets characters.
;
; Used by the routines at #R$B75A and #R$CB98.
@label=reset_map_and_characters
c$B79B LD B,$07         ; B = 7; // iterations
@nowarn
 $B79D LD HL,$8020      ; HL = $8020; // iterate over non-player characters
*$B7A0 PUSH BC          ; {do <%
 $B7A1 PUSH HL          ; }
 $B7A2 CALL $C5D3       ; {  reset_visible_character();
 $B7A5 POP HL           ; }
 $B7A6 LD A,L           ; {  HL += 32;
 $B7A7 ADD A,$20        ;
 $B7A9 LD L,A           ;
 $B7AA POP BC           ; }
 $B7AB DJNZ $B7A0       ; %> while (--B);
 $B7AD LD A,$07         ; {clock = 7;
 $B7AF LD ($A13D),A     ; }
 $B7B2 XOR A            ; {day_or_night = 0;
 $B7B3 LD ($A146),A     ; }
 $B7B6 LD ($8001),A     ; ($8001) = 0; // flags
 $B7B9 LD A,$14         ; {roomdef_50_blocked_tunnel_collapsed_tunnel = interiorobject_COLLAPSED_TUNNEL_SW_NE;
 $B7BB LD ($708C),A     ; }
 $B7BE LD A,$34         ; {blockage = 0x34; /* Reset boundary. */
@nowarn
 $B7C0 LD ($7077),A     ; }
; Lock the gates.
 $B7C3 LD HL,$F05D      ; HL = &locked_doors[0];
 $B7C6 LD B,$09         ; B = 9; // 9 iterations
*$B7C8 SET 7,(HL)       ; {do <% *HL++ |= door_LOCKED;
 $B7CA INC HL           ; }
 $B7CB DJNZ $B7C8       ; %> while (--B);
; Reset all beds.
 $B7CD LD B,$06         ; B = 6; // iterations
 $B7CF LD A,$17         ; {HL = &beds[0];
 $B7D1 LD HL,$6B79      ; }
*$B7D4 LD E,(HL)        ; {do <% E = *HL++;
 $B7D5 INC HL           ; }
 $B7D6 LD D,(HL)        ; {  D = *HL++;
 $B7D7 INC HL           ; }
 $B7D8 LD (DE),A        ;   *DE = interiorobject_OCCUPIED_BED;
 $B7D9 DJNZ $B7D4       ; %> while (--B);
; Clear the mess halls.
 $B7DB LD A,$0D         ; {roomdef_23_breakfast.bench_A = interiorobject_EMPTY_BENCH;
 $B7DD LD ($6F17),A     ; }
 $B7E0 LD ($6F1A),A     ; roomdef_23_breakfast.bench_B = interiorobject_EMPTY_BENCH;
 $B7E3 LD ($6F1D),A     ; roomdef_23_breakfast.bench_C = interiorobject_EMPTY_BENCH;
 $B7E6 LD ($6F4F),A     ; roomdef_25_breakfast.bench_D = interiorobject_EMPTY_BENCH;
 $B7E9 LD ($6F52),A     ; roomdef_25_breakfast.bench_E = interiorobject_EMPTY_BENCH;
 $B7EC LD ($6F55),A     ; roomdef_25_breakfast.bench_F = interiorobject_EMPTY_BENCH;
 $B7EF LD ($6F58),A     ; roomdef_25_breakfast.bench_G = interiorobject_EMPTY_BENCH;
; Reset characters 12..15 (guards) and 20..25 (prisoners).
 $B7F2 LD DE,$7667      ; DE = &character_structs[12].room;
 $B7F5 LD C,$0A         ; C = 10; // iterations
@nowarn
 $B7F7 LD HL,$B819      ; HL = &character_reset_data[0];
*$B7FA LD B,$03         ; {do <% memcpy(DE, HL, 3); DE += 3; HL += 3;
*$B7FC LD A,(HL)        ;
 $B7FD LD (DE),A        ;
 $B7FE INC DE           ;
 $B7FF INC HL           ;
 $B800 DJNZ $B7FC       ;
 $B802 EX DE,HL         ; }
 $B803 LD (HL),$12      ; {  *DE++ = 18; /* Bug/Odd: This is reset to 18 but the initial data is 24. */
 $B805 INC HL           ; }
 $B806 LD (HL),$00      ; {  *DE++ = 0x00;
 $B808 INC HL           ; }
 $B809 INC HL           ; {  DE += 2;
 $B80A INC HL           ;
 $B80B EX DE,HL         ; }
 $B80C LD A,C           ; {  if (C == 7) DE = &character_structs[20].room;
 $B80D CP $07           ;
 $B80F JR NZ,$B814      ;
 $B811 LD DE,$769F      ; }
*$B814 DEC C            ; {%> while (--C);
 $B815 JP NZ,$B7FA      ; }
 $B818 RET              ; return;
; 10 x 3-byte structs
; .
; struct { byte room; byte x; byte y; }; // partial of character_struct
@label=character_reset_data
 $B819 DEFB $03,$28,$3C ; room_3_HUT2RIGHT, 40,60 // for character 12
 $B81C DEFB $03,$24,$30 ; room_3_HUT2RIGHT, 36,48 // for character 13
 $B81F DEFB $05,$28,$3C ; room_5_HUT3RIGHT, 40,60 // for character 14
 $B822 DEFB $05,$24,$22 ; room_5_HUT3RIGHT, 36,34 // for character 15
 $B825 DEFB $FF,$34,$3C ; room_NONE,        52,60 // for character 20
 $B828 DEFB $FF,$34,$2C ; room_NONE,        52,44 // for character 21
 $B82B DEFB $FF,$34,$1C ; room_NONE,        52,28 // for character 22
 $B82E DEFB $FF,$34,$3C ; room_NONE,        52,60 // for character 23
 $B831 DEFB $FF,$34,$2C ; room_NONE,        52,44 // for character 24
 $B834 DEFB $FF,$34,$1C ; room_NONE,        52,28 // for character 25

; render_mask_buffer stuff.
@label=clip_x0
g$B837 DEFB $00
@label=clip_y0
 $B838 DEFB $00
@label=clip_height
 $B839 DEFB $00
@label=clip_width
 $B83A DEFB $00

; Check the mask buffer to see if the hero is hiding behind something.
;
; Used by the routine at #R$B866.
;
; I:IY Pointer to visible character.
@label=searchlight_mask_test
c$B83B PUSH IY       ; {HL = IY;
 $B83D POP HL        ; }
 $B83E LD A,L        ; {if (L) return; /* Skip non-hero characters. */
 $B83F AND A         ;
 $B840 RET NZ        ; }
 $B841 LD HL,$8131   ; HL = $8100 + $31; // mask_buffer + 0x31
; Bug: Does a fused load of BC, but doesn't use C after. Probably a leftover
; stride constant.
 $B844 LD BC,$0804   ; BC = 0x0804; // 8 iterations
 $B847 XOR A         ; {do <% if (*HL != 0) goto still_in_searchlight;
*$B848 CP (HL)       ;
 $B849 JR NZ,$B860   ; }
 $B84B INC L         ; {  HL += 4; // stride is 4?
 $B84C INC L         ;
 $B84D INC L         ;
 $B84E INC L         ; }
 $B84F DJNZ $B848    ; %> while (--B);
; Otherwise the hero has escaped the searchlight, so decrement the counter.
 $B851 LD HL,$81BD   ; HL = &searchlight_state;
 $B854 DEC (HL)      ; (*HL)--;
 $B855 LD A,$FF      ; {if (searchlight_STATE_SEARCHING != *HL) return;
 $B857 CP (HL)       ;
 $B858 RET NZ        ; }
 $B859 CALL $AB6B    ; choose_game_window_attributes();
 $B85C CALL $A15F    ; set_game_window_attributes();
 $B85F RET           ; return;
@label=still_in_searchlight
*$B860 LD HL,$81BD   ; {searchlight_state = searchlight_STATE_CAUGHT;
 $B863 LD (HL),$1F   ; }
 $B865 RET           ; return;

; Plot vischars and items in order.
;
; Used by the routines at #R$6939 and #R$9D7B.
;
; .
;
@label=plot_sprites
; This can return a vischar OR an itemstruct, but not both.
c$B866 CALL $B89C    ; locate_vischar_or_itemstruct();
 $B869 RET NZ        ; if (!Z) return;
 $B86A BIT 6,A       ; {if ((A & (1<<6)) == 0) <% // mysteryflagconst874 'item found' flag
 $B86C JR NZ,$B88F   ; }
 $B86E CALL $E420    ;   setup_vischar_plotting();
 $B871 JR NZ,$B866   ;   if (!Z) goto plot_sprites;
 $B873 CALL $B916    ;   render_mask_buffer();
 $B876 LD A,($81BD)  ; {  if (searchlight_state != searchlight_STATE_SEARCHING)
 $B879 CP $FF        ; searchlight_mask_test();
 $B87B CALL NZ,$B83B ; }
 $B87E LD A,(IY+$1E) ;   A = IY[0x1E];
 $B881 CP $03        ; {  if (A != 3) <%
 $B883 JR Z,$B88A    ; }
 $B885 CALL $E102    ;     masked_sprite_plotter_24_wide_vischar();
 $B888 JR $B866      ;     goto plot_sprites; %>
*$B88A CALL Z,$E2A2  ;   if (Z) masked_sprite_plotter_16_wide_vischar(); // odd to test for Z since it's always set
 $B88D JR $B866      ;   goto plot_sprites; %>
*$B88F CALL $DC41    ; else <% setup_item_plotting();
 $B892 JR NZ,$B866   ;   if (!Z) goto plot_sprites;
 $B894 CALL $B916    ;   render_mask_buffer();
 $B897 CALL $E29F    ;   masked_sprite_plotter_16_wide_item();
 $B89A JR $B866      ;   goto plot_sprites; %>

; Locates a vischar or item to plot.
;
; Used by the routine at #R$B866.
;
; O:IY vischar or itemstruct to plot.
@label=locate_vischar_or_itemstruct
c$B89C LD BC,$0000    ; BC = 0; // prev-x
 $B89F LD D,C         ; {DE = 0; // prev-y
 $B8A0 LD E,C         ; }
 $B8A1 LD A,$FF       ; A = 0xFF; // 'nothing found' marker 0xFF
 $B8A3 EX AF,AF'
 $B8A4 EXX
 $B8A5 LD DE,$0000    ; DE = 0;
 $B8A8 LD BC,$0820    ; B = 8; C = 32; // iterations, stride
 $B8AB LD HL,$8007    ; HL = $8007; // vischar byte7
*$B8AE BIT 7,(HL)     ; {do <% if ((*HL & vischar_BYTE7_LOCATABLE) == 0) goto next;
 $B8B0 JR Z,$B8F7     ; }
 $B8B2 PUSH HL        ;
 $B8B3 PUSH BC        ;
 $B8B4 LD A,$08       ; {  HL += 8; // $8007 + 8 = $800F = mi.pos.x
 $B8B6 ADD A,L        ;
 $B8B7 LD L,A         ; }
 $B8B8 LD C,(HL)      ; {  C = *HL++;
 $B8B9 INC L          ; }
 $B8BA LD B,(HL)      ;   B = *HL;
 $B8BB INC BC         ; {  BC += 4;
 $B8BC INC BC         ;
 $B8BD INC BC         ;
 $B8BE INC BC         ; }
 $B8BF PUSH BC
 $B8C0 EXX
 $B8C1 POP HL
 $B8C2 SBC HL,BC      ;
 $B8C4 EXX
 $B8C5 JR C,$B8F5     ;   JR C,pop_next
 $B8C7 INC L          ;   HL++;
 $B8C8 LD C,(HL)      ; {  C = *HL++;
 $B8C9 INC L          ; }
 $B8CA LD B,(HL)      ;   B = *HL;
 $B8CB INC BC         ; {  BC += 4;
 $B8CC INC BC         ;
 $B8CD INC BC         ;
 $B8CE INC BC         ; }
 $B8CF PUSH BC
 $B8D0 EXX
 $B8D1 POP HL
 $B8D2 SBC HL,DE      ;
 $B8D4 EXX
 $B8D5 JR C,$B8F5     ;   JR C,pop_next
 $B8D7 INC L          ;   HL++;
 $B8D8 POP BC
 $B8D9 PUSH BC
 $B8DA LD A,$08       ; {  A = 8 - B; /* Item index. */
 $B8DC SUB B          ; }
 $B8DD EX AF,AF'      ;   // unpaired
 $B8DE LD E,(HL)      ; {  E = *HL++;
 $B8DF INC L          ; }
 $B8E0 LD D,(HL)      ;   D = *HL;
 $B8E1 PUSH HL
 $B8E2 EXX
 $B8E3 POP HL
 $B8E4 DEC L          ; {  L -= 2;
 $B8E5 DEC L          ; }
 $B8E6 LD D,(HL)      ; {  D = *HL--;
 $B8E7 DEC L          ; }
 $B8E8 LD E,(HL)      ; {  E = *HL--;
 $B8E9 DEC L          ; }
 $B8EA LD B,(HL)      ; {  B = *HL--;
 $B8EB DEC L          ; }
 $B8EC LD C,(HL)      ;   C = *HL;
 $B8ED LD A,L         ; {  HL -= 15;
 $B8EE SUB $0F        ;
 $B8F0 LD L,A         ; }
 $B8F1 PUSH HL        ; {  IY = HL;
 $B8F2 POP IY         ; }
 $B8F4 EXX
*$B8F5 POP BC         ;   pop_next:
 $B8F6 POP HL
*$B8F7 LD A,L         ; {  next: HL += C;
 $B8F8 ADD A,C        ;
 $B8F9 LD L,A         ; }
 $B8FA DJNZ $B8AE     ; %> while (--B);
 $B8FC CALL $DBEB     ; get_greatest_itemstruct();
 $B8FF EX AF,AF'      ; // extract return value
; If A' top bit remains set from initialisation, then no vischar was found.
; (It's not affected by get_greatest_itemstruct which passes it through).
 $B900 BIT 7,A        ; {if (A & (1<<7)) return;
 $B902 RET NZ         ; }
 $B903 PUSH IY        ; {HL = IY;
 $B905 POP HL         ; }
 $B906 BIT 6,A        ; {if ((A & (1<<6)) == 0) <% // mysteryflagconst874 'item found' flag?
 $B908 JR NZ,$B90F    ; }
 $B90A RES 7,(IY+$07) ;   IY[7] &= ~vischar_BYTE7_LOCATABLE;
 $B90E RET            ;   return; %>
*$B90F INC HL         ; {else <% HL[1] &= ~itemstruct_ROOM_FLAG_NEARBY_6; // looks wrong: HL points to a vischar here
 $B910 RES 6,(HL)     ; }
; This is odd. It tests the bit we've just cleared as if we're setting flags
; for return, but we can't be as we're followed by another instruction...
; unless DEC HL doesn't alter the Z flag... which is true, it doesn't.
 $B912 BIT 6,(HL)     ; {  BIT 6,HL[1]
 $B914 DEC HL         ; }
 $B915 RET            ;   return; %>

; Render the mask buffer.
;
; Used by the routine at #R$B866.
;
; .
;
; Clear the mask buffer.
@label=render_mask_buffer
@nowarn
c$B916 LD HL,$8100   ; {memset(mask_buffer, 0xFF, 0xA0);
 $B919 LD (HL),$FF   ;
@nowarn
 $B91B LD DE,$8101   ;
 $B91E LD BC,$009F   ;
 $B921 LDIR          ; }
 $B923 LD A,($68A0)  ; {if (room_index) <%
 $B926 AND A         ;
 $B927 JR Z,$B935    ; }
; Indoors.
 $B929 LD HL,$81DA   ;   HL = &interior_mask_data;
 $B92C LD A,(HL)     ;   A = *HL; // count byte
 $B92D AND A         ; {  if (A == 0) return; // no masks
 $B92E RET Z         ; }
 $B92F LD B,A        ;   B = A; // iterations
 $B930 INC HL        ; {  HL += 3; %> // skip count byte, then off by 2 bytes
 $B931 INC HL        ;
 $B932 INC HL        ;
 $B933 JR $B93A      ; }
; Outdoors.
@bfix-begin
; Bug? This count of 59 doesn't match NELEMS(exterior_mask_data); which is 58.
*$B935 LD B,$3B      ; else <% B = 59; // 59 iterations
@bfix+else
*$B935 LD B,$3A      ; else <% B = NELEMS(exterior_mask_data); // 58 iterations
@bfix+end
 $B937 LD HL,$EC03   ;   HL = $EC03; // exterior_mask_data + 2 bytes %>
; Mask against all.
*$B93A PUSH BC       ; do <%
 $B93B PUSH HL
 $B93C LD A,($81B5)  ; {  A = screenpos_x - 1;
 $B93F DEC A         ; }
 $B940 CP (HL)       ; {  if (A >= HL[0] || A + 4 < HL[-1]) goto pop_next;
 $B941 JP NC,$BAC3   ;
 $B944 ADD A,$04     ;
 $B946 DEC HL        ;
 $B947 CP (HL)       ;
 $B948 JP C,$BAC3    ; }
 $B94B INC HL        ; {
 $B94C INC HL        ;
 $B94D INC HL        ; }
 $B94E LD A,($81B6)  ; {  A = screenpos_y - 1;
 $B951 DEC A         ; }
 $B952 CP (HL)       ; {  if (A >= HL[2] || A + 5 < HL[1]) goto pop_next;
 $B953 JP NC,$BAC3   ;
 $B956 ADD A,$05     ;
 $B958 DEC HL        ;
 $B959 CP (HL)       ;
 $B95A JP C,$BAC3    ; }
 $B95D INC HL        ; {
 $B95E INC HL        ; }
 $B95F LD A,($81B2)  ; {  if (tinypos_stash_x <= HL[3]) goto pop_next;
 $B962 CP (HL)       ;
 $B963 JP Z,$BAC3    ;
 $B966 JP C,$BAC3    ;
 $B969 INC HL        ; }
 $B96A LD A,($81B3)  ; {  if (tinypos_stash_y < HL[4]) goto pop_next;
 $B96D CP (HL)       ;
 $B96E JP C,$BAC3    ;
 $B971 INC HL        ; }
 $B972 LD A,($81B4)  ;   A = tinypos_stash_height;
 $B975 AND A         ; {  if (A) A--;
 $B976 JR Z,$B979    ;
 $B978 DEC A         ; }
*$B979 CP (HL)       ; {  if (A >= HL[5]) goto pop_next;
 $B97A JP NC,$BAC3   ; }
 $B97D LD A,L        ; {  HL -= 6;
 $B97E SUB $06       ;
 $B980 LD L,A        ;
 $B981 JR NC,$B984   ;
 $B983 DEC H         ; }
; Clipping.
*$B984 LD A,($81B5)  ;   A = screenpos_x;
 $B987 LD C,A        ;   C = A;
 $B988 CP (HL)       ; {  if (A >= *HL) <%
 $B989 JP C,$B99F    ; }
 $B98C SUB (HL)      ;     clip_x0 = A - *HL; // sampled HL=$81EC,$81F4,$EC12
 $B98D LD ($B837),A  ;
 $B990 INC HL        ;     HL++;
 $B991 LD A,(HL)     ; {    A = *HL - C;
 $B992 SUB C         ; }
 $B993 CP $03        ; {    if (A >= 3) A = 3;
 $B995 JR C,$B999    ;
 $B997 LD A,$03      ; }
*$B999 INC A         ; {    ($B83A) = ++A; // clip_width + 1 %>
 $B99A LD ($B83A),A  ; }
 $B99D JR $B9B6      ;   else <%
*$B99F LD B,(HL)     ;     B = *HL;
 $B9A0 XOR A         ; {    clip_x0 = 0;
 $B9A1 LD ($B837),A  ; }
 $B9A4 LD A,B        ; {    C = 4 - (B - C);
 $B9A5 SUB C         ;
 $B9A6 LD C,A        ;
 $B9A7 LD A,$04      ;
 $B9A9 SUB C         ;
 $B9AA LD C,A        ; }
 $B9AB INC HL        ;     HL++;
 $B9AC LD A,(HL)     ; {    A = (*HL - B) + 1;
 $B9AD SUB B         ;
 $B9AE INC A         ; }
 $B9AF CP C          ; {    if (A >= C) A = C;
 $B9B0 JR C,$B9B3    ;
 $B9B2 LD A,C        ; }
*$B9B3 LD ($B83A),A  ;     ($B83A) = A; // clip_width + 1 %>
*$B9B6 INC HL        ;   HL++;
 $B9B7 LD A,($81B6)  ;   A = screenpos_y;
 $B9BA LD C,A        ;   C = A;
 $B9BB CP (HL)       ; {  if (A >= *HL) <%
 $B9BC JP C,$B9D2    ; }
 $B9BF SUB (HL)      ;     A -= *HL;
 $B9C0 LD ($B838),A  ;     clip_y0 = A;
 $B9C3 INC HL        ; {    A = *++HL - C;
 $B9C4 LD A,(HL)     ;
 $B9C5 SUB C         ; }
 $B9C6 CP $04        ; {    if (A >= 4) A = 4;
 $B9C8 JR C,$B9CC    ;
 $B9CA LD A,$04      ; }
*$B9CC INC A         ;     A++;
 $B9CD LD ($B839),A  ; {    ($B839) = A; %>
 $B9D0 JR $B9E9      ; }
*$B9D2 LD B,(HL)     ;   else <% B = *HL;
 $B9D3 XOR A         ; {    clip_y0 = 0;
 $B9D4 LD ($B838),A  ; }
 $B9D7 LD A,B        ; {    C = 5 - (B - C);
 $B9D8 SUB C         ;
 $B9D9 LD C,A        ;
 $B9DA LD A,$05      ;
 $B9DC SUB C         ;
 $B9DD LD C,A        ; }
 $B9DE INC HL        ; {    A = (*++HL - B) + 1;
 $B9DF LD A,(HL)     ;
 $B9E0 SUB B         ;
 $B9E1 INC A         ; }
 $B9E2 CP C          ; {    if (A >= C) A = C;
 $B9E3 JR C,$B9E6    ;
 $B9E5 LD A,C        ; }
*$B9E6 LD ($B839),A  ;     ($B839) = A; %>
*$B9E9 DEC HL        ;   HL--;
 $B9EA LD BC,$0000   ;   BC = 0;
 $B9ED LD A,($B838)  ; {  if (clip_y0 == 0) C = -screenpos_y + *HL;
 $B9F0 AND A         ;
 $B9F1 JR NZ,$B9FA   ;
 $B9F3 LD A,($81B6)  ;
 $B9F6 NEG           ;
 $B9F8 ADD A,(HL)    ;
 $B9F9 LD C,A        ; }
*$B9FA DEC HL        ; {  HL -= 2;
 $B9FB DEC HL        ; }
 $B9FC LD A,($B837)  ; {  if (clip_x0 == 0) B = -screenpos_x + *HL;
 $B9FF AND A         ;
 $BA00 JR NZ,$BA09   ;
 $BA02 LD A,($81B5)  ;
 $BA05 NEG           ;
 $BA07 ADD A,(HL)    ;
 $BA08 LD B,A        ; }
*$BA09 DEC HL        ;   HL--;
 $BA0A LD A,(HL)     ;   A = *HL;
 $BA0B EX AF,AF'
 $BA0C LD A,C        ; {  Adash = C * 32 + B;
 $BA0D ADD A,A       ;
 $BA0E ADD A,A       ;
 $BA0F ADD A,A       ;
 $BA10 ADD A,A       ;
 $BA11 ADD A,A       ;
 $BA12 ADD A,B       ; }
@nowarn
 $BA13 LD HL,$8100   ; {  HL = mask_buffer + Adash;
 $BA16 ADD A,L       ;
 $BA17 LD L,A        ; }
 $BA18 LD ($81A0),HL ;   ($81A0) = HL; // mask buffer pointer
 $BA1B EX AF,AF'
 $BA1C ADD A,A       ; {  DE = mask_pointers[A];
 $BA1D LD C,A        ;
 $BA1E LD B,$00      ;
 $BA20 LD HL,$EBC5   ;
 $BA23 ADD HL,BC     ;
 $BA24 LD E,(HL)     ;
 $BA25 INC HL        ;
 $BA26 LD D,(HL)     ; }
 $BA27 LD HL,($B839) ;   L = clip_height; H = clip_width;
 $BA2A LD A,L        ; {  ($BA70) = L; // self modify
 $BA2B LD ($BA70),A  ; }
 $BA2E LD A,H        ; {  ($BA72) = H; // self modify
 $BA2F LD ($BA72),A  ; }
 $BA32 LD A,(DE)     ; {  ($BA90) = *DE - H; // self modify // *DE is the mask's width
 $BA33 SUB H         ;
 $BA34 LD ($BA90),A  ; }
 $BA37 LD A,$20      ; {  ($BABA) = 32 - H; // self modify
 $BA39 SUB H         ;
 $BA3A LD ($BABA),A  ; }
 $BA3D PUSH DE
 $BA3E LD A,(DE)     ; {  E = *DE;
 $BA3F LD E,A        ; }
 $BA40 LD A,($B838)  ;   A = clip_y0;
 $BA43 CALL $BACD    ;   HL = multiply(); D = 0;
 $BA46 LD A,($B837)  ; {  E = clip_x0;
 $BA49 LD E,A        ; }
 $BA4A ADD HL,DE     ;   HL += DE;
 $BA4B POP DE
 $BA4C INC HL        ;   HL++; // iterations
*$BA4D LD A,(DE)     ;   do <% A = *DE; // DE -> $E560 upwards (in exterior_mask_data)
 $BA4E AND A         ; {    if (A >= 128) <%
 $BA4F JP P,$BA60    ; }
 $BA52 AND $7F       ;       A &= 0x7F;
 $BA54 INC DE        ;       DE++;
 $BA55 LD C,A        ; {      HL -= A;
 $BA56 SBC HL,BC     ; }
 $BA58 JR C,$BA69    ;       if (HL < 0) goto $BA69;
 $BA5A INC DE        ;       DE++; // doesn't affect flags
 $BA5B JR NZ,$BA4D   ;       if (HL != 0) goto $BA4D;
 $BA5D XOR A         ;       A = 0;
 $BA5E JR $BA6C      ;       goto $BA6C; %>
*$BA60 INC DE        ;     DE++;
 $BA61 DEC HL        ; {  %> while (--HL);
 $BA62 LD A,L        ;
 $BA63 OR H          ;
 $BA64 JP NZ,$BA4D   ; }
 $BA67 JR $BA6C      ;   goto $BA6C;
*$BA69 LD A,L        ; {  A = -L;
 $BA6A NEG           ; }
*$BA6C LD HL,($81A0) ;   HL = ($81A0); // mask buffer pointer
 $BA6F LD C,$01      ;   C = 1; // self modified
*$BA71 LD B,$01      ;   do <% B = 1; // self modified
*$BA73 EX AF,AF'     ;     do <%
 $BA74 LD A,(DE)     ;       Adash = *DE;
 $BA75 AND A         ;       Adash &= Adash;
 $BA76 JP P,$BA7E    ;       if (!P) <%
 $BA79 AND $7F       ;         Adash &= 0x7F;
 $BA7B EX AF,AF'     ; // bank the counter
 $BA7C INC DE        ;         DE++;
 $BA7D LD A,(DE)     ;         A = *DE; %>
*$BA7E AND A         ;       A &= A;
 $BA7F CALL NZ,$BADC ;       if (!Z) mask_against_tile();
 $BA82 INC L         ;       L++;
 $BA83 EX AF,AF'     ;       // unpaired?
 $BA84 AND A         ; {      if (A != 0 && --A != 0) DE--;
 $BA85 JR Z,$BA8B    ;
 $BA87 DEC A         ;
 $BA88 JR Z,$BA8B    ;
 $BA8A DEC DE        ; }
*$BA8B INC DE        ;       DE++;
 $BA8C DJNZ $BA73    ;     %> while (--B);
 $BA8E PUSH BC
 $BA8F LD B,$01      ;     B = 1; // self modified
 $BA91 EX AF,AF'     ; bank while we test B
 $BA92 LD A,B        ; {    if (B) <%
 $BA93 AND A         ;
 $BA94 JP Z,$BAB9    ; }
 $BA97 EX AF,AF'     ; unbank
 $BA98 AND A         ; {      if (A) goto $BAA3;
 $BA99 JR NZ,$BAA3   ; }
*$BA9B LD A,(DE)     ;       do <% A = *DE;
 $BA9C AND A         ; {        if (A >= 128) <%
 $BA9D JP P,$BAAF    ; }
 $BAA0 AND $7F       ;         A &= 0x7F;
 $BAA2 INC DE        ;         DE++;
*$BAA3 LD C,A        ; {        B -= A;
 $BAA4 LD A,B        ;
 $BAA5 SUB C         ;
 $BAA6 LD B,A        ; }
 $BAA7 JR C,$BAB6    ;         if (B < 0) goto $BAB6;
 $BAA9 INC DE        ;         DE++; // doesn't affect flags
 $BAAA JR NZ,$BA9B   ;         if (B != 0) goto $BA9B;
 $BAAC EX AF,AF'     ;         // why not just jump instr earlier? // bank
 $BAAD JR $BAB9      ;         goto $BAB9; %>
*$BAAF INC DE        ;         DE++;
 $BAB0 DJNZ $BA9B    ;       %> while (--B);
 $BAB2 XOR A         ;       A = 0;
 $BAB3 EX AF,AF'     ;       // why not just jump instr earlier? // bank
 $BAB4 JR $BAB9      ;       goto $BAB9;
*$BAB6 NEG           ;       A = -A;
 $BAB8 EX AF,AF'     ;       // bank %>
*$BAB9 LD A,$20      ; {    HL += 32; // self modified
 $BABB ADD A,L       ;
 $BABC LD L,A        ; }
 $BABD EX AF,AF'     ;     // unbank
 $BABE POP BC
 $BABF DEC C         ; {  %> while (--C);
 $BAC0 JP NZ,$BA71   ; }
*$BAC3 POP HL        ;   pop_next:
 $BAC4 POP BC
 $BAC5 LD DE,$0008   ; {  HL += 8;
 $BAC8 ADD HL,DE     ; }
 $BAC9 DEC B         ; {%> while (--B);
 $BACA JP NZ,$B93A   ; }
@rfix-begin
; Bug: RET is missing here. We fall through into multiply.
@rfix+else
       RET
@rfix+end

; Multiply the two input values, A and E, returning a widened result in HL.
;
; Used by the routine at #R$B916.
;
; I:A Left hand value.
; I:E Right hand value.
; O:D Zero.
; O:HL Multiplied result.
@label=multiply
c$BACD LD B,$08      ; B = 8; // iterations
 $BACF LD HL,$0000   ; HL = 0;
 $BAD2 LD D,H        ; D = 0;
*$BAD3 ADD HL,HL     ; do <% HL += HL;
 $BAD4 RLA           ;   RLA  // carry = (A >> 7); A <<= 1; /* shift out of high end */
 $BAD5 JP NC,$BAD9   ; {  if (carry) HL += DE; /* shift into low end */
 $BAD8 ADD HL,DE     ; }
*$BAD9 DJNZ $BAD3    ; %> while (--B);
 $BADB RET           ; return;

; AND a tile in the mask buffer against the specified mask tile.
;
; Used by the routine at #R$B916.
;
; I:A Mask tile index.
; I:HL Pointer to a tile to be masked.
@label=mask_against_tile
c$BADC PUSH HL       ; DEdash = HL
 $BADD EXX
 $BADE LD L,A        ; {HLdash = &mask_tiles[A];
 $BADF LD H,$00      ;
 $BAE1 ADD HL,HL     ;
 $BAE2 ADD HL,HL     ;
 $BAE3 ADD HL,HL     ;
 $BAE4 LD BC,$8218   ;
 $BAE7 ADD HL,BC     ; }
 $BAE8 POP DE
 $BAE9 LD B,$08      ; Bdash = 8; // 8 iterations
*$BAEB LD A,(DE)     ; {do <% *DEdash &= *HLdash++;
 $BAEC AND (HL)      ;
 $BAED LD (DE),A     ;
 $BAEE INC L         ; }
 $BAEF INC E         ; {  DEdash += 4; /* mask buffer rowbytes */
 $BAF0 INC E         ;
 $BAF1 INC E         ;
 $BAF2 INC E         ; }
 $BAF3 DJNZ $BAEB    ; %> while (--Bdash);
 $BAF5 EXX
 $BAF6 RET           ; return;

; Clipping vischars to the game window.
;
; Used by the routines at #R$BB98 and #R$E420.
;
; O:A 0 => visible, 0xFF => invisible.
; O:BC Clipped width.
; O:DE Clipped height.
; O:IY Pointer to visible character.
;
; Width part.
@label=vischar_visible
c$BAF7 LD HL,$81B5    ; HL = &screenpos_x;
 $BAFA LD A,($81BB)   ; {A = map_position[0] + 24;
 $BAFD ADD A,$18      ; }
 $BAFF SUB (HL)       ; A -= *HL;
 $BB00 JP Z,$BB94     ; {if (A > 0) <%
 $BB03 JP C,$BB94     ; }
 $BB06 CP (IY+$1E)    ;   CP IY[30]  // if (A ?? IY[30])
 $BB09 JP NC,$BB11    ;   if (carry) <%
 $BB0C LD B,$00       ; {    BC = A; %>
 $BB0E LD C,A         ; }
 $BB0F JR $BB33       ;   else <%
*$BB11 LD A,(HL)      ; {    A = *HL + IY[30];
 $BB12 ADD A,(IY+$1E) ; }
 $BB15 LD HL,$81BB    ; {    A -= map_position[0];
 $BB18 SUB (HL)       ; }
 $BB19 JP Z,$BB94     ; {    if (A <= 0) goto exit;
 $BB1C JP C,$BB94     ; }
 $BB1F CP (IY+$1E)    ;     CP IY[30]
 $BB22 JP NC,$BB2E    ;     if (carry) <%
 $BB25 LD C,A         ;       C = A;
 $BB26 NEG            ; {      B = -A + IY[30]; %>
 $BB28 ADD A,(IY+$1E) ;
 $BB2B LD B,A         ; }
 $BB2C JR $BB33       ;     else <%
*$BB2E LD B,$00       ; {      BC = IY[30]; %> %>
 $BB30 LD C,(IY+$1E)  ; }
; Height part.
*$BB33 LD A,($81BC)   ; {  HL = ((map_position >> 8) + 17) * 8;
 $BB36 ADD A,$11      ;
 $BB38 LD L,A         ;
 $BB39 LD H,$00       ;
 $BB3B ADD HL,HL      ;
 $BB3C ADD HL,HL      ;
 $BB3D ADD HL,HL      ; }
 $BB3E LD E,(IY+$1A)  ;   E = IY[26];
 $BB41 LD D,(IY+$1B)  ;   D = IY[27];
 $BB44 AND A          ;   A &= A;
 $BB45 SBC HL,DE      ;   HL -= DE;
 $BB47 JP Z,$BB94     ; {  if (result <= 0) goto exit;
 $BB4A JP C,$BB94     ; }
 $BB4D LD A,H         ; {  if (H) goto exit;
 $BB4E AND A          ;
 $BB4F JP NZ,$BB94    ; }
 $BB52 LD A,L         ;   A = L;
 $BB53 CP (IY+$1F)    ;   CP IY[31]
 $BB56 JP NC,$BB5E    ;   if (carry) <%
 $BB59 LD E,A         ; {    DE = A; %>
 $BB5A LD D,$00       ; }
 $BB5C JR $BB92       ;   else <%
*$BB5E LD L,(IY+$1F)  ; {    HL = IY[31] + DE;
 $BB61 LD H,$00       ;
 $BB63 ADD HL,DE      ; }
 $BB64 EX DE,HL       ; {    DE = map_position >> 8 * 8;
 $BB65 LD A,($81BC)   ;
 $BB68 LD L,A         ;
 $BB69 LD H,$00       ;
 $BB6B ADD HL,HL      ;
 $BB6C ADD HL,HL      ;
 $BB6D ADD HL,HL      ;
 $BB6E EX DE,HL       ; }
 $BB6F AND A          ;     A &= A; // likely: clear carry
 $BB70 SBC HL,DE      ;     HL -= DE;
 $BB72 JP C,$BB94     ; {    if (result <= 0) goto exit;
 $BB75 JP Z,$BB94     ; }
 $BB78 LD A,H         ; {    if (H) goto exit;
 $BB79 AND A          ;
 $BB7A JP NZ,$BB94    ; }
 $BB7D LD A,L         ;     A = L;
 $BB7E CP (IY+$1F)    ;     CP IY[31]
 $BB81 JP NC,$BB8D    ;     if (carry) <%
 $BB84 LD E,A         ;       E = A;
 $BB85 NEG            ; {      D = -A + IY[31]; %>
 $BB87 ADD A,(IY+$1F) ;
 $BB8A LD D,A         ; }
 $BB8B JR $BB92       ;     else <%
*$BB8D LD D,$00       ; {      DE = IY[31]; %> %>
 $BB8F LD E,(IY+$1F)  ; }
*$BB92 XOR A          ;   A = 0; // return Z (vischar is visible)
 $BB93 RET            ;   return; %>
*$BB94 LD A,$FF       ; exit: A = 0xFF;
 $BB96 AND A          ; A &= A; // return NZ (vischar is not visible)
 $BB97 RET            ; return;

; Paints any tiles occupied by visible characters with tiles from tile_buf.
;
; Used by the routine at #R$9D7B.
@label=restore_tiles
c$BB98 LD B,$08      ; B = 8; // iterations
 $BB9A LD IY,$8000   ; IY = $8000;
*$BB9E PUSH BC       ; do <%
 $BB9F LD A,(IY+$01) ; {  if (IY[1] == vischar_FLAGS_EMPTY_SLOT) goto next;
 $BBA2 CP $FF        ;
 $BBA4 JP Z,$BC9F    ; }
 $BBA7 LD H,(IY+$1B) ; {  screenpos_y = (IY[26] >> 3) | (IY[27] << 5); // divide by 8
 $BBAA LD A,(IY+$1A) ;
 $BBAD SRL H         ;
 $BBAF RRA           ;
 $BBB0 SRL H         ;
 $BBB2 RRA           ;
 $BBB3 SRL H         ;
 $BBB5 RRA           ;
 $BBB6 LD ($81B6),A  ; }
 $BBB9 LD H,(IY+$19) ; {  screenpos_x = (IY[24] >> 3) | (IY[25] << 5); // divide by 8
 $BBBC LD A,(IY+$18) ;
 $BBBF SRL H         ;
 $BBC1 RRA           ;
 $BBC2 SRL H         ;
 $BBC4 RRA           ;
 $BBC5 SRL H         ;
 $BBC7 RRA           ;
 $BBC8 LD ($81B5),A  ; }
 $BBCB CALL $BAF7    ;   vischar_visible();
 $BBCE CP $FF        ; {  if (A == 0xFF) goto next; // vischar not visible
 $BBD0 JP Z,$BC9F    ; }
 $BBD3 LD A,E        ; {  A = ((E >> 3) & 31) + 2;
 $BBD4 RRA           ;
 $BBD5 RRA           ;
 $BBD6 RRA           ;
 $BBD7 AND $1F       ;
 $BBD9 ADD A,$02     ; }
 $BBDB PUSH AF
;
 $BBDC LD HL,$81B6   ; {  A += screenpos_y - map_position_y;
 $BBDF ADD A,(HL)    ;
 $BBE0 LD HL,$81BC   ;
 $BBE3 SUB (HL)      ; }
;
 $BBE4 JR C,$BBF7    ;   if (A >= 0) <%
 $BBE6 SUB $11       ;     A -= 17;
 $BBE8 JR Z,$BBF7    ; {    if (A > 0) <%
 $BBEA JR C,$BBF7    ; }
 $BBEC LD E,A        ;       E = A;
 $BBED POP AF
 $BBEE SUB E         ;       A -= E;
 $BBEF JP C,$BC9F    ;       if (carry) goto next;
 $BBF2 JR NZ,$BBF8   ;       if (!Z) goto $BBF8;
 $BBF4 JP $BC9F      ;       goto next; %> %>
*$BBF7 POP AF
;
*$BBF8 CP $05        ; {  if (A > 5) A = 5;
 $BBFA JP Z,$BC02    ;
 $BBFD JP C,$BC02    ;
 $BC00 LD A,$05      ; }
;
*$BC02 LD ($BC5F),A  ;   ($BC5F) = A; // self modify outer loop counter
 $BC05 LD A,C        ;   A = C;
 $BC06 LD ($BC61),A  ;   ($BC61) = A; // self modify inner loop counter
 $BC09 LD ($BC89),A  ;   ($BC89) = A; // self modify
 $BC0C LD A,$18      ; {  A = 24 - C;
 $BC0E SUB C         ; }
 $BC0F LD ($BC8E),A  ;   ($BC8E) = A; // self modify
 $BC12 ADD A,$A8     ;   A += $A8;
 $BC14 LD ($BC95),A  ;   ($BC95) = A; // self modify
;
; Work out x,y offsets into the tile buffer.
 $BC17 LD HL,$81BB   ;   HL = &map_position;
 $BC1A LD A,B        ;   A = B;
 $BC1B AND A         ;   A &= A;
 $BC1C LD A,$00      ;   A = 0; // interleaved
 $BC1E JR NZ,$BC24   ;   if (Z) <%
 $BC20 LD A,($81B5)  ;     A = screenpos_x;
 $BC23 SUB (HL)      ;     A -= *HL; %>
*$BC24 LD B,A        ;   B = A;
;
 $BC25 LD A,D        ;   A = D;
 $BC26 AND A         ;   A &= A;
 $BC27 LD A,$00      ;   A = 0; // interleaved
 $BC29 JR NZ,$BC30   ;   if (Z) <%
 $BC2B INC HL        ;     HL++;
 $BC2C LD A,($81B6)  ;     A = screenpos_y;
 $BC2F SUB (HL)      ;     A -= *HL; %>
*$BC30 LD C,A        ;   C = A;
;
; Calculate the offset into screen buffer.
; C * 192 == C * 24 * 8
 $BC31 LD H,C        ; {  DE = C << 7;
 $BC32 XOR A         ;
 $BC33 SRL H         ;
 $BC35 RRA           ;
 $BC36 LD E,A        ;
 $BC37 LD D,H        ; }
 $BC38 SRL H         ; {  HL = C << 6;
 $BC3A RRA           ;
 $BC3B LD L,A        ; }
 $BC3C ADD HL,DE     ; {  HL += DE + B + $F290; // screen buffer start address
 $BC3D LD E,B        ;
 $BC3E LD D,$00      ;
 $BC40 ADD HL,DE     ;
 $BC41 LD DE,$F290   ;
 $BC44 ADD HL,DE     ; }
;
 $BC45 EX DE,HL      ; swap it into DE. HL about to be overwritten.
;
; Copy BC (x,y coord) into HL'
 $BC46 PUSH BC
 $BC47 EXX
 $BC48 POP HL        ;   POP HLdash
 $BC49 EXX
;
 $BC4A LD A,B        ;   A = B;
 $BC4B LD L,C        ; {  HL = C * 24 + A + $F0F8; // visible tiles array
 $BC4C LD H,$00      ;
 $BC4E ADD HL,HL     ;
 $BC4F ADD HL,HL     ;
 $BC50 ADD HL,HL     ;
 $BC51 LD C,L        ;
 $BC52 LD B,H        ;
 $BC53 ADD HL,HL     ;
 $BC54 ADD HL,BC     ;
 $BC55 LD C,A        ;
 $BC56 LD B,$00      ;
 $BC58 ADD HL,BC     ;
 $BC59 LD BC,$F0F8   ;
 $BC5C ADD HL,BC     ; }
 $BC5D EX DE,HL
 $BC5E LD C,$05      ;   C = 5; // iterations // self modified $BC5F
*$BC60 LD B,$04      ;   do <% B = 4; // iterations // self modified $BC61
*$BC62 PUSH HL       ;     do <%
 $BC63 LD A,(DE)     ;       A = *DE;
 $BC64 EXX
 $BC65 POP DE        ;       POP DEdash // visible tiles array pointer
 $BC66 PUSH HL       ;       PUSH HLdash // save x,y
 $BC67 CALL $BCAA    ;       select_tile_set(); // call using banked registers
 $BC6A LD L,A        ; {      HLdash = A * 8 + BCdash;
 $BC6B LD H,$00      ;
 $BC6D ADD HL,HL     ;
 $BC6E ADD HL,HL     ;
 $BC6F ADD HL,HL     ;
 $BC70 ADD HL,BC     ; }
 $BC71 LD BC,$0818   ;       Bdash, Cdash = 8, 24; // iterations, stride
*$BC74 LD A,(HL)     ; {      do <% *DEdash = *HLdash++;
 $BC75 LD (DE),A     ; }
 $BC76 LD A,C        ; {        DEdash += Cdash;
 $BC77 ADD A,E       ;
 $BC78 JR NC,$BC7B   ;
 $BC7A INC D         ;
*$BC7B LD E,A        ;
 $BC7C INC L         ; }
 $BC7D DJNZ $BC74    ;       %> while (--Bdash);
 $BC7F POP HL        ;       POP HLdash
 $BC80 INC H         ;       Hdash++;
 $BC81 EXX
 $BC82 INC DE        ;       DE++;
 $BC83 INC HL        ;       HL++;
 $BC84 DJNZ $BC62    ;     %> while (--B);
 $BC86 EXX
 $BC87 LD A,H        ;     A = Hdash;
 $BC88 SUB $00       ;     A -= 0; // self modified $BC89
 $BC8A LD H,A        ;     Hdash = A;
 $BC8B INC L         ;     Ldash++;
 $BC8C EXX
 $BC8D LD A,$14      ;     A = 20; // self modified $BC8E
 $BC8F ADD A,E       ;     A += E;
 $BC90 JR NC,$BC93   ; {    if (carry) D++;
 $BC92 INC D         ; }
*$BC93 LD E,A        ;     E = A;
 $BC94 LD A,$BC      ;     A = $BC; // self modified $BC95
 $BC96 ADD A,L       ;     A += L;
 $BC97 JR NC,$BC9A   ; {    if (carry) H++;
 $BC99 INC H         ; }
*$BC9A LD L,A        ;     L = A;
 $BC9B DEC C         ; {  %> while (--C);
 $BC9C JP NZ,$BC60   ; }
*$BC9F POP BC        ;   next:
 $BCA0 LD DE,$0020   ; {  IY += 32; // stride
 $BCA3 ADD IY,DE     ;
 $BCA5 DEC B         ; }
 $BCA6 JP NZ,$BB9E   ; %> while (--B);
 $BCA9 RET           ; return;

; Turn a map ref into a tile set pointer.
;
; Used by the routine at #R$BB98.
;
; I:H X shift.
; I:L Y shift.
; O:A  Preserved.
; O:BC Pointer to tile set.
@label=select_tile_set
c$BCAA EX AF,AF'
 $BCAB LD A,($68A0)  ; {if (room_index) <%
 $BCAE AND A         ;
 $BCAF JR Z,$BCB6    ; }
 $BCB1 LD BC,$9768   ;   BC = &interior_tiles[0];
 $BCB4 EX AF,AF'
 $BCB5 RET           ;   return; %>
; Convert map position to an index into 7x5 supertile refs array.
*$BCB6 LD A,($81BC)  ; {else <% Adash = (((map_position >> 8) & 3) + L) >> 2;
 $BCB9 AND $03       ;
 $BCBB ADD A,L       ;
 $BCBC RRA           ;
 $BCBD RRA           ; }
 $BCBE AND $3F       ; {  L = (Adash & 0x3F) * 7; // vertical
 $BCC0 LD L,A        ;
 $BCC1 ADD A,A       ;
 $BCC2 ADD A,A       ;
 $BCC3 ADD A,A       ;
 $BCC4 SUB L         ;
 $BCC5 LD L,A        ; }
 $BCC6 LD A,($81BB)  ; {  Adash = (((map_position & 0xFF) & 3) + H) >> 2;
 $BCC9 AND $03       ;
 $BCCB ADD A,H       ;
 $BCCC RRA           ;
 $BCCD RRA           ; }
 $BCCE AND $3F       ; {  Adash = (Adash & 0x3F) + L; // horizontal
 $BCD0 ADD A,L       ; }
 $BCD1 LD HL,$FF58   ; {  Adash = $FF58[Adash]; // (7x5) supertile refs
 $BCD4 ADD A,L       ;
 $BCD5 LD L,A        ;
 $BCD6 LD A,(HL)     ; }
 $BCD7 LD BC,$8590   ;   BC = &exterior_tiles[0];
 $BCDA CP $2D        ; {  if (Adash >= 45) <%
 $BCDC JR C,$BCEC    ; }
 $BCDE LD BC,$8A18   ;     BC = &exterior_tiles[145];
 $BCE1 CP $8B        ; {    if (Adash >= 139 && Adash < 204) <%
 $BCE3 JR C,$BCEC    ;
 $BCE5 CP $CC        ;
 $BCE7 JR NC,$BCEC   ; }
 $BCE9 LD BC,$90F8   ;       BC = &exterior_tiles[145 + 220]; %> %>
*$BCEC EX AF,AF'
 $BCED RET           ;   return; %>

; Map super-tile refs. 54x34. Each byte represents a 32x32 tile.
;
; The map, with blanks and grass replaced to show the outline more clearly:
;                                                                         5F 33 3C 58
;                                                                   5F 33 34 2E 3D 45 3C 58
;                               55 5E 31                         33 34 2B 37 2D 3F 28 48 42 5B 58
;                               82 3E 30 2E 57             33 34 2E 37 2A 2F 2C 41 26 47 43 53 42 3C 57
;                         75 76 81 5E 31 33 3C 5E 31 33 34 2B 35 2D 36 29 .. .. .. .. 49 44 54 43 3D 45 3C 58
;                   75 76 7C 7F 80 3E 30 39 3D 3E 30 2E 35 2A 2F 38 .. .. .. .. .. .. .. .. 41 44 46 27 48 42 5B 58
; 75 76 7A 79 75 76 7C 7F 7E 3A 5D 40 31 3A 3F 40 31 2D 2F 29 .. .. .. .. .. .. .. .. .. .. .. .. 41 26 47 43 53 42 3C 58
; 6A 74 77 78 7B 7F 7E 3A 2F 2C 49 3B 32 2C 41 3B 32 38 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 49 44 54 43 3D 52 59 53
; 63 64 66 6F 7D 3A 2F 38 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 06 07 .. .. .. .. .. .. .. .. 41 44 46 51 5D 58 5A 53
; 65 62 6C 6D 36 2C .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 02 03 04 08 1A .. .. .. .. .. .. .. .. .. 41 44 5C 5B 57 58 5A 53
; 63 64 6B 6E 71 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 02 03 04 05 09 1C 1B .. .. .. .. .. .. .. .. .. .. .. 59 53 45 3C 57 58 5A
; 61 62 5A 73 72 70 71 .. .. .. .. .. .. .. .. .. .. .. .. .. 02 03 14 05 0A 17 1E 1D .. .. .. .. 06 07 .. .. .. .. .. .. 55 58 5A 53 45 3C 57
; 49 3B 68    5A 73 72 70 71 .. .. 75 76 7A 79 .. .. .. 00 01 04 05 0A 21 22 16 1F 19 .. .. 02 03 04 08 1A .. .. .. .. .. 4B 45 3C 58 5A 53 45 45
; .. .. 41 56 68    5A 73 72 70 71 6A 74 84 85 7A 79 .. 0D 0C 0B 17 20 16 15 18 .. .. 02 03 04 05 09 1C 1B .. .. .. .. .. 4A 50 4C 52 5B 58 5A
; .. .. .. .. 49 56 68 69 5A 73 72 63 86 88 74 77 78 .. 0E 0F 12 16 15 18 .. .. 02 03 14 05 0A 17 1E 1D .. .. .. .. 06 07 49 44 4D 51 4C 52 3C 58
; .. .. .. .. .. .. 49 67 68 69 5A 65 87 83 64 66 6F .. 10 11 13 18 .. .. 00 01 04 05 0A 21 22 16 1F 19 .. .. 02 03 04 08 1A .. 41 44 4E 51 4C 45 3C 58
; .. .. .. .. .. .. .. .. 41 67 68 59 CC CD 62 8A 6D .. .. .. .. .. .. .. 0D 0C 0B 17 20 16 15 18 .. .. 02 03 04 05 09 1C 1B .. .. .. 49 44 4E 28 4C 52 5B 58
; .. .. .. .. .. .. .. .. .. .. 41 89 CE CF D2 D5 6F .. .. .. .. .. .. .. 0E 0F 12 16 15 18 .. .. 02 03 14 05 0A 17 1E 1D .. .. .. B9 BA .. 49 26 C8 C9 4C 45 3C 58
; .. .. .. .. .. .. .. B9 BA B1 B1 49 D0 D1 D3 D6 D8 9B 9C .. .. .. .. .. 10 11 13 18 .. .. 00 01 04 05 0A 21 22 16 1F 19 .. .. BB BC BD BE 9D 97 CA CB 4D 28 4C 45
; .. .. .. .. .. .. BB BC BD BE AF B2 B7 93 D4 D7 D9 8E 90 9B 9C .. .. .. .. .. .. .. .. .. 0D 0C 0B 17 20 16 15 18 .. .. .. .. .. C5 C0 97 96 93 95 94 41 26 C8 C9
; .. .. .. .. .. B1 B1 C5 C0 97 96 B3 B5 B6 '' '' 8C 8D 8B 8E 90 9B 9C .. .. .. .. .. .. .. 0E 0F 12 16 15 18 .. .. .. .. .. 9C 9D C6 C2 93 95 94 '' 99 98 97 CA CB
; .. .. .. B1 B1 B0 AF C6 C2 93 95 B4 8B 8E 90 8F '' '' 8C 8D 8B 8E A8 AA 9C .. .. .. .. .. 10 11 13 18 .. .. .. .. .. 9C 9D 97 96 C7 C4 94 '' 99 98 97 96 93 95 94
; .. .. B1 B0 AF 97 96 C7 C4 94 '' B8 8C 8D 8B 8E 90 8F '' '' 8C 8D A7 A6 90 9B 9C .. .. .. .. .. .. .. .. .. .. 9C 9D 97 96 93 95 94 '' 99 98 97 96 93 95 94 .. ..
; .. .. B0 B2 B7 93 95 94 '' '' '' '' '' '' 8C 8D 8B 8E A8 A9 '' '' A5 A4 8B 8E 90 9B 9C .. .. B9 BA .. .. 9C 9D 97 96 93 95 94 B8 99 98 97 96 93 95 94 .. .. .. ..
; .. .. B0 B3 B5 B6 '' '' '' '' '' '' '' '' '' '' 8C 8D A7 A6 90 8F '' '' 8C 8D 8B 8E 90 9B BB BC BD BE 9D 97 96 93 95 94 '' 99 98 97 96 93 95 94 .. .. .. .. .. ..
; .. .. B1 B4 8B 8E 90 8F '' '' '' '' '' '' '' '' '' '' A5 A4 8B 8E 90 8F '' '' 8C 8D 8B 8E 90 BF C0 97 96 93 95 94 '' 99 98 97 96 93 95 94 .. .. .. .. .. .. .. ..
; .. .. .. .. 8C 8D 8B 8E 90 8F '' '' '' '' '' '' '' '' '' '' 8C 8D AB AC 90 8F '' '' 8C 8D 8B C1 C2 93 95 94 '' 99 98 97 96 93 95 94 .. .. .. .. .. .. .. .. .. ..
; .. .. .. .. .. .. 8C 8D 8B 8E 90 8F '' '' '' B9 BA '' '' 99 98 97 AD AE 8B 8E 90 8F '' '' 8C C3 C4 94 '' 99 98 97 96 93 95 94 .. .. .. .. .. .. .. .. .. .. .. ..
; .. .. .. .. .. .. .. .. 8C 8D 8B 8E 90 8F BB BC BD BE 98 97 96 93 95 94 8C 8D 8B 8E 90 8F '' '' '' 99 98 97 96 93 95 94 .. .. .. .. .. .. .. .. .. .. .. .. .. ..
; .. .. .. .. .. .. .. .. .. .. 8C 8D 8B 8E 90 BF C0 97 96 93 95 94 .. .. .. .. 8C 8D 8B 8E 90 A2 A3 97 96 93 95 94 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. ..
; .. .. .. .. .. .. .. .. .. .. .. .. 8C 8D 8B C1 C2 93 95 94 .. .. .. .. .. .. .. .. 8C 8D 8B A0 A1 93 95 94 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. ..
; .. .. .. .. .. .. .. .. .. .. .. .. .. .. 8C C3 C4 94 .. .. .. .. .. .. .. .. .. .. .. .. 8C 9F 9E 94 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. ..
; .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. ..
; .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. ..
@label=map_tiles
b$BCEE DEFB $60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$5F,$33,$3C,$58,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BD24 DEFB $60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$5F,$33,$34,$2E,$3D,$45,$3C,$58,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BD5A DEFB $60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$55,$5E,$31,$60,$60,$60,$60,$60,$60,$60,$60,$33,$34,$2B,$37,$2D,$3F,$28,$48,$42,$5B,$58,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BD90 DEFB $60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$82,$3E,$30,$2E,$57,$60,$60,$60,$60,$33,$34,$2E,$37,$2A,$2F,$2C,$41,$26,$47,$43,$53,$42,$3C,$57,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BDC6 DEFB $60,$60,$60,$60,$60,$60,$60,$60,$75,$76,$81,$5E,$31,$33,$3C,$5E,$31,$33,$34,$2B,$35,$2D,$36,$29,$25,$24,$23,$25,$49,$44,$54,$43,$3D,$45,$3C,$58,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BDFC DEFB $60,$60,$60,$60,$60,$60,$75,$76,$7C,$7F,$80,$3E,$30,$39,$3D,$3E,$30,$2E,$35,$2A,$2F,$38,$24,$25,$23,$23,$24,$25,$25,$23,$41,$44,$46,$27,$48,$42,$5B,$58,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BE32 DEFB $75,$76,$7A,$79,$75,$76,$7C,$7F,$7E,$3A,$5D,$40,$31,$3A,$3F,$40,$31,$2D,$2F,$29,$23,$25,$23,$24,$23,$25,$24,$23,$25,$24,$24,$23,$41,$26,$47,$43,$53,$42,$3C,$58,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BE68 DEFB $6A,$74,$77,$78,$7B,$7F,$7E,$3A,$2F,$2C,$49,$3B,$32,$2C,$41,$3B,$32,$38,$25,$23,$24,$24,$25,$25,$24,$23,$23,$25,$24,$23,$23,$25,$23,$24,$49,$44,$54,$43,$3D,$52,$59,$53,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BE9E DEFB $63,$64,$66,$6F,$7D,$3A,$2F,$38,$25,$24,$23,$23,$24,$25,$23,$25,$24,$24,$23,$25,$23,$25,$24,$24,$23,$25,$06,$07,$23,$25,$24,$25,$24,$23,$25,$23,$41,$44,$46,$51,$5D,$58,$5A,$53,$60,$60,$60,$60,$60,$60,$60,$60,$60,$60
 $BED4 DEFB $65,$62,$6C,$6D,$36,$2C,$23,$24,$23,$25,$24,$25,$23,$24,$24,$23,$23,$25,$23,$24,$23,$25,$23,$23,$02,$03,$04,$08,$1A,$23,$25,$24,$25,$24,$23,$25,$24,$23,$41,$44,$5C,$5B,$57,$58,$5A,$53,$60,$60,$60,$60,$60,$60,$60,$60
 $BF0A DEFB $63,$64,$6B,$6E,$71,$24,$23,$23,$24,$23,$24,$24,$23,$25,$24,$23,$25,$25,$24,$23,$24,$23,$02,$03,$04,$05,$09,$1C,$1B,$25,$23,$23,$24,$25,$24,$23,$25,$25,$23,$24,$59,$53,$45,$3C,$57,$58,$5A,$60,$60,$60,$60,$60,$60,$60
 $BF40 DEFB $61,$62,$5A,$73,$72,$70,$71,$24,$23,$25,$23,$25,$24,$23,$25,$25,$24,$23,$23,$24,$02,$03,$14,$05,$0A,$17,$1E,$1D,$25,$23,$24,$24,$06,$07,$23,$25,$23,$24,$23,$25,$55,$58,$5A,$53,$45,$3C,$57,$60,$60,$60,$60,$60,$60,$60
 $BF76 DEFB $49,$3B,$68,$60,$5A,$73,$72,$70,$71,$23,$24,$75,$76,$7A,$79,$24,$23,$25,$00,$01,$04,$05,$0A,$21,$22,$16,$1F,$19,$24,$24,$02,$03,$04,$08,$1A,$23,$24,$25,$25,$24,$4B,$45,$3C,$58,$5A,$53,$45,$45,$60,$60,$60,$60,$60,$60
 $BFAC DEFB $24,$25,$41,$56,$68,$60,$5A,$73,$72,$70,$71,$6A,$74,$84,$85,$7A,$79,$23,$0D,$0C,$0B,$17,$20,$16,$15,$18,$24,$23,$02,$03,$04,$05,$09,$1C,$1B,$24,$23,$24,$23,$23,$4A,$50,$4C,$52,$5B,$58,$5A,$60,$60,$60,$60,$60,$60,$60
 $BFE2 DEFB $23,$24,$25,$23,$49,$56,$68,$69,$5A,$73,$72,$63,$86,$88,$74,$77,$78,$25,$0E,$0F,$12,$16,$15,$18,$24,$23,$02,$03,$14,$05,$0A,$17,$1E,$1D,$25,$25,$24,$23,$06,$07,$49,$44,$4D,$51,$4C,$52,$3C,$58,$60,$60,$60,$60,$60,$60
 $C018 DEFB $25,$23,$24,$25,$24,$23,$49,$67,$68,$69,$5A,$65,$87,$83,$64,$66,$6F,$24,$10,$11,$13,$18,$23,$25,$00,$01,$04,$05,$0A,$21,$22,$16,$1F,$19,$24,$23,$02,$03,$04,$08,$1A,$25,$41,$44,$4E,$51,$4C,$45,$3C,$58,$60,$60,$60,$60
 $C04E DEFB $23,$24,$25,$23,$25,$24,$25,$23,$41,$67,$68,$59,$CC,$CD,$62,$8A,$6D,$23,$25,$23,$23,$24,$23,$24,$0D,$0C,$0B,$17,$20,$16,$15,$18,$25,$23,$02,$03,$04,$05,$09,$1C,$1B,$24,$25,$23,$49,$44,$4E,$28,$4C,$52,$5B,$58,$60,$60
 $C084 DEFB $24,$25,$23,$25,$24,$23,$24,$24,$25,$23,$41,$89,$CE,$CF,$D2,$D5,$6F,$24,$23,$25,$24,$23,$25,$23,$0E,$0F,$12,$16,$15,$18,$25,$23,$02,$03,$14,$05,$0A,$17,$1E,$1D,$23,$23,$24,$B9,$BA,$25,$49,$26,$C8,$C9,$4C,$45,$3C,$58
 $C0BA DEFB $23,$24,$25,$24,$23,$23,$25,$B9,$BA,$B1,$B1,$49,$D0,$D1,$D3,$D6,$D8,$9B,$9C,$24,$23,$25,$24,$23,$10,$11,$13,$18,$24,$23,$00,$01,$04,$05,$0A,$21,$22,$16,$1F,$19,$23,$25,$BB,$BC,$BD,$BE,$9D,$97,$CA,$CB,$4D,$28,$4C,$45
 $C0F0 DEFB $25,$23,$24,$23,$25,$24,$BB,$BC,$BD,$BE,$AF,$B2,$B7,$93,$D4,$D7,$D9,$8E,$90,$9B,$9C,$23,$23,$25,$24,$25,$23,$25,$25,$24,$0D,$0C,$0B,$17,$20,$16,$15,$18,$23,$25,$25,$24,$24,$C5,$C0,$97,$96,$93,$95,$94,$41,$26,$C8,$C9
 $C126 DEFB $23,$25,$25,$24,$23,$B1,$B1,$C5,$C0,$97,$96,$B3,$B5,$B6,$91,$92,$8C,$8D,$8B,$8E,$90,$9B,$9C,$24,$25,$24,$24,$23,$23,$23,$0E,$0F,$12,$16,$15,$18,$24,$23,$25,$24,$23,$9C,$9D,$C6,$C2,$93,$95,$94,$91,$99,$98,$97,$CA,$CB
 $C15C DEFB $25,$24,$23,$B1,$B1,$B0,$AF,$C6,$C2,$93,$95,$B4,$8B,$8E,$90,$8F,$91,$92,$8C,$8D,$8B,$8E,$A8,$AA,$9C,$25,$23,$25,$25,$24,$10,$11,$13,$18,$25,$24,$23,$24,$23,$9C,$9D,$97,$96,$C7,$C4,$94,$92,$99,$98,$97,$96,$93,$95,$94
 $C192 DEFB $23,$25,$B1,$B0,$AF,$97,$96,$C7,$C4,$94,$91,$B8,$8C,$8D,$8B,$8E,$90,$8F,$91,$92,$8C,$8D,$A7,$A6,$90,$9B,$9C,$24,$24,$23,$24,$25,$24,$23,$24,$25,$23,$9C,$9D,$97,$96,$93,$95,$94,$91,$99,$98,$97,$96,$93,$95,$94,$23,$24
 $C1C8 DEFB $24,$24,$B0,$B2,$B7,$93,$95,$94,$92,$91,$92,$91,$92,$91,$8C,$8D,$8B,$8E,$A8,$A9,$91,$92,$A5,$A4,$8B,$8E,$90,$9B,$9C,$25,$23,$B9,$BA,$25,$23,$9C,$9D,$97,$96,$93,$95,$94,$B8,$99,$98,$97,$96,$93,$95,$94,$24,$25,$24,$23
 $C1FE DEFB $25,$23,$B0,$B3,$B5,$B6,$91,$92,$91,$92,$91,$92,$91,$92,$91,$92,$8C,$8D,$A7,$A6,$90,$8F,$91,$92,$8C,$8D,$8B,$8E,$90,$9B,$BB,$BC,$BD,$BE,$9D,$97,$96,$93,$95,$94,$91,$99,$98,$97,$96,$93,$95,$94,$23,$25,$23,$24,$25,$23
 $C234 DEFB $24,$25,$B1,$B4,$8B,$8E,$90,$8F,$91,$91,$92,$91,$92,$91,$92,$91,$92,$91,$A5,$A4,$8B,$8E,$90,$8F,$91,$92,$8C,$8D,$8B,$8E,$90,$BF,$C0,$97,$96,$93,$95,$94,$92,$99,$98,$97,$96,$93,$95,$94,$25,$23,$24,$23,$24,$25,$23,$25
 $C26A DEFB $23,$24,$25,$24,$8C,$8D,$8B,$8E,$90,$8F,$91,$92,$91,$92,$91,$92,$91,$92,$91,$92,$8C,$8D,$AB,$AC,$90,$8F,$91,$92,$8C,$8D,$8B,$C1,$C2,$93,$95,$94,$91,$99,$98,$97,$96,$93,$95,$94,$25,$24,$23,$24,$23,$25,$25,$24,$25,$23
 $C2A0 DEFB $25,$25,$24,$23,$25,$24,$8C,$8D,$8B,$8E,$90,$8F,$91,$91,$92,$B9,$BA,$91,$92,$99,$98,$97,$AD,$AE,$8B,$8E,$90,$8F,$91,$92,$8C,$C3,$C4,$94,$92,$99,$98,$97,$96,$93,$95,$94,$25,$23,$24,$23,$25,$23,$24,$24,$23,$25,$24,$25
 $C2D6 DEFB $24,$23,$25,$24,$23,$25,$25,$23,$8C,$8D,$8B,$8E,$90,$8F,$BB,$BC,$BD,$BE,$98,$97,$96,$93,$95,$94,$8C,$8D,$8B,$8E,$90,$8F,$91,$92,$91,$99,$98,$97,$96,$93,$95,$94,$23,$25,$24,$24,$23,$25,$24,$25,$23,$23,$25,$23,$24,$24
 $C30C DEFB $23,$25,$24,$23,$25,$23,$24,$25,$24,$23,$8C,$8D,$8B,$8E,$90,$BF,$C0,$97,$96,$93,$95,$94,$25,$23,$24,$23,$8C,$8D,$8B,$8E,$90,$A2,$A3,$97,$96,$93,$95,$94,$25,$24,$23,$24,$23,$24,$24,$23,$25,$24,$24,$25,$24,$25,$23,$23
 $C342 DEFB $25,$23,$24,$25,$24,$23,$25,$23,$25,$24,$25,$23,$8C,$8D,$8B,$C1,$C2,$93,$95,$94,$25,$24,$23,$23,$25,$25,$24,$23,$8C,$8D,$8B,$A0,$A1,$93,$95,$94,$25,$23,$25,$23,$24,$23,$25,$23,$25,$24,$24,$25,$23,$23,$25,$23,$24,$25
 $C378 DEFB $25,$25,$23,$24,$23,$24,$23,$25,$24,$23,$24,$25,$24,$25,$8C,$C3,$C4,$94,$23,$24,$23,$25,$24,$25,$24,$25,$23,$24,$25,$23,$8C,$9F,$9E,$94,$25,$25,$23,$24,$23,$25,$23,$24,$25,$23,$24,$23,$25,$24,$23,$24,$23,$24,$23,$23
 $C3AE DEFB $23,$24,$25,$23,$25,$24,$25,$23,$23,$25,$23,$24,$23,$24,$23,$25,$23,$24,$25,$23,$24,$23,$24,$24,$23,$24,$25,$24,$23,$25,$24,$25,$23,$24,$23,$24,$24,$25,$24,$23,$25,$23,$24,$25,$24,$25,$23,$25,$24,$25,$25,$23,$25,$23
 $C3E4 DEFB $23,$24,$25,$23,$25,$24,$25,$23,$23,$25,$23,$24,$23,$24,$23,$25,$23,$24,$25,$23,$24,$23,$24,$24,$23,$24,$25,$24,$23,$25,$24,$25,$23,$24,$23,$24,$24,$25,$24,$23,$25,$23,$24,$25,$24,$25,$23,$25,$24,$25,$25,$23,$25,$23

; Pointer to bytes to output as pseudo-random data.
;
; Initially set to $9000. Wraps around after $90FF.
@label=prng_pointer
g$C41A DEFW $9000    ; prng_pointer

; Spawn characters.
;
; Used by the routines at #R$6939 and #R$9D7B.
;
; .
;
; Form a clamped map position in DE.
@label=spawn_characters
c$C41C LD HL,($81BB) ; HL = map_position;
 $C41F LD A,L        ; {E = (L < 8) ? 0 : L;
 $C420 SUB $08       ;
 $C422 JR NC,$C425   ;
 $C424 XOR A         ;
*$C425 LD E,A        ; }
 $C426 LD A,H        ; {D = (H < 8) ? 0 : H;
 $C427 SUB $08       ;
 $C429 JR NC,$C42C   ;
 $C42B XOR A         ;
*$C42C LD D,A        ; }
; Walk all character structs.
 $C42D LD HL,$7612   ; HL = &character_structs[0];
 $C430 LD B,$1A      ; B = character_26_STOVE_1; // the 26 'real' characters
*$C432 BIT 6,(HL)    ; {do <% if (*HL & characterstruct_FLAG_DISABLED) goto skip;
 $C434 JR NZ,$C474   ; }
; Is the character in this room?
 $C436 PUSH HL       ;   (stash HL)
 $C437 INC HL        ;   HL++; // $7613
 $C438 LD A,($68A0)  ;   A = room_index;
 $C43B CP (HL)       ; {  if (A != *HL) goto unstash_skip; // not in the visible room
 $C43C JR NZ,$C473   ; }
 $C43E AND A         ; {  if (A != 0) goto indoors;
 $C43F JR NZ,$C46A   ; }
; Outdoors.
 $C441 INC HL        ;   HL++; // $7614
; Screen Y calculation.
; .
; A is zero here, and represents 0x200.
 $C442 SUB (HL)      ;   A -= *HL; // charstr->pos.x
 $C443 INC HL        ;   HL++; // $7615
 $C444 SUB (HL)      ;   A -= *HL; // charstr->pos.y
 $C445 INC HL        ;   HL++; // $7616
 $C446 SUB (HL)      ;   A -= *HL; // charstr->pos.height
 $C447 LD C,A        ;   C = A;
 $C448 LD A,D        ;   A = D;
 $C449 CP C          ; {  if (C <= A) goto unstash_skip; // check
 $C44A JR NC,$C473   ; }
 $C44C ADD A,$20     ;   A += 32;
 $C44E JR NC,$C452   ; {  if (A > 0xFF) A = 0xFF;
 $C450 LD A,$FF      ; }
*$C452 CP C          ; {  if (C > A) goto unstash_skip; // check
 $C453 JR C,$C473    ; }
 $C455 DEC HL        ;   HL--; // $7615
; move down and to the left
; .
; why move the character here?
 $C456 LD A,$40      ;   A = 64;
 $C458 ADD A,(HL)    ;   *HL += A;
 $C459 DEC HL        ;   HL--; // $7614
 $C45A SUB (HL)      ;   *HL -= A;
; Screen X calculation.
 $C45B ADD A,A       ;   A *= 2; // A == 128
 $C45C LD C,A        ;   C = A;
 $C45D LD A,E        ;   A = E;
 $C45E CP C          ; {  if (C <= A) goto unstash_skip; // check
 $C45F JR NC,$C473   ; }
 $C461 ADD A,$28     ;   A += 40;
 $C463 JR NC,$C467   ; {  if (A > 0xFF) A = 0xFF;
 $C465 LD A,$FF      ; }
*$C467 CP C          ; {  if (C > A) goto unstash_skip; // check
 $C468 JR C,$C473    ; }
*$C46A POP HL        ; indoors: (unstash HL)
 $C46B PUSH HL       ; {  (stash HL, DE, BC)
 $C46C PUSH DE       ;
 $C46D PUSH BC       ; }
 $C46E CALL $C4E0    ;   spawn_character();
 $C471 POP BC        ; {  (unstash BC, DE)
 $C472 POP DE        ; }
*$C473 POP HL        ; unstash_skip: (unstash HL)
*$C474 LD A,L        ; {skip: HL += 7; // stride
 $C475 ADD A,$07     ;
 $C477 LD L,A        ;
 $C478 JR NC,$C47B   ;
 $C47A INC H         ; }
*$C47B DJNZ $C432    ; %> while (--B);
 $C47D RET           ; return;

; Run through all visible characters, resetting them if they're off-screen.
;
; Used by the routine at #R$9D7B.
@label=purge_invisible_characters
c$C47E LD HL,($81BB) ; HL = &map_position;
 $C481 LD A,L        ; {E = MAX(L - 9, 0);
 $C482 SUB $09       ;
 $C484 JR NC,$C487   ;
 $C486 XOR A         ;
*$C487 LD E,A        ; }
 $C488 LD A,H        ; {D = MAX(H - 9, 0);
 $C489 SUB $09       ;
 $C48B JR NC,$C48E   ;
 $C48D XOR A         ;
*$C48E LD D,A        ; }
 $C48F LD B,$07      ; B = 7; // 7 iterations
@nowarn
 $C491 LD HL,$8020   ; HL = $8020; // iterate over non-player characters
*$C494 LD A,(HL)     ; do <% A = *HL;
 $C495 CP $FF        ; {  if (A == character_NONE) goto next;
 $C497 JP Z,$C4D9    ; }
 $C49A PUSH HL
 $C49B LD A,$1C      ; {  HL += 28;
 $C49D ADD A,L       ;
 $C49E LD L,A        ; }
 $C49F LD A,($68A0)  ; {  if (room_index != *HL) goto reset; /* this character is not in the current room */
 $C4A2 CP (HL)       ;
 $C4A3 JR NZ,$C4CF   ; }
 $C4A5 DEC L         ; {  C = *--HL;
 $C4A6 LD C,(HL)     ; }
 $C4A7 DEC L         ; {  A = *--HL;
 $C4A8 LD A,(HL)     ; }
 $C4A9 CALL $E550    ;   divide_by_8_with_rounding(C,A);
 $C4AC LD C,A        ;   C = A;
 $C4AD LD A,D        ; {  if (C <= D || C > MIN(D + 34, 255)) goto reset;
 $C4AE CP C          ;
 $C4AF JR NC,$C4CF   ;
 $C4B1 ADD A,$22     ;
 $C4B3 JR NC,$C4B7   ;
 $C4B5 LD A,$FF      ;
*$C4B7 CP C          ;
 $C4B8 JR C,$C4CF    ; }
 $C4BA DEC L         ; {  C = *--HL;
 $C4BB LD C,(HL)     ; }
 $C4BC DEC L         ; {  A = *--HL;
 $C4BD LD A,(HL)     ; }
 $C4BE CALL $E555    ;   divide_by_8(C,A);
 $C4C1 LD C,A        ;   C = A;
 $C4C2 LD A,E        ; {  if (C <= E || C > MIN(E + 42, 255)) goto reset;
 $C4C3 CP C          ;
 $C4C4 JR NC,$C4CF   ; }
 $C4C6 ADD A,$2A     ; {  goto pop_next;
 $C4C8 JR NC,$C4CC   ;
 $C4CA LD A,$FF      ;
*$C4CC CP C          ;
 $C4CD JR NC,$C4D8   ; }
*$C4CF POP HL        ;   reset:
 $C4D0 PUSH HL
 $C4D1 PUSH DE
 $C4D2 PUSH BC
 $C4D3 CALL $C5D3    ;   reset_visible_character();
 $C4D6 POP BC
 $C4D7 POP DE
*$C4D8 POP HL        ;   pop_next:
*$C4D9 LD A,$20      ; {  next: HL += 32;
 $C4DB ADD A,L       ;
 $C4DC LD L,A        ; }
 $C4DD DJNZ $C494    ; %> while (--B);
 $C4DF RET           ; return;

; Adds characters to the visible character list.
;
; Used by the routine at #R$C41C.
;
; I:HL Pointer to character to spawn.
@label=spawn_character
c$C4E0 BIT 6,(HL)     ; {if (*HL & characterstruct_FLAG_DISABLED) return; /* character disabled */
 $C4E2 RET NZ         ; }
 $C4E3 PUSH HL
; Find an empty slot in the visible character list.
@nowarn
 $C4E4 LD HL,$8020    ; HL = $8020; // iterate over non-player characters
 $C4E7 LD DE,$0020
 $C4EA LD A,$FF
 $C4EC LD B,$07       ; B = 7; // 7 iterations
*$C4EE CP (HL)        ; {do <% if (*HL == vischar_CHARACTER_EMPTY_SLOT) goto found_empty_slot;
 $C4EF JR Z,$C4F6     ; }
 $C4F1 ADD HL,DE      ;   HL += 32; // stride
 $C4F2 DJNZ $C4EE     ; %> while (--B);
 $C4F4 POP HL
 $C4F5 RET            ; return;
; Empty slot found.
*$C4F6 POP DE         ; found_empty_slot: // DE = HL (-> character struct)
 $C4F7 PUSH HL        ; // resave
 $C4F8 POP IY         ; // IY = HL (-> empty slot in visible character list)
 $C4FA PUSH HL        ; // resave
 $C4FB PUSH DE
 $C4FC INC DE         ; DE++;
; Scale coords dependent on which room the character is in.
 $C4FD LD HL,$81A4    ; HL = &saved_pos_x;
 $C500 LD A,(DE)      ; {A = *DE++;
 $C501 INC DE         ; }
 $C502 AND A          ; A &= A;
 $C503 JR NZ,$C518    ; if (A == 0) <%
 $C505 LD A,$03       ;   A = 3; // 3 iterations
*$C507 EX AF,AF'      ;   do <%
 $C508 LD A,(DE)      ; {    BC = *DE * 8;
 $C509 CALL $B1C7     ; }
 $C50C LD (HL),C      ; {    *HL++ = C;
 $C50D INC HL         ; }
 $C50E LD (HL),B      ; {    *HL++ = B;
 $C50F INC HL         ; }
 $C510 INC DE         ;     DE++;
 $C511 EX AF,AF'
 $C512 DEC A          ; {  %> while (--A); %>
 $C513 JP NZ,$C507    ; }
 $C516 JR $C523       ; else <%
*$C518 LD B,$03       ; B = 3; // 3 iterations
*$C51A LD A,(DE)      ; {do <% *HL++ = *DE++;
 $C51B LD (HL),A      ;
 $C51C INC DE         ;
 $C51D INC HL         ; }
 $C51E LD (HL),$00    ; {  *HL++ = 0;
 $C520 INC HL         ; }
 $C521 DJNZ $C51A     ; %> while (--B); %>
*$C523 CALL $AFDF     ; collision();
 $C526 CALL Z,$B14C   ; if (Z) bounds_check();
 $C529 POP DE
 $C52A POP HL
 $C52B RET NZ         ; RET NZ // if collision or bounds_check is nonzero, then return
 $C52C LD A,(DE)      ; {A = *DE | characterstruct_FLAG_DISABLED; /* Disable character */
 $C52D OR $40         ; }
 $C52F LD (DE),A      ; *DE = A;
 $C530 AND $1F        ; A &= characterstruct_BYTE0_MASK;
 $C532 LD (HL),A      ; {*HL++ = A;
 $C533 INC L          ; }
 $C534 LD (HL),$00    ; *HL = 0;
 $C536 PUSH DE
 $C537 LD DE,$CD9A    ; DE = &character_meta_data[0]; /* Commandant */
 $C53A AND A          ; {if (A) <%
 $C53B JR Z,$C54E     ; }
@nowarn
 $C53D LD DE,$CD9E    ;   DE = &character_meta_data[1]; /* Guard */
 $C540 CP $10         ; {  if (A >= 16) <%
 $C542 JR C,$C54E     ; }
 $C544 LD DE,$CDA2    ;     DE = &character_meta_data[2]; /* Dog */
 $C547 CP $14         ; {    if (A >= 20) <%
 $C549 JR C,$C54E     ; }
 $C54B LD DE,$CDA6    ;       DE = &character_meta_data[3]; %> %> %> /* Prisoner */
*$C54E EX DE,HL
 $C54F LD A,$07       ; {DE += 7;
 $C551 ADD A,E        ;
 $C552 LD E,A         ; }
 $C553 LDI            ; *DE++ = *HL++;
 $C555 LDI            ; *DE++ = *HL++;
 $C557 LD A,$0B       ; {DE += 11;
 $C559 ADD A,E        ;
 $C55A LD E,A         ; }
 $C55B LDI            ; *DE++ = *HL++;
 $C55D LDI            ; *DE++ = *HL++;
 $C55F LD A,E         ; {DE -= 8;
 $C560 SUB $08        ;
 $C562 LD E,A         ; }
 $C563 LD HL,$81A4    ; {memcpy(DE, &saved_pos_x, 6);
 $C566 LD BC,$0006    ;
 $C569 LDIR           ; }
 $C56B POP HL
 $C56C INC HL         ; {HL += 5;
 $C56D INC HL         ;
 $C56E INC HL         ;
 $C56F INC HL         ;
 $C570 INC HL         ; }
 $C571 LD A,$07       ; {DE += 7;
 $C573 ADD A,E        ;
 $C574 LD E,A         ; }
 $C575 LD A,($68A0)   ; A = room_index;
 $C578 LD (DE),A      ; *DE = A; // sampled DE=$803C (vischar->room)
 $C579 AND A          ; {if (A) <%
 $C57A JR Z,$C588     ; }
 $C57C LD BC,$2040    ; {  play_speaker(sound_CHARACTER_ENTERS_2);
 $C57F CALL $A11D     ; }
 $C582 LD BC,$2030    ; {  play_speaker(sound_CHARACTER_ENTERS_1); %>
 $C585 CALL $A11D     ; }
*$C588 LD A,E         ; {DE -= 26;
 $C589 SUB $1A        ;
 $C58B LD E,A         ; }
 $C58C LDI            ; *DE++ = *HL++;
 $C58E LDI            ; *DE++ = *HL++;
 $C590 DEC HL         ; {HL -= 2;
 $C591 DEC HL         ; }
*$C592 LD A,(HL)      ; {if (*HL == 0) <%
 $C593 AND A          ;
 $C594 JR NZ,$C59C    ; }
 $C596 LD A,$03       ; {  DE += 3; %>
 $C598 ADD A,E        ;
 $C599 LD E,A         ; }
 $C59A JR $C5C4       ; else <%
*$C59C XOR A          ; {  entered_move_characters = 0;
 $C59D LD ($A13E),A   ; }
 $C5A0 PUSH DE
 $C5A1 CALL $C651     ;   get_next_target();
 $C5A4 CP $FF         ; {  if (A == 255) <%
 $C5A6 JR NZ,$C5B6    ; }
 $C5A8 POP HL
 $C5A9 DEC L          ; {    HL -= 2;
 $C5AA DEC L          ; }
 $C5AB PUSH HL
 $C5AC CALL $CB2D     ;     CALL $CB2D
 $C5AF POP HL
 $C5B0 LD D,H         ; {    DE = HL + 2;
 $C5B1 LD E,L         ;
 $C5B2 INC E          ;
 $C5B3 INC E          ; }
 $C5B4 JR $C592       ;     goto $C592; %>
*$C5B6 CP $80         ; {  if (A == 128) IY[1] |= vischar_FLAGS_DOOR_THING; // $8021
 $C5B8 JR NZ,$C5BE    ;
 $C5BA SET 6,(IY+$01) ; }
*$C5BE POP DE
 $C5BF LD BC,$0003    ; {  memcpy(DE, HL, 3); %>
 $C5C2 LDIR           ; }
*$C5C4 XOR A          ; {*DE = 0;
 $C5C5 LD (DE),A      ; }
 $C5C6 LD A,E         ; {DE -= 7;
 $C5C7 SUB $07        ;
 $C5C9 LD E,A         ; }
 $C5CA EX DE,HL
 $C5CB PUSH HL
 $C5CC CALL $B71B     ; calc_vischar_screenpos_from_mi_pos();
 $C5CF POP HL
 $C5D0 JP $C918       ; character_behaviour(); return; // exit via

; Reset a visible character (either a character or an object).
;
; Used by the routines at #R$68A2, #R$69C9, #R$B79B and #R$C47E.
;
; I:HL Pointer to visible character.
@label=reset_visible_character
c$C5D3 LD A,(HL)     ; A = *HL;
 $C5D4 CP $FF        ; {if (A == character_NONE) return;
 $C5D6 RET Z         ; }
 $C5D7 CP $1A        ; {if (A >= character_26_STOVE_1) <%
 $C5D9 JR C,$C602    ;
 $C5DB EX AF,AF'     ; }
; A stove or crate character.
 $C5DC LD (HL),$FF   ; {  HL[0] = character_NONE;
 $C5DE INC L         ; }
 $C5DF LD (HL),$FF   ;   HL[1] = 0xFF; // flags
 $C5E1 LD A,$06      ; {  HL[7] = 0; // more flags
 $C5E3 ADD A,L       ;
 $C5E4 LD L,A        ;
 $C5E5 LD (HL),$00   ; }
 $C5E7 ADD A,$08     ; {  HL += 0x0F; // vischar + 0x0F
 $C5E9 LD L,A        ;
 $C5EA EX AF,AF'     ; }
; Save the old position.
 $C5EB LD DE,$69AE   ;   DE = &movable_items[0]; // stove1
 $C5EE CP $1A        ; {  if (A != character_26_STOVE_1) <%
 $C5F0 JR Z,$C5FC    ; }
 $C5F2 LD DE,$69C0   ;     DE = &movable_items[2]; // stove2
 $C5F5 CP $1B        ; {    if (A != character_27_STOVE_2) <%
 $C5F7 JR Z,$C5FC    ; }
 $C5F9 LD DE,$69B7   ;       DE = &movable_items[1]; %> %> // crate
; The DOS version of the game has a difference here. Instead of
; memcpy'ing the current vischar's position into the movable_items's
; position, it only copies the first two bytes. The code is setup for a
; copy of six bytes (cx is set to 3) but the 'movsw' ought to be a 'rep
; movsw' for it to work. It fixes the bug where stoves get left in place
; after a restarted game, but almost looks like an accident.
*$C5FC LD BC,$0006   ; {  memcpy(DE, HL, 6);
 $C5FF LDIR          ; }
 $C601 RET           ;   return; %>
; A non-object character.
*$C602 EX DE,HL      ; else <%
 $C603 CALL $C7B9    ;   DE = get_character_struct(A);
 $C606 RES 6,(HL)    ;   *DE &= ~characterstruct_FLAG_DISABLED;
 $C608 LD A,$1C      ; {
 $C60A ADD A,E       ;
 $C60B LD E,A        ; }
 $C60C LD A,(DE)     ;   A = HL[0x1C]; // room index
 $C60D INC HL        ; {  *++DE = A; // characterstruct.room = room index;
 $C60E LD (HL),A     ;
 $C60F EX AF,AF'     ; }
 $C610 EX DE,HL
 $C611 LD A,L        ; {  HL[7] = 0; // more flags
 $C612 SUB $15       ;
 $C614 LD L,A        ;
 $C615 LD (HL),$00   ; }
 $C617 ADD A,$08     ; {  HL += 0x0F; // vischar+0x0F
 $C619 LD L,A        ; }
; Save the old position.
 $C61A INC DE        ; {  DE++; // &characterstruct.x
 $C61B EX AF,AF'     ; }
 $C61C AND A         ; {  if (A == 0) <%
 $C61D JR NZ,$C624   ; }
; Outdoors.
 $C61F CALL $E542    ;     pos_to_tinypos(HL,DE); %> // HL,DE updated
 $C622 JR $C62D      ;   else <%
; Indoors.
*$C624 LD B,$03      ;     B = 3;
*$C626 LD A,(HL)     ; {    do <% *DE++ = *HL;
 $C627 LD (DE),A     ; }
 $C628 INC L         ; {      HL += 2;
 $C629 INC L         ;
 $C62A INC DE        ; }
 $C62B DJNZ $C626    ;     %> while (--B); %>
*$C62D LD A,L        ; {  HL -= 21; // reset HL to point to original vischar
 $C62E SUB $15       ;
 $C630 LD L,A        ; }
 $C631 LD A,(HL)     ;   A = *HL; // HL points to vischar // sampled HL=$8040,$8020,$8080,$80A0
 $C632 LD (HL),$FF   ; {  *HL++ = character_NONE;
 $C634 INC L         ; }
 $C635 LD (HL),$FF   ; {  *HL++ = vischar_FLAGS_EMPTY_SLOT;
 $C637 INC L         ; }
; Guard dogs only.
 $C638 CP $10        ; {  if (A >= character_16_GUARD_DOG_1 && A <= character_19_GUARD_DOG_4) <%
 $C63A JR C,$C64C    ;
 $C63C CP $14        ;
 $C63E JR NC,$C64C   ; }
 $C640 LD (HL),$FF   ; {    *HL++ = 0xFF;
 $C642 INC L         ; }
 $C643 LD (HL),$00   ;     *HL = 0;
 $C645 CP $12        ; {    if (A >= character_18_GUARD_DOG_3) *HL = 24; /* Characters 18 and 19 */
 $C647 JR C,$C64B    ;
 $C649 LD (HL),$18   ; }
*$C64B DEC L         ;     HL--; %>
*$C64C LDI           ;   *DE++ = *HL++; // copy target into charstruct
 $C64E LDI           ;   *DE++ = *HL++;
 $C650 RET           ;   return; %>

; Gets a new location.
;
; Used by the routines at #R$A3BB, #R$C4E0, #R$C6A0 and #R$CB23.
;
; I:HL Pointer to characterstruct + 5. // sampled HL=$768E,$7695,$769C,$7617
; .    761E, 7625, 762C, 7633, 7656, 765D
; O:A  0/128/255
; O:HL Pointer to somewhere in word_783A.
@label=get_next_target
c$C651 LD A,(HL)     ; A = *HL;
 $C652 CP $FF        ; {if (A == 0xFF) <%
 $C654 JR NZ,$C664   ; }
 $C656 INC HL        ; {  A = *++HL & ~characterstruct_BYTE6_MASK_LO;
 $C657 LD A,(HL)     ;
 $C658 AND $F8       ; }
 $C65A LD (HL),A     ;   *HL = A;
 $C65B CALL $CB85    ;   random_nibble();
 $C65E AND $07       ;   A &= characterstruct_BYTE6_MASK_LO;
 $C660 ADD A,(HL)    ;   A += *HL;
 $C661 LD (HL),A     ; {  *HL = A; %>
 $C662 JR $C692      ; }
*$C664 PUSH HL       ; else <%
 $C665 INC HL        ; {  C = *++HL; // byte6
 $C666 LD C,(HL)     ; }
 $C667 CALL $CB79    ;   DE = element_A_of_table_7738(A);
 $C66A LD H,$00      ;   H = 0;
 $C66C LD A,C        ;   A = C;
 $C66D CP $FF        ; {  if (A == 0xFF) H--; // H = 0xFF
 $C66F JR NZ,$C672   ;
 $C671 DEC H         ; }
*$C672 LD L,A        ;   L = A;
 $C673 ADD HL,DE     ;   HL += DE;
 $C674 EX DE,HL
 $C675 LD A,(DE)     ;   A = *DE;
 $C676 CP $FF        ;   if (A == door_NONE) ...
 $C678 POP HL        ;   // interleaved
 $C679 JR Z,$C69D    ;   ... goto return_255;
 $C67B AND $7F       ;   A &= ~door_LOCKED;
 $C67D CP $28        ; {  if (A < 40) <%
 $C67F JR NC,$C68F   ; }
 $C681 LD A,(DE)     ;     A = *DE;
 $C682 BIT 7,(HL)    ; {    if (*HL & vischar_BYTE2_BIT7) A ^= door_LOCKED; // sampled HL=$762C,$8002,$7672,$7679,$7680,$76A3,$76AA,$76B1,$76B8,$76BF ... looks quite general
 $C684 JR Z,$C688    ;
 $C686 XOR $80       ; }
*$C688 CALL $6A12    ;     HL = get_door();
 $C68B INC HL        ;     HL++;
 $C68C LD A,$80      ;     A = 0x80;
 $C68E RET           ;     return; %>
*$C68F LD A,(DE)     ; {  A = *DE - 40; %>
 $C690 SUB $28       ; }
; sampled A=$38,2D,02,06,1E,20,21,3C,23,2B,3A,0B,2D,04,03,1C,1B,21,3C,...
*$C692 ADD A,A       ; {HL = word_783A[A];
 $C693 LD HL,$783A   ;
 $C696 ADD A,L       ;
 $C697 LD L,A        ;
 $C698 JR NC,$C69B   ;
 $C69A INC H         ; }
*$C69B XOR A         ; A = 0;
 $C69C RET           ; return;
*$C69D LD A,$FF      ; return_255: A = 255;
 $C69F RET           ; return;

; Moves characters around.
;
; Used by the routine at #R$9D7B.
@label=move_characters
c$C6A0 LD A,$FF      ; {entered_move_characters = 0xFF;
 $C6A2 LD ($A13E),A  ; }
; Move to the next character, wrapping around after character 26.
 $C6A5 LD A,($8217)  ; {character = character_index + 1;
 $C6A8 INC A         ; }
 $C6A9 CP $1A        ; {if (character == character_26_STOVE_1)
 $C6AB JR NZ,$C6AE   ;
 $C6AD XOR A         ;   character = character_0_COMMANDANT;}
*$C6AE LD ($8217),A  ; character_index = character;
; Get its chararacter struct, exiting if it's not enabled.
 $C6B1 CALL $C7B9    ; HL = get_character_struct(character); // passing character in A
 $C6B4 BIT 6,(HL)    ; {if (*HL & characterstruct_FLAG_DISABLED)
 $C6B6 RET NZ        ;   return; /* Disabled character. */}
 $C6B7 PUSH HL
; Are any items to be found in the same room as the character?
 $C6B8 INC HL        ; {room = *++HL; // characterstruct room
 $C6B9 LD A,(HL)     ; }
 $C6BA AND A         ; {if (room != room_0_OUTDOORS) <%
 $C6BB JR Z,$C6C5    ; }
; This discovers one item at a time.
 $C6BD CALL $CCFB    ;   is_item_discoverable_interior(room); // passing room in A, returning item in ?
 $C6C0 JR NZ,$C6C5   ; {  if (Z) item_discovered(item); %> // passing item in C
 $C6C2 CALL $CD31    ; }
*$C6C5 POP HL        ; HL = characterstruct
 $C6C6 INC HL        ; {HL += 2; // point at characterstruct pos
 $C6C7 INC HL        ; }
 $C6C8 PUSH HL
 $C6C9 INC HL        ; {HL += 3; // point at characterstruct target
 $C6CA INC HL        ;
 $C6CB INC HL        ; }
; No target? Not yet understood.
 $C6CC LD A,(HL)     ; A = *HL; // charstr->target.x
 $C6CD AND A         ; {if (A == 0) <%
 $C6CE JR NZ,$C6D2   ; }
 $C6D0 POP HL
 $C6D1 RET           ;   return; %>
*$C6D2 CALL $C651    ; get_next_target(); // "move towards" ? // returning ? in A, ? in HL
 $C6D5 CP $FF        ; {if (A == 0xFF) <%
 $C6D7 JP NZ,$C6FF   ; }
 $C6DA LD A,($8217)  ;   character = character_index;
 $C6DD AND A         ; {  if (character != character_0_COMMANDANT) <%
 $C6DE JR Z,$C6F2    ; }
; Not the commandant.
 $C6E0 CP $0C        ; {    if (character >= character_12_GUARD_12)
 $C6E2 JR NC,$C6F9   ;   goto character_12_or_higher;}
; Characters 1..11.
@label=character_1_to_11
*$C6E4 LD A,(HL)     ; {    *HL++ ^= (1 << 7); // HLlocation->x
 $C6E5 XOR $80       ;
 $C6E7 LD (HL),A     ;
 $C6E8 INC HL        ; }
; Pattern: [-2]+1
 $C6E9 BIT 7,A       ; {    if (A & (1 << 7)) (*HL) -= 2;
 $C6EB JR Z,$C6EF    ;
 $C6ED DEC (HL)      ;
 $C6EE DEC (HL)      ; }
*$C6EF INC (HL)      ;     (*HL)++; // i.e -1 or +1 // HLlocation->y
 $C6F0 POP HL
 $C6F1 RET           ;     return; %>
; Commandant.
@label=commandant
*$C6F2 LD A,(HL)     ; {  A = *HL & characterstruct_BYTE5_MASK; // sampled HL=$7617 (characterstruct + 5) // location
 $C6F3 AND $7F       ; }
 $C6F5 CP $24        ; {  if (A != 36) goto character_1_to_11;
 $C6F7 JR NZ,$C6E4   ; }
@label=character_12_or_higher
*$C6F9 POP DE        ;
 $C6FA JP $C7C6      ;   goto character_event; // exit via
;   Two unused bytes.
 $C6FD DEFB $18,$6F  ;   %>
*$C6FF CP $80        ; {if (A == 0x80) <%
 $C701 JP NZ,$C76E   ; }
 $C704 POP DE        ;   // DE points at characterstruct.pos - PUSH at $C6C8
 $C705 DEC DE        ; {  room = DE[-1];
 $C706 LD A,(DE)     ;
 $C707 INC DE        ; }
 $C708 PUSH HL
 $C709 AND A         ; {  if (room == room_0_OUTDOORS) <%
 $C70A JP NZ,$C71F   ; }
 $C70D PUSH DE
; Divide the location at HL by 2 and store it to saved_pos.
 $C70E LD DE,$81A4   ;     DE = &saved_pos_x;
 $C711 LD B,$02      ;     B = 2; // 2 iters
*$C713 LD A,(HL)     ; {    do <% *DE++ = *HL++ >> 1;
 $C714 AND A         ;
 $C715 RRA           ;
 $C716 LD (DE),A     ;
 $C717 INC HL        ;
 $C718 INC DE        ; }
 $C719 DJNZ $C713    ;     %> while (--B);
 $C71B LD HL,$81A4   ;     HL = &saved_pos_x;
 $C71E POP DE        ;     %>
; Establish a maximum for passing into change_by_delta.
*$C71F DEC DE        ; {  if (DE[-1] == room_0_OUTDOORS)
 $C720 LD A,(DE)     ;
 $C721 INC DE        ;
 $C722 AND A         ;
 $C723 LD A,$02      ; A = 2;
 $C725 JR Z,$C729    ;
 $C727 LD A,$06      ; else A = 6;}
*$C729 EX AF,AF'
 $C72A LD B,$00      ;   B = 0;
 $C72C CALL $C79A    ;   change_by_delta(A, B, HL, DE);
 $C72F INC DE        ;   DE++;
 $C730 INC HL        ;   HL++;
 $C731 CALL $C79A    ;   change_by_delta(A, B, HL, DE);
 $C734 POP HL
 $C735 LD A,B        ; {  if (B != 2) return; // managed to move
 $C736 CP $02        ;
 $C738 RET NZ        ; }
; So when we reach here a character is stuck.
; .
; Are we checking to see if a door is adjacent?
 $C739 DEC DE        ; {  DE -= 2; // DE -> charstr->room
 $C73A DEC DE        ; }
 $C73B DEC HL        ;   HL--; // HL -> doorpos
 $C73C LD A,(HL)     ; {  *DE = (*HL & ~doorpos_FLAGS_MASK_DIRECTION) >> 2; // extract room field
 $C73D AND $FC       ;
 $C73F RRA           ;
 $C740 RRA           ;
 $C741 LD (DE),A     ; }
; Stuff reading from doors[].
 $C742 LD A,(HL)     ; {  if ((*HL & doorpos_FLAGS_MASK_DIRECTION) < 2) <% // sampled HL=$78FA,$794A,$78DA,$791E,$78E2,$790E,$796A,$790E,$791E,$7962,$791A
 $C743 AND $03       ;
 $C745 CP $02        ;
 $C747 JR NC,$C750   ; }
 $C749 INC HL        ; {    HL += 5; %> // next door's pos
 $C74A INC HL        ;
 $C74B INC HL        ;
 $C74C INC HL        ;
 $C74D INC HL        ; }
 $C74E JR $C753      ;   else <%
*$C750 DEC HL        ; {    HL -= 3; %> // previous door's pos
 $C751 DEC HL        ;
 $C752 DEC HL        ; }
*$C753 LD A,(DE)     ; {  room = *DE++;
 $C754 INC DE        ; }
 $C755 AND A         ; {  if (room != room_0_OUTDOORS) <%
 $C756 JR Z,$C761    ; }
; Indoors. Copy the door's tinypos into the charstr's tinypos.
 $C758 LDI           ;     *DE++ = *HL++; // x
 $C75A LDI           ;     *DE++ = *HL++; // y
 $C75C LDI           ;     *DE++ = *HL++; // height
 $C75E DEC DE        ;     DE--; %>
 $C75F JR $C78B      ;   else <%
; Outdoors. Copy the door's tinypos into the charstr's tinypos, dividing by two.
*$C761 LD B,$03      ;     B = 3;
*$C763 LD A,(HL)     ; {    do <% *DE++ = *HL++ >> 1;
 $C764 AND A         ;
 $C765 RRA           ;
 $C766 LD (DE),A     ;
 $C767 INC HL        ;
 $C768 INC DE        ; }
 $C769 DJNZ $C763    ;     %> while (--B)
 $C76B DEC DE        ;     DE--; %> %>
 $C76C JR $C78B      ; else <%
*$C76E POP DE
; Establish a maximum for passing into change_by_delta.
 $C76F DEC DE        ; {  room = DE[-1]; // DE -> charstr
 $C770 LD A,(DE)     ;
 $C771 INC DE        ; }
 $C772 AND A         ; {  if (room == room_0_OUTDOORS) A = 2; else A = 6;
 $C773 LD A,$02      ;
 $C775 JR Z,$C779    ;
 $C777 LD A,$06      ; }
*$C779 EX AF,AF'
 $C77A LD B,$00      ;   B = 0;
 $C77C CALL $C79A    ;   change_by_delta(A, B, HL, DE);
 $C77F INC HL        ;   HL++;
 $C780 INC DE        ;   DE++;
 $C781 CALL $C79A    ;   change_by_delta(A, B, HL, DE);
 $C784 INC DE        ;   DE++;
 $C785 LD A,B        ; {  if (B != 2) return; %> // managed to move
 $C786 CP $02        ;
 $C788 JR Z,$C78B    ;
 $C78A RET           ; }
; So when we reach here a character is stuck.
*$C78B INC DE        ; DE++; // DE -> charstr->target
 $C78C EX DE,HL
 $C78D LD A,(HL)     ; A = *HL; // sampled HL=$761E $7625 $768E $7695 $7656 $7695 $7680 // => character struct entry + 5 // target field
 $C78E CP $FF        ; {if (A == 0xFF) return;
 $C790 RET Z         ; }
 $C791 BIT 7,A       ; if ((A & (1<<7)) != 0) ...
 $C793 INC HL        ; HL++;       // interleaved
 $C794 JR NZ,$C798   ; ... goto exit;
 $C796 INC (HL)      ; (*HL)++;
 $C797 RET           ; return;
*$C798 DEC (HL)      ; exit: (*HL)--;
 $C799 RET           ; return;

; Increments 'first' by ('first' - 'second').
;
; Used by the routine at #R$C6A0.
;
; I:A' A maximum value, usually 2 or 6.
; I:B Return code. Incremented if delta is zero.
; I:DE Pointer to bytes within character_structs. // 761b,761c, 7622,7623,
; .    7629,762a, 7630,7631, 7653,...
; I:HL Pointer to bytes within word_783A.         // 787a,787b, 787e,787f,
; .    78b2,78b3, 7884,7885, 7892,...
; O:B Incremented by one if no movement.
@label=change_by_delta
c$C79A EX AF,AF'
 $C79B LD C,A        ; C = Adash; // ie. banked A // some maximum value
 $C79C EX AF,AF'
 $C79D LD A,(DE)     ; {A = *DE - *HL; // delta
 $C79E SUB (HL)      ; }
 $C79F JR NZ,$C7A3   ; if (A == 0) <%
 $C7A1 INC B         ;   B++;
 $C7A2 RET           ;   return; %>
*$C7A3 JR NC,$C7B0   ; else if (A < 0) <% // delta -ve => second > first
 $C7A5 NEG           ;   A = -A; // absolute value
 $C7A7 CP C          ; {  if (A >= C) A = C;
 $C7A8 JR C,$C7AB    ;
 $C7AA LD A,C        ; }
*$C7AB LD C,A        ; {  *DE += A; // move first towards second
 $C7AC LD A,(DE)     ;
 $C7AD ADD A,C       ;
 $C7AE LD (DE),A     ; }
 $C7AF RET           ;   return; %>
*$C7B0 CP C          ; {else <% if (A >= C) A = C; // delta +ve => first > second
 $C7B1 JR C,$C7B4    ;
 $C7B3 LD A,C        ; }
*$C7B4 LD C,A        ; {  *DE -= A; // move first towards second
 $C7B5 LD A,(DE)     ;
 $C7B6 SUB C         ;
 $C7B7 LD (DE),A     ; }
 $C7B8 RET           ;   return; %>

; Get character struct.
;
; Used by the routines at #R$A38C, #R$C5D3 and #R$C6A0.
;
; I:A  Character index.
; O:HL Character struct.
@label=get_character_struct
c$C7B9 LD L,A        ; {HL = &character_structs[A];
 $C7BA ADD A,A       ;
 $C7BB ADD A,A       ;
 $C7BC ADD A,A       ;
 $C7BD SUB L         ;
 $C7BE LD HL,$7612   ;
 $C7C1 ADD A,L       ;
 $C7C2 LD L,A        ;
 $C7C3 RET NC        ;
 $C7C4 INC H         ; }
 $C7C5 RET           ; return;

; Character event.
;
; Used by the routines at #R$C6A0 and #R$CB2D.
; .
; Makes characters sit, sleep or other things TBD.
;
; I:HL Points to character_struct.unk2 or vischar.target.
@label=character_event
c$C7C6 LD A,(HL)     ; A = *HL;
 $C7C7 CP $07        ; {if (A >= character_7_GUARD_7  && A <= character_12_GUARD_12) goto character_sleeps;
 $C7C9 JR C,$C7D0    ;
 $C7CB CP $0D        ;
 $C7CD JP C,$A444    ; }
*$C7D0 CP $12        ; {if (A >= character_18_GUARD_DOG_3 && A <= character_22_PRISONER_3) goto character_sits;
 $C7D2 JR C,$C7D9    ;
 $C7D4 CP $17        ;
 $C7D6 JP C,$A420    ; }
*$C7D9 PUSH HL       ; // POPped by handlers
@nowarn
 $C7DA LD HL,$C7F9   ; map = &character_to_event_handler_index_map[0];
 $C7DD LD B,$18      ; B = NELEMS(character_to_event_handler_index_map); // 24 iterations
; Locate the character in the map.
*$C7DF CP (HL)       ; {do <% if (A == map->character) goto call_action;
 $C7E0 JR Z,$C7EA    ; }
 $C7E2 INC HL        ; {  map += 2;
 $C7E3 INC HL        ; }
 $C7E4 DJNZ $C7DF    ; %> while (--B);
 $C7E6 POP HL
 $C7E7 LD (HL),$00   ; *HL = 0; // no action
 $C7E9 RET           ; return;
*$C7EA INC HL        ; {call_action: goto character_event_handlers[*++HL];
 $C7EB LD A,(HL)     ;
 $C7EC ADD A,A       ;
 $C7ED LD C,A        ;
 $C7EE LD B,$00      ;
@nowarn
 $C7F0 LD HL,$C829   ;
 $C7F3 ADD HL,BC     ;
 $C7F4 LD A,(HL)     ;
 $C7F5 INC HL        ;
 $C7F6 LD H,(HL)     ;
 $C7F7 LD L,A        ;
 $C7F8 JP (HL)       ; }
; character_to_event_handler_index_map
; .
; Array of (character + flags, character event handler index) mappings.
@label=character_to_event_handler_index_map
 $C7F9 DEFW $00A6    ; character_6_GUARD_6       | 0b10100000, charevnt_0,
 $C7FB DEFW $00A7    ; character_7_GUARD_7       | 0b10100000, charevnt_0,
 $C7FD DEFW $01A8    ; character_8_GUARD_8       | 0b10100000, charevnt_1,
 $C7FF DEFW $01A9    ; character_9_GUARD_9       | 0b10100000, charevnt_1,
 $C801 DEFW $0005    ; character_5_GUARD_5       | 0b00000000, charevnt_0,
 $C803 DEFW $0106    ; character_6_GUARD_6       | 0b00000000, charevnt_1,
 $C805 DEFW $0385    ; character_5_GUARD_5       | 0b10000000, charevnt_3,  // checks byte_A13E case 1
 $C807 DEFW $0386    ; character_6_GUARD_6       | 0b10000000, charevnt_3,  // checks byte_A13E case 1
 $C809 DEFW $020E    ; character_14_GUARD_14     | 0b00000000, charevnt_2,
 $C80B DEFW $020F    ; character_15_GUARD_15     | 0b00000000, charevnt_2,
 $C80D DEFW $008E    ; character_14_GUARD_14     | 0b10000000, charevnt_0,
 $C80F DEFW $018F    ; character_15_GUARD_15     | 0b10000000, charevnt_1,
 $C811 DEFW $0510    ; character_16_GUARD_DOG_1  | 0b00000000, charevnt_5,  // checks byte_A13E case 2
 $C813 DEFW $0511    ; character_16_GUARD_DOG_2  | 0b00000000, charevnt_5,  // checks byte_A13E case 2
 $C815 DEFW $0090    ; character_16_GUARD_DOG_1  | 0b10000000, charevnt_0,
 $C817 DEFW $0191    ; character_16_GUARD_DOG_2  | 0b10000000, charevnt_1,
 $C819 DEFW $00A0    ; character_0_COMMANDANT    | 0b10100000, charevnt_0,
 $C81B DEFW $01A1    ; character_1_GUARD_1       | 0b10100000, charevnt_1,
 $C81D DEFW $072A    ; character_10_GUARD_10     | 0b00100000, charevnt_7,
 $C81F DEFW $082C    ; character_12_GUARD_12     | 0b00100000, charevnt_8,  // hero sleeps
 $C821 DEFW $092B    ; character_11_GUARD_11     | 0b00100000, charevnt_9,  // hero sits
 $C823 DEFW $06A4    ; character_4_GUARD_4       | 0b10100000, charevnt_6,  // go to 0x0315
 $C825 DEFW $0A24    ; character_4_GUARD_4       | 0b00100000, charevnt_10, // released from solitary
 $C827 DEFW $0425    ; character_5_GUARD_5       | 0b00100000, charevnt_4,  // zero in_solitary
; character_event_handlers
; .
; Array of pointers to character event handlers.
@label=character_event_handlers
 $C829 DEFW $C864    ; charevnt_handler *character_event_handlers[] = { &charevnt_handler_0,
 $C82B DEFW $C85C    ;   &charevnt_handler_1,
 $C82D DEFW $C860    ;   &charevnt_handler_2,
 $C82F DEFW $C86C    ;   &charevnt_handler_3_check_var_A13E,
 $C831 DEFW $C83F    ;   &charevnt_handler_4_solitary_ends,
 $C833 DEFW $C877    ;   &charevnt_handler_5_check_var_A13E_anotherone,
 $C835 DEFW $C845    ;   &charevnt_handler_6,
 $C837 DEFW $C882    ;   &charevnt_handler_7,
 $C839 DEFW $C88D    ;   &charevnt_handler_8_hero_sleeps,
 $C83B DEFW $C889    ;   &charevnt_handler_9_hero_sits,
 $C83D DEFW $C84C    ;   &charevnt_handler_10_hero_released_from_solitary, };
; charevnt_handler_4_solitary_ends
@label=charevnt_handler_4_solitary_ends
 $C83F XOR A         ; {in_solitary = 0;
 $C840 LD ($A13A),A  ; }
 $C843 JR $C864      ; goto charevnt_handler_0;
; charevnt_handler_6
@label=charevnt_handler_6
 $C845 POP HL        ; // (popped) sampled HL=$80C2 (x2),$8042  // likely target location
 $C846 LD (HL),$03   ; {*HL++ = 0x03;
 $C848 INC HL        ; }
 $C849 LD (HL),$15   ; *HL   = 0x15;
 $C84B RET           ; return;
; charevnt_handler_10_hero_released_from_solitary
@label=charevnt_handler_10_hero_released_from_solitary
 $C84C POP HL
 $C84D LD (HL),$A4   ; {*HL++ = 0xA4;
 $C84F INC HL        ; }
 $C850 LD (HL),$03   ; *HL   = 0x03;
 $C852 XOR A         ; {automatic_player_counter = 0; // force automatic control
 $C853 LD ($A139),A  ; }
 $C856 LD BC,$2500   ; {set_hero_target_location(0x0025); return;
 $C859 JP $A344      ; }
; charevnt_handler_1
@label=charevnt_handler_1
 $C85C LD C,$10      ; C = 0x10; // 0xFF10
 $C85E JR $C866      ; goto exit;
; charevnt_handler_2
@label=charevnt_handler_2
 $C860 LD C,$38      ; C = 0x38; // 0xFF38
 $C862 JR $C866      ; goto exit;
; charevnt_handler_0
@label=charevnt_handler_0
*$C864 LD C,$08      ; C = 0x08; // 0xFF08 // sampled HL=$8022,$8042,$8002,$8062
*$C866 POP HL        ; exit:
 $C867 LD (HL),$FF   ; {*HL++ = 0xFF;
 $C869 INC HL        ; }
 $C86A LD (HL),C     ; *HL   = C;
 $C86B RET           ; return;
; charevnt_handler_3_check_var_A13E
@label=charevnt_handler_3_check_var_A13E
 $C86C POP HL
 $C86D LD A,($A13E)  ; {if (entered_move_characters == 0) goto byte_A13E_is_zero; else goto byte_A13E_is_nonzero;
 $C870 AND A         ;
 $C871 JP Z,$A3F8    ;
 $C874 JP $A3F3      ; }
; charevnt_handler_5_check_var_A13E_anotherone
@label=charevnt_handler_5_check_var_A13E_anotherone
 $C877 POP HL
 $C878 LD A,($A13E)  ; {if (entered_move_characters == 0) goto byte_A13E_is_zero_anotherone; else goto byte_A13E_is_nonzero_anotherone;
 $C87B AND A         ;
 $C87C JP Z,$A4D8    ;
 $C87F JP $A4D3      ; }
; charevnt_handler_7
@label=charevnt_handler_7
 $C882 POP HL
 $C883 LD (HL),$05   ; {*HL++ = 0x05;
 $C885 INC HL        ; }
 $C886 LD (HL),$00   ; *HL   = 0x00;
 $C888 RET           ; return;
; charevnt_handler_9_hero_sits
@label=charevnt_handler_9_hero_sits
 $C889 POP HL
 $C88A JP $A47F      ; goto hero_sits;
; charevnt_handler_8_hero_sleeps
@label=charevnt_handler_8_hero_sleeps
 $C88D POP HL
 $C88E JP $A489      ; goto hero_sleeps;

; A countdown until any food item is discovered.
;
; (<- follow_suspicious_character, bribes_solitary_food)
@label=food_discovered_counter
g$C891 DEFB $00      ; food_discovered_counter

; Causes characters to follow the hero if he's being suspicious.
;
; Used by the routine at #R$9D7B.
; .
; Also: Food item discovery.
; .
; Also: Automatic hero behaviour.
;
; .
;
; (I've still no idea what this flag means).
@label=follow_suspicious_character
c$C892 XOR A         ; {entered_move_characters = 0;
 $C893 LD ($A13E),A  ; }
; If the bell is not ringing, hostiles persue.
 $C896 LD A,($A130)  ; {if (bell == 0) hostiles_persue();
 $C899 AND A         ;
 $C89A CALL Z,$CCAB  ; }
; If food was dropped then count down until it is discovered.
 $C89D LD HL,$C891   ; {if (food_discovered_counter != 0 && --food_discovered_counter == 0) <%
 $C8A0 LD A,(HL)     ;
 $C8A1 AND A         ;
 $C8A2 JR Z,$C8B1    ;
 $C8A4 DEC (HL)      ;
 $C8A5 JR NZ,$C8B1   ; }
; De-poison the food.
@nowarn
 $C8A7 LD HL,$76F9   ; {  item_structs[item_FOOD].item &= ~itemstruct_ITEM_FLAG_POISONED;
 $C8AA RES 5,(HL)    ; }
 $C8AC LD C,$07      ;   C = item_FOOD;
 $C8AE CALL $CD31    ;   item_discovered(); %>
; Make supporting characters react.
@nowarn
*$C8B1 LD IY,$8020   ; IY = $8020; // iterate over non-player characters
 $C8B5 LD B,$07      ; B = 7; // iterations
*$C8B7 PUSH BC       ; do <%
 $C8B8 LD A,(IY+$01) ; {  if (IY[1] != 0) <% // flags
 $C8BB CP $FF        ;
 $C8BD JP Z,$C8F4    ; }
 $C8C0 LD A,(IY+$00) ; {    A = IY[0] & vischar_CHARACTER_MASK; // character index
 $C8C3 AND $1F       ; }
 $C8C5 CP $14        ; {    if (A <= character_19_GUARD_DOG_4) <% // Hostile characters only.}
 $C8C7 JP NC,$C8F1   ;
; Characters 0..19.
 $C8CA PUSH AF
 $C8CB CALL $CCCD    ;       is_item_discoverable();
 $C8CE LD A,($A138)  ; {      if (red_flag || automatic_player_counter > 0) guards_follow_suspicious_character();
 $C8D1 AND A         ;
 $C8D2 JR NZ,$C8D8   ;
 $C8D4 LD A,($A139)  ;
 $C8D7 AND A         ;
*$C8D8 CALL NZ,$CC37 ; }
 $C8DB POP AF
; Guard dogs 1..4 (characters 16..19).
 $C8DC CP $0F        ; {      if (A >= character_16_GUARD_DOG_1) <%
 $C8DE JP Z,$C8F1    ;
 $C8E1 JP C,$C8F1    ; }
; Is the food nearby?
 $C8E4 PUSH IY       ; {        if (item_structs[item_FOOD].room & itemstruct_ROOM_FLAG_NEARBY_7) IY[1] = 3; %> %>
 $C8E6 POP HL        ;
 $C8E7 INC L         ;
 $C8E8 LD A,($76FA)  ;
 $C8EB BIT 7,A       ;
 $C8ED JR Z,$C8F1    ;
 $C8EF LD (HL),$03   ; }
*$C8F1 CALL $C918    ;     character_behaviour(); %>
*$C8F4 POP BC
 $C8F5 LD DE,$0020   ; {  IY += 32; // stride
 $C8F8 ADD IY,DE     ; }
 $C8FA DEC B         ; {%> while (--B);
 $C8FB JP NZ,$C8B7   ; }
; Inhibit hero automatic behaviour when the flag is red, or otherwise
; inhibited.
 $C8FE LD A,($A138)  ; {if (!red_flag && (in_solitary || automatic_player_counter == 0)) <%}
 $C901 AND A         ;
; Bug: Pointless JP NZ (jumps to RET, RET NZ would do).
 $C902 JP NZ,$C917   ;
 $C905 LD A,($A13A)  ;
 $C908 AND A         ;
 $C909 JR NZ,$C910   ;
 $C90B LD A,($A139)  ;
 $C90E AND A         ;
 $C90F RET NZ        ;
*$C910 LD IY,$8000   ;   IY = $8000;
 $C914 CALL $C918    ;   character_behaviour(); %>
*$C917 RET           ; return;

; Character behaviour stuff.
;
; Used by the routines at #R$C4E0 and #R$C892.
;
; I:IY Pointer to visible character.
@label=character_behaviour
c$C918 LD A,(IY+$07)  ; A = IY[7]; // $8007 etc. // more flags
 $C91B LD B,A         ; B = A;
; If the bottom nibble is set then decrement it.
 $C91C AND $0F        ; A &= vischar_BYTE7_MASK_LO;
 $C91E JR Z,$C925     ; if (A) <%
 $C920 DEC B          ; {  IY[7] = --B; // decrement but don't affect flags
 $C921 LD (IY+$07),B  ; }
 $C924 RET            ;   return; %>
*$C925 PUSH IY        ; {HL = IY;
 $C927 POP HL         ; }
 $C928 INC L          ; {A = *++HL; // incremented HL is $8021 $8041 $8061
 $C929 LD A,(HL)      ; }
 $C92A AND A          ; {if (A != 0) <%
 $C92B JP Z,$C9BA     ; }
 $C92E CP $01         ; {  if (A == vischar_FLAGS_BRIBE_PENDING) <%
 $C930 JR NZ,$C943    ; }
*$C932 PUSH HL
 $C933 EXX
 $C934 POP DE         ;     POP DEdash // ie. DEdash = HL
 $C935 INC E          ; {    DEdash += 3;
 $C936 INC E          ;
 $C937 INC E          ; }
 $C938 LD HL,$81B8    ;     HLdash = &hero_map_position.x;
 $C93B LDI            ;     *DEdash++ = *HLdash++;
 $C93D LDI            ;     *DEdash++ = *HLdash++;
 $C93F EXX
 $C940 JP $C9C0       ;     goto jump_c9c0; %>
*$C943 CP $02         ; {  else if (A == vischar_FLAGS_BIT1) <%
 $C945 JR NZ,$C953    ; }
 $C947 LD A,($A139)   ; {    if (automatic_player_counter) goto $C932; // jump into case 1
 $C94A AND A          ;
 $C94B JR NZ,$C932    ; }
 $C94D LD (HL),$00    ; {    *HL++ = 0;
 $C94F INC L          ; }
 $C950 JP $CB23       ;     get_next_target_and_handle_it(); return; %> // exit via
*$C953 CP $03         ; {  else if (A == (vischar_FLAGS_BRIBE_PENDING + vischar_FLAGS_BIT1)) <%}
 $C955 JR NZ,$C979    ;
 $C957 PUSH HL
 $C958 EX DE,HL
 $C959 LD HL,$76FA    ; {    if (item_structs[item_FOOD].room & itemstruct_ROOM_FLAG_NEARBY_7) <%
 $C95C BIT 7,(HL)     ;
 $C95E JR Z,$C96C     ; }
; Moves dog toward poisoned food?
 $C960 INC HL         ;       HL++;
 $C961 LD A,E         ; {      DE += 3;
 $C962 ADD A,$03      ;
 $C964 LD E,A         ; }
 $C965 LDI            ;       *DE++ = *HL++;
 $C967 LDI            ;       *DE++ = *HL++;
 $C969 POP HL
 $C96A JR $C9C0       ;       goto jump_c9c0; %>
*$C96C XOR A          ;     else <% A = 0;
 $C96D LD (DE),A      ;       *DE = A;
 $C96E EX DE,HL
 $C96F INC L          ; {      *++HL = 0xFF;
 $C970 LD (HL),$FF    ; }
 $C972 INC L          ; {      *++HL = 0;
 $C973 LD (HL),$00    ; }
 $C975 POP HL
 $C976 JP $CB23       ;       get_next_target_and_handle_it(); return; %> %> // exit via
*$C979 CP $04         ; {  else if (A == vischar_FLAGS_SAW_BRIBE) <%
 $C97B JR NZ,$C9BA    ; }
 $C97D PUSH HL
 $C97E LD A,($AF8E)   ;     A = bribed_character;
 $C981 CP $FF         ; {    if (A != character_NONE) <%
 $C983 JR Z,$C995     ; }
 $C985 LD C,A
 $C986 LD B,$07       ;       B = 7; // 7 iterations
@nowarn
 $C988 LD HL,$8020    ;       HL = $8020; // iterate over non-player characters
*$C98B LD A,C         ;       do <%
 $C98C CP (HL)        ; {        if (*HL == A) goto found_bribed;
 $C98D JR Z,$C99C     ; }
 $C98F LD A,$20       ; {        HL += 32;
 $C991 ADD A,L        ;
 $C992 LD L,A         ; }
 $C993 DJNZ $C98B     ;       %> while (--B); %>
*$C995 POP HL
; Bribed character was not visible.
 $C996 LD (HL),$00    ; {    *HL++ = 0;
 $C998 INC L          ; }
 $C999 JP $CB23       ;     get_next_target_and_handle_it(); return; // exit via
; Found bribed character.
*$C99C LD A,$0F       ; {found_bribed: HL += 15;
 $C99E ADD A,L        ;
 $C99F LD L,A         ; }
 $C9A0 POP DE
 $C9A1 PUSH DE
 $C9A2 LD A,E         ; {    DE += 3;
 $C9A3 ADD A,$03      ;
 $C9A5 LD E,A         ; }
 $C9A6 LD A,($68A0)   ; {    if (room_index) <%
 $C9A9 AND A          ;
 $C9AA JP NZ,$C9B2    ; }
; Indoors.
 $C9AD CALL $E542     ;       pos_to_tinypos(HL,DE); %>
 $C9B0 JR $C9B7       ;     else <%
; Outdoors.
*$C9B2 LDI            ;       *DE++ = *HL++;
 $C9B4 INC L          ;       HL++;
 $C9B5 LDI            ;       *DE++ = *HL++; %>
*$C9B7 POP HL
 $C9B8 JR $C9C0       ;     goto jump_c9c0; %> %>
*$C9BA INC L          ; {A = HL[1];
 $C9BB LD A,(HL)      ;
 $C9BC DEC L          ; }
 $C9BD AND A          ; {if (A == 0) goto character_behaviour_end_1;
 $C9BE JR Z,$C9F5     ; }
*$C9C0 LD A,(HL)      ; jump_c9c0: A = *HL; // HL is $8001
 $C9C1 EXX
 $C9C2 LD C,A         ; Cdash = A;
; Self modify vischar_at_pos_x/y routines.
 $C9C3 LD A,($68A0)   ; {if (room_index > room_0_OUTDOORS) <%
 $C9C6 AND A          ;
 $C9C7 JR Z,$C9CE     ; }
@nowarn
 $C9C9 LD HL,$CB75    ;   HLdash = &multiply_by_1; %>
 $C9CC JR $C9DA       ; else <%
*$C9CE BIT 6,C        ; {  if (Cdash & vischar_FLAGS_DOOR_THING) <%
 $C9D0 JR Z,$C9D7     ; }
@nowarn
 $C9D2 LD HL,$B295    ;     HLdash = &multiply_by_4; %>
 $C9D5 JR $C9DA       ;   else <%
@nowarn
*$C9D7 LD HL,$B1C7    ;     HLdash = &multiply_by_8; %> %>
*$C9DA LD ($CA13),HL  ; ($CA13) = HLdash; // self-modify vischar_at_pos_x:$CA13
 $C9DD LD ($CA4B),HL  ; ($CA4B) = HLdash; // self-modify vischar_at_pos_y:$CA4B
 $C9E0 EXX
 $C9E1 BIT 5,(IY+$07) ; {if (IY[7] & vischar_BYTE7_IMPEDED) goto character_behaviour_end_2; // hit a wall etc.
 $C9E5 JR NZ,$C9FF    ; }
 $C9E7 INC L          ; {HL += 3;
 $C9E8 INC L          ;
 $C9E9 INC L          ; }
 $C9EA CALL $CA11     ; vischar_at_pos_x();
 $C9ED JR NZ,$C9F5    ; if (Z) <%
 $C9EF CALL $CA49     ;   vischar_at_pos_y();
 $C9F2 JP Z,$CA81     ;   if (Z) goto bribes_solitary_food; %> // exit via // character couldn't move?
; This entry point is used by the routine at #R$CA81.
*$C9F5 CP (IY+$0D)    ; {character_behaviour_end_1: if (A != IY[13]) IY[13] = A | input_KICK; // sampled IY=$8040,$8020,$8000
 $C9F8 RET Z          ;
 $C9F9 OR $80         ;
 $C9FB LD (IY+$0D),A  ; }
 $C9FE RET            ; return;
*$C9FF LD A,$04       ; {character_behaviour_end_2: L += 4;
 $CA01 ADD A,L        ;
 $CA02 LD L,A         ; }
 $CA03 CALL $CA49     ; vischar_at_pos_y();
 $CA06 JR NZ,$C9F5    ; {if (Z) vischar_at_pos_x();
 $CA08 CALL $CA11     ; }
 $CA0B JR NZ,$C9F5    ; if (!Z) goto character_behaviour_end_1; // likely: couldn't move, so .. do something
 $CA0D DEC L          ; HL--;
 $CA0E JP $CA81       ; bribes_solitary_food(); return; // exit via

; Move character on the X axis.
;
; Used by the routine at #R$C918.
;
; I:HL Pointer to visible character block + 4.
; I:IY Pointer to visible character block.
; O:A  8/4/0 .. meaning ?
; O:HL Pointer to ?
@label=vischar_at_pos_x
c$CA11 LD A,(HL)      ; A = *HL; // sampled HL=$8004,$8044,$8064,$8084
 $CA12 CALL $B1C7     ; multiply_by_8(); // self modified by #R$C9DA
 $CA15 LD A,L         ; {HL += 11; // position on X axis ($800F etc.)
 $CA16 ADD A,$0B      ;
 $CA18 LD L,A         ; }
 $CA19 LD E,(HL)      ; {E = *HL++;
 $CA1A INC L          ; }
 $CA1B LD D,(HL)      ; D = *HL;
 $CA1C EX DE,HL
 $CA1D SBC HL,BC      ; DE -= BC;
 $CA1F JR Z,$CA3E     ; if (DE) <%
 $CA21 JP M,$CA30     ;   if (DE > 0) <% // +ve
 $CA24 LD A,H         ; {    if (D != 0   || E >= 3)  <% A = 8; return; %> %>
 $CA25 AND A          ; else <% // -ve
 $CA26 JR NZ,$CA2D    ;
 $CA28 LD A,L         ;
 $CA29 CP $03         ;
 $CA2B JR C,$CA3E     ;
*$CA2D LD A,$08       ;
 $CA2F RET            ; }
*$CA30 LD A,H         ; {    if (D != 255 || E < 254) <% A = 4; return; %> %>
 $CA31 CP $FF         ; %>
 $CA33 JR NZ,$CA3B    ;
 $CA35 LD A,L         ;
 $CA36 CP $FE         ;
 $CA38 JP NC,$CA3E    ;
*$CA3B LD A,$04       ;
 $CA3D RET            ; }
*$CA3E EX DE,HL
 $CA3F LD A,L         ; {HL -= 11;
 $CA40 SUB $0B        ;
 $CA42 LD L,A         ; }
 $CA43 SET 5,(IY+$07) ; IY[7] |= vischar_BYTE7_IMPEDED;
 $CA47 XOR A          ; A = 0;
 $CA48 RET            ; return;

; Move character on the Y axis.
;
; Used by the routine at #R$C918.
; .
; Nearly identical to vischar_at_pos_x above.
;
; I:HL Pointer to visible character block + 5.
; I:IY Pointer to visible character block.
; O:A  5/7/0 .. meaning ?
; O:HL Pointer to ?
@label=vischar_at_pos_y
c$CA49 LD A,(HL)      ; A = *HL; // sampled HL=$8025,$8065,$8005
 $CA4A CALL $B1C7     ; multiply_by_8(); // self modified by #R$C918
 $CA4D LD A,L         ; {HL += 12; // position on Y axis ($8011 etc.)
 $CA4E ADD A,$0C      ;
 $CA50 LD L,A         ; }
 $CA51 LD E,(HL)      ; {E = *HL++;
 $CA52 INC L          ; }
 $CA53 LD D,(HL)      ; D = *HL;
 $CA54 EX DE,HL
 $CA55 SBC HL,BC      ; DE -= BC;
 $CA57 JR Z,$CA76     ; if (DE) <%
 $CA59 JP M,$CA68     ;   if (DE > 0) <% // +ve
 $CA5C LD A,H         ; {    if (D != 0   || E >= 3)  <% A = 5; return; %> %>
 $CA5D AND A          ; else <% // -ve
 $CA5E JR NZ,$CA65    ;
 $CA60 LD A,L         ;
 $CA61 CP $03         ;
 $CA63 JR C,$CA76     ;
*$CA65 LD A,$05       ;
 $CA67 RET            ; }
*$CA68 LD A,H         ; {    if (D != 255 || E < 254) <% A = 7; return; %> %>
 $CA69 CP $FF         ; %>
 $CA6B JR NZ,$CA73    ;
 $CA6D LD A,L         ;
 $CA6E CP $FE         ;
 $CA70 JP NC,$CA76    ;
*$CA73 LD A,$07       ;
 $CA75 RET            ; }
*$CA76 EX DE,HL
 $CA77 LD A,L         ; {HL -= 14;
 $CA78 SUB $0E        ;
 $CA7A LD L,A         ; }
 $CA7B RES 5,(IY+$07) ; IY[7] &= ~vischar_BYTE7_IMPEDED;
 $CA7F XOR A          ; A = 0;
 $CA80 RET            ; return;

; Bribes, solitary, food, 'character enters' sound.
;
; Used by the routine at #R$C918.
;
; I:IY Pointer to $8000, $8020, $8040, $8060, $8080
; I:HL Pointer to $8004, $8024, $8044, $8064, $8084
@label=bribes_solitary_food
c$CA81 LD A,(IY+$01) ; A = IY[1];
 $CA84 LD C,A        ; C = A;
 $CA85 AND $3F       ; A &= vischar_FLAGS_MASK;
 $CA87 JR Z,$CAB6    ; if (A) <%
 $CA89 CP $01        ; {  if (A == vischar_FLAGS_BRIBE_PENDING) <%
 $CA8B JR NZ,$CA99   ; }
 $CA8D LD A,($AF8E)  ; {    if (IY[0] == bribed_character) <% accept_bribe(); return; %> // exit via
 $CA90 CP (IY+$00)   ;
 $CA93 JP Z,$B107    ; }
 $CA96 JP $CB98      ;     else <% solitary(); return; %> %> // failed to bribe? // exit via
*$CA99 CP $02        ; {  else if (A == vischar_FLAGS_BIT1 || A == vischar_FLAGS_SAW_BRIBE) <% return; %>
 $CA9B RET Z         ;
 $CA9C CP $04        ;
 $CA9E RET Z         ; }
 $CA9F PUSH HL
; Decide how long until food is discovered.
@nowarn
 $CAA0 LD HL,$76F9   ; {  if ((item_structs[item_FOOD].item & itemstruct_ITEM_FLAG_POISONED) == 0) A = 32; else A = 255;
 $CAA3 BIT 5,(HL)    ;
 $CAA5 LD A,$20      ;
 $CAA7 JR Z,$CAAB    ;
 $CAA9 LD A,$FF      ; }
*$CAAB LD ($C891),A  ;   food_discovered_counter = A;
 $CAAE POP HL
 $CAAF DEC L         ; {  HL -= 2;
 $CAB0 DEC L         ; }
 $CAB1 XOR A         ; {  *HL = 0;
 $CAB2 LD (HL),A     ; }
 $CAB3 JP $C9F5      ;   goto character_behaviour_end_1; %> // exit via
*$CAB6 BIT 6,C       ; {if (C & vischar_FLAGS_DOOR_THING) <%
 $CAB8 JR Z,$CB13    ; }
; Results in character entering.
 $CABA DEC L         ; {  C = *--HL; // 80a3, 8083, 8063, 8003 // likely target location
 $CABB LD C,(HL)     ; }
 $CABC DEC L         ; {  A = *--HL;
 $CABD LD A,(HL)     ; }
 $CABE PUSH HL
 $CABF CALL $CB79    ;   DE = element_A_of_table_7738(A);
 $CAC2 POP HL
 $CAC3 LD A,E        ; {  DE += C;
 $CAC4 ADD A,C       ;
 $CAC5 LD E,A        ;
 $CAC6 JR NC,$CAC9   ;
 $CAC8 INC D         ; }
*$CAC9 LD A,(DE)     ;   A = *DE;
 $CACA BIT 7,(HL)    ; {  if (*HL & vischar_BYTE2_BIT7) A ^= door_REVERSE;
 $CACC JR Z,$CAD0    ;
 $CACE XOR $80       ; }
*$CAD0 PUSH AF
 $CAD1 LD A,(HL)     ; {  A = *HL++; // $8002, ...
 $CAD2 INC L         ; }
; Pattern: [-2]+1
 $CAD3 BIT 7,A       ; {  if (A & vischar_BYTE2_BIT7) (*HL) -= 2; // $8003, ... // likely target location
 $CAD5 JR Z,$CAD9    ;
 $CAD7 DEC (HL)      ;
 $CAD8 DEC (HL)      ; }
*$CAD9 INC (HL)      ;   (*HL)++; // likely target location
 $CADA POP AF
 $CADB CALL $6A12    ;   HL = get_door();
 $CADE LD A,(HL)     ; {  IY[0x1C] = (*HL >> 2) & 0x3F; // IY=$8000 => $801C (room index) // HL=$790E,$7962,$795E => door position thingy // 0x3F is doors[0] room mask shifted right 2
 $CADF RRA           ;
 $CAE0 RRA           ;
 $CAE1 AND $3F       ;
 $CAE3 LD (IY+$1C),A ; }
; TOP_LEFT or TOP_RIGHT => next door pos
; .
; BOTTOM_RIGHT or BOTTOM_LEFT => current door pos
 $CAE6 LD A,(HL)     ; {  A = *HL & doorpos_FLAGS_MASK_DIRECTION; // door position thingy, lowest two bits -- index?
 $CAE7 AND $03       ; }
 $CAE9 CP $02        ; {  if (A < 2) HL += 5; else HL -= 3;
 $CAEB JP NC,$CAF5   ;
 $CAEE INC HL        ;
 $CAEF INC HL        ;
 $CAF0 INC HL        ;
 $CAF1 INC HL        ;
 $CAF2 INC HL        ;
 $CAF3 JR $CAF8      ;
*$CAF5 DEC HL        ;
 $CAF6 DEC HL        ;
 $CAF7 DEC HL        ; }
*$CAF8 PUSH HL
 $CAF9 PUSH IY       ; {  HL = IY;
 $CAFB POP HL        ; }
 $CAFC LD A,L        ; {  if (L == 0) <%
 $CAFD AND A         ;
 $CAFE JP NZ,$CB08   ; }
; Hero's vischar only.
 $CB01 INC L         ;     HL++; // $8000 -> $8001
 $CB02 RES 6,(HL)    ; {    *HL++ &= ~vischar_FLAGS_DOOR_THING;
 $CB04 INC L         ; }
 $CB05 CALL $CB23    ;     get_next_target_and_handle_it(); %>
*$CB08 POP HL
 $CB09 CALL $68A2    ;   transition();
 $CB0C LD BC,$2030   ; {  play_speaker(sound_CHARACTER_ENTERS_1);
 $CB0F CALL $A11D    ; }
 $CB12 RET           ;   return; %>
*$CB13 DEC L         ; {HL -= 2;
 $CB14 DEC L         ; }
 $CB15 LD A,(HL)     ; A = *HL; // $8002 etc. // likely target location
 $CB16 CP $FF        ; {if (A != 0xFF) <%
 $CB18 JR Z,$CB23    ; }
 $CB1A INC L         ;   HL++;
 $CB1B BIT 7,A       ; {  if (A & vischar_BYTE2_BIT7) <%
 $CB1D JR Z,$CB21    ; }
 $CB1F DEC (HL)      ; {    (*HL) -= 2; %> // $8003 etc.
 $CB20 DEC (HL)      ; }
*$CB21 INC (HL)      ;   else <% (*HL)++;
 $CB22 DEC L         ;     HL--; %> %>
; FALL THROUGH to get_next_target_and_handle_it.

; (unknown) get_next_target_and_handle_it
;
; Used by the routines at #R$A3BB, #R$B107, #R$C918, #R$CA81 and #R$CB2D.
;
; I:A  Character index?
; I:HL ?
@label=get_next_target_and_handle_it
c$CB23 PUSH HL
 $CB24 CALL $C651    ; get_next_target();
 $CB27 CP $FF        ; {if (A == 0xFF) <%
 $CB29 JP NZ,$CB61   ; }
 $CB2C POP HL
; FALL THROUGH into ran_out_of_list.

; (unknown) ran_out_of_list
;
; Used by the routine at #R$C4E0.
;
; .
;
; If not the hero's vischar ...
@label=ran_out_of_list
c$CB2D LD A,L        ; {  if (L != 0x02) <%
 $CB2E CP $02        ;
 $CB30 JP Z,$CB46    ; }
 $CB33 LD A,(IY+$00) ; {    if (IY[0] & vischar_CHARACTER_MASK == 0) <%
 $CB36 AND $1F       ;
 $CB38 JR NZ,$CB42   ; }
 $CB3A LD A,(HL)     ; {      A = *HL & ~vischar_BYTE2_BIT7;
 $CB3B AND $7F       ; }
 $CB3D CP $24        ; {      if (A == 36) goto $CB46; // character index
 $CB3F JR Z,$CB46    ; }
 $CB41 XOR A         ;       A = 0; %> // forces next if statement to be taken
*$CB42 CP $0C        ; {    if (A <= character_11_GUARD_11) goto $CB50; %>
 $CB44 JR C,$CB50    ; }
; We arrive here if:
; - vischar is the hero, or
; - character is character_0_COMMANDANT and (target low byte & 0x7F) == 36, or
; - character is >= character_12_GUARD_12
*$CB46 PUSH HL
 $CB47 CALL $C7C6    ;   character_event();
 $CB4A POP HL
 $CB4B LD A,(HL)     ;   A = *HL;
 $CB4C AND A         ; {  if (A == 0) return;
 $CB4D RET Z         ; }
 $CB4E JR $CB23      ;   get_next_target_and_handle_it(); return; // exit via
; We arrive here if:
; - vischar is not the hero, and
;   - character is character_0_COMMANDANT and (target low byte & 0x7F) != 36, or
;   - character is character_1_GUARD_1 .. character_11_GUARD_11
*$CB50 LD A,(HL)     ; {  *HL++ = *HL ^ 0x80;
 $CB51 XOR $80       ;
 $CB53 LD (HL),A     ;
 $CB54 INC HL        ; }
; Pattern: [-2]+1
 $CB55 BIT 7,A       ; {  if (A & (1<<7)) <%
 $CB57 JR Z,$CB5B    ; }
 $CB59 DEC (HL)      ; {    (*HL) -= 2; %>
 $CB5A DEC (HL)      ; }
*$CB5B INC (HL)      ;   (*HL)++
 $CB5C DEC HL        ;   HL--;
 $CB5D XOR A         ;   A = 0;
 $CB5E RET           ;   return; %> // strictly the terminating brace is after the following unreferenced bytes
;
 $CB5F DEFB $18,$09  ; Unreferenced bytes.

; (unknown) handle_target
;
; Used by the routine at #R$CB23.
@label=handle_target
c$CB61 CP $80         ; {if (A == 128) <%
 $CB63 JP NZ,$CB6A    ; }
 $CB66 SET 6,(IY+$01) ;   IY[1] |= vischar_FLAGS_DOOR_THING; %>
*$CB6A POP DE
 $CB6B INC E          ; {memcpy(DE + 2, HL, 2);
 $CB6C INC E          ;
 $CB6D LD BC,$0002    ;
 $CB70 LDIR           ; }
 $CB72 LD A,$80       ; A = 128;
 $CB74 RET            ; return;

; Widen A to BC (multiply by 1).
@label=multiply_by_1
c$CB75 LD C,A        ; {BC = A; return;
 $CB76 LD B,$00      ;
 $CB78 RET           ; }

; Return the A'th element of table_7738.
;
; Used by the routines at #R$C651 and #R$CA81.
;
; I:A  Index.
; O:DE Element.
@label=element_A_of_table_7738
c$CB79 ADD A,A       ; {DE = table_7738[A];
 $CB7A LD E,A        ;
 $CB7B LD D,$00      ;
 $CB7D LD HL,$7738   ;
 $CB80 ADD HL,DE     ;
 $CB81 LD E,(HL)     ;
 $CB82 INC HL        ;
 $CB83 LD D,(HL)     ; }
 $CB84 RET           ; return;

; Pseudo-random number generator.
;
; Used by the routine at #R$C651.
;
; O:A Pseudo-random number from 0..15.
@label=random_nibble
c$CB85 PUSH HL
 $CB86 LD HL,($C41A) ; {HL = prng_pointer + 1;
 $CB89 INC L         ; }
; sampled HL=$902E,$902F,$9030,$9031,$9032,$9033,$9034,$9035,... looks like
; it's fetching exterior tiles
 $CB8A LD A,(HL)     ; {A = *HL & 0x0F;
 $CB8B AND $0F       ; }
 $CB8D LD ($C41A),HL ; prng_pointer = HL;
 $CB90 POP HL
 $CB91 RET           ; return;

; Unreferenced byte.
u$CB92 DEFB $13,$40,$30,$10,$7E,$F0 ; unused_CB92

; The hero has been sent to solitary.
;
; Used by the routines at #R$A51C, #R$AFDF, #R$CA81 and #R$EFCB.
;
; .
;
; Silence bell.
@label=solitary
c$CB98 LD A,$FF        ; {bell = bell_STOP;
 $CB9A LD ($A130),A    ; }
; Seize hero's held items.
 $CB9D LD HL,$8215     ; HL = &items_held[0];
 $CBA0 LD C,(HL)       ; C = *HL;
 $CBA1 LD (HL),A       ; *HL = item_NONE;
 $CBA2 CALL $CD31      ; item_discovered();
 $CBA5 LD HL,$8216     ; HL = &items_held[1];
 $CBA8 LD C,(HL)       ; C = *HL;
 $CBA9 LD (HL),$FF     ; *HL = item_NONE;
 $CBAB CALL $CD31      ; item_discovered();
 $CBAE CALL $7C33      ; draw_all_items();
; Discover all items.
 $CBB1 LD B,$10        ; B = 16; // all items
 $CBB3 LD HL,$76C9     ; HL = &item_structs[0].room;
*$CBB6 PUSH BC         ; do <%
 $CBB7 PUSH HL
; Is the item outdoors?
 $CBB8 LD A,(HL)       ; {  A = *HL & itemstruct_ROOM_MASK;
 $CBB9 AND $3F         ; }
 $CBBB JR NZ,$CBDC     ;   if (A == room_0_OUTDOORS) <%
 $CBBD DEC HL          ; {    A = *--HL;
 $CBBE LD A,(HL)       ; }
 $CBBF INC HL          ; {    HL += 2;
 $CBC0 INC HL          ; }
 $CBC1 EX DE,HL
 $CBC2 EX AF,AF'
 $CBC3 XOR A           ;     A = 0;
*$CBC4 PUSH AF         ;     do <%
 $CBC5 PUSH DE
; If the item is within the camp bounds then it will be discovered.
 $CBC6 CALL $A01A      ;       within_camp_bounds();
 $CBC9 JR Z,$CBD5      ;       if (Z) goto $CBD5;
 $CBCB POP DE
 $CBCC POP AF
 $CBCD INC A           ; {    %> while (++A != 3);
 $CBCE CP $03          ;
 $CBD0 JP NZ,$CBC4     ; }
 $CBD3 JR $CBDC        ;     goto next;
*$CBD5 POP DE
 $CBD6 POP AF
 $CBD7 EX AF,AF'
 $CBD8 LD C,A          ;     C = A;
 $CBD9 CALL $CD31      ;     item_discovered(); %>
*$CBDC POP HL          ;   next:
 $CBDD POP BC
 $CBDE LD DE,$0007     ; {  HL += 7; // stride
 $CBE1 ADD HL,DE       ; }
 $CBE2 DJNZ $CBB6      ; %> while (--B);
; Move the hero to solitary.
 $CBE4 LD A,$18        ; {$801C = room_24_SOLITARY;
 $CBE6 LD ($801C),A    ; }
 $CBE9 LD A,$14        ; {current_door = 20;
 $CBEB LD ($68A1),A    ; }
 $CBEE LD B,$23        ; {decrease_morale(35);
 $CBF0 CALL $A0E0      ; }
 $CBF3 CALL $B79B      ; reset_map_and_characters();
 $CBF6 LD DE,$7613     ; {memcpy(&character_structs[0].secondbyte, &solitary_hero_reset_data, 6);
 $CBF9 LD HL,$CC31     ;
 $CBFC LD BC,$0006     ;
 $CBFF LDIR            ; }
 $CC01 LD B,$0D        ; {queue_message_for_display(message_YOU_ARE_IN_SOLITARY);
 $CC03 CALL $7D15      ; }
 $CC06 LD B,$0E        ; {queue_message_for_display(message_WAIT_FOR_RELEASE);
 $CC08 CALL $7D15      ; }
 $CC0B LD B,$13        ; {queue_message_for_display(message_ANOTHER_DAY_DAWNS);
 $CC0D CALL $7D15      ; }
 $CC10 LD A,$FF        ; {in_solitary = 0xFF; // inhibit user input
 $CC12 LD ($A13A),A    ; }
 $CC15 XOR A           ; {automatic_player_counter = 0; // immediately take automatic control of hero
 $CC16 LD ($A139),A    ; }
 $CC19 LD HL,$CE2E     ; {$8015 = sprite_prisoner;
 $CC1C LD ($8015),HL   ; }
 $CC1F LD HL,$7AC6     ; HL = &solitary_pos;
 $CC22 LD IY,$8000     ; IY = $8000;
 $CC26 LD (IY+$0E),$03 ; IY[0x0E] = direction_BOTTOM_LEFT; // character faces bottom left
 $CC2A XOR A           ; {($8002) = 0; // target location - why is this storing a byte and not a word?
 $CC2B LD ($8002),A    ; }
 $CC2E JP $68A2        ; transition(); return; // exit via

; Partial character struct.
;
; (<- solitary)
@label=solitary_hero_reset_data
b$CC31 DEFB $00         ; room = room_0_OUTDOORS
 $CC32 DEFB $74,$64,$03 ; pos = 0x74, 0x64, 0x03
 $CC35 DEFB $24,$00     ; target = 0x24, 0x00

; Guards follow suspicious character.
;
; Used by the routine at #R$C892.
;
; I:IY Pointer to visible character.
@label=guards_follow_suspicious_character
c$CC37 PUSH IY         ; {HL = IY;
 $CC39 POP HL          ; }
 $CC3A LD A,(HL)       ; A = *HL;
; Wearing the uniform stops anyone but the commandant from following the hero.
 $CC3B AND A           ; {if (A != character_0_COMMANDANT && *$8015 == sprite_guard) return;
 $CC3C JR Z,$CC46      ;
 $CC3E LD A,($8015)    ;
 $CC41 LD DE,$CEA6     ;
 $CC44 CP E            ;
 $CC45 RET Z           ; }
; Which is the case here?
; .
; - Don't follow mad people, or
; .
; - Don't follow the hero when bribe has been used
*$CC46 INC L           ; {if (HL[1] == vischar_FLAGS_SAW_BRIBE) return; // $8041 etc. // 'gone mad' flag
 $CC47 LD A,(HL)       ;
 $CC48 CP $04          ;
 $CC4A RET Z           ; }
 $CC4B DEC L
 $CC4C LD A,L          ; {HL += 15;
 $CC4D ADD A,$0F       ;
 $CC4F LD L,A          ; }
 $CC50 LD DE,$81B2     ; DE = &tinypos_stash_x;
 $CC53 LD A,($68A0)    ; {if (room_index == room_0_OUTDOORS) <%
 $CC56 AND A           ;
 $CC57 JP NZ,$CC92     ; }
 $CC5A CALL $E542      ;   pos_to_tinypos(HL,DE);
 $CC5D LD HL,$81B8     ;   HL = &hero_map_position.x;
 $CC60 LD DE,$81B2     ;   DE = &tinypos_stash_x;
 $CC63 LD A,(IY+$0E)   ;   A = IY[0x0E]; // ?
 $CC66 RRA             ;   carry = A & 1; A >>= 1;
 $CC67 LD C,A          ;   C = A;
 $CC68 JR C,$CC80      ;   if (!carry) <% /* TL or BR */
; Range check.
 $CC6A INC HL          ;     HL++;
 $CC6B INC DE          ;     DE++;
 $CC6C LD A,(DE)       ; {    A = *DE - 1;
 $CC6D DEC A           ; }
 $CC6E CP (HL)         ; {    if (A >= *HL || A + 2 < *HL) return; // *DE - 1 .. *DE + 1
 $CC6F RET NC          ;
 $CC70 ADD A,$02       ;
 $CC72 CP (HL)         ;
 $CC73 RET C           ; }
 $CC74 DEC HL          ;     HL--;
 $CC75 DEC DE          ;     DE--;
 $CC76 LD A,(DE)       ;     A = *DE;
 $CC77 CP (HL)         ;     CP *HL  // TRICKY!
 $CC78 BIT 0,C         ; {    BIT 0,C // if ((C & (1<<0)) == 0) carry = !carry; /* TL (can't be TR) */
 $CC7A JR NZ,$CC7D     ;
 $CC7C CCF             ; }
*$CC7D RET C           ;     RET C   // This is odd: CCF then RET C? // will need to fall into 'else' clause
 $CC7E JR $CC92        ;   %>
; Range check.
*$CC80 LD A,(DE)       ; {  else <% A = *DE - 1;
 $CC81 DEC A           ; }
 $CC82 CP (HL)         ; {    if (A >= *HL || A + 2 < *HL) return; // *DE - 1 .. *DE + 1
 $CC83 RET NC          ;
 $CC84 ADD A,$02       ;
 $CC86 CP (HL)         ;
 $CC87 RET C           ; }
 $CC88 INC HL          ;     HL++;
 $CC89 INC DE          ;     DE++;
 $CC8A LD A,(DE)       ;     A = *DE;
 $CC8B CP (HL)         ;     CP *HL  // TRICKY!
 $CC8C BIT 0,C         ; {    BIT 0,C // if ((C & (1<<0)) == 0) carry = !carry; /* TL or TR */
 $CC8E JR NZ,$CC91     ;
 $CC90 CCF             ; }
*$CC91 RET C           ;     RET C %> %>
*$CC92 LD A,($A138)    ; {if (!red_flag) <%
 $CC95 AND A           ;
 $CC96 JR NZ,$CCA3     ; }
 $CC98 LD A,(IY+$13)   ;   A = IY[0x13]; // sampled IY=$8020 // saw this breakpoint hit when outdoors
 $CC9B CP $20          ; {  if (A < 32) // height
 $CC9D RET NC          ; }
 $CC9E LD (IY+$01),$02 ;     IY[1] = vischar_FLAGS_BIT1; // dog+food flag?
 $CCA2 RET             ;   return; %>
*$CCA3 XOR A           ; {bell = bell_RING_PERPETUAL;
 $CCA4 LD ($A130),A    ; }
 $CCA7 CALL $CCAB      ; hostiles_persue();
 $CCAA RET             ; return;

; Guards persue prisoners.
;
; Used by the routines at #R$C892, #R$CC37, #R$CCCD and #R$EF9A.
; .
; For all visible, hostile characters, at height < 32, set the bribed/persue
; flag.
; .
; Research: If I nop this out then guards don't spot the items I drop.
@label=hostiles_persue
@nowarn
c$CCAB LD HL,$8020   ; {HL = $8020; // iterate over non-player characters
 $CCAE LD DE,$0020   ; }
 $CCB1 LD B,$07      ; B = 7; // iterations
*$CCB3 PUSH HL       ; do <%
; HL[0x13] is the character's height, testing this excludes the guards in the
; towers.
 $CCB4 LD A,(HL)     ; {  if (HL[0] <= character_19_GUARD_DOG_4 && HL[0x13] < 32) HL[1] = vischar_FLAGS_BRIBE_PENDING;
 $CCB5 CP $14        ;
 $CCB7 JR NC,$CCC8   ;
 $CCB9 LD A,$13      ;
 $CCBB ADD A,L       ;
 $CCBC LD L,A        ;
 $CCBD LD A,(HL)     ;
 $CCBE CP $20        ;
 $CCC0 JR NC,$CCC8   ;
 $CCC2 LD A,L        ;
 $CCC3 SUB $12       ;
 $CCC5 LD L,A        ;
 $CCC6 LD (HL),$01   ;
*$CCC8 POP HL        ; }
 $CCC9 ADD HL,DE     ;   HL += 32; // stride
 $CCCA DJNZ $CCB3    ; %> while (--B);
 $CCCC RET           ; return;

; Is item discoverable?
;
; Used by the routine at #R$C892.
; .
; Searches item_structs for items dropped nearby. If items are found the
; hostiles are made to persue the hero.
; .
; Green key and food items are ignored.
@label=is_item_discoverable
c$CCCD LD A,($68A0)  ; A = room_index;
 $CCD0 AND A         ; {if (A != room_0_OUTDOORS) <%
 $CCD1 JR Z,$CCDB    ; }
; Interior.
 $CCD3 CALL $CCFB    ;   is_item_discoverable_interior(A);
 $CCD6 RET NZ        ; {  if (Z) hostiles_persue(); /* Item found */
 $CCD7 CALL $CCAB    ; }
 $CCDA RET           ;   return; %>
; Exterior.
*$CCDB LD HL,$76C9   ; else <% HL = &item_structs[0].room;
 $CCDE LD DE,$0007
 $CCE1 LD B,$10      ;   B = 16; // iterations == n.itemstructs
*$CCE3 BIT 7,(HL)    ; {  do <% if (HL[0] & itemstruct_ROOM_FLAG_NEARBY_7) goto nearby;
 $CCE5 JR NZ,$CCEB   ; }
*$CCE7 ADD HL,DE     ;     next: HL += 7; // stride
 $CCE8 DJNZ $CCE3    ;   %> while (--B);
 $CCEA RET           ;   return; %>
; Suspected bug: HL is decremented, but not re-incremented before 'goto next'.
; So it must be reading a byte early when iteration is resumed. Consequences? I
; think it'll screw up when multiple items are in range.
*$CCEB DEC HL        ; nearby: HL--;
 $CCEC LD A,(HL)     ; {A = *HL & itemstruct_ITEM_MASK; // sampled HL=$772A (&item_structs[item_PURSE].item)
 $CCED AND $0F       ; }
@rfix+begin
       INC HL        ; potentially a bug fix but needs thinking about
@rfix+end
; The green key and food items are ignored.
 $CCEF CP $0B        ; {if (A == item_GREEN_KEY || A == item_FOOD) goto next;
 $CCF1 JR Z,$CCE7    ;
 $CCF3 CP $07        ;
 $CCF5 JR Z,$CCE7    ; }
 $CCF7 CALL $CCAB    ; hostiles_persue();
 $CCFA RET           ; return;

; Is an item discoverable indoors?
;
; Used by the routines at #R$C6A0 and #R$CCCD.
; .
; A discoverable item is one moved away from its default room, and one that
; isn't the red cross parcel.
;
; I:A     Room ref.
; O:Flags Z => found, NZ => not found.
; O:C     Item (if found).
@label=is_item_discoverable_interior
c$CCFB LD C,A        ; C = A; // room ref
 $CCFC LD HL,$76C9   ; HL = &item_structs[0].room; // pointer to room ref
 $CCFF LD B,$10      ; B = 16; // item__LIMIT
*$CD01 LD A,(HL)     ; {do <% A = *HL & itemstruct_ROOM_MASK;
 $CD02 AND $3F       ; }
; Is the item in the specified room?
 $CD04 CP C          ; {  if (A == C) <% // yes
 $CD05 JR NZ,$CD1B   ; }
 $CD07 PUSH HL
; Has the item been moved to a different room?
; .
; Bug? Note that room_and_flags doesn't get its flags masked off. Does it need
; & 0x3F ? (DOS version has it)
 $CD08 DEC HL        ; {    A = default_item_locations[HL[-1] & itemstruct_ITEM_MASK].room_and_flags; // HL[-1] = itemstruct.item
 $CD09 LD A,(HL)     ;
 $CD0A AND $0F       ;
 $CD0C LD E,A        ;
 $CD0D ADD A,A       ;
 $CD0E ADD A,E       ;
 $CD0F LD E,A        ;
 $CD10 LD D,$00      ;
 $CD12 LD HL,$CD6A   ;
 $CD15 ADD HL,DE     ;
 $CD16 LD A,(HL)     ; }
 $CD17 CP C          ; {    if (A != C) goto not_in_default_room;
 $CD18 JR NZ,$CD22   ; }
 $CD1A POP HL        ;     - %>
*$CD1B LD DE,$0007   ; {  next: HL += 7; // stride
 $CD1E ADD HL,DE     ; }
 $CD1F DJNZ $CD01    ; %> while (--B);
 $CD21 RET           ; return; // return with NZ set (not found)
*$CD22 POP HL        ; not_in_default_room:
 $CD23 DEC HL        ; {A = HL[-1] & itemstruct_ITEM_MASK; // itemstruct.item
 $CD24 LD A,(HL)     ;
 $CD25 AND $0F       ; }
; Ignore red cross parcel.
 $CD27 CP $0C        ; {if (A == item_RED_CROSS_PARCEL) <%
 $CD29 JR NZ,$CD2E   ; }
 $CD2B INC HL
 $CD2C JR $CD1B      ;   goto next; %>
*$CD2E LD C,A        ; C = A;
 $CD2F XOR A         ; A = 0; // set Z (found)
 $CD30 RET           ; return;

; Item discovered.
;
; Used by the routines at #R$B75A, #R$C6A0, #R$C892 and #R$CB98.
;
; I:C Item.
@label=item_discovered
c$CD31 LD A,C        ; A = C;
 $CD32 CP $FF        ; {if (A == item_NONE) return;
 $CD34 RET Z         ; }
 $CD35 AND $0F       ; A &= itemstruct_ITEM_MASK;
 $CD37 PUSH AF
 $CD38 LD B,$10      ; {queue_message_for_display(message_ITEM_DISCOVERED);
 $CD3A CALL $7D15    ; }
 $CD3D LD B,$05      ; {decrease_morale(5);
 $CD3F CALL $A0E0    ; }
 $CD42 POP AF
 $CD43 ADD A,A       ; {HL = &default_item_locations[A];
 $CD44 ADD A,C       ;
 $CD45 LD HL,$CD6A   ;
 $CD48 LD D,$00      ;
 $CD4A LD E,A        ;
 $CD4B ADD HL,DE     ; }
 $CD4C LD A,(HL)     ; A = HL->room_and_flags;
 $CD4D EX DE,HL
 $CD4E EX AF,AF'
; Bug: This is not masked, so goes out of range.
 $CD4F LD A,C        ; Adash = C;
 $CD50 CALL $7C26    ; HL = item_to_itemstruct(Adash);
 $CD53 RES 7,(HL)    ; *HL &= ~itemstruct_ITEM_FLAG_HELD;
 $CD55 EX DE,HL
 $CD56 INC DE        ; DE++;
 $CD57 LD BC,$0003   ; {memcpy(DE, HL, 3); DE += 3; HL += 3; // reset location?
 $CD5A LDIR          ; }
 $CD5C EX DE,HL
 $CD5D EX AF,AF'
 $CD5E AND A         ; {if (A == room_0_OUTDOORS) <%
 $CD5F JR NZ,$CD65   ; }
 $CD61 LD (HL),A     ;   *HL = A; // A is already zero
 $CD62 JP $7BD0      ;   goto calc_exterior_item_screenpos;
*$CD65 LD (HL),$05   ; else <% *HL = 5;
 $CD67 JP $7BF2      ;   goto calc_interior_item_screenpos;

; Default item locations.
;
; Array of 16 three-byte structures.
; .
; struct default_item_location { byte room_and_flags; byte x; byte y; };
; .
; #define ITEM_ROOM(item_no, flags) ((item_no & 0x3F) | (flags << 6))
@label=default_item_locations
; do the next flags mean that the wiresnips are always or /never/ found?
b$CD6A DEFB $FF,$40,$20 ; item_WIRESNIPS        { ITEM_ROOM(room_NONE, 3),       ... }
 $CD6D DEFB $09,$3E,$30 ; item_SHOVEL           { ITEM_ROOM(room_9, 0),          ... }
 $CD70 DEFB $0A,$49,$24 ; item_LOCKPICK         { ITEM_ROOM(room_10, 0),         ... }
 $CD73 DEFB $0B,$2A,$3A ; item_PAPERS           { ITEM_ROOM(room_11, 0),         ... }
 $CD76 DEFB $0E,$32,$18 ; item_TORCH            { ITEM_ROOM(room_14, 0),         ... }
 $CD79 DEFB $3F,$24,$2C ; item_BRIBE            { ITEM_ROOM(room_NONE, 0),       ... }
 $CD7C DEFB $0F,$2C,$41 ; item_UNIFORM          { ITEM_ROOM(room_15, 0),         ... }
 $CD7F DEFB $13,$40,$30 ; item_FOOD             { ITEM_ROOM(room_19, 0),         ... }
 $CD82 DEFB $01,$42,$34 ; item_POISON           { ITEM_ROOM(room_1, 0),          ... }
 $CD85 DEFB $16,$3C,$2A ; item_RED_KEY          { ITEM_ROOM(room_22, 0),         ... }
 $CD88 DEFB $0B,$1C,$22 ; item_YELLOW_KEY       { ITEM_ROOM(room_11, 0),         ... }
 $CD8B DEFB $00,$4A,$48 ; item_GREEN_KEY        { ITEM_ROOM(room_0_OUTDOORS, 0), ... }
 $CD8E DEFB $3F,$1C,$32 ; item_RED_CROSS_PARCEL { ITEM_ROOM(room_NONE, 0),       ... }
 $CD91 DEFB $12,$24,$3A ; item_RADIO            { ITEM_ROOM(room_18, 0),         ... }
 $CD94 DEFB $3F,$1E,$22 ; item_PURSE            { ITEM_ROOM(room_NONE, 0),       ... }
 $CD97 DEFB $3F,$34,$1C ; item_COMPASS          { ITEM_ROOM(room_NONE, 0),       ... }

; Data for the four classes of characters.
; (<- spawn_character)
@label=character_meta_data_commandant
w$CD9A DEFW $CDF2 ; &animations[0]
 $CD9C DEFW $CED6 ; sprite_commandant
@label=character_meta_data_guard
 $CD9E DEFW $CDF2 ; &animations[0]
 $CDA0 DEFW $CEA6 ; sprite_guard
@label=character_meta_data_dog
 $CDA2 DEFW $CDF2 ; &animations[0]
 $CDA4 DEFW $CE76 ; sprite_dog
@label=character_meta_data_prisoner
 $CDA6 DEFW $CDF2 ; &animations[0]
 $CDA8 DEFW $CE2E ; sprite_prisoner

; Indices into animations.
;
; none, up, down, left, up+left, down+left, right, up+right, down+right, fire
; .
; Groups of nine. (<- called_from_main_loop_9)
@label=byte_CDAA
b$CDAA DEFB $08,$00,$04,$87,$00,$87,$04,$04,$04 ; TL
 $CDB3 DEFB $09,$84,$05,$05,$84,$05,$01,$01,$05 ; TR
 $CDBC DEFB $0A,$85,$02,$06,$85,$06,$85,$85,$02 ; BR
 $CDC5 DEFB $0B,$07,$86,$03,$07,$03,$07,$07,$86 ; BL
 $CDCE DEFB $14,$0C,$8C,$93,$0C,$93,$10,$10,$8C ; TL + crawl
 $CDD7 DEFB $15,$90,$11,$8D,$90,$95,$0D,$0D,$11 ; TR + crawl
 $CDE0 DEFB $16,$8E,$0E,$12,$8E,$0E,$91,$91,$0E ; BR + crawl
 $CDE9 DEFB $17,$13,$92,$0F,$13,$0F,$8F,$8F,$92 ; BL + crawl

; Animation states.
;
; Array, 24 long, of pointers to data.
@label=animations
w$CDF2 DEFW $CF26 ; anim_walk_tl
 $CDF4 DEFW $CF3A ; anim_walk_tr
 $CDF6 DEFW $CF4E ; anim_walk_br
 $CDF8 DEFW $CF62 ; anim_walk_bl
 $CDFA DEFW $CF96 ; anim_turn_tl
 $CDFC DEFW $CFA2 ; anim_turn_tr
 $CDFE DEFW $CFAE ; anim_turn_br
 $CE00 DEFW $CFBA ; anim_turn_bl
 $CE02 DEFW $CF76 ; anim_wait_tl
 $CE04 DEFW $CF7E ; anim_wait_tr
 $CE06 DEFW $CF86 ; anim_wait_br
 $CE08 DEFW $CF8E ; anim_wait_bl
 $CE0A DEFW $CFC6 ; anim_crawl_tl
 $CE0C DEFW $CFD2 ; anim_crawl_tr
 $CE0E DEFW $CFDE ; anim_crawl_br
 $CE10 DEFW $CFEA ; anim_crawl_bl
 $CE12 DEFW $CFF6 ; anim_crawlturn_tl
 $CE14 DEFW $D002 ; anim_crawlturn_tr
 $CE16 DEFW $D00E ; anim_crawlturn_br
 $CE18 DEFW $D01A ; anim_crawlturn_bl
 $CE1A DEFW $CF06 ; anim_crawlwait_tl
 $CE1C DEFW $CF0E ; anim_crawlwait_tr
 $CE1E DEFW $CF16 ; anim_crawlwait_br
 $CE20 DEFW $CF1E ; anim_crawlwait_bl

; Sprites: objects which can move.
;
; This include STOVE, CRATE, PRISONER, CRAWL, DOG, GUARD and COMMANDANT.
; .
; Structure: (b) width in bytes + 1, (b) height in rows, (w) data ptr, (w) mask
; ptr
; .
; 'tl' => character faces top left of the screen
; .
; 'br' => character faces bottom right of the screen
@label=sprites
@label=sprite_stove
b$CE22 DEFB $03,$16,$46,$DB,$72,$DB ; { 3, 22, &bitmap_stove, &mask_stove } // (16x22,$DB46,$DB72)
@label=sprite_crate
 $CE28 DEFB $04,$18,$B6,$DA,$FE,$DA ; { 4, 24, &bitmap_crate, &mask_crate } // (24x24,$DAB6,$DAFE)
;
@label=sprite_prisoner
 $CE2E DEFB $03,$1B,$8C,$D2,$45,$D5 ; { 3, 27, &bitmap_prisoner_facing_top_left_1, &mask_various_facing_top_left_1 } // (16x27,$D28C,$D545)
 $CE34 DEFB $03,$1C,$56,$D2,$05,$D5 ; { 3, 28, &bitmap_prisoner_facing_top_left_2, &mask_various_facing_top_left_2 } // (16x28,$D256,$D505)
 $CE3A DEFB $03,$1C,$20,$D2,$C5,$D4 ; { 3, 28, &bitmap_prisoner_facing_top_left_3, &mask_various_facing_top_left_3 } // (16x28,$D220,$D4C5)
 $CE40 DEFB $03,$1C,$EA,$D1,$85,$D4 ; { 3, 28, &bitmap_prisoner_facing_top_left_4, &mask_various_facing_top_left_4 } // (16x28,$D1EA,$D485)
 $CE46 DEFB $03,$1B,$C0,$D2,$85,$D5 ; { 3, 27, &bitmap_prisoner_facing_bottom_right_1, &mask_various_facing_bottom_right_1 } // (16x27,$D2C0,$D585)
 $CE4C DEFB $03,$1D,$F4,$D2,$C5,$D5 ; { 3, 29, &bitmap_prisoner_facing_bottom_right_2, &mask_various_facing_bottom_right_2 } // (16x29,$D2F4,$D5C5)
 $CE52 DEFB $03,$1C,$2C,$D3,$05,$D6 ; { 3, 28, &bitmap_prisoner_facing_bottom_right_3, &mask_various_facing_bottom_right_3 } // (16x28,$D32C,$D605)
 $CE58 DEFB $03,$1C,$62,$D3,$3D,$D6 ; { 3, 28, &bitmap_prisoner_facing_bottom_right_4, &mask_various_facing_bottom_right_4 } // (16x28,$D362,$D63D)
;
 $CE5E DEFB $04,$10,$C5,$D3,$77,$D6 ; { 4, 16, &bitmap_crawl_facing_bottom_left_1, &mask_crawl_facing_bottom_left } // (24x16,$D3C5,$D677)
 $CE64 DEFB $04,$0F,$98,$D3,$77,$D6 ; { 4, 15, &bitmap_crawl_facing_bottom_left_2, &mask_crawl_facing_bottom_left } // (24x15,$D398,$D677)
 $CE6A DEFB $04,$10,$F5,$D3,$55,$D4 ; { 4, 16, &bitmap_crawl_facing_top_left_1, &mask_crawl_facing_top_left } // (24x16,$D3F5,$D455)
 $CE70 DEFB $04,$10,$25,$D4,$55,$D4 ; { 4, 16, &bitmap_crawl_facing_top_left_2, &mask_crawl_facing_top_left } // (24x16,$D425,$D455)
;
@label=sprite_dog
 $CE76 DEFB $04,$10,$67,$D8,$21,$D9 ; { 4, 16, &bitmap_dog_facing_top_left_1, &mask_dog_facing_top_left } // (24x16,$D867,$D921)
 $CE7C DEFB $04,$10,$97,$D8,$21,$D9 ; { 4, 16, &bitmap_dog_facing_top_left_2, &mask_dog_facing_top_left } // (24x16,$D897,$D921)
 $CE82 DEFB $04,$0F,$C7,$D8,$21,$D9 ; { 4, 15, &bitmap_dog_facing_top_left_3, &mask_dog_facing_top_left } // (24x15,$D8C7,$D921)
 $CE88 DEFB $04,$0F,$F4,$D8,$21,$D9 ; { 4, 15, &bitmap_dog_facing_top_left_4, &mask_dog_facing_top_left } // (24x15,$D8F4,$D921)
 $CE8E DEFB $04,$0E,$51,$D9,$F9,$D9 ; { 4, 14, &bitmap_dog_facing_bottom_right_1, &mask_dog_facing_bottom_right } // (24x14,$D951,$D9F9)
 $CE94 DEFB $04,$0F,$7B,$D9,$F9,$D9 ; { 4, 15, &bitmap_dog_facing_bottom_right_2, &mask_dog_facing_bottom_right } // (24x15,$D97B,$D9F9)
; Height of following sprite is one row too high.
 $CE9A DEFB $04,$0F,$A8,$D9,$F9,$D9 ; { 4, 15, &bitmap_dog_facing_bottom_right_3, &mask_dog_facing_bottom_right } // (24x15,$D9A8,$D9F9)
 $CEA0 DEFB $04,$0E,$CF,$D9,$F9,$D9 ; { 4, 14, &bitmap_dog_facing_bottom_right_4, &mask_dog_facing_bottom_right } // (24x14,$D9CF,$D9F9)
;
@label=sprite_guard
 $CEA6 DEFB $03,$1B,$4D,$D7,$45,$D5 ; { 3, 27, &bitmap_guard_facing_top_left_1, &mask_various_facing_top_left_1 } // (16x27,$D74D,$D545)
 $CEAC DEFB $03,$1D,$13,$D7,$05,$D5 ; { 3, 29, &bitmap_guard_facing_top_left_2, &mask_various_facing_top_left_2 } // (16x29,$D713,$D505)
 $CEB2 DEFB $03,$1B,$DD,$D6,$C5,$D4 ; { 3, 27, &bitmap_guard_facing_top_left_3, &mask_various_facing_top_left_3 } // (16x27,$D6DD,$D4C5)
 $CEB8 DEFB $03,$1B,$A7,$D6,$85,$D4 ; { 3, 27, &bitmap_guard_facing_top_left_4, &mask_various_facing_top_left_4 } // (16x27,$D6A7,$D485)
 $CEBE DEFB $03,$1D,$83,$D7,$85,$D5 ; { 3, 29, &bitmap_guard_facing_bottom_right_1, &mask_various_facing_bottom_right_1 } // (16x29,$D783,$D585)
 $CEC4 DEFB $03,$1D,$BD,$D7,$C5,$D5 ; { 3, 29, &bitmap_guard_facing_bottom_right_2, &mask_various_facing_bottom_right_2 } // (16x29,$D7BD,$D5C5)
 $CECA DEFB $03,$1C,$F7,$D7,$05,$D6 ; { 3, 28, &bitmap_guard_facing_bottom_right_3, &mask_various_facing_bottom_right_3 } // (16x28,$D7F7,$D605)
 $CED0 DEFB $03,$1C,$2F,$D8,$3D,$D6 ; { 3, 28, &bitmap_guard_facing_bottom_right_4, &mask_various_facing_bottom_right_4 } // (16x28,$D82F,$D63D)
;
@label=sprite_commandant
 $CED6 DEFB $03,$1C,$D6,$D0,$45,$D5 ; { 3, 28, &bitmap_commandant_facing_top_left_1, &mask_various_facing_top_left_1 } // (16x28,$D0D6,$D545)
 $CEDC DEFB $03,$1E,$9A,$D0,$05,$D5 ; { 3, 30, &bitmap_commandant_facing_top_left_2, &mask_various_facing_top_left_2 } // (16x30,$D09A,$D505)
 $CEE2 DEFB $03,$1D,$60,$D0,$C5,$D4 ; { 3, 29, &bitmap_commandant_facing_top_left_3, &mask_various_facing_top_left_3 } // (16x29,$D060,$D4C5)
 $CEE8 DEFB $03,$1D,$26,$D0,$85,$D4 ; { 3, 29, &bitmap_commandant_facing_top_left_4, &mask_various_facing_top_left_4 } // (16x29,$D026,$D485)
 $CEEE DEFB $03,$1B,$0E,$D1,$85,$D5 ; { 3, 27, &bitmap_commandant_facing_bottom_right_1, &mask_various_facing_bottom_right_1 } // (16x27,$D10E,$D585)
 $CEF4 DEFB $03,$1C,$44,$D1,$C5,$D5 ; { 3, 28, &bitmap_commandant_facing_bottom_right_2, &mask_various_facing_bottom_right_2 } // (16x28,$D144,$D5C5)
 $CEFA DEFB $03,$1B,$7C,$D1,$05,$D6 ; { 3, 27, &bitmap_commandant_facing_bottom_right_3, &mask_various_facing_bottom_right_3 } // (16x27,$D17C,$D605)
 $CF00 DEFB $03,$1C,$B2,$D1,$3D,$D6 ; { 3, 28, &bitmap_commandant_facing_bottom_right_4, &mask_various_facing_bottom_right_4 } // (16x28,$D1B2,$D63D)

; Animations.
;
; Read by routine around $B64F (called_from_main_loop_9)
@label=anim_crawlwait_tl
b$CF06 DEFB $01,$04,$04,$FF,$00,$00,$00,$0A
@label=anim_crawlwait_tr
 $CF0E DEFB $01,$05,$05,$FF,$00,$00,$00,$8A
@label=anim_crawlwait_br
 $CF16 DEFB $01,$06,$06,$FF,$00,$00,$00,$88
@label=anim_crawlwait_bl
 $CF1E DEFB $01,$07,$07,$FF,$00,$00,$00,$08
;
@label=anim_walk_tl
 $CF26 DEFB $04,$00,$00,$02,$02,$00,$00,$00,$02,$00,$00,$01,$02,$00,$00,$02,$02,$00,$00,$03
@label=anim_walk_tr
 $CF3A DEFB $04,$01,$01,$03,$00,$02,$00,$80,$00,$02,$00,$81,$00,$02,$00,$82,$00,$02,$00,$83
@label=anim_walk_br
 $CF4E DEFB $04,$02,$02,$00,$FE,$00,$00,$04,$FE,$00,$00,$05,$FE,$00,$00,$06,$FE,$00,$00,$07
@label=anim_walk_bl
 $CF62 DEFB $04,$03,$03,$01,$00,$FE,$00,$84,$00,$FE,$00,$85,$00,$FE,$00,$86,$00,$FE,$00,$87
;
@label=anim_wait_tl
 $CF76 DEFB $01,$00,$00,$FF,$00,$00,$00,$00
@label=anim_wait_tr
 $CF7E DEFB $01,$01,$01,$FF,$00,$00,$00,$80
@label=anim_wait_br
 $CF86 DEFB $01,$02,$02,$FF,$00,$00,$00,$04
@label=anim_wait_bl
 $CF8E DEFB $01,$03,$03,$FF,$00,$00,$00,$84
;
@label=anim_turn_tl
 $CF96 DEFB $02,$00,$01,$FF,$00,$00,$00,$00,$00,$00,$00,$80
@label=anim_turn_tr
 $CFA2 DEFB $02,$01,$02,$FF,$00,$00,$00,$80,$00,$00,$00,$04
@label=anim_turn_br
 $CFAE DEFB $02,$02,$03,$FF,$00,$00,$00,$04,$00,$00,$00,$84
@label=anim_turn_bl
 $CFBA DEFB $02,$03,$00,$FF,$00,$00,$00,$84,$00,$00,$00,$00
;
@label=anim_crawl_tl
 $CFC6 DEFB $02,$04,$04,$02,$02,$00,$00,$0A,$02,$00,$00,$0B
@label=anim_crawl_tr
 $CFD2 DEFB $02,$05,$05,$03,$00,$02,$00,$8A,$00,$02,$00,$8B
@label=anim_crawl_br
 $CFDE DEFB $02,$06,$06,$00,$FE,$00,$00,$88,$FE,$00,$00,$89
@label=anim_crawl_bl
 $CFEA DEFB $02,$07,$07,$01,$00,$FE,$00,$08,$00,$FE,$00,$09
;
@label=anim_crawlturn_tl
 $CFF6 DEFB $02,$04,$05,$FF,$00,$00,$00,$0A,$00,$00,$00,$8A
@label=anim_crawlturn_tr
 $D002 DEFB $02,$05,$06,$FF,$00,$00,$00,$8A,$00,$00,$00,$88
@label=anim_crawlturn_br
 $D00E DEFB $02,$06,$07,$FF,$00,$00,$00,$88,$00,$00,$00,$08
@label=anim_crawlturn_bl
 $D01A DEFB $02,$07,$04,$FF,$00,$00,$00,$08,$00,$00,$00,$0A

; Sprite bitmaps and masks.
;
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D026-$D05F-1-16{0,0,64,116}(bitmap-commandant-facing-top-left-1)
; }
; TABLE#
@label=bitmap_commandant_facing_top_left_4
b$D026 DEFB $00,$00,$00,$60,$00,$F0,$00,$F8 ; {bitmap: COMMANDANT FACING TOP LEFT 4
 $D02E DEFB $00,$FC,$01,$7C,$01,$78,$00,$04
 $D036 DEFB $00,$FE,$03,$FE,$07,$FA,$07,$FA
 $D03E DEFB $06,$FA,$0E,$F6,$0E,$C6,$0E,$38
 $D046 DEFB $06,$F8,$06,$E0,$09,$98,$04,$58
 $D04E DEFB $03,$B0,$03,$B0,$01,$80,$02,$70
 $D056 DEFB $03,$B0,$01,$B0,$07,$B0,$01,$30
 $D05E DEFB $00,$20                         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D060-$D099-1-16{0,0,64,116}(bitmap-commandant-facing-top-left-2)
; }
; TABLE#
@label=bitmap_commandant_facing_top_left_3
 $D060 DEFB $00,$00,$00,$60,$00,$F0,$00,$F8 ; {bitmap: COMMANDANT FACING TOP LEFT 3
 $D068 DEFB $00,$FC,$01,$7C,$01,$78,$00,$00
 $D070 DEFB $00,$FC,$03,$FE,$03,$FA,$07,$FA
 $D078 DEFB $06,$F6,$06,$F6,$0E,$C6,$0D,$3A
 $D080 DEFB $15,$F8,$1B,$F6,$03,$C8,$04,$18
 $D088 DEFB $07,$D8,$03,$80,$02,$30,$01,$D0
 $D090 DEFB $01,$C0,$00,$E0,$01,$60,$00,$60
 $D098 DEFB $00,$C0                         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D09A-$D0D5-1-16{0,0,64,120}(bitmap-commandant-facing-top-left-3)
; }
; TABLE#
@label=bitmap_commandant_facing_top_left_2
 $D09A DEFB $00,$00,$00,$60,$00,$F0,$00,$F8 ; {bitmap: COMMANDANT FACING TOP LEFT 2
 $D0A2 DEFB $00,$FC,$01,$7C,$01,$78,$00,$04
 $D0AA DEFB $01,$FE,$03,$FE,$07,$FA,$07,$FA
 $D0B2 DEFB $06,$FA,$06,$F4,$0E,$CA,$0E,$3A
 $D0BA DEFB $0D,$F8,$05,$E0,$0B,$98,$04,$50
 $D0C2 DEFB $03,$D0,$07,$A0,$03,$A0,$03,$40
 $D0CA DEFB $00,$A0,$03,$B0,$03,$A0,$01,$80
 $D0D2 DEFB $07,$80,$01,$80                 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D0D6-$D10E-1-16{0,0,64,112}(bitmap-commandant-facing-top-left-4)
; }
; TABLE#
@label=bitmap_commandant_facing_top_left_1
 $D0D6 DEFB $00,$00,$00,$60,$00,$F0,$00,$F8 ; {bitmap: COMMANDANT FACING TOP LEFT 1
 $D0DE DEFB $00,$FC,$01,$7C,$01,$78,$00,$04
 $D0E6 DEFB $00,$FE,$03,$FE,$07,$FA,$06,$FA
 $D0EE DEFB $06,$FA,$07,$7A,$03,$64,$07,$18
 $D0F6 DEFB $06,$F8,$0A,$F0,$0D,$CC,$02,$1C
 $D0FE DEFB $07,$D8,$07,$D8,$03,$A0,$04,$38
 $D106 DEFB $07,$B8,$03,$98,$0B,$18,$07,$30 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D10E-$D143-1-16{0,0,64,108}(bitmap-commandant-facing-bottom-right-1)
; }
; TABLE#
@label=bitmap_commandant_facing_bottom_right_1
 $D10E DEFB $00,$00,$01,$C0,$03,$E0,$07,$C0 ; {bitmap: COMMANDANT FACING BOTTOM RIGHT 1
 $D116 DEFB $03,$B0,$00,$60,$01,$80,$06,$B0
 $D11E DEFB $0F,$78,$1F,$A8,$3F,$B0,$3B,$B0
 $D126 DEFB $77,$A8,$37,$8C,$20,$74,$17,$B0
 $D12E DEFB $37,$80,$0B,$A0,$0C,$60,$0F,$40
 $D136 DEFB $0E,$00,$01,$40,$07,$40,$07,$00
 $D13E DEFB $07,$00,$03,$00,$03,$C0         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D144-$D17B-1-16{0,0,64,112}(bitmap-commandant-facing-bottom-right-2)
; }
; TABLE#
@label=bitmap_commandant_facing_bottom_right_2
 $D144 DEFB $00,$00,$01,$C0,$03,$E0,$07,$C0 ; {bitmap: COMMANDANT FACING BOTTOM RIGHT 2
 $D14C DEFB $03,$B0,$00,$60,$01,$80,$02,$B0
 $D154 DEFB $0F,$68,$1F,$B0,$1F,$B0,$1B,$B0
 $D15C DEFB $3B,$A8,$3B,$88,$34,$70,$37,$B0
 $D164 DEFB $37,$A8,$07,$10,$28,$B8,$0F,$B8
 $D16C DEFB $0F,$60,$0E,$10,$01,$70,$0E,$70
 $D174 DEFB $0E,$60,$0C,$38,$0E,$00,$03,$00 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D17C-$D1B1-1-16{0,0,64,108}(bitmap-commandant-facing-bottom-right-3)
; }
; TABLE#
@label=bitmap_commandant_facing_bottom_right_3
 $D17C DEFB $00,$00,$01,$C0,$03,$E0,$07,$C0 ; {bitmap: COMMANDANT FACING BOTTOM RIGHT 3
 $D184 DEFB $03,$B0,$00,$60,$01,$80,$02,$B0
 $D18C DEFB $07,$68,$0F,$B0,$0F,$B0,$1D,$B0
 $D194 DEFB $1B,$A8,$1B,$88,$1C,$74,$0A,$B4
 $D19C DEFB $06,$A0,$09,$90,$0E,$70,$0F,$70
 $D1A4 DEFB $06,$E0,$08,$00,$1E,$E0,$1C,$E0
 $D1AC DEFB $18,$E0,$18,$60,$08,$70         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D1B2-$D1E9-1-16{0,0,64,112}(bitmap-commandant-facing-bottom-right-4)
; }
; TABLE#
@label=bitmap_commandant_facing_bottom_right_4
 $D1B2 DEFB $00,$00,$01,$C0,$03,$E0,$07,$C0 ; {bitmap: COMMANDANT FACING BOTTOM RIGHT 4
 $D1BA DEFB $03,$B0,$00,$60,$01,$80,$06,$B0
 $D1C2 DEFB $0F,$68,$1F,$A8,$1F,$B0,$3B,$B0
 $D1CA DEFB $3B,$B0,$3B,$88,$30,$70,$37,$B0
 $D1D2 DEFB $0F,$A8,$37,$10,$08,$70,$07,$60
 $D1DA DEFB $03,$40,$04,$A0,$07,$60,$07,$40
 $D1E2 DEFB $06,$C0,$06,$80,$03,$60,$00,$60 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D1EA-$D21F-1-16{0,0,64,108}(bitmap-prisoner-facing-top-left-1)
; }
; TABLE#
@label=bitmap_prisoner_facing_top_left_4
 $D1EA DEFB $00,$00,$00,$F0,$01,$F0,$01,$C0 ; {bitmap: PRISONER FACING TOP LEFT 4
 $D1F2 DEFB $00,$F0,$01,$00,$00,$78,$03,$FC
 $D1FA DEFB $07,$F4,$07,$F4,$06,$F4,$0E,$F4
 $D202 DEFB $0D,$E8,$0D,$94,$0C,$78,$15,$F8
 $D20A DEFB $1B,$D8,$07,$D8,$0F,$B0,$0F,$70
 $D212 DEFB $07,$70,$07,$70,$03,$60,$03,$60
 $D21A DEFB $0C,$60,$03,$00,$00,$60         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D220-$D255-1-16{0,0,64,108}(bitmap-prisoner-facing-top-left-2)
; }
; TABLE#
@label=bitmap_prisoner_facing_top_left_3
 $D220 DEFB $00,$00,$00,$F0,$01,$F0,$01,$C0 ; {bitmap: PRISONER FACING TOP LEFT 3
 $D228 DEFB $00,$F0,$01,$00,$00,$78,$03,$FC
 $D230 DEFB $07,$F4,$07,$F4,$0F,$EC,$0E,$EC
 $D238 DEFB $1D,$EC,$1B,$94,$54,$70,$6F,$F4
 $D240 DEFB $0F,$D0,$0F,$D0,$07,$B0,$07,$A0
 $D248 DEFB $07,$A0,$07,$40,$03,$40,$03,$80
 $D250 DEFB $05,$80,$00,$40,$03,$C0         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D256-$D28B-1-16{0,0,64,108}(bitmap-prisoner-facing-top-left-3)
; }
; TABLE#
@label=bitmap_prisoner_facing_top_left_2
 $D256 DEFB $00,$00,$00,$F0,$01,$F0,$01,$C0 ; {bitmap: PRISONER FACING TOP LEFT 2
 $D25E DEFB $00,$F0,$01,$00,$00,$78,$01,$FC
 $D266 DEFB $03,$F4,$07,$F4,$06,$F4,$06,$F4
 $D26E DEFB $0E,$E4,$0D,$94,$0C,$78,$15,$F8
 $D276 DEFB $1B,$D8,$07,$D8,$0F,$D0,$07,$D0
 $D27E DEFB $07,$A0,$07,$A0,$03,$A0,$03,$40
 $D286 DEFB $01,$60,$06,$00,$03,$00         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D28C-$D2BF-1-16{0,0,64,104}(bitmap-prisoner-facing-top-left-4)
; }
; TABLE#
@label=bitmap_prisoner_facing_top_left_1
 $D28C DEFB $00,$00,$00,$F0,$01,$F0,$01,$C0 ; {bitmap: PRISONER FACING TOP LEFT 1
 $D294 DEFB $00,$F0,$01,$00,$00,$70,$01,$F8
 $D29C DEFB $03,$F8,$07,$F8,$06,$F0,$0E,$F0
 $D2A4 DEFB $0E,$E8,$06,$88,$06,$70,$02,$F0
 $D2AC DEFB $05,$D0,$06,$D0,$09,$B0,$0F,$A0
 $D2B4 DEFB $0F,$60,$0E,$E0,$0E,$E0,$0C,$40
 $D2BC DEFB $34,$20,$18,$E0                 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D2C0-$D2F3-1-16{0,0,64,104}(bitmap-prisoner-facing-bottom-right-1)
; }
; TABLE#
@label=bitmap_prisoner_facing_bottom_right_1
 $D2C0 DEFB $00,$00,$03,$80,$05,$C0,$07,$80 ; {bitmap: PRISONER FACING BOTTOM RIGHT 1
 $D2C8 DEFB $04,$40,$03,$80,$0D,$60,$1E,$E0
 $D2D0 DEFB $3E,$F0,$37,$50,$35,$50,$77,$50
 $D2D8 DEFB $6F,$38,$6E,$54,$51,$CC,$5F,$C0
 $D2E0 DEFB $9E,$C0,$DE,$C0,$0F,$40,$0F,$40
 $D2E8 DEFB $07,$00,$07,$00,$16,$00,$16,$00
 $D2F0 DEFB $05,$00,$03,$80                 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D2F4-$D32B-1-16{0,0,64,112}(bitmap-prisoner-facing-bottom-right-2)
; }
; TABLE#
@label=bitmap_prisoner_facing_bottom_right_2
 $D2F4 DEFB $00,$00,$03,$80,$05,$C0,$07,$80 ; {bitmap: PRISONER FACING BOTTOM RIGHT 2
 $D2FC DEFB $04,$40,$03,$80,$0D,$40,$1E,$E0
 $D304 DEFB $3E,$E0,$37,$50,$75,$50,$77,$50
 $D30C DEFB $77,$50,$34,$30,$33,$C0,$37,$D0
 $D314 DEFB $0F,$40,$37,$60,$0F,$60,$3E,$E0
 $D31C DEFB $1E,$C0,$1E,$C0,$1D,$80,$1D,$00
 $D324 DEFB $1A,$80,$09,$C0,$14,$00,$0E,$00 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D32C-$D361-1-16{0,0,64,108}(bitmap-prisoner-facing-bottom-right-3)
; }
; TABLE#
@label=bitmap_prisoner_facing_bottom_right_3
 $D32C DEFB $00,$00,$03,$80,$05,$C0,$07,$80 ; {bitmap: PRISONER FACING BOTTOM RIGHT 3
 $D334 DEFB $04,$40,$03,$80,$0D,$40,$1E,$E0
 $D33C DEFB $1E,$E0,$37,$40,$35,$40,$37,$40
 $D344 DEFB $37,$40,$1A,$20,$19,$C0,$05,$C0
 $D34C DEFB $0D,$40,$13,$60,$1E,$E0,$1E,$E0
 $D354 DEFB $1C,$C0,$3D,$C0,$39,$80,$31,$80
 $D35C DEFB $50,$40,$60,$E0,$30,$00         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D362-$D397-1-16{0,0,64,108}(bitmap-prisoner-facing-bottom-right-4)
; }
; TABLE#
@label=bitmap_prisoner_facing_bottom_right_4
 $D362 DEFB $00,$00,$03,$80,$05,$C0,$07,$80 ; {bitmap: PRISONER FACING BOTTOM RIGHT 4
 $D36A DEFB $04,$40,$03,$80,$0D,$60,$1E,$E0
 $D372 DEFB $1E,$F0,$3B,$50,$39,$50,$37,$50
 $D37A DEFB $37,$50,$36,$30,$21,$C8,$2F,$E8
 $D382 DEFB $17,$60,$37,$60,$0F,$60,$1F,$40
 $D38A DEFB $07,$40,$06,$C0,$0E,$80,$0D,$80
 $D392 DEFB $08,$00,$05,$80,$0E,$C0         ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D398-$D3C4-1-24{0,0,96,60}(bitmap-crawl-facing-bottom-right-1)
; }
; TABLE#
@label=bitmap_crawl_facing_bottom_left_2
 $D398 DEFB $00,$00,$00,$00,$0A,$00,$00,$39 ; {bitmap: CRAWL FACING BOTTOM RIGHT 2
 $D3A0 DEFB $80,$00,$FE,$C0,$03,$FE,$C0,$07
 $D3A8 DEFB $FE,$C0,$08,$FE,$C0,$07,$7D,$CC
 $D3B0 DEFB $0F,$7B,$D6,$2F,$B5,$F8,$37,$38
 $D3B8 DEFB $E0,$C0,$18,$00,$40,$30,$00,$00
 $D3C0 DEFB $10,$00,$00,$60,$00             ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D3C5-$D3F4-1-24{0,0,96,64}(bitmap-crawl-facing-bottom-right-2)
; }
; TABLE#
@label=bitmap_crawl_facing_bottom_left_1
 $D3C5 DEFB $00,$00,$00,$00,$0A,$00,$00,$3D ; {bitmap: CRAWL FACING BOTTOM RIGHT 1
 $D3CD DEFB $80,$00,$FE,$80,$03,$FE,$C0,$03
 $D3D5 DEFB $FE,$D8,$0D,$FD,$CC,$1E,$FB,$A0
 $D3DD DEFB $1E,$F7,$98,$1E,$77,$2C,$0C,$EF
 $D3E5 DEFB $F0,$30,$EF,$C0,$10,$C7,$00,$01
 $D3ED DEFB $80,$00,$01,$00,$00,$06,$00,$00 ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D3F5-$D424-1-24{0,0,96,64}(bitmap-crawl-facing-top-left-1)
; }
; TABLE#
@label=bitmap_crawl_facing_top_left_1
 $D3F5 DEFB $03,$80,$00,$07,$A0,$00,$07,$78 ; {bitmap: CRAWL FACING TOP LEFT 1
 $D3FD DEFB $00,$06,$FE,$00,$01,$FC,$00,$07
 $D405 DEFB $F3,$80,$CF,$EF,$C0,$BE,$DF,$40
 $D40D DEFB $10,$3F,$40,$00,$3E,$C0,$00,$7D
 $D415 DEFB $C0,$00,$73,$80,$00,$79,$C0,$00
 $D41D DEFB $1A,$E8,$00,$03,$2C,$00,$01,$04 ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D425-$D454-1-24{0,0,96,64}(bitmap-crawl-facing-top-left-2)
; }
; TABLE#
@label=bitmap_crawl_facing_top_left_2
 $D425 DEFB $03,$80,$00,$07,$80,$00,$06,$78 ; {bitmap: CRAWL FACING TOP LEFT 2
 $D42D DEFB $00,$05,$FE,$00,$03,$F8,$00,$07
 $D435 DEFB $F7,$80,$07,$6F,$C0,$03,$9F,$40
 $D43D DEFB $37,$9F,$40,$2F,$1F,$00,$00,$1F
 $D445 DEFB $00,$00,$1E,$00,$00,$0E,$C0,$00
 $D44D DEFB $0F,$00,$00,$07,$60,$00,$01,$30 ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D455-$D484-1-24{0,0,96,64}(mask-crawl-facing-top-left) }
; TABLE#
@label=mask_crawl_facing_top_left
 $D455 DEFB $F8,$1F,$FF,$F0,$07,$FF,$F0,$01 ; {mask: CRAWL FACING TOP LEFT (shared)
 $D45D DEFB $FF,$F0,$00,$FF,$F8,$00,$7F,$30
 $D465 DEFB $00,$3F,$00,$00,$1F,$00,$00,$1F
 $D46D DEFB $00,$00,$1F,$80,$00,$1F,$D0,$00
 $D475 DEFB $1F,$FF,$00,$3F,$FF,$00,$17,$FF
 $D47D DEFB $80,$03,$FF,$E0,$01,$FF,$F8,$01 ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$D485-$D4C4-1-16(mask-various-facing-top-left-1) }
; TABLE#
@label=mask_various_facing_top_left_4
 $D485 DEFB $FE,$0F,$FC,$07,$F8,$03,$FC,$01 ; {mask: VARIOUS FACING TOP LEFT 4
 $D48D DEFB $FC,$01,$F8,$01,$FC,$01,$F8,$00
 $D495 DEFB $F0,$00,$F0,$00,$E0,$00,$E0,$00
 $D49D DEFB $E0,$00,$C0,$00,$C0,$01,$C0,$03
 $D4A5 DEFB $C0,$01,$E0,$01,$C0,$01,$E0,$01
 $D4AD DEFB $E0,$01,$E0,$01,$E0,$03,$E0,$07
 $D4B5 DEFB $C0,$07,$E0,$07,$F0,$07,$F8,$07
 $D4BD DEFB $FE,$8F,$FF,$DF,$FF,$FF,$FF,$FF ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$D4C5-$D504-1-16(mask-various-facing-top-left-2) }
; TABLE#
@label=mask_various_facing_top_left_3
 $D4C5 DEFB $FE,$0F,$FC,$07,$F8,$03,$FC,$01 ; {mask: VARIOUS FACING TOP LEFT 3
 $D4CD DEFB $FC,$01,$F8,$01,$FC,$01,$F8,$01
 $D4D5 DEFB $F0,$00,$E0,$00,$C0,$00,$C0,$00
 $D4DD DEFB $C0,$00,$00,$00,$00,$00,$00,$00
 $D4E5 DEFB $00,$00,$C0,$01,$C0,$03,$C0,$03
 $D4ED DEFB $C0,$03,$C0,$03,$80,$03,$80,$07
 $D4F5 DEFB $C0,$0F,$E0,$0F,$F0,$0F,$F8,$0F
 $D4FD DEFB $FE,$1F,$FF,$3F,$FF,$FF,$FF,$FF ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$D505-$D544-1-16(mask-various-facing-top-left-3) }
; TABLE#
@label=mask_various_facing_top_left_2
 $D505 DEFB $FE,$0F,$FC,$07,$F8,$07,$FC,$03 ; {mask: VARIOUS FACING TOP LEFT 2
 $D50D DEFB $FC,$01,$F8,$01,$FC,$01,$F8,$01
 $D515 DEFB $F0,$00,$E0,$00,$C0,$00,$C0,$00
 $D51D DEFB $C0,$00,$C0,$01,$80,$00,$80,$00
 $D525 DEFB $80,$01,$C0,$03,$80,$03,$C0,$03
 $D52D DEFB $C0,$03,$C0,$03,$C0,$07,$C0,$0F
 $D535 DEFB $E0,$0F,$F0,$07,$F0,$0F,$E0,$1F
 $D53D DEFB $F0,$3F,$F8,$3F,$FE,$7F,$FF,$FF ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$D545-$D584-1-16(mask-various-facing-top-left-4) }
; TABLE#
@label=mask_various_facing_top_left_1
 $D545 DEFB $FE,$0F,$FC,$07,$F8,$03,$FC,$01 ; {mask: VARIOUS FACING TOP LEFT 1
 $D54D DEFB $FC,$01,$F8,$01,$FC,$01,$FC,$00
 $D555 DEFB $F8,$00,$F0,$00,$E0,$00,$E0,$01
 $D55D DEFB $E0,$03,$E0,$03,$E0,$03,$F0,$03
 $D565 DEFB $E0,$03,$E0,$01,$E0,$01,$E0,$03
 $D56D DEFB $E0,$03,$E0,$03,$C0,$03,$C0,$03
 $D575 DEFB $80,$03,$80,$03,$C0,$07,$E0,$CF
 $D57D DEFB $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$D585-$D5C4-1-16(mask-various-facing-bottom-right-1) }
; TABLE#
@label=mask_various_facing_bottom_right_1
 $D585 DEFB $F8,$1F,$F0,$0F,$E0,$0F,$E0,$07 ; {mask: VARIOUS FACING BOTTOM RIGHT 1
 $D58D DEFB $F0,$0F,$C0,$0F,$80,$07,$C0,$03
 $D595 DEFB $80,$03,$00,$07,$00,$07,$00,$03
 $D59D DEFB $00,$01,$00,$01,$00,$01,$00,$03
 $D5A5 DEFB $00,$0F,$00,$0F,$00,$0F,$80,$07
 $D5AD DEFB $80,$07,$80,$07,$C0,$0F,$C0,$1F
 $D5B5 DEFB $E0,$3F,$E0,$1F,$F4,$0F,$FE,$1F
 $D5BD DEFB $FF,$7F,$FF,$FF,$FF,$FF,$FF,$FF ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$D5C5-$D604-1-16(mask-various-facing-bottom-right-2) }
; TABLE#
@label=mask_various_facing_bottom_right_2
 $D5C5 DEFB $F8,$1F,$F0,$0F,$E0,$0F,$E0,$07 ; {mask: VARIOUS FACING BOTTOM RIGHT 2
 $D5CD DEFB $F0,$0F,$E0,$0F,$C0,$07,$C0,$03
 $D5D5 DEFB $80,$07,$80,$07,$00,$07,$00,$03
 $D5DD DEFB $00,$03,$00,$07,$80,$07,$80,$03
 $D5E5 DEFB $C0,$07,$80,$03,$80,$03,$80,$07
 $D5ED DEFB $80,$07,$80,$07,$80,$07,$80,$07
 $D5F5 DEFB $C0,$03,$E0,$03,$C0,$27,$E0,$3F
 $D5FD DEFB $F0,$7F,$FF,$FF,$FF,$FF,$FF,$FF ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D605-$D63C-1-16{0,0,64,112}(mask-various-facing-bottom-right-3)
; }
; TABLE#
@label=mask_various_facing_bottom_right_3
 $D605 DEFB $F8,$1F,$F0,$0F,$E0,$0F,$E0,$07 ; {mask: VARIOUS FACING BOTTOM RIGHT 3
 $D60D DEFB $F0,$0F,$C0,$0F,$80,$07,$C0,$03
 $D615 DEFB $C0,$07,$80,$07,$80,$07,$00,$03
 $D61D DEFB $00,$03,$00,$01,$80,$01,$C0,$03
 $D625 DEFB $80,$07,$80,$07,$80,$07,$80,$07
 $D62D DEFB $80,$07,$80,$0F,$80,$07,$00,$07
 $D635 DEFB $00,$0F,$00,$07,$83,$03,$C7,$C7 ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D63D-$D676-1-16{0,0,64,116}(mask-various-facing-bottom-right-4)
; }
; TABLE#
@label=mask_various_facing_bottom_right_4
 $D63D DEFB $F8,$1F,$F0,$0F,$E0,$0F,$E0,$07 ; {mask: VARIOUS FACING BOTTOM RIGHT 4
 $D645 DEFB $F0,$0F,$E0,$0F,$C0,$07,$C0,$03
 $D64D DEFB $C0,$03,$80,$07,$80,$07,$00,$07
 $D655 DEFB $00,$03,$00,$07,$80,$03,$80,$03
 $D65D DEFB $80,$07,$80,$07,$80,$07,$80,$07
 $D665 DEFB $80,$07,$80,$0F,$C0,$1F,$C0,$0F
 $D66D DEFB $E0,$1F,$C0,$0F,$E0,$07,$F0,$0F
 $D675 DEFB $F8,$FF                         ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D677-$D6A6-1-24(mask-crawl-facing-bottom-left) }
; TABLE#
@label=mask_crawl_facing_bottom_left
 $D677 DEFB $FF,$F5,$FF,$FF,$C0,$7F,$FF,$00 ; {mask: CRAWL FACING BOTTOM RIGHT (shared)
 $D67F DEFB $3F,$FC,$00,$1F,$F8,$00,$07,$F0
 $D687 DEFB $00,$03,$E0,$00,$01,$C0,$00,$01
 $D68F DEFB $C0,$00,$00,$80,$00,$01,$00,$00
 $D697 DEFB $03,$00,$00,$0F,$06,$00,$3F,$AC
 $D69F DEFB $00,$FF,$F8,$0F,$FF,$F0,$1F,$FF ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D6A7-$D6DC-1-16{0,0,64,108}(bitmap-guard-facing-top-left-1)
; }
; TABLE#
@label=bitmap_guard_facing_top_left_4
 $D6A7 DEFB $00,$00,$01,$E0,$03,$F0,$01,$F0 ; {bitmap: GUARD FACING TOP LEFT 4
 $D6AF DEFB $01,$E4,$02,$F4,$01,$08,$00,$7C
 $D6B7 DEFB $07,$FC,$07,$DC,$0F,$C4,$0E,$34
 $D6BF DEFB $0E,$F4,$1D,$C4,$1C,$38,$1A,$78
 $D6C7 DEFB $1A,$DC,$03,$DC,$1B,$DC,$07,$DC
 $D6CF DEFB $0F,$DC,$0F,$9C,$0F,$98,$07,$60
 $D6D7 DEFB $18,$70,$0E,$B0,$00,$E0         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D6DD-$D712-1-16{0,0,64,108}(bitmap-guard-facing-top-left-2)
; }
; TABLE#
@label=bitmap_guard_facing_top_left_3
 $D6DD DEFB $00,$00,$01,$E0,$03,$F0,$01,$F0 ; {bitmap: GUARD FACING TOP LEFT 3
 $D6E5 DEFB $01,$E4,$02,$F4,$01,$04,$00,$78
 $D6ED DEFB $07,$FC,$0F,$AC,$1F,$8C,$18,$6C
 $D6F5 DEFB $1B,$E8,$3B,$C8,$B4,$30,$AC,$F0
 $D6FD DEFB $0D,$F8,$1F,$B8,$1F,$B8,$1F,$38
 $D705 DEFB $1F,$38,$1F,$38,$3E,$38,$3D,$B0
 $D70D DEFB $1D,$00,$03,$40,$06,$00         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D713-$D74C-1-16{0,0,64,116}(bitmap-guard-facing-top-left-3)
; }
; TABLE#
@label=bitmap_guard_facing_top_left_2
 $D713 DEFB $00,$00,$01,$E0,$03,$F0,$01,$F0 ; {bitmap: GUARD FACING TOP LEFT 2
 $D71B DEFB $01,$E4,$02,$F4,$01,$04,$00,$78
 $D723 DEFB $07,$FC,$0F,$BC,$1F,$84,$1E,$74
 $D72B DEFB $1D,$E8,$1B,$90,$38,$70,$34,$F8
 $D733 DEFB $35,$B8,$0F,$B8,$2F,$B8,$0F,$B8
 $D73B DEFB $1F,$B8,$1F,$B8,$1F,$90,$1F,$40
 $D743 DEFB $0F,$40,$00,$00,$03,$00,$0B,$00
 $D74B DEFB $06,$00                         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D74D-$D782-1-16{0,0,64,108}(bitmap-guard-facing-top-left-4)
; }
; TABLE#
@label=bitmap_guard_facing_top_left_1
 $D74D DEFB $00,$00,$01,$E0,$03,$F0,$01,$F0 ; {bitmap: GUARD FACING TOP LEFT 1
 $D755 DEFB $01,$E4,$02,$F4,$01,$04,$00,$78
 $D75D DEFB $03,$FC,$07,$D8,$0F,$C4,$0C,$38
 $D765 DEFB $0D,$F0,$0D,$C0,$0E,$38,$06,$78
 $D76D DEFB $06,$D8,$09,$D8,$06,$D8,$09,$D8
 $D775 DEFB $0F,$98,$0F,$98,$1F,$90,$1F,$40
 $D77D DEFB $27,$70,$38,$00,$18,$00         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D783-$D7BC-1-16{0,0,64,116}(bitmap-guard-facing-bottom-right-1)
; }
; TABLE#
@label=bitmap_guard_facing_bottom_right_1
 $D783 DEFB $00,$00,$00,$00,$07,$80,$0F,$C0 ; {bitmap: GUARD FACING BOTTOM RIGHT 1
 $D78B DEFB $0F,$80,$07,$40,$0C,$80,$23,$A0
 $D793 DEFB $14,$70,$16,$D0,$6A,$D0,$EB,$50
 $D79B DEFB $EB,$50,$65,$38,$74,$D4,$25,$4C
 $D7A3 DEFB $1A,$E0,$22,$E0,$36,$F0,$35,$70
 $D7AB DEFB $33,$B0,$3F,$B0,$3F,$A0,$1F,$80
 $D7B3 DEFB $1E,$40,$01,$80,$0B,$80,$05,$E0
 $D7BB DEFB $00,$80                         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D7BD-$D7F6-1-16{0,0,64,116}(bitmap-guard-facing-bottom-right-2)
; }
; TABLE#
@label=bitmap_guard_facing_bottom_right_2
 $D7BD DEFB $00,$00,$00,$00,$07,$80,$0F,$C0 ; {bitmap: GUARD FACING BOTTOM RIGHT 2
 $D7C5 DEFB $0F,$80,$07,$40,$0C,$80,$13,$A0
 $D7CD DEFB $14,$70,$16,$D0,$16,$D0,$2B,$50
 $D7D5 DEFB $6B,$50,$6B,$10,$68,$D0,$35,$68
 $D7DD DEFB $35,$68,$0A,$E0,$1A,$F0,$26,$F0
 $D7E5 DEFB $35,$70,$33,$70,$3F,$60,$3F,$00
 $D7ED DEFB $3F,$60,$1C,$60,$03,$30,$06,$00
 $D7F5 DEFB $03,$80                         ; }
; #UDGTABLE
; {
; #UDGARRAY2,7,4,2;$D7F7-$D82E-1-16{0,0,64,112}(bitmap-guard-facing-bottom-right-3)
; }
; TABLE#
@label=bitmap_guard_facing_bottom_right_3
 $D7F7 DEFB $00,$00,$00,$00,$07,$80,$0F,$C0 ; {bitmap: GUARD FACING BOTTOM RIGHT 3
 $D7FF DEFB $0F,$80,$07,$40,$0C,$80,$23,$A0
 $D807 DEFB $14,$60,$16,$D0,$2A,$D0,$2B,$50
 $D80F DEFB $6B,$40,$75,$00,$74,$E0,$39,$60
 $D817 DEFB $15,$60,$2C,$F0,$32,$F0,$36,$F0
 $D81F DEFB $35,$70,$32,$F0,$3E,$C0,$3E,$30
 $D827 DEFB $1E,$70,$60,$60,$70,$70,$38,$38 ; }
; #UDGTABLE
; {
; #UDGARRAY1,7,4,2;$D82F-$D866-1-16{0,0,64,112}(bitmap-guard-facing-bottom-right-4)
; }
; TABLE#
@label=bitmap_guard_facing_bottom_right_4
 $D82F DEFB $00,$00,$00,$00,$07,$80,$0F,$C0 ; {bitmap: GUARD FACING BOTTOM RIGHT 4
 $D837 DEFB $0F,$80,$07,$40,$0C,$80,$13,$A0
 $D83F DEFB $14,$70,$16,$D0,$16,$D0,$2B,$50
 $D847 DEFB $6B,$50,$6B,$10,$68,$D0,$35,$60
 $D84F DEFB $35,$60,$0A,$E0,$1A,$F0,$25,$70
 $D857 DEFB $2B,$70,$27,$B0,$3F,$B0,$1F,$80
 $D85F DEFB $1F,$40,$0C,$80,$12,$C0,$0F,$60 ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D867-$D896-1-24{0,0,96,64}(bitmap-dog-facing-top-left-1)
; }
; TABLE#
@label=bitmap_dog_facing_top_left_1
 $D867 DEFB $1A,$C0,$00,$1F,$80,$00,$0B,$80 ; {bitmap: DOG FACING TOP LEFT 1
 $D86F DEFB $00,$04,$C0,$00,$03,$F0,$00,$03
 $D877 DEFB $FC,$00,$01,$FF,$00,$0F,$FF,$C0
 $D87F DEFB $13,$FF,$E0,$00,$7F,$E0,$00,$1F
 $D887 DEFB $E0,$00,$03,$D0,$00,$01,$D0,$00
 $D88F DEFB $00,$88,$00,$00,$A0,$00,$03,$10 ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D897-$D8C6-1-24{0,0,96,64}(bitmap-dog-facing-top-left-2)
; }
; TABLE#
@label=bitmap_dog_facing_top_left_2
 $D897 DEFB $1A,$80,$00,$1F,$C0,$00,$0B,$80 ; {bitmap: DOG FACING TOP LEFT 2
 $D89F DEFB $00,$04,$C0,$00,$03,$F0,$00,$03
 $D8A7 DEFB $F8,$00,$03,$FF,$00,$01,$FF,$C0
 $D8AF DEFB $01,$FF,$E0,$01,$7F,$E0,$03,$1B
 $D8B7 DEFB $E0,$06,$03,$D0,$00,$03,$B0,$00
 $D8BF DEFB $01,$D0,$00,$00,$40,$00,$00,$C0 ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D8C7-$D8F3-1-24{0,0,96,60}(bitmap-dog-facing-top-left-3)
; }
; TABLE#
@label=bitmap_dog_facing_top_left_3
 $D8C7 DEFB $1A,$80,$00,$1F,$C0,$00,$0B,$80 ; {bitmap: DOG FACING TOP LEFT 3
 $D8CF DEFB $00,$04,$C0,$00,$03,$E0,$00,$03
 $D8D7 DEFB $F8,$00,$03,$FF,$00,$03,$FF,$C0
 $D8DF DEFB $01,$FF,$E0,$01,$3F,$E0,$01,$DD
 $D8E7 DEFB $E0,$00,$03,$D0,$00,$01,$B0,$00
 $D8EF DEFB $00,$90,$00,$03,$00             ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D8F4-$D920-1-24{0,0,96,60}(bitmap-dog-facing-top-left-4)
; }
; TABLE#
@label=bitmap_dog_facing_top_left_4
 $D8F4 DEFB $1A,$C0,$00,$1F,$80,$00,$0B,$80 ; {bitmap: DOG FACING TOP LEFT 4
 $D8FC DEFB $00,$04,$C0,$00,$03,$F0,$00,$03
 $D904 DEFB $FC,$00,$03,$FF,$00,$01,$FF,$C0
 $D90C DEFB $01,$FF,$E0,$03,$7F,$E0,$06,$BD
 $D914 DEFB $E0,$00,$03,$D0,$00,$03,$30,$00
 $D91C DEFB $0E,$C8,$00,$01,$80             ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D921-$D950-1-24(mask-dog-facing-top-left) }
; TABLE#
@label=mask_dog_facing_top_left
 $D921 DEFB $C0,$1F,$FF,$C0,$1F,$FF,$E0,$3F ; {mask: DOG FACING TOP LEFT (shared)
 $D929 DEFB $FF,$F0,$0F,$FF,$F8,$03,$FF,$F8
 $D931 DEFB $00,$FF,$F0,$00,$3F,$E0,$00,$1F
 $D939 DEFB $C0,$00,$0F,$E8,$00,$0F,$F0,$00
 $D941 DEFB $0F,$F0,$00,$07,$F9,$F0,$07,$FF
 $D949 DEFB $E0,$03,$FF,$F0,$07,$FF,$F8,$07 ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D951-$D97A-1-24{0,0,96,56}(bitmap-dog-facing-bottom-right-1)
; }
; TABLE#
@label=bitmap_dog_facing_bottom_right_1
 $D951 DEFB $00,$00,$00,$0E,$00,$00,$1F,$80 ; {bitmap: DOG FACING BOTTOM RIGHT 1
 $D959 DEFB $00,$1F,$C0,$00,$1F,$F0,$00,$1F
 $D961 DEFB $F8,$00,$0F,$FD,$80,$0E,$FF,$00
 $D969 DEFB $04,$FF,$C0,$08,$7E,$C0,$08,$1D
 $D971 DEFB $E0,$00,$0C,$60,$00,$02,$00,$00
 $D979 DEFB $01,$80                         ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D97B-$D9A7-1-24{0,0,96,60}(bitmap-dog-facing-bottom-right-2)
; }
; TABLE#
@label=bitmap_dog_facing_bottom_right_2
 $D97B DEFB $00,$00,$00,$0E,$00,$00,$1F,$00 ; {bitmap: DOG FACING BOTTOM RIGHT 2
 $D983 DEFB $00,$1F,$C0,$00,$1F,$E0,$00,$1F
 $D98B DEFB $F8,$00,$0F,$FD,$00,$1E,$FF,$00
 $D993 DEFB $68,$FF,$C0,$00,$7E,$C0,$00,$1D
 $D99B DEFB $E0,$00,$18,$60,$00,$0A,$00,$00
 $D9A3 DEFB $12,$00,$00,$08,$00             ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D9A8-$D9CE-1-24{0,0,96,60}(bitmap-dog-facing-bottom-right-3)
; }
; TABLE#
@label=bitmap_dog_facing_bottom_right_3
 $D9A8 DEFB $00,$00,$00,$0C,$00,$00,$1F,$00 ; {bitmap: DOG FACING BOTTOM RIGHT 3
 $D9B0 DEFB $00,$1F,$C0,$00,$1F,$E0,$00,$1F
 $D9B8 DEFB $F8,$00,$0F,$FD,$00,$0E,$FF,$00
 $D9C0 DEFB $18,$FF,$C0,$09,$7E,$C0,$04,$19
 $D9C8 DEFB $E0,$00,$6C,$60,$00,$1A,$00     ; }
; #UDGTABLE
; {
; #UDGARRAY3,7,4,3;$D9CF-$D9F8-1-24{0,0,96,56}(bitmap-dog-facing-bottom-right-4)
; }
; TABLE#
@label=bitmap_dog_facing_bottom_right_4
 $D9CF DEFB $00,$00,$00,$0C,$00,$00,$1F,$00 ; {bitmap: DOG FACING BOTTOM RIGHT 4
 $D9D7 DEFB $00,$1F,$C0,$00,$1F,$F0,$00,$0F
 $D9DF DEFB $F8,$00,$0F,$FD,$80,$0E,$FF,$00
 $D9E7 DEFB $06,$7F,$C0,$04,$7E,$C0,$02,$1D
 $D9EF DEFB $E0,$01,$0A,$60,$00,$0D,$00,$00
 $D9F7 DEFB $18,$00                         ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$D9F9-$DA28-1-24(mask-dog-facing-bottom-right) }
; TABLE#
@label=mask_dog_facing_bottom_right
 $D9F9 DEFB $F1,$FF,$FF,$E0,$7F,$FF,$C0,$3F ; {mask: DOG FACING BOTTOM RIGHT (shared)
 $DA01 DEFB $FF,$C0,$0F,$FF,$C0,$07,$FF,$C0
 $DA09 DEFB $02,$7F,$E0,$00,$3F,$80,$00,$3F
 $DA11 DEFB $00,$00,$1F,$80,$00,$1F,$E0,$00
 $DA19 DEFB $0F,$F0,$00,$0F,$FE,$80,$1F,$FF
 $DA21 DEFB $C0,$3F,$FF,$E0,$7F,$FF,$F7,$FF ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$DA29-$DA6A-1-24{0,0,96,96}(flag-up) }
; TABLE#
@label=bitmap_flag_up
 $DA29 DEFB $00,$00,$00,$00,$00,$7C,$00,$03 ; {bitmap: FLAG UP
 $DA31 DEFB $FE,$80,$1F,$FE,$E0,$FF,$8E,$7F
 $DA39 DEFB $FC,$06,$7F,$E0,$06,$7F,$00,$7E
 $DA41 DEFB $60,$03,$FE,$60,$1F,$FE,$30,$FF
 $DA49 DEFB $FE,$3F,$FF,$0C,$3F,$FC,$1C,$3F
 $DA51 DEFB $F0,$1C,$3F,$80,$F8,$30,$03,$F8
 $DA59 DEFB $70,$0F,$C0,$60,$7E,$00,$7F,$F8
 $DA61 DEFB $00,$FF,$E0,$00,$0F,$00,$00,$00
 $DA69 DEFB $00,$00                         ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$DA6B-$DAB5-1-24{0,0,96,96}(flag-down) }
; TABLE#
@label=bitmap_flag_down
 $DA6B DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; {bitmap: FLAG DOWN
 $DA73 DEFB $00,$F8,$00,$00,$7F,$00,$00,$7F
 $DA7B DEFB $E0,$00,$3F,$FC,$1C,$30,$FF,$FC
 $DA83 DEFB $30,$1F,$FC,$30,$03,$D8,$3F,$00
 $DA8B DEFB $18,$3F,$E0,$18,$3F,$FC,$38,$3F
 $DA93 DEFB $FF,$F0,$70,$FF,$F0,$60,$1F,$F0
 $DA9B DEFB $60,$07,$F0,$7F,$00,$F8,$FF,$E0
 $DAA3 DEFB $18,$C3,$F8,$18,$00,$7F,$1C,$00
 $DAAB DEFB $0F,$FC,$00,$00,$F0,$00,$00,$00
 $DAB3 DEFB $00,$00,$00                     ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$DAB6-$DAFD-1-24{0,0,96,96}(bitmap-crate) }
; TABLE#
@label=bitmap_crate
 $DAB6 DEFB $00,$30,$00,$00,$FC,$00,$03,$FF ; {bitmap: CRATE
 $DABE DEFB $00,$0F,$E7,$C0,$3F,$99,$F0,$4E
 $DAC6 DEFB $66,$7C,$73,$99,$FF,$78,$E7,$FC
 $DACE DEFB $7B,$3F,$F3,$7B,$CF,$CF,$3B,$F3
 $DAD6 DEFB $3F,$4B,$FC,$FF,$73,$FD,$FF,$78
 $DADE DEFB $FD,$FC,$7B,$3D,$F3,$7B,$CD,$CF
 $DAE6 DEFB $7B,$F1,$3F,$3B,$FC,$FF,$0B,$FD
 $DAEE DEFB $FF,$03,$FD,$FF,$00,$FD,$FC,$00
 $DAF6 DEFB $3D,$F0,$00,$0D,$C0,$00,$01,$00 ; }
; #UDGTABLE
; { #UDGARRAY3,7,4,3;$DAFE-$DB45-1-24(mask-crate) }
; TABLE#
@label=mask_crate
 $DAFE DEFB $FF,$03,$FF,$FC,$00,$FF,$F0,$00 ; {mask: CRATE
 $DB06 DEFB $3F,$C0,$00,$0F,$80,$00,$03,$00
 $DB0E DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $DB16 DEFB $00,$00,$00,$00,$00,$00,$80,$00
 $DB1E DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $DB26 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $DB2E DEFB $00,$00,$00,$80,$00,$00,$C0,$00
 $DB36 DEFB $00,$F0,$00,$00,$FC,$00,$00,$FF
 $DB3E DEFB $00,$03,$FF,$C0,$0F,$FF,$F0,$3F ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DB46-$DB71-1-16{0,0,64,88}(bitmap-stove) }
; TABLE#
@label=bitmap_stove
 $DB46 DEFB $1C,$00,$13,$C0,$0C,$30,$13,$C8 ; {bitmap: STOVE
 $DB4E DEFB $1F,$F8,$0F,$F0,$13,$C8,$0C,$30
 $DB56 DEFB $0F,$F0,$0F,$F0,$1F,$F8,$19,$98
 $DB5E DEFB $16,$68,$35,$AC,$36,$6C,$3B,$DC
 $DB66 DEFB $3C,$3C,$2F,$F4,$17,$E8,$3B,$DC
 $DB6E DEFB $33,$CC,$60,$06                 ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DB72-$DB9D-1-16(mask-stove) }
; TABLE#
@label=mask_stove
 $DB72 DEFB $C0,$3F,$C0,$0F,$E0,$07,$C0,$03 ; {mask: STOVE
 $DB7A DEFB $C0,$03,$E0,$07,$C0,$03,$E0,$07
 $DB82 DEFB $E0,$07,$E0,$07,$C0,$03,$C0,$03
 $DB8A DEFB $C0,$03,$80,$01,$80,$01,$80,$01
 $DB92 DEFB $80,$01,$80,$01,$C0,$03,$80,$01
 $DB9A DEFB $80,$01,$0C,$30                 ; }

; Mark nearby items.
;
; Used by the routines at #R$6939 and #R$9D7B.
; .
; Iterates over item structs, testing to see if each item is within range
; (-1..22, 0..15) of the map position.
; .
; This is similar to is_item_discoverable_interior in that it iterates over all
; item_structs.
@label=mark_nearby_items
c$DB9E LD A,($68A0)  ; A = room_index;
 $DBA1 CP $FF        ; {if (A == room_NONE) A = 0;
 $DBA3 JR NZ,$DBA6   ;
 $DBA5 XOR A         ; }
*$DBA6 LD C,A        ; C = A; // room ref
 $DBA7 LD DE,($81BB) ; DE = map_position;
 $DBAB LD B,$10      ; B = item__LIMIT;
 $DBAD LD HL,$76C9   ; HL = &item_structs[0].room;
*$DBB0 PUSH HL       ; do <%
 $DBB1 LD A,(HL)     ; {  if (HL[0] & itemstruct_ROOM_MASK == C) <% // compare room
 $DBB2 AND $3F       ;
 $DBB4 CP C          ;
 $DBB5 JR NZ,$DBDC   ; }
 $DBB7 INC HL        ; {    if (HL[4] > E - 2 && HL[4] < E + 23) <% // itemstruct.screenpos.x
 $DBB8 INC HL        ;
 $DBB9 INC HL        ;
 $DBBA INC HL        ;
 $DBBB LD A,E        ;
 $DBBC DEC A         ;
 $DBBD DEC A         ;
 $DBBE CP (HL)       ;
 $DBBF JR Z,$DBC3    ;
 $DBC1 JR NC,$DBDC   ;
*$DBC3 ADD A,$19     ;
 $DBC5 CP (HL)       ;
 $DBC6 JR C,$DBDC    ; }
 $DBC8 LD A,D        ; {      if (HL[5] > D - 1 && HL[5] < D + 16) <% // itemstruct.screenpos.y
 $DBC9 INC HL        ;
 $DBCA DEC A         ;
 $DBCB CP (HL)       ;
 $DBCC JR Z,$DBD0    ;
 $DBCE JR NC,$DBDC   ;
*$DBD0 ADD A,$11     ;
 $DBD2 CP (HL)       ;
 $DBD3 JR C,$DBDC    ; }
 $DBD5 POP HL
 $DBD6 SET 7,(HL)    ; {        *HL |= itemstruct_ROOM_FLAG_NEARBY_6 | itemstruct_ROOM_FLAG_NEARBY_7; // sampled HL=$772B &itemstruct_14.room
 $DBD8 SET 6,(HL)    ; }
 $DBDA JR $DBE1      ;         goto next; %> %> %>
; Reset.
*$DBDC POP HL
 $DBDD RES 7,(HL)    ; {  *HL &= ~(itemstruct_ROOM_FLAG_NEARBY_6 | itemstruct_ROOM_FLAG_NEARBY_7);
 $DBDF RES 6,(HL)    ; }
*$DBE1 LD A,$07      ; {  next: HL += 7; // stride
 $DBE3 ADD A,L       ;
 $DBE4 LD L,A        ;
 $DBE5 JR NC,$DBE8   ;
 $DBE7 INC H         ; }
*$DBE8 DJNZ $DBB0    ; %> while (--B);
 $DBEA RET           ; return;

; Iterates over all item_structs looking for nearby items.
;
; Used by the routine at #R$B89C.
; .
; Returns the furthest/highest/nearest item?
; .
; Iterates over all items. Uses multiply_by_8.
;
; I:BC' samples = 0, $1A, $1C, $1E, $20, $22,
; I:DE' samples = 0, $22, $22, $22, $22, $22,
; O:IY Pointer to to item struct. (result?)
; O:A' result?
@label=get_greatest_itemstruct
c$DBEB LD BC,$1007   ; B = item_LIMIT; // iterations
 $DBEE LD HL,$76C9   ; Outer_HL = &item_structs[0].room;
*$DBF1 BIT 7,(HL)    ; {do <% if ((*Outer_HL & (itemstruct_ROOM_FLAG_NEARBY_6 | itemstruct_ROOM_FLAG_NEARBY_7)) == (itemstruct_ROOM_FLAG_NEARBY_6 | itemstruct_ROOM_FLAG_NEARBY_7)) <%
 $DBF3 JR Z,$DC38    ;
 $DBF5 BIT 6,(HL)    ;
 $DBF7 JR Z,$DC38    ; }
 $DBF9 PUSH HL       ;   HL = Outer_HL;
 $DBFA PUSH BC
 $DBFB INC HL        ; {  HLdash = *++HL * 8; // x position
 $DBFC LD A,(HL)     ;
 $DBFD CALL $B1C7    ; }
 $DC00 PUSH BC       ;
 $DC01 EXX
 $DC02 POP HL        ;
 $DC03 AND A         ;   A &= A; // Clear carry flag.
 $DC04 SBC HL,BC     ;   HLdash -= BCdash; // itemstr->pos.x * 8 - x
 $DC06 EXX
 $DC07 JR Z,$DC36    ; {  if (HLdash > 0) <%
 $DC09 JR C,$DC36    ; }
 $DC0B INC HL        ;     HL++; // y position
 $DC0C LD A,(HL)     ; {    HLdash = *HL * 8;
 $DC0D CALL $B1C7    ; }
 $DC10 PUSH BC
 $DC11 EXX
 $DC12 POP HL        ;     // not clearing carry?
 $DC13 SBC HL,DE     ;     HLdash -= BCdash; // itemstr->pos.y * 8 - y
 $DC15 EXX
 $DC16 JR Z,$DC36    ; {    if (HLdash > 0) <%
 $DC18 JR C,$DC36    ; }
 $DC1A PUSH HL       ; {      HLdash = HL;
 $DC1B EXX
 $DC1C POP HL        ; }
; Get x,y for the next iteration.
 $DC1D LD A,(HL)     ; {      DEdash = *HLdash-- * 8; // y position
 $DC1E CALL $B1C7    ;
 $DC21 LD E,C        ;
 $DC22 LD D,B        ;
 $DC23 DEC HL        ; }
 $DC24 LD A,(HL)     ; {      BCdash = *HLdash-- * 8; // x position
 $DC25 CALL $B1C7    ; }
 $DC28 DEC HL        ; {      HLdash--; // point to item
 $DC29 DEC HL        ; }
 $DC2A PUSH HL       ; {      IY = HLdash; // IY is not banked // sampled IY=$771C,7715 (pointing into item_structs)
 $DC2B POP IY        ; }
 $DC2D EXX
 $DC2E POP BC        ;       - // fetch iter count
 $DC2F PUSH BC
 $DC30 LD A,$10      ; {      A = (16 - B) | (1<<6); // item found flag
 $DC32 SUB B         ;
 $DC33 OR $40        ; }
 $DC35 EX AF,AF'     ;       %> %> // unpaired // returns the value in Adash
*$DC36 POP BC
 $DC37 POP HL
*$DC38 LD A,C        ; {  %> Outer_HL += 7; // stride
 $DC39 ADD A,L       ;
 $DC3A LD L,A        ;
 $DC3B JR NC,$DC3E   ;
 $DC3D INC H         ; }
*$DC3E DJNZ $DBF1    ; %> while (--B);
 $DC40 RET           ; return;

; Set up item plotting.
;
; Used by the routine at #R$B866.
;
; I:A  Item.
; I:IY Pointer to itemstruct. (samples = 0x771C, 0x76F9)
;
; 0x3F looks like it ought to be 0x1F (item__LIMIT - 1). Potential bug: The use
; of A later on does not re-clamp it to 0x1F.
@label=setup_item_plotting
c$DC41 AND $3F       ; A &= 0x3F;
; Bug: This writes to saved_item but it's never subsequently read from.
 $DC43 LD ($8213),A  ; saved_item = A;
 $DC46 PUSH IY       ; {HL = IY + 2;
 $DC48 POP HL        ;
 $DC49 INC HL        ;
 $DC4A INC HL        ; }
 $DC4B LD DE,$81B2   ; DE = &tinypos_stash_x;
 $DC4E LD BC,$0005   ; BC = 5;
 $DC51 LDIR
 $DC53 EX DE,HL
 $DC54 LD (HL),B     ; *HL = B; // B == 0 due to LDIR /* Items are never drawn flipped. */
 $DC55 LD HL,$DD7D   ; {HL = &item_definitions[A];
 $DC58 ADD A,A       ;
 $DC59 LD C,A        ;
 $DC5A ADD A,A       ;
 $DC5B ADD A,C       ;
 $DC5C LD C,A        ;
 $DC5D ADD HL,BC     ; }
 $DC5E INC HL        ; HL++; // &item_definitions[A].height
 $DC5F LD A,(HL)     ; A = (HL);
 $DC60 LD ($8214),A  ; item_height = A;
 $DC63 INC HL        ; HL++;
 $DC64 LD DE,$81AC   ; {memcpy(&bitmap_pointer, HL, 4); // copy bitmap and mask pointers
 $DC67 LD BC,$0004   ;
 $DC6A LDIR          ; }
 $DC6C CALL $DD02    ; item_visible();
 $DC6F RET NZ        ; if (!Z) return; /* invisible */
 $DC70 PUSH BC
 $DC71 PUSH DE
 $DC72 LD A,E        ; A = E;
 $DC73 LD ($E2C2),A  ; ($E2C1 + 1) = A; // self modify masked_sprite_plotter_16_wide_left
 $DC76 LD A,B        ; A = B;
 $DC77 AND A         ; {if (A == 0) <%
 $DC78 JP NZ,$DC81   ; }
 $DC7B LD A,$77      ;   A = 0x77; // 0b01110111 /* opcode of 'LD (HL),A' */
 $DC7D EX AF,AF'     ; {  Adash = C; %>
 $DC7E LD A,C        ; }
 $DC7F JR $DC86      ; else <%
*$DC81 XOR A         ;   A = 0; /* opcode of 'NOP' */
 $DC82 EX AF,AF'     ; {  Adash = 3 - C; %>
 $DC83 LD A,$03      ;
 $DC85 SUB C         ; }
*$DC86 EXX
 $DC87 LD C,A        ; Cdash = Adash;
 $DC88 EX AF,AF'
 $DC89 LD HL,$E0E0   ; HLdash = &masked_sprite_plotter_16_enables[0];
 $DC8C LD B,$03      ; Bdash = 3; // iterations
*$DC8E LD E,(HL)     ; {do <% Edash = *HLdash++;
 $DC8F INC HL        ; }
 $DC90 LD D,(HL)     ;   Ddash = *HLdash;
 $DC91 LD (DE),A     ;   *DEdash = A;
 $DC92 INC HL        ;   HLdash++;
 $DC93 LD E,(HL)     ; {  Edash = *HLdash++;
 $DC94 INC HL        ; }
 $DC95 LD D,(HL)     ; {  Ddash = *HLdash++;
 $DC96 INC HL        ; }
 $DC97 LD (DE),A     ;   *DEdash = A;
 $DC98 DEC C         ; {  if (--Cdash == 0) A ^= 0x77; /* Toggle between LD (HL),A and NOP. */
 $DC99 JR NZ,$DC9D   ;
 $DC9B XOR $77       ; }
*$DC9D DJNZ $DC8E    ; %> while (--Bdash);
 $DC9F EXX
 $DCA0 LD A,D        ; A = D;
 $DCA1 AND A         ; A &= A;
 $DCA2 LD DE,$0000   ; DE = 0;
 $DCA5 JR NZ,$DCBC   ; if (Z) <%
 $DCA7 LD HL,$81BC   ;   HL = $81BC; // &map_position + 1;
 $DCAA LD A,($81B6)  ; {  A = ($81B6) - *HL;
 $DCAD SUB (HL)      ; }
 $DCAE LD L,A        ; {  HL = A * 192;
 $DCAF LD H,$00      ;
 $DCB1 ADD HL,HL     ;
 $DCB2 ADD HL,HL     ;
 $DCB3 ADD HL,HL     ;
 $DCB4 ADD HL,HL     ;
 $DCB5 ADD HL,HL     ;
 $DCB6 ADD HL,HL     ;
 $DCB7 LD E,L        ;
 $DCB8 LD D,H        ;
 $DCB9 ADD HL,HL     ;
 $DCBA ADD HL,DE     ; }
 $DCBB EX DE,HL      ; %>
*$DCBC LD A,($81B5)  ; A = screenpos_x;
 $DCBF LD HL,$81BB   ; HL = $81BB; // &map_position;
 $DCC2 SUB (HL)      ; A -= *HL; // x
 $DCC3 LD L,A        ; {HL = A;
 $DCC4 LD H,$00      ; }
 $DCC6 JR NC,$DCCA   ; {if (carry) H = 0xFF;
 $DCC8 LD H,$FF      ; }
*$DCCA ADD HL,DE     ; HL += DE;
 $DCCB LD DE,$F290   ; DE = $F290; // screen buffer start address
 $DCCE ADD HL,DE     ; HL += DE;
@nowarn
 $DCCF LD ($81A2),HL ; ($81A2) = HL;  // screen buffer pointer
@nowarn
 $DCD2 LD HL,$8100   ; HL = mask_buffer;
 $DCD5 POP DE
 $DCD6 PUSH DE
 $DCD7 LD A,D        ; {L += D * 4;
 $DCD8 ADD A,A       ;
 $DCD9 ADD A,A       ;
 $DCDA ADD A,L       ;
 $DCDB LD L,A        ; }
 $DCDC LD ($81B0),HL ; ($81B0) = HL;
 $DCDF POP DE
 $DCE0 PUSH DE
 $DCE1 LD A,D        ; A = D;
 $DCE2 AND A         ; {if (A) <%
 $DCE3 JR Z,$DCEF    ; }
; Bug: Generic multiply loop which only ever multiplies by two...
 $DCE5 LD D,A        ;   D = A;
 $DCE6 XOR A         ;   A = 0;
 $DCE7 LD E,$03      ;   E = 3; // unusual (or self modified and i've not spotted the setter)
 $DCE9 DEC E         ;   E--;
*$DCEA ADD A,E       ; {  do <% A += E; %> while (--D); %>
 $DCEB DEC D         ;
 $DCEC JP NZ,$DCEA   ; }
; D ends up as zero either way.
*$DCEF LD E,A        ; E = A;
 $DCF0 LD HL,($81AC) ; {bitmap_pointer += DE;
 $DCF3 ADD HL,DE     ;
 $DCF4 LD ($81AC),HL ; }
 $DCF7 LD HL,($81AE) ; {mask_pointer += DE;
 $DCFA ADD HL,DE     ;
 $DCFB LD ($81AE),HL ; }
 $DCFE POP BC
 $DCFF POP DE
 $DD00 XOR A         ; A = 0;
 $DD01 RET           ; return; /* visible */

; Clipping items to the game window.
;
; Used by the routine at #R$DC41.
; .
; Counterpart to vischar_visible.
;
; O:AF Z => visible !Z => invisible
; O:BC Clipped width.
; O:DE Clipped height.
;
; Width part.
@label=item_visible
c$DD02 LD HL,$81B5   ; HL = &screenpos_x;
 $DD05 LD DE,($81BB) ; DE = map_position;
 $DD09 LD A,E        ; {A = E + 24 - HL[0]; // xoff
 $DD0A ADD A,$18     ;
 $DD0C SUB (HL)      ; }
 $DD0D JR Z,$DD66    ; {if (A <= 0) goto invisible;
 $DD0F JR C,$DD66    ; }
 $DD11 CP $03        ; {if (A < 3) <%
 $DD13 JP NC,$DD1B   ; }
 $DD16 LD B,$00      ; {  BC = A; %>
 $DD18 LD C,A        ; }
 $DD19 JR $DD33      ; else <%
*$DD1B LD A,(HL)     ; {  A = HL[0] + 3 - E;
 $DD1C ADD A,$03     ;
 $DD1E SUB E         ; }
 $DD1F JR Z,$DD66    ; {  if (A <= 0) goto invisible;
 $DD21 JR C,$DD66    ; }
 $DD23 CP $03        ; {  if (A < 3) <%
 $DD25 JP NC,$DD2F   ; }
 $DD28 LD C,A        ;     C = A;
 $DD29 LD A,$03      ; {    B = 3 - C; %>
 $DD2B SUB C         ;
 $DD2C LD B,A        ; }
 $DD2D JR $DD33      ;   else <%
*$DD2F LD B,$00      ; {    BC = 3; %> %>
 $DD31 LD C,$03      ; }
; Height part.
*$DD33 LD A,D        ; {A = D + 17 - HL[1];
 $DD34 ADD A,$11     ;
 $DD36 INC HL        ;
 $DD37 SUB (HL)      ; }
 $DD38 JR Z,$DD66    ; {if (A <= 0) goto invisible;
 $DD3A JR C,$DD66    ; }
 $DD3C CP $02        ; {if (A < 2) <%
 $DD3E JP NC,$DD47   ; }
 $DD41 LD E,$08      ; {  DE = 8; %>
 $DD43 LD D,$00      ; }
 $DD45 JR $DD64      ; else <%
*$DD47 LD A,(HL)     ; {  A = HL[1] + 2 - D;
 $DD48 ADD A,$02     ;
 $DD4A SUB D         ; }
 $DD4B JR Z,$DD66    ; {  if (A <= 0) goto invisible;
 $DD4D JR C,$DD66    ; }
 $DD4F CP $02        ; {  if (A < 2) <%
 $DD51 JP NC,$DD5E   ; }
 $DD54 LD A,($8214)  ; {    E = item_height - 8;
 $DD57 SUB $08       ;
 $DD59 LD E,A        ; }
 $DD5A LD D,$08      ;     D = 8; %>
 $DD5C JR $DD64      ;   else <%
*$DD5E LD D,$00      ; {    DE = item_height; %> %>
 $DD60 LD A,($8214)  ;
 $DD63 LD E,A        ; }
*$DD64 XOR A         ; visible: A = 0;
 $DD65 RET           ; return;
*$DD66 OR $01        ; invisible: A |= 1;
 $DD68 RET           ; return;

; Item attributes.
;
; 20 bytes, 4 of which are unknown, possibly unused.
; .
; 'Yellow/black' means yellow ink over black paper, for example.
@label=item_attributes
b$DD69 DEFB $06      ; item_attribute: WIRESNIPS - yellow/black
 $DD6A DEFB $05      ; item_attribute: SHOVEL - cyan/black
 $DD6B DEFB $05      ; item_attribute: LOCKPICK - cyan/black
 $DD6C DEFB $07      ; item_attribute: PAPERS - white/black
 $DD6D DEFB $04      ; item_attribute: TORCH - green/black
 $DD6E DEFB $42      ; item_attribute: BRIBE - bright-red/black
 $DD6F DEFB $04      ; item_attribute: UNIFORM - green/black
; Food turns purple/black when it's poisoned.
@label=item_attributes_food
 $DD70 DEFB $07      ; item_attribute: FOOD - white/black
 $DD71 DEFB $03      ; item_attribute: POISON - purple/black
 $DD72 DEFB $42      ; item_attribute: RED KEY - bright-red/black
 $DD73 DEFB $06      ; item_attribute: YELLOW KEY - yellow/black
 $DD74 DEFB $04      ; item_attribute: GREEN KEY - green/black
 $DD75 DEFB $05      ; item_attribute: PARCEL - cyan/black
 $DD76 DEFB $07      ; item_attribute: RADIO - white/black
 $DD77 DEFB $07      ; item_attribute: PURSE - white/black
 $DD78 DEFB $04      ; item_attribute: COMPASS - green/black
; The following are likely unused.
 $DD79 DEFB $06      ; item_attribute: yellow/black
 $DD7A DEFB $05      ; item_attribute: cyan/black
 $DD7B DEFB $42      ; item_attribute: bright-red/black
 $DD7C DEFB $42      ; item_attribute: bright-red/black

; Item definitions.
;
; Array of "sprite" structures.
; .
; item_definition: WIRESNIPS
@label=item_definitions
b$DD7D DEFB $02      ; width
 $DD7E DEFB $0B      ; height
 $DD7F DEFW $DE7F    ; bitmap pointer
 $DD81 DEFW $DF1D    ; mask pointer
; item_definition: SHOVEL
 $DD83 DEFB $02      ; width
 $DD84 DEFB $0D      ; height
 $DD85 DEFW $DDDD    ; bitmap pointer
 $DD87 DEFW $DE95    ; mask pointer
; item_definition: LOCKPICK
 $DD89 DEFB $02      ; width
 $DD8A DEFB $10      ; height
 $DD8B DEFW $DE11    ; bitmap pointer
 $DD8D DEFW $DEAF    ; mask pointer
; item_definition: PAPERS
 $DD8F DEFB $02      ; width
 $DD90 DEFB $0F      ; height
 $DD91 DEFW $DE61    ; bitmap pointer
 $DD93 DEFW $DEFF    ; mask pointer
; item_definition: TORCH
 $DD95 DEFB $02      ; width
 $DD96 DEFB $0C      ; height
 $DD97 DEFW $DF73    ; bitmap pointer
 $DD99 DEFW $E07F    ; mask pointer
; item_definition: BRIBE
 $DD9B DEFB $02      ; width
 $DD9C DEFB $0D      ; height
 $DD9D DEFW $DFAB    ; bitmap pointer
 $DD9F DEFW $E005    ; mask pointer
; item_definition: UNIFORM
 $DDA1 DEFB $02      ; width
 $DDA2 DEFB $10      ; height
 $DDA3 DEFW $DF8B    ; bitmap pointer
 $DDA5 DEFW $E01F    ; mask pointer
; item_definition: FOOD
 $DDA7 DEFB $02      ; width
 $DDA8 DEFB $10      ; height
 $DDA9 DEFW $DF33    ; bitmap pointer
 $DDAB DEFW $E0B7    ; mask pointer
; item_definition: POISON
 $DDAD DEFB $02      ; width
 $DDAE DEFB $10      ; height
 $DDAF DEFW $DF53    ; bitmap pointer
 $DDB1 DEFW $E05F    ; mask pointer
; item_definition: RED_KEY
 $DDB3 DEFB $02      ; width
 $DDB4 DEFB $0D      ; height
 $DDB5 DEFW $DDF7    ; bitmap pointer
 $DDB7 DEFW $DE95    ; mask pointer
; item_definition: YELLOW_KEY
 $DDB9 DEFB $02      ; width
 $DDBA DEFB $0D      ; height
 $DDBB DEFW $DDF7    ; bitmap pointer
 $DDBD DEFW $DE95    ; mask pointer
; item_definition: GREEN_KEY
 $DDBF DEFB $02      ; width
 $DDC0 DEFB $0D      ; height
 $DDC1 DEFW $DDF7    ; bitmap pointer
 $DDC3 DEFW $DE95    ; mask pointer
; item_definition: PARCEL
 $DDC5 DEFB $02      ; width
 $DDC6 DEFB $10      ; height
 $DDC7 DEFW $DFE5    ; bitmap pointer
 $DDC9 DEFW $E03F    ; mask pointer
; item_definition: RADIO
 $DDCB DEFB $02      ; width
 $DDCC DEFB $10      ; height
 $DDCD DEFW $DFC5    ; bitmap pointer
 $DDCF DEFW $E097    ; mask pointer
; item_definition: PURSE
 $DDD1 DEFB $02      ; width
 $DDD2 DEFB $0C      ; height
 $DDD3 DEFW $DE49    ; bitmap pointer
 $DDD5 DEFW $DEE7    ; mask pointer
; item_definition: COMPASS
 $DDD7 DEFB $02      ; width
 $DDD8 DEFB $0C      ; height
 $DDD9 DEFW $DE31    ; bitmap pointer
 $DDDB DEFW $DECF    ; mask pointer

; Item bitmaps and masks.
;
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DDDD-$DDF6-1-16{0,0,64,52}(item-shovel) }
; TABLE#
@label=bitmap_shovel
b$DDDD DEFB $00,$00  ; {item_bitmap: SHOVEL (16x13)
 $DDDF DEFB $00,$02
 $DDE1 DEFB $00,$05
 $DDE3 DEFB $00,$0E
 $DDE5 DEFB $00,$30
 $DDE7 DEFB $00,$C0
 $DDE9 DEFB $33,$00
 $DDEB DEFB $6C,$00
 $DDED DEFB $E7,$00
 $DDEF DEFB $FC,$00
 $DDF1 DEFB $00,$00
 $DDF3 DEFB $00,$00
 $DDF5 DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DDF7-$DE10-1-16{0,0,64,52}(item-key) }
; TABLE#
@label=bitmap_key
 $DDF7 DEFB $00,$00  ; {item_bitmap: KEY (shared for all keys) (16x13)
 $DDF9 DEFB $00,$00
 $DDFB DEFB $00,$00
 $DDFD DEFB $00,$18
 $DDFF DEFB $00,$64
 $DE01 DEFB $00,$1C
 $DE03 DEFB $00,$70
 $DE05 DEFB $19,$C0
 $DE07 DEFB $27,$00
 $DE09 DEFB $32,$00
 $DE0B DEFB $19,$00
 $DE0D DEFB $07,$00
 $DE0F DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DE11-$DE30-1-16{0,0,64,64}(item-lockpick) }
; TABLE#
@label=bitmap_lockpick
 $DE11 DEFB $01,$80  ; {item_bitmap: LOCKPICK (16x16)
 $DE13 DEFB $00,$C0
 $DE15 DEFB $03,$70
 $DE17 DEFB $0C,$60
 $DE19 DEFB $38,$40
 $DE1B DEFB $E0,$00
 $DE1D DEFB $C0,$00
 $DE1F DEFB $03,$18
 $DE21 DEFB $0C,$F0
 $DE23 DEFB $30,$C0
 $DE25 DEFB $23,$07
 $DE27 DEFB $2C,$08
 $DE29 DEFB $30,$38
 $DE2B DEFB $00,$E6
 $DE2D DEFB $03,$C4
 $DE2F DEFB $03,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DE31-$DE48-1-16{0,0,64,48}(item-compass) }
; TABLE#
@label=bitmap_compass
 $DE31 DEFB $00,$00  ; {item_bitmap: COMPASS (16x12)
 $DE33 DEFB $07,$E0
 $DE35 DEFB $18,$18
 $DE37 DEFB $24,$24
 $DE39 DEFB $41,$02
 $DE3B DEFB $41,$02
 $DE3D DEFB $24,$A4
 $DE3F DEFB $58,$9A
 $DE41 DEFB $27,$E4
 $DE43 DEFB $18,$18
 $DE45 DEFB $07,$E0
 $DE47 DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DE49-$DE60-1-16{0,0,64,48}(item-purse) }
; TABLE#
@label=bitmap_purse
 $DE49 DEFB $00,$00  ; {item_bitmap: PURSE (16x12)
 $DE4B DEFB $01,$80
 $DE4D DEFB $07,$40
 $DE4F DEFB $03,$80
 $DE51 DEFB $01,$00
 $DE53 DEFB $02,$80
 $DE55 DEFB $05,$40
 $DE57 DEFB $0D,$A0
 $DE59 DEFB $0B,$E0
 $DE5B DEFB $0F,$E0
 $DE5D DEFB $07,$C0
 $DE5F DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DE61-$DE7E-1-16{0,0,64,60}(item-papers) }
; TABLE#
@label=bitmap_papers
 $DE61 DEFB $00,$00  ; {item_bitmap: PAPERS (16x15)
 $DE63 DEFB $0C,$00
 $DE65 DEFB $07,$00
 $DE67 DEFB $06,$C0
 $DE69 DEFB $02,$B0
 $DE6B DEFB $33,$6C
 $DE6D DEFB $6C,$D4
 $DE6F DEFB $6B,$36
 $DE71 DEFB $DA,$CE
 $DE73 DEFB $D6,$F3
 $DE75 DEFB $35,$EC
 $DE77 DEFB $0D,$DC
 $DE79 DEFB $03,$D0
 $DE7B DEFB $00,$80
 $DE7D DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DE7F-$DE94-1-16{0,0,64,44}(item-wiresnips) }
; TABLE#
@label=bitmap_wiresnips
 $DE7F DEFB $00,$00  ; {item_bitmap: WIRESNIPS (16x11)
 $DE81 DEFB $00,$18
 $DE83 DEFB $00,$36
 $DE85 DEFB $00,$60
 $DE87 DEFB $03,$FB
 $DE89 DEFB $0E,$6E
 $DE8B DEFB $30,$E0
 $DE8D DEFB $C1,$80
 $DE8F DEFB $06,$00
 $DE91 DEFB $18,$00
 $DE93 DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DE95-$DEAE-1-16{0,0,64,52}(item-mask-shovelkey) }
; TABLE#
@label=mask_shovel_key
 $DE95 DEFB $FF,$FD  ; {item_mask: SHOVEL or KEY (shared) (16x13)
 $DE97 DEFB $FF,$F8
 $DE99 DEFB $FF,$E0
 $DE9B DEFB $FF,$80
 $DE9D DEFB $FF,$01
 $DE9F DEFB $CC,$01
 $DEA1 DEFB $80,$03
 $DEA3 DEFB $00,$0F
 $DEA5 DEFB $00,$3F
 $DEA7 DEFB $00,$FF
 $DEA9 DEFB $00,$7F
 $DEAB DEFB $E0,$7F
 $DEAD DEFB $F8,$FF  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DEAF-$DECE-1-16{0,0,64,64}(item-mask-lockpick) }
; TABLE#
@label=mask_lockpick
 $DEAF DEFB $FC,$3F  ; {item_mask: LOCKPICK (16x16)
 $DEB1 DEFB $FC,$0F
 $DEB3 DEFB $F0,$07
 $DEB5 DEFB $C0,$0F
 $DEB7 DEFB $03,$1F
 $DEB9 DEFB $07,$BF
 $DEBB DEFB $1C,$E7
 $DEBD DEFB $30,$03
 $DEBF DEFB $C0,$07
 $DEC1 DEFB $80,$08
 $DEC3 DEFB $80,$30
 $DEC5 DEFB $80,$C0
 $DEC7 DEFB $83,$01
 $DEC9 DEFB $CC,$00
 $DECB DEFB $F8,$11
 $DECD DEFB $F8,$3B  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DECF-$DEE6-1-16{0,0,64,48}(item-mask-compass) }
; TABLE#
@label=mask_compass
 $DECF DEFB $F8,$1F  ; {item_mask: COMPASS (16x12)
 $DED1 DEFB $E0,$07
 $DED3 DEFB $C0,$03
 $DED5 DEFB $80,$01
 $DED7 DEFB $00,$00
 $DED9 DEFB $00,$00
 $DEDB DEFB $80,$01
 $DEDD DEFB $00,$00
 $DEDF DEFB $80,$01
 $DEE1 DEFB $C0,$03
 $DEE3 DEFB $E0,$07
 $DEE5 DEFB $F8,$1F  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DEE7-$DEFE-1-16{0,0,64,48}(item-mask-purse) }
; TABLE#
@label=mask_purse
 $DEE7 DEFB $FE,$7F  ; {item_mask: PURSE (16x12)
 $DEE9 DEFB $F8,$3F
 $DEEB DEFB $F0,$1F
 $DEED DEFB $F8,$3F
 $DEEF DEFB $FC,$3F
 $DEF1 DEFB $F8,$3F
 $DEF3 DEFB $F0,$1F
 $DEF5 DEFB $E0,$0F
 $DEF7 DEFB $E0,$0F
 $DEF9 DEFB $E0,$0F
 $DEFB DEFB $F0,$1F
 $DEFD DEFB $F8,$3F  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DEFF-$DF1C-1-16{0,0,64,60}(item-mask-papers) }
; TABLE#
@label=mask_papers
 $DEFF DEFB $F3,$FF  ; {item_mask: PAPERS (16x15)
 $DF01 DEFB $E0,$FF
 $DF03 DEFB $F0,$3F
 $DF05 DEFB $F0,$0F
 $DF07 DEFB $C8,$03
 $DF09 DEFB $80,$01
 $DF0B DEFB $00,$01
 $DF0D DEFB $00,$00
 $DF0F DEFB $00,$00
 $DF11 DEFB $00,$00
 $DF13 DEFB $00,$00
 $DF15 DEFB $C0,$01
 $DF17 DEFB $F0,$03
 $DF19 DEFB $FC,$2F
 $DF1B DEFB $FF,$7F  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DF1D-$DF32-1-16{0,0,64,44}(item-mask-wiresnips) }
; TABLE#
@label=mask_wiresnips
 $DF1D DEFB $FF,$E7  ; {item_mask: WIRESNIPS (16x11)
 $DF1F DEFB $FF,$C1
 $DF21 DEFB $FF,$80
 $DF23 DEFB $FC,$00
 $DF25 DEFB $F0,$00
 $DF27 DEFB $C0,$00
 $DF29 DEFB $00,$01
 $DF2B DEFB $08,$1F
 $DF2D DEFB $20,$7F
 $DF2F DEFB $C1,$FF
 $DF31 DEFB $E7,$FF  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DF33-$DF52-1-16{0,0,64,64}(item-food) }
; TABLE#
@label=bitmap_food
 $DF33 DEFB $00,$30  ; {item_bitmap: FOOD (16x16)
 $DF35 DEFB $00,$00
 $DF37 DEFB $00,$30
 $DF39 DEFB $00,$30
 $DF3B DEFB $0E,$78
 $DF3D DEFB $1F,$B8
 $DF3F DEFB $07,$38
 $DF41 DEFB $18,$B8
 $DF43 DEFB $1E,$38
 $DF45 DEFB $19,$98
 $DF47 DEFB $17,$E0
 $DF49 DEFB $19,$F8
 $DF4B DEFB $06,$60
 $DF4D DEFB $07,$98
 $DF4F DEFB $01,$F8
 $DF51 DEFB $00,$60  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DF53-$DF72-1-16{0,0,64,64}(item-poison) }
; TABLE#
@label=bitmap_poison
 $DF53 DEFB $00,$00  ; {item_bitmap: POISON (16x16)
 $DF55 DEFB $00,$80
 $DF57 DEFB $00,$80
 $DF59 DEFB $01,$40
 $DF5B DEFB $01,$C0
 $DF5D DEFB $00,$80
 $DF5F DEFB $01,$40
 $DF61 DEFB $03,$E0
 $DF63 DEFB $06,$30
 $DF65 DEFB $06,$B0
 $DF67 DEFB $06,$30
 $DF69 DEFB $06,$F0
 $DF6B DEFB $06,$F0
 $DF6D DEFB $07,$F0
 $DF6F DEFB $05,$D0
 $DF71 DEFB $03,$E0  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DF73-$DF8A-1-16{0,0,64,48}(item-torch) }
; TABLE#
@label=bitmap_torch
 $DF73 DEFB $00,$00  ; {item_bitmap: TORCH (16x12)
 $DF75 DEFB $00,$08
 $DF77 DEFB $00,$3C
 $DF79 DEFB $02,$FC
 $DF7B DEFB $0D,$70
 $DF7D DEFB $1E,$A0
 $DF7F DEFB $1E,$80
 $DF81 DEFB $16,$80
 $DF83 DEFB $16,$80
 $DF85 DEFB $16,$00
 $DF87 DEFB $0C,$00
 $DF89 DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DF8B-$DFAA-1-16{0,0,64,64}(item-uniform) }
; TABLE#
@label=bitmap_uniform
 $DF8B DEFB $01,$E0  ; {item_bitmap: UNIFORM (16x16)
 $DF8D DEFB $07,$F0
 $DF8F DEFB $0F,$F8
 $DF91 DEFB $0F,$F8
 $DF93 DEFB $1F,$FC
 $DF95 DEFB $0F,$F3
 $DF97 DEFB $F3,$CC
 $DF99 DEFB $3C,$30
 $DF9B DEFB $0F,$CF
 $DF9D DEFB $F3,$3C
 $DF9F DEFB $3C,$F0
 $DFA1 DEFB $0F,$CF
 $DFA3 DEFB $F3,$3C
 $DFA5 DEFB $3C,$F0
 $DFA7 DEFB $0F,$C0
 $DFA9 DEFB $03,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DFAB-$DFC4-1-16{0,0,64,52}(item-bribe) }
; TABLE#
@label=bitmap_bribe
 $DFAB DEFB $00,$00  ; {item_bitmap: BRIBE (16x13)
 $DFAD DEFB $00,$00
 $DFAF DEFB $03,$00
 $DFB1 DEFB $0F,$C0
 $DFB3 DEFB $3F,$30
 $DFB5 DEFB $4C,$FC
 $DFB7 DEFB $F3,$F2
 $DFB9 DEFB $3C,$CF
 $DFBB DEFB $0F,$3C
 $DFBD DEFB $03,$F0
 $DFBF DEFB $00,$C0
 $DFC1 DEFB $00,$00
 $DFC3 DEFB $00,$00  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DFC5-$DFE4-1-16{0,0,64,64}(item-radio) }
; TABLE#
@label=bitmap_radio
 $DFC5 DEFB $00,$10  ; {item_bitmap: RADIO (16x16)
 $DFC7 DEFB $00,$10
 $DFC9 DEFB $38,$10
 $DFCB DEFB $C6,$10
 $DFCD DEFB $37,$90
 $DFCF DEFB $CC,$50
 $DFD1 DEFB $F3,$50
 $DFD3 DEFB $CC,$EE
 $DFD5 DEFB $B7,$38
 $DFD7 DEFB $B6,$C6
 $DFD9 DEFB $CF,$36
 $DFDB DEFB $3E,$D6
 $DFDD DEFB $0F,$36
 $DFDF DEFB $03,$D6
 $DFE1 DEFB $00,$F6
 $DFE3 DEFB $00,$35  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$DFE5-$E004-1-16{0,0,64,64}(item-parcel) }
; TABLE#
@label=bitmap_parcel
 $DFE5 DEFB $00,$00  ; {item_bitmap: PARCEL (16x16)
 $DFE7 DEFB $03,$00
 $DFE9 DEFB $0E,$40
 $DFEB DEFB $39,$F0
 $DFED DEFB $E7,$E4
 $DFEF DEFB $1F,$9F
 $DFF1 DEFB $8E,$7C
 $DFF3 DEFB $B1,$F3
 $DFF5 DEFB $B8,$CF
 $DFF7 DEFB $BB,$37
 $DFF9 DEFB $BB,$73
 $DFFB DEFB $BB,$67
 $DFFD DEFB $BB,$77
 $DFFF DEFB $3B,$7C
 $E001 DEFB $0B,$70
 $E003 DEFB $03,$40  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$E005-$E01E-1-16{0,0,64,52}(item-mask-bribe) }
; TABLE#
@label=mask_bribe
 $E005 DEFB $FC,$FF  ; {item_mask: BRIBE (16x13)
 $E007 DEFB $F0,$3F
 $E009 DEFB $C0,$0F
 $E00B DEFB $80,$03
 $E00D DEFB $80,$00
 $E00F DEFB $00,$00
 $E011 DEFB $00,$00
 $E013 DEFB $00,$00
 $E015 DEFB $C0,$00
 $E017 DEFB $F0,$00
 $E019 DEFB $FC,$00
 $E01B DEFB $FF,$03
 $E01D DEFB $FF,$CF  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$E01F-$E03E-1-16{0,0,64,64}(item-mask-uniform) }
; TABLE#
@label=mask_uniform
 $E01F DEFB $F8,$0F  ; {item_mask: UNIFORM (16x16)
 $E021 DEFB $F0,$07
 $E023 DEFB $E0,$03
 $E025 DEFB $E0,$03
 $E027 DEFB $C0,$00
 $E029 DEFB $00,$00
 $E02B DEFB $00,$00
 $E02D DEFB $00,$00
 $E02F DEFB $00,$00
 $E031 DEFB $00,$00
 $E033 DEFB $00,$00
 $E035 DEFB $00,$00
 $E037 DEFB $00,$00
 $E039 DEFB $00,$03
 $E03B DEFB $C0,$0F
 $E03D DEFB $F0,$3F  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$E03F-$E05E-1-16{0,0,64,64}(item-mask-parcel) }
; TABLE#
@label=mask_parcel
 $E03F DEFB $FC,$FF  ; {item_mask: PARCEL (16x16)
 $E041 DEFB $F0,$3F
 $E043 DEFB $C0,$0F
 $E045 DEFB $00,$03
 $E047 DEFB $00,$00
 $E049 DEFB $00,$00
 $E04B DEFB $00,$00
 $E04D DEFB $00,$00
 $E04F DEFB $00,$00
 $E051 DEFB $00,$00
 $E053 DEFB $00,$00
 $E055 DEFB $00,$00
 $E057 DEFB $00,$00
 $E059 DEFB $00,$00
 $E05B DEFB $C0,$03
 $E05D DEFB $F0,$0F  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$E05F-$E07E-1-16{0,0,64,64}(item-mask-poison) }
; TABLE#
@label=mask_poison
 $E05F DEFB $FF,$7F  ; {item_mask: POISON (16x16)
 $E061 DEFB $FE,$3F
 $E063 DEFB $FE,$3F
 $E065 DEFB $FC,$1F
 $E067 DEFB $FC,$1F
 $E069 DEFB $FE,$3F
 $E06B DEFB $FC,$1F
 $E06D DEFB $F8,$0F
 $E06F DEFB $F0,$07
 $E071 DEFB $F0,$07
 $E073 DEFB $F0,$07
 $E075 DEFB $F0,$07
 $E077 DEFB $F0,$07
 $E079 DEFB $F0,$07
 $E07B DEFB $F0,$07
 $E07D DEFB $F8,$0F  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$E07F-$E096-1-16{0,0,64,48}(item-mask-torch) }
; TABLE#
@label=mask_torch
 $E07F DEFB $FF,$F7  ; {item_mask: TORCH (16x12)
 $E081 DEFB $FF,$C3
 $E083 DEFB $FD,$01
 $E085 DEFB $F0,$01
 $E087 DEFB $E0,$03
 $E089 DEFB $C0,$0F
 $E08B DEFB $C0,$1F
 $E08D DEFB $C0,$3F
 $E08F DEFB $C0,$3F
 $E091 DEFB $C0,$7F
 $E093 DEFB $E1,$FF
 $E095 DEFB $F3,$FF  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$E097-$E0B6-1-16{0,0,64,64}(item-mask-radio) }
; TABLE#
@label=mask_radio
 $E097 DEFB $FF,$C7  ; {item_mask: RADIO (16x16)
 $E099 DEFB $C7,$C7
 $E09B DEFB $01,$C7
 $E09D DEFB $00,$47
 $E09F DEFB $00,$07
 $E0A1 DEFB $00,$07
 $E0A3 DEFB $00,$01
 $E0A5 DEFB $00,$00
 $E0A7 DEFB $00,$01
 $E0A9 DEFB $00,$00
 $E0AB DEFB $00,$00
 $E0AD DEFB $00,$00
 $E0AF DEFB $C0,$00
 $E0B1 DEFB $F0,$00
 $E0B3 DEFB $FC,$00
 $E0B5 DEFB $FF,$01  ; }
; #UDGTABLE
; { #UDGARRAY2,7,4,2;$E0B7-$E0D6-1-16{0,0,64,64}(item-mask-food) }
; TABLE#
@label=mask_food
 $E0B7 DEFB $FF,$87  ; {item_mask: FOOD (16x16)
 $E0B9 DEFB $FF,$CF
 $E0BB DEFB $FF,$87
 $E0BD DEFB $F1,$87
 $E0BF DEFB $E0,$03
 $E0C1 DEFB $C0,$03
 $E0C3 DEFB $E0,$03
 $E0C5 DEFB $C0,$03
 $E0C7 DEFB $C0,$03
 $E0C9 DEFB $C0,$03
 $E0CB DEFB $C0,$07
 $E0CD DEFB $C0,$03
 $E0CF DEFB $E0,$07
 $E0D1 DEFB $F0,$03
 $E0D3 DEFB $F8,$03
 $E0D5 DEFB $FE,$07  ; }

; Unreferenced byte.
u$E0D7 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; {unused_E0D7
 $E0DF DEFB $00                             ; }

; Addresses of self-modified locations which are changed between NOPs and LD
; (HL),A.
;
; (<- setup_item_plotting, setup_vischar_plotting)
@label=masked_sprite_plotter_16_enables
w$E0E0 DEFW $E319    ; masked_sprite_plotter_16_wide_case_1_enable0
 $E0E2 DEFW $E3C5    ; masked_sprite_plotter_16_wide_case_2_enable1
 $E0E4 DEFW $E32A    ; masked_sprite_plotter_16_wide_case_1_enable2
 $E0E6 DEFW $E3D6    ; masked_sprite_plotter_16_wide_case_2_enable3
 $E0E8 DEFW $E340    ; masked_sprite_plotter_16_wide_case_1_enable4
 $E0EA DEFW $E3EC    ; masked_sprite_plotter_16_wide_case_2_enable5

; Addresses of self-modified locations which are changed between NOPs and LD
; (HL),A.
;
; (<- setup_vischar_plotting)
@label=masked_sprite_plotter_24_enables
w$E0EC DEFW $E188    ; masked_sprite_plotter_24_wide_enable0
 $E0EE DEFW $E259    ; masked_sprite_plotter_24_wide_enable1
 $E0F0 DEFW $E199    ; masked_sprite_plotter_24_wide_enable2
 $E0F2 DEFW $E26A    ; masked_sprite_plotter_24_wide_enable3
 $E0F4 DEFW $E1AA    ; masked_sprite_plotter_24_wide_enable4
 $E0F6 DEFW $E27B    ; masked_sprite_plotter_24_wide_enable5
 $E0F8 DEFW $E1BF    ; masked_sprite_plotter_24_wide_enable6
 $E0FA DEFW $E290    ; masked_sprite_plotter_24_wide_enable7
; These two look different. Unused?
 $E0FC DEFW $E2A2    ; masked_sprite_plotter_16_wide_vischar
 $E0FE DEFW $E102    ; masked_sprite_plotter_24_wide_vischar

; Unused word?
;
; Unsure if related to the above masked_sprite_plotter_24_enables table.
u$E100 DEFW $0806    ; unused_E100

; Sprite plotter for 24-pixel-wide sprites. Used for characters and objects.
;
; Used by the routine at #R$B866.
;
; I:IY Pointer to visible character.
@label=masked_sprite_plotter_24_wide_vischar
c$E102 LD A,(IY+$18) ; {if ((A = (IY[24] & 7)) >= 4) goto unaligned;
 $E105 AND $07       ;
 $E107 CP $04        ;
 $E109 JP NC,$E1CE   ; }
; Shift right?
 $E10C CPL           ; {A = (~A & 3) * 8; // jump table offset (on input, A is 0..3)
 $E10D AND $03       ;
 $E10F ADD A,A       ;
 $E110 ADD A,A       ;
 $E111 ADD A,A       ; }
 $E112 LD ($E161),A  ; ($E160 + 1) = A; // self-modify: jump into mask rotate
 $E115 LD ($E143),A  ; ($E142 + 1) = A; // self-modify: jump into bitmap rotate
 $E118 EXX           ; {maskptr = mask_pointer;
 $E119 LD HL,($81AE) ; }
 $E11C EXX           ; {bitmapptr = bitmap_pointer;
 $E11D LD HL,($81AC) ; }
@label=masked_sprite_plotter_24_wide_height_iters
 $E120 LD B,$20      ; iters = 32; // iterations // clipped_height & 0xFF // self modified
; Load bitmap bytes into B,C,E.
*$E122 PUSH BC       ; {do <% bm0 = *bitmapptr++; // bitmap bytes
 $E123 LD B,(HL)     ;
 $E124 INC HL        ; }
 $E125 LD C,(HL)     ; {  bm1 = *bitmapptr++;
 $E126 INC HL        ; }
 $E127 LD E,(HL)     ; {  bm2 = *bitmapptr++;
 $E128 INC HL        ;
 $E129 PUSH HL       ;
 $E12A EXX           ; }
; Load mask bytes into B',C',E'.
 $E12B LD B,(HL)     ; {  mask0 = *maskptr++; // mask bytes
 $E12C INC HL        ; }
 $E12D LD C,(HL)     ; {  mask1 = *maskptr++;
 $E12E INC HL        ; }
 $E12F LD E,(HL)     ; {  mask2 = *maskptr++;
 $E130 INC HL        ;
 $E131 PUSH HL       ; }
 $E132 LD A,($81B7)  ; {  if (flip_sprite & (1<<7)) flip_24_masked_pixels();
 $E135 AND A         ;
 $E136 CALL M,$E3FA  ; }
 $E139 LD HL,($81B0) ; {  foremaskptr = foreground_mask_pointer;
 $E13C EXX           ; }
@nowarn
 $E13D LD HL,($81A2) ;   screenptr = ($81A2); // moved compared to the other routines
; Shift bitmap.
 $E140 LD D,$00      ;   bm3 = 0;
@label=masked_sprite_plotter_24_wide_jump0
 $E142 JR $E144      ;   goto $E144; // self-modified // jump table
*$E144 SRL B         ;   SRL bm0 // 0 // carry = bm0 & 1; bm0 >>= 1;
 $E146 RR C          ;   RR bm1       // new_carry = bm1 & 1; bm1 = (bm1 >> 1) | (carry << 7); carry = new_carry;
 $E148 RR E          ;   RR bm2       // new_carry = bm2 & 1; bm2 = (bm2 >> 1) | (carry << 7); carry = new_carry;
 $E14A RR D          ;   RR bm3       // new_carry = bm3 & 1; bm3 = (bm3 >> 1) | (carry << 7); carry = new_carry;
 $E14C SRL B         ;   SRL bm0 // 1
 $E14E RR C          ;   RR bm1
 $E150 RR E          ;   RR bm2
 $E152 RR D          ;   RR bm3
 $E154 SRL B         ;   SRL bm0 // 2
 $E156 RR C          ;   RR bm1
 $E158 RR E          ;   RR bm2
 $E15A RR D          ; {  RR bm3
 $E15C EXX           ; }
; Shift mask.
 $E15D LD D,$FF      ;   mask3 = 0xFF;
 $E15F SCF           ;   carry = 1;
@label=masked_sprite_plotter_24_wide_jump1
 $E160 JR $E162      ;   goto $E162; // self-modified // jump table
*$E162 RR B          ;   RR mask0 // 0 // new_carry = mask0 & 1; mask0 = (mask0 >> 1) | (carry << 7); carry = new_carry;
 $E164 RR C          ;   RR mask1      // new_carry = mask1 & 1; mask1 = (mask1 >> 1) | (carry << 7); carry = new_carry;
 $E166 RR E          ;   RR mask2      // new_carry = mask2 & 1; mask2 = (mask2 >> 1) | (carry << 7); carry = new_carry;
 $E168 RR D          ;   RR mask3      // new_carry = mask3 & 1; mask3 = (mask3 >> 1) | (carry << 7); carry = new_carry;
 $E16A RR B          ;   RR mask0 // 1
 $E16C RR C          ;   RR mask1
 $E16E RR E          ;   RR mask2
 $E170 RR D          ;   RR mask3
 $E172 RR B          ;   RR mask0 // 2
 $E174 RR C          ;   RR mask1
 $E176 RR E          ;   RR mask2
 $E178 RR D          ;   RR mask3
;   Plot, using foreground mask.
 $E17A LD A,(HL)     ; {  A = ((~*foremaskptr | mask0) & *screenptr) | (bm0 & *foremaskptr);
 $E17B CPL           ;
 $E17C OR B          ;
 $E17D EXX           ;
 $E17E AND (HL)      ;
 $E17F EX AF,AF'     ;
 $E180 LD A,B        ;
 $E181 EXX           ;
 $E182 AND (HL)      ;
 $E183 LD B,A        ;
 $E184 EX AF,AF'     ;
 $E185 OR B          ; }
 $E186 INC L         ; {  foremaskptr++;
 $E187 EXX           ; }
@label=masked_sprite_plotter_24_wide_enable0
 $E188 LD (HL),A     ; {  *screenptr++ = A;          // enable/disable 0
 $E189 INC HL        ;
 $E18A EXX           ; }
 $E18B LD A,(HL)     ; {  A = ((~*foremaskptr | mask1) & *screenptr) | (bm1 & *foremaskptr);
 $E18C CPL           ;
 $E18D OR C          ;
 $E18E EXX
 $E18F AND (HL)      ;
 $E190 EX AF,AF'
 $E191 LD A,C        ;
 $E192 EXX
 $E193 AND (HL)      ;
 $E194 LD C,A        ;
 $E195 EX AF,AF'
 $E196 OR C          ; }
 $E197 INC L         ; {  foremaskptr++;
 $E198 EXX           ; }
@label=masked_sprite_plotter_24_wide_enable2
 $E199 LD (HL),A     ; {  *screenptr++ = A;          // enable/disable 2
 $E19A INC HL        ;
 $E19B EXX           ; }
 $E19C LD A,(HL)     ; {  A = ((~*foremaskptr | mask2) & *screenptr) | (bm2 & *foremaskptr);
 $E19D CPL           ;
 $E19E OR E          ;
 $E19F EXX
 $E1A0 AND (HL)      ;
 $E1A1 EX AF,AF'
 $E1A2 LD A,E        ;
 $E1A3 EXX
 $E1A4 AND (HL)      ;
 $E1A5 LD E,A        ;
 $E1A6 EX AF,AF'
 $E1A7 OR E          ; }
 $E1A8 INC L         ; {  foremaskptr++;
 $E1A9 EXX           ; }
@label=masked_sprite_plotter_24_wide_enable4
 $E1AA LD (HL),A     ; {  *screenptr++ = A;          // enable/disable 4
 $E1AB INC HL        ;
 $E1AC EXX           ; }
 $E1AD LD A,(HL)     ; {  A = ((~*foremaskptr | mask3) & *screenptr) | (bm3 & *foremaskptr);
 $E1AE CPL           ;
 $E1AF OR D          ;
 $E1B0 EXX
 $E1B1 AND (HL)      ;
 $E1B2 EX AF,AF'
 $E1B3 LD A,D        ;
 $E1B4 EXX
 $E1B5 AND (HL)      ;
 $E1B6 LD D,A        ;
 $E1B7 EX AF,AF'
 $E1B8 OR D          ; }
 $E1B9 INC L         ;   foremaskptr++;
 $E1BA LD ($81B0),HL ; {  foreground_mask_pointer = foremaskptr;
 $E1BD POP HL        ;
 $E1BE EXX           ; }
@label=masked_sprite_plotter_24_wide_enable6
 $E1BF LD (HL),A     ;   *screenptr = A;            // enable/disable 6
 $E1C0 LD BC,$0015   ; {  screenptr += 21; // stride (24 - 3)
 $E1C3 ADD HL,BC     ; }
@nowarn
 $E1C4 LD ($81A2),HL ; {  ($81A2) = screenptr;
 $E1C7 POP HL        ; }
 $E1C8 POP BC        ; {%> while (--iters);
 $E1C9 DEC B         ;
 $E1CA JP NZ,$E122   ; }
 $E1CD RET           ; return;
; Shift left?
@label=masked_sprite_plotter_24_wide_unaligned
*$E1CE SUB $04       ; unaligned: A -= 4;
 $E1D0 RLCA          ; RLCA
 $E1D1 RLCA          ; RLCA
 $E1D2 RLCA          ; RLCA
 $E1D3 LD ($E22A),A  ; ($E229 + 1) = A; // self-modify: jump into mask rotate
 $E1D6 LD ($E204),A  ; ($E203 + 1) = A; // self-modify: jump into bitmap rotate
 $E1D9 EXX           ; {HLdash = mask_pointer;
 $E1DA LD HL,($81AE) ; }
 $E1DD EXX           ; {HL = bitmap_pointer;
 $E1DE LD HL,($81AC) ; }
@label=masked_sprite_plotter_24_wide_unaligned_height_iters
 $E1E1 LD B,$20      ; B = 32; // iterations // clipped_height & 0xFF // self modified
; Load bitmap bytes into B,C,E.
*$E1E3 PUSH BC       ; do <%
 $E1E4 LD B,(HL)     ; {  B = *HL++;
 $E1E5 INC HL        ; }
 $E1E6 LD C,(HL)     ; {  C = *HL++;
 $E1E7 INC HL        ; }
 $E1E8 LD E,(HL)     ; {  E = *HL++;
 $E1E9 INC HL        ; }
 $E1EA PUSH HL
 $E1EB EXX
; Load mask bytes into B',C',E'.
 $E1EC LD B,(HL)     ; {  B = *HL++;
 $E1ED INC HL        ; }
 $E1EE LD C,(HL)     ; {  C = *HL++;
 $E1EF INC HL        ; }
 $E1F0 LD E,(HL)     ; {  E = *HL++;
 $E1F1 INC HL        ; }
 $E1F2 PUSH HL
 $E1F3 LD A,($81B7)  ; {  if (flip_sprite & (1<<7)) flip_24_masked_pixels();
 $E1F6 AND A         ;
 $E1F7 CALL M,$E3FA  ; }
 $E1FA LD HL,($81B0) ;   HL = foreground_mask_pointer;
 $E1FD EXX
@nowarn
 $E1FE LD HL,($81A2) ;   HL = ($81A2); // screen pointer
; Shift bitmap.
 $E201 LD D,$00      ;   D = 0;
@label=masked_sprite_plotter_24_wide_jump2
 $E203 JR $E205      ;   goto $E205; // self-modified to jump into ...;
*$E205 SLA E         ;   SLA E
 $E207 RL C          ;   RL C
 $E209 RL B          ;   RL B
 $E20B RL D          ;   RL D
 $E20D SLA E         ;   SLA E
 $E20F RL C          ;   RL C
 $E211 RL B          ;   RL B
 $E213 RL D          ;   RL D
 $E215 SLA E         ;   SLA E
 $E217 RL C          ;   RL C
 $E219 RL B          ;   RL B
 $E21B RL D          ;   RL D
 $E21D SLA E         ;   SLA E
 $E21F RL C          ;   RL C
 $E221 RL B          ;   RL B
 $E223 RL D          ;   RL D
 $E225 EXX
; Shift mask.
 $E226 LD D,$FF      ;   D = 255;
 $E228 SCF           ;   SCF
@label=masked_sprite_plotter_24_wide_jump3
 $E229 JR $E22B      ;   goto $E22B; // self-modified to jump into ...;
*$E22B RL E          ;   RL E
 $E22D RL C          ;   RL C
 $E22F RL B          ;   RL B
 $E231 RL D          ;   RL D
 $E233 RL E          ;   RL E
 $E235 RL C          ;   RL C
 $E237 RL B          ;   RL B
 $E239 RL D          ;   RL D
 $E23B RL E          ;   RL E
 $E23D RL C          ;   RL C
 $E23F RL B          ;   RL B
 $E241 RL D          ;   RL D
 $E243 RL E          ;   RL E
 $E245 RL C          ;   RL C
 $E247 RL B          ;   RL B
 $E249 RL D          ;   RL D
; Plot, using foreground mask.
 $E24B LD A,(HL)     ; {  A = ~*HL | D;       // 1
 $E24C CPL           ;
 $E24D OR D          ; }
 $E24E EXX
 $E24F AND (HL)      ;   A &= *HL;
 $E250 EX AF,AF'
 $E251 LD A,D        ;   A = D;
 $E252 EXX
 $E253 AND (HL)      ;   A &= *HL;
 $E254 LD D,A        ;   D = A;
 $E255 EX AF,AF'
 $E256 OR D          ;   A |= D;
 $E257 INC L         ;   L++;
 $E258 EXX
@label=masked_sprite_plotter_24_wide_enable1
 $E259 LD (HL),A     ; {  *HL++ = A;          // enable/disable 1
 $E25A INC HL        ; }
 $E25B EXX
 $E25C LD A,(HL)     ; {  A = ~*HL | B;       // 2
 $E25D CPL           ;
 $E25E OR B          ; }
 $E25F EXX
 $E260 AND (HL)      ;   A &= *HL;
 $E261 EX AF,AF'
 $E262 LD A,B        ;   A = B;
 $E263 EXX
 $E264 AND (HL)      ;   A &= *HL;
 $E265 LD B,A        ;   B = A;
 $E266 EX AF,AF'
 $E267 OR B          ;   A |= B;
 $E268 INC L         ;   L++;
 $E269 EXX
@label=masked_sprite_plotter_24_wide_enable3
 $E26A LD (HL),A     ; {  *HL++ = A;          // enable/disable 3
 $E26B INC HL        ; }
 $E26C EXX
 $E26D LD A,(HL)     ; {  A = ~*HL | C;       // 3
 $E26E CPL           ;
 $E26F OR C          ; }
 $E270 EXX
 $E271 AND (HL)      ;   A &= *HL;
 $E272 EX AF,AF'
 $E273 LD A,C        ;   A = C;
 $E274 EXX
 $E275 AND (HL)      ;   A &= *HL;
 $E276 LD C,A        ;   C = A;
 $E277 EX AF,AF'
 $E278 OR C          ;   A |= C;
 $E279 INC L         ;   L++;
 $E27A EXX
@label=masked_sprite_plotter_24_wide_enable5
 $E27B LD (HL),A     ; {  *HL++ = A;          // enable/disable 5
 $E27C INC HL        ; }
 $E27D EXX
 $E27E LD A,(HL)     ; {  A = ~*HL | E;       // 4
 $E27F CPL           ;
 $E280 OR E          ; }
 $E281 EXX
 $E282 AND (HL)      ;   A &= *HL;
 $E283 EX AF,AF'
 $E284 LD A,E        ;   A = E;
 $E285 EXX
 $E286 AND (HL)      ;   A &= *HL;
 $E287 LD E,A        ;   E = A;
 $E288 EX AF,AF'
 $E289 OR E          ;   A |= E;
 $E28A INC L         ;   L++;
 $E28B LD ($81B0),HL ;   foreground_mask_pointer = HL;
 $E28E POP HL
 $E28F EXX
@label=masked_sprite_plotter_24_wide_enable7
 $E290 LD (HL),A     ;   *HL = A;            // enable/disable 7
 $E291 LD BC,$0015   ; {  HL += 21;
 $E294 ADD HL,BC     ; }
@nowarn
 $E295 LD ($81A2),HL ;   ($81A2) = HL;
 $E298 POP HL
 $E299 POP BC
 $E29A DEC B         ; {%> while (--B);
 $E29B JP NZ,$E1E3   ; }
 $E29E RET           ; return;

; Entry point for masked_sprite_plotter_16_wide_left which assumes A == 0. (+
; no vischar passed).
;
; Used by the routine at #R$B866.
@label=masked_sprite_plotter_16_wide_item
c$E29F XOR A         ; A = 0;
 $E2A0 JR $E2AC      ; goto masked_sprite_plotter_16_wide_left;

; Sprite plotter. Used for characters and objects.
;
; Used by the routine at #R$B866.
; .
; Looks like it plots a two byte-wide sprite with mask into a three byte-wide
; destination.
;
; I:IY Pointer to visible character.
@label=masked_sprite_plotter_16_wide_vischar
c$E2A2 LD A,(IY+$18) ; {if ((A = IY[24] & 7) >= 4) goto masked_sprite_plotter_16_wide_right.
 $E2A5 AND $07       ;
 $E2A7 CP $04        ;
 $E2A9 JP NC,$E34E   ; }
; FALL THROUGH into masked_sprite_plotter_16_wide_left.

; Sprite plotter "left" case.
;
; Used by the routine at #R$E29F.
; .
; Shifts left/right (unsure which atm).
; .
; Shifts left/right (unsure which atm).
@label=masked_sprite_plotter_16_wide_left
c$E2AC CPL           ; {A = (~A & 3) * 6; // jump table offset
 $E2AD AND $03       ;
 $E2AF ADD A,A       ;
 $E2B0 LD H,A        ;
 $E2B1 ADD A,A       ;
 $E2B2 ADD A,H       ; }
 $E2B3 LD ($E2DC),A  ; ($E2DB + 1) = A; // self-modify: jump into mask rotate
 $E2B6 LD ($E2F4),A  ; ($E2F3 + 1) = A; // self-modify: jump into bitmap rotate
 $E2B9 EXX           ; {maskptr = mask_pointer; // maskptr = HL'  // observed: $D505 (a mask)
 $E2BA LD HL,($81AE) ;
 $E2BD EXX           ; }
 $E2BE LD HL,($81AC) ; bitmapptr = bitmap_pointer; // bitmapptr = HL  // observed: $D256 (a bitmap)
@label=masked_sprite_plotter_16_wide_case_1_height_iters
 $E2C1 LD B,$20      ; B = 32; // iterations // height? // self modified
; Load bitmap bytes into D,E.
*$E2C3 LD D,(HL)     ; {do <% bm0 = *bitmapptr++; // D
 $E2C4 INC HL        ; }
 $E2C5 LD E,(HL)     ; {  bm1 = *bitmapptr++; // E
 $E2C6 INC HL        ; }
; Load mask bytes into D',E'.
 $E2C7 PUSH HL       ; {  mask0 = *maskptr++; // D'
 $E2C8 EXX
 $E2C9 LD D,(HL)     ;
 $E2CA INC HL        ; }
 $E2CB LD E,(HL)     ; {  mask1 = *maskptr++; // E'
 $E2CC INC HL        ;
 $E2CD PUSH HL       ; }
 $E2CE LD A,($81B7)  ; {  if (flip_sprite & (1<<7)) flip_16_masked_pixels();
 $E2D1 AND A         ;
 $E2D2 CALL M,$E40F  ; }
 $E2D5 LD HL,($81B0) ;   foremaskptr = foreground_mask_pointer;  // observed: $8100 = mask_buffer
; Shift mask.
; .
; 24 version does bitmap rotates then mask rotates. Is this the opposite way
; around to save a bank switch?
 $E2D8 LD C,$FF      ;   mask2 = 0xFF; // all bits set => mask OFF (that would match the observed stored mask format)
 $E2DA SCF           ;   carry = 1; // mask OFF
@label=masked_sprite_plotter_16_wide_case_1_jump0
 $E2DB JR $E2DD      ;   goto $E2DD; // self modified // jump table
*$E2DD RR D          ;   RR mask0 // 0 // new_carry = mask0 & 1; mask0 = (mask0 >> 1) | (carry << 7); carry = new_carry;
 $E2DF RR E          ;   RR mask1      // new_carry = mask1 & 1; mask1 = (mask1 >> 1) | (carry << 7); carry = new_carry;
 $E2E1 RR C          ;   RR mask2      // new_carry = mask2 & 1; mask2 = (mask2 >> 1) | (carry << 7); carry = new_carry;
 $E2E3 RR D          ;   RR mask0 // 1
 $E2E5 RR E          ;   RR mask1
 $E2E7 RR C          ;   RR mask2
 $E2E9 RR D          ;   RR mask0 // 2
 $E2EB RR E          ;   RR mask1
 $E2ED RR C          ;   RR mask2
; Shift bitmap.
 $E2EF EXX           ; {  bm2 = 0; // all bits clear => pixels OFF
 $E2F0 LD C,$00      ; }
 $E2F2 AND A         ;   A &= A; // I do not grok this. Setting carry flag?
@label=masked_sprite_plotter_16_wide_case_1_jump1
 $E2F3 JR $E2F5      ;   goto $E2F5; // self modified // jump table
*$E2F5 SRL D         ;   SRL bm0 // 0 // carry = bm0 & 1; bm0 >>= 1;
 $E2F7 RR E          ;   RR bm1       // new_carry = bm1 & 1; bm1 = (bm1 >> 1) | (carry << 7); carry = new_carry;
 $E2F9 RR C          ;   RR bm2       // new_carry = bm2 & 1; bm2 = (bm2 >> 1) | (carry << 7); carry = new_carry;
 $E2FB SRL D         ;   SRL bm0 // 1
 $E2FD RR E          ;   RR bm1
 $E2FF RR C          ;   RR bm2
 $E301 SRL D         ;   SRL bm0 // 2
 $E303 RR E          ;   RR bm1
 $E305 RR C          ;   RR bm2
; Plot, using foreground mask.
@nowarn
 $E307 LD HL,($81A2) ;   screenptr = ($81A2);
 $E30A EXX           ; {  A = ((~*foremaskptr | mask0) & *screenptr) | (bm0 & *foremaskptr);
 $E30B LD A,(HL)     ;
 $E30C CPL           ;
 $E30D OR D          ;
 $E30E EXX
 $E30F AND (HL)      ;
 $E310 EX AF,AF'
 $E311 LD A,D        ;
 $E312 EXX
 $E313 AND (HL)      ;
 $E314 LD D,A        ;
 $E315 EX AF,AF'
 $E316 OR D          ; }
 $E317 INC L         ; {  foremaskptr++;
 $E318 EXX           ; }
@label=masked_sprite_plotter_16_wide_case_1_enable0
 $E319 LD (HL),A     ; {  *screenptr++ = A; // entry point jump0
 $E31A INC HL        ; }
 $E31B EXX           ; {  A = ((~*foremaskptr | mask1) & *screenptr) | (bm1 & *foremaskptr);
 $E31C LD A,(HL)     ;
 $E31D CPL           ;
 $E31E OR E          ;
 $E31F EXX
 $E320 AND (HL)      ;
 $E321 EX AF,AF'
 $E322 LD A,E        ;
 $E323 EXX
 $E324 AND (HL)      ;
 $E325 LD E,A        ;
 $E326 EX AF,AF'
 $E327 OR E          ; }
 $E328 INC L         ; {  foremaskptr++;
 $E329 EXX           ; }
@label=masked_sprite_plotter_16_wide_case_1_enable2
 $E32A LD (HL),A     ; {  *screenptr++ = A; // entry point jump2
 $E32B INC HL        ; }
 $E32C EXX           ; {  A = ((~*foremaskptr | mask2) & *screenptr) | (bm2 & *foremaskptr);
 $E32D LD A,(HL)     ;
 $E32E CPL           ;
 $E32F OR C          ;
 $E330 EXX
 $E331 AND (HL)      ;
 $E332 EX AF,AF'
 $E333 LD A,C        ;
 $E334 EXX
 $E335 AND (HL)      ;
 $E336 LD C,A        ;
 $E337 EX AF,AF'
 $E338 OR C          ; }
 $E339 INC L         ; {  foremaskptr += 2;
 $E33A INC L         ; }
 $E33B LD ($81B0),HL ; {  foreground_mask_pointer = foremaskptr;
 $E33E POP HL        ;
 $E33F EXX           ; }
@label=masked_sprite_plotter_16_wide_case_1_enable4
 $E340 LD (HL),A     ;   *screenptr = A; // entry point jump4
 $E341 LD DE,$0016   ; {  screenptr += 22; // stride (24 - 2)
 $E344 ADD HL,DE     ; }
@nowarn
 $E345 LD ($81A2),HL ;   ($81A2) = screenptr;
 $E348 POP HL        ; {%> while (--B);
 $E349 DEC B         ;
 $E34A JP NZ,$E2C3   ; }
 $E34D RET           ; return;

; Sprite plotter "right" case.
;
; Used by the routine at #R$E2A2.
; .
; Counterpart of above routine.
@label=masked_sprite_plotter_16_wide_right
c$E34E SUB $04       ; {A = (A - 4) * 6; // jump table offset
 $E350 ADD A,A       ;
 $E351 LD L,A        ;
 $E352 ADD A,A       ;
 $E353 ADD A,L       ; }
 $E354 LD ($E39A),A  ; ($E399 + 1) = A; // self-modify - first jump
 $E357 LD ($E37D),A  ; ($E37C + 1) = A; // self-modify - second jump
 $E35A EXX           ; {maskptr = mask_pointer;
 $E35B LD HL,($81AE) ; }
 $E35E EXX           ; {bitmapptr = bitmap_pointer;
 $E35F LD HL,($81AC) ; }
@label=masked_sprite_plotter_16_wide_case_2_height_iters
 $E362 LD B,$20      ; B = 32; // iterations // height? // self modified
*$E364 LD D,(HL)     ; {do <% bm1 = *bitmapptr++; // numbering of the masks ... unsure
 $E365 INC HL        ; }
 $E366 LD E,(HL)     ; {  bm2 = *bitmapptr++;
 $E367 INC HL        ; }
 $E368 PUSH HL       ; {  mask1 = *maskptr++;
 $E369 EXX
 $E36A LD D,(HL)     ;
 $E36B INC HL        ; }
 $E36C LD E,(HL)     ; {  mask2 = *maskptr++;
 $E36D INC HL        ; }
 $E36E PUSH HL       ; {  if (flip_sprite & (1<<7)) flip_16_masked_pixels();
 $E36F LD A,($81B7)  ;
 $E372 AND A         ;
 $E373 CALL M,$E40F  ; }
 $E376 LD HL,($81B0) ;   foremaskptr = foreground_mask_pointer;
;   Shift mask.
 $E379 LD C,$FF      ;   mask0 = 0xFF; // all bits set => mask OFF (that would match the observed stored mask format)
 $E37B SCF           ;   carry = 1; // mask OFF
@label=masked_sprite_plotter_16_wide_case_2_jump0
 $E37C JR $E37E      ;   goto $E37E; // self modified // jump table
*$E37E RL E          ;   RL mask2 // 0 // new_carry = mask2 >> 7; mask2 = (mask2 << 1) | (carry << 0); carry = new_carry;
 $E380 RL D          ;   RL mask1      // new_carry = mask1 >> 7; mask1 = (mask1 << 1) | (carry << 0); carry = new_carry;
 $E382 RL C          ;   RL mask0      // new_carry = mask0 >> 7; mask0 = (mask0 << 1) | (carry << 0); carry = new_carry;
 $E384 RL E          ;   RL mask2 // 1
 $E386 RL D          ;   RL mask1
 $E388 RL C          ;   RL mask0
 $E38A RL E          ;   RL mask2 // 2
 $E38C RL D          ;   RL mask1
 $E38E RL C          ;   RL mask0
 $E390 RL E          ;   RL mask2 // 3 // four groups of shifting in this routine, compared to three above.
 $E392 RL D          ;   RL mask1
 $E394 RL C          ;   RL mask0
; Shift bitmap.
 $E396 EXX           ; {  bm0 = 0; // all bits clear => pixels OFF
 $E397 XOR A         ;
 $E398 LD C,A        ; }
@label=masked_sprite_plotter_16_wide_case_2_jump1
 $E399 JR $E39B      ;   goto $E39B; // self modified // jump table
*$E39B SLA E         ;   SLA bm2 // 0 // carry = bm2 >> 7; bm2 <<= 1;
 $E39D RL D          ;   RL bm1       // new_carry = bm1 >> 7; bm1 = (bm1 << 1) | (carry << 0); carry = new_carry;
 $E39F RL C          ;   RL bm0       // new_carry = bm0 >> 7; bm0 = (bm0 << 1) | (carry << 0); carry = new_carry;
 $E3A1 SLA E         ;   SLA bm2
 $E3A3 RL D          ;   RL bm1
 $E3A5 RL C          ;   RL bm0
 $E3A7 SLA E         ;   SLA bm2
 $E3A9 RL D          ;   RL bm1
 $E3AB RL C          ;   RL bm0
 $E3AD SLA E         ;   SLA bm2
 $E3AF RL D          ;   RL bm1
 $E3B1 RL C          ;   RL bm0
; Plot, using foreground mask.
@nowarn
 $E3B3 LD HL,($81A2) ;   screenptr = ($81A2);
 $E3B6 EXX           ; {  A = ((~*foremaskptr | mask0) & *screenptr) | (bm0 & *foremaskptr);
 $E3B7 LD A,(HL)     ;
 $E3B8 CPL           ;
 $E3B9 OR C          ;
 $E3BA EXX
 $E3BB AND (HL)      ;
 $E3BC EX AF,AF'
 $E3BD LD A,C        ;
 $E3BE EXX
 $E3BF AND (HL)      ;
 $E3C0 LD C,A        ;
 $E3C1 EX AF,AF'
 $E3C2 OR C          ; }
 $E3C3 INC L         ; {  foremaskptr++;
 $E3C4 EXX           ; }
@label=masked_sprite_plotter_16_wide_case_2_enable1
 $E3C5 LD (HL),A     ; {  *screenptr++ = A; // entry point jump1
 $E3C6 INC HL        ; }
 $E3C7 EXX           ; {  A = ((~*foremaskptr | mask1) & *screenptr) | (bm1 & *foremaskptr);
 $E3C8 LD A,(HL)     ;
 $E3C9 CPL           ;
 $E3CA OR D          ;
 $E3CB EXX
 $E3CC AND (HL)      ;
 $E3CD EX AF,AF'
 $E3CE LD A,D        ;
 $E3CF EXX
 $E3D0 AND (HL)      ;
 $E3D1 LD D,A        ;
 $E3D2 EX AF,AF'
 $E3D3 OR D          ; }
 $E3D4 INC L         ; {  foremaskptr++;
 $E3D5 EXX           ; }
@label=masked_sprite_plotter_16_wide_case_2_enable3
 $E3D6 LD (HL),A     ; {  *screenptr++ = A; // entry point jump3
 $E3D7 INC HL        ; }
 $E3D8 EXX           ; {  A = ((~*foremaskptr | mask2) & *screenptr) | (bm2 & *foremaskptr);
 $E3D9 LD A,(HL)     ;
 $E3DA CPL           ;
 $E3DB OR E          ;
 $E3DC EXX
 $E3DD AND (HL)      ;
 $E3DE EX AF,AF'
 $E3DF LD A,E        ;
 $E3E0 EXX
 $E3E1 AND (HL)      ;
 $E3E2 LD E,A        ;
 $E3E3 EX AF,AF'
 $E3E4 OR E          ; }
 $E3E5 INC L         ; {  foremaskptr += 2;
 $E3E6 INC L         ; }
 $E3E7 LD ($81B0),HL ; {  foreground_mask_pointer = foremaskptr;
 $E3EA POP HL        ;
 $E3EB EXX           ; }
@label=masked_sprite_plotter_16_wide_case_2_enable5
 $E3EC LD (HL),A     ;   *screenptr = A; // entry point jump5
 $E3ED LD DE,$0016   ; {  screenptr += 22; // stride (24 - 2)
 $E3F0 ADD HL,DE     ; }
@nowarn
 $E3F1 LD ($81A2),HL ;   ($81A2) = screenptr;
 $E3F4 POP HL        ; {%> while (--B);
 $E3F5 DEC B         ;
 $E3F6 JP NZ,$E364   ; }
 $E3F9 RET           ; return;

; Reverses the 24 pixels in E,C,B and E',C',B'.
;
; Used by the routine at #R$E102.
;
; I:E  First 8 pixels.
; I:BC Second 16 pixels.
; O:E  Reversed pixels.
; O:BC Reversed pixels.
;
; Reverse the bitmap bytes.
@label=flip_24_masked_pixels
c$E3FA LD H,$7F      ; H = 0x7F;  // HL = 0x7F00 | (DE & 0x00FF); // 0x7F00 -> table of bit reversed bytes
 $E3FC LD L,E        ; L = E;
 $E3FD LD E,B        ; E = B;     // DE = (DE & 0xFF00) | (BC >> 8);
 $E3FE LD B,(HL)     ; B = *HL;   // BC = (*HL << 8) | (BC & 0xFF);
 $E3FF LD L,E        ; L = E;     // HL = (HL & 0xFF00) | (DE & 0xFF);
 $E400 LD E,(HL)     ; E = *HL;   // DE = (DE & 0xFF00) | *HL;
 $E401 LD L,C        ; L = C;     // HL = (HL & 0xFF00) | (BC & 0xFF);
 $E402 LD C,(HL)     ; C = *HL;   // BC = (BC & 0xFF00) | *HL;
 $E403 EXX
; Reverse the mask bytes.
 $E404 LD H,$7F      ; Hdash = 0x7F;
 $E406 LD L,E        ; Ldash = Edash;
 $E407 LD E,B        ; Edash = Bdash;
 $E408 LD B,(HL)     ; Bdash = *HLdash;
 $E409 LD L,E        ; Ldash = Edash;
 $E40A LD E,(HL)     ; Edash = *HLdash;
 $E40B LD L,C        ; Ldash = Cdash;
 $E40C LD C,(HL)     ; Cdash = *HLdash;
 $E40D EXX
 $E40E RET           ; return;

; Reverses the 16 pixels in D,E and D',E'.
;
; Used by the routines at #R$E2AC and #R$E34E.
;
; I:DE 16 pixels to reverse.
; O:DE Reversed pixels.
;
; Reverse the bitmap bytes.
@label=flip_16_masked_pixels
c$E40F LD H,$7F      ; H = 0x7F;  // HL = 0x7F00 | (DE >> 8); // 0x7F00 -> table of bit reversed bytes
 $E411 LD L,D        ; L = D;
 $E412 LD D,E        ; D = E;     // DE = (E << 8) | *HL;
 $E413 LD E,(HL)     ; E = *HL;
 $E414 LD L,D        ; L = D;     // HL = (HL & 0xFF00) | (DE >> 8);
 $E415 LD D,(HL)     ; D = *HL;   // DE = (*HL << 8) | (DE & 0x00FF);
 $E416 EXX
; Reverse the mask bytes.
 $E417 LD H,$7F      ; Hdash = 0x7F;
 $E419 LD L,D        ; Ldash = Ddash;
 $E41A LD D,E        ; Ddash = Edash;
 $E41B LD E,(HL)     ; Edash = *HLdash;
 $E41C LD L,D        ; Ldash = Ddash;
 $E41D LD D,(HL)     ; Ddash = *HLdash;
 $E41E EXX
 $E41F RET           ; return;

; Set up vischar plotting.
;
; Used by the routine at #R$B866.
;
; I:HL Pointer to ? // observed: always the same as IY
; I:IY Pointer to visible character.
@label=setup_vischar_plotting
c$E420 LD A,$0F      ; {HL += 15;
 $E422 ADD A,L       ;
 $E423 LD L,A        ; }
 $E424 LD DE,$81B2   ; DE = &tinypos_stash_x;
 $E427 LD A,($68A0)  ; {if (room_index) <%
 $E42A AND A         ;
 $E42B JR Z,$E438    ; }
; Indoors.
 $E42D LDI           ;   *DE++ = *HL++;
 $E42F INC L         ;   HL++;
 $E430 LDI           ;   *DE++ = *HL++;
 $E432 INC L         ;   HL++;
 $E433 LDI           ;   *DE++ = *HL++;
 $E435 INC L         ;   HL++; %>
 $E436 JR $E44E      ; else <%
; Outdoors.
*$E438 LD A,(HL)     ; {  A = *HL++;
 $E439 INC L         ; }
 $E43A LD C,(HL)     ;   C = *HL;
 $E43B CALL $E550    ;   divide_by_8_with_rounding(C,A);
 $E43E LD (DE),A     ;   *DE++ = A;
 $E43F INC L         ; {  HL++;
 $E440 INC DE        ; }
 $E441 LD B,$02      ;   B = 2; // 2 iterations
*$E443 LD A,(HL)     ; {  do <% A = *HL++;
 $E444 INC L         ; }
 $E445 LD C,(HL)     ;     C = *HL;
 $E446 CALL $E555    ;     divide_by_8(C,A);
 $E449 LD (DE),A     ;     *DE++ = A;
 $E44A INC L         ; {    HL++;
 $E44B INC DE        ; }
 $E44C DJNZ $E443    ;   %> while (--B); %>
*$E44E LD C,(HL)     ; {C = *HL++;
 $E44F INC L         ; }
 $E450 LD B,(HL)     ; B = *HL++;
 $E451 PUSH BC
 $E452 INC L
 $E453 LD A,(HL)     ; {flip_sprite = *HL++; // set left/right flip flag / sprite offset
 $E454 LD ($81B7),A  ; }
 $E457 EX AF,AF'
 $E458 INC L
 $E459 LD B,$02      ; B = 2; // 2 iterations
*$E45B LD A,(HL)     ; {do <% Adash = *HL++;
 $E45C INC L         ; }
 $E45D LD C,(HL)     ;   C = *HL++;
 $E45E CALL $E555    ;   divide_by_8(C,Adash);
 $E461 LD (DE),A     ; {  *DE++ = Adash;
 $E462 INC L         ;
 $E463 INC DE        ; }
 $E464 DJNZ $E45B    ; %> while (--B);
 $E466 EX AF,AF'
 $E467 POP DE
 $E468 ADD A,A       ; {DE += A * 6;
 $E469 LD C,A        ;
 $E46A ADD A,A       ;
 $E46B ADD A,C       ;
 $E46C ADD A,E       ;
 $E46D LD E,A        ;
 $E46E JR NC,$E471   ;
 $E470 INC D         ; }
*$E471 INC L         ; {L += 2;
 $E472 INC L         ; }
 $E473 EX DE,HL
 $E474 LDI           ; *DE++ = *HL++; // width in bytes
 $E476 LDI           ; *DE++ = *HL++; // height in rows
 $E478 LD DE,$81AC   ; {memcpy(bitmap_pointer, HL, 4); // copy bitmap pointer and mask pointer
 $E47B LD BC,$0004   ;
 $E47E LDIR          ; }
 $E480 CALL $BAF7    ; vischar_visible();
 $E483 AND A         ; {if (A) return; /* invisible */
 $E484 RET NZ        ; }
 $E485 PUSH BC
 $E486 PUSH DE
 $E487 LD A,(IY+$1E) ; A = IY[30];
 $E48A CP $03        ; {if (A == 3) <% // 3 => 16 wide (4 => 24 wide)
 $E48C JR NZ,$E49C   ; }
 $E48E LD A,E        ; {  ($E2C1 + 1) = E; // self modify masked_sprite_plotter_16_wide_left
 $E48F LD ($E2C2),A  ; }
 $E492 LD ($E363),A  ;   ($E362 + 1) = E; // self-modify masked_sprite_plotter_16_wide_right
 $E495 LD A,$03      ;   A = 3;
 $E497 LD HL,$E0E0   ;   HL = masked_sprite_plotter_16_enables; %>
 $E49A JR $E4A8      ; else <%
*$E49C LD A,E
 $E49D LD ($E121),A  ;   ($E120 + 1) = E; // self-modify masked_sprite_plotter_24_wide_vischar (shift right case)
 $E4A0 LD ($E1E2),A  ;   ($E1E1 + 1) = E; // self-modify masked_sprite_plotter_24_wide_vischar (shift left case)
 $E4A3 LD A,$04      ;   A = 4;
 $E4A5 LD HL,$E0EC   ;   HL = masked_sprite_plotter_24_enables; %>
*$E4A8 PUSH HL
 $E4A9 LD ($E4C0),A  ; ($E4BF + 1) = A; // self-modify
 $E4AC LD E,A        ; E = A;
 $E4AD LD A,B        ; A = B;
 $E4AE AND A         ; {if (A == 0) <%
 $E4AF JR NZ,$E4B7   ; }
 $E4B1 LD A,$77      ;   A = 0x77; /* opcode of 'LD (HL),A' */
 $E4B3 EX AF,AF'
 $E4B4 LD A,C        ;   Adash = C; %>
 $E4B5 JR $E4BB      ; else <%
*$E4B7 XOR A         ;   A = 0; /* opcode of 'LD (HL),A' */
 $E4B8 EX AF,AF'
 $E4B9 LD A,E        ; {  Adash = E - C; %>
 $E4BA SUB C         ; }
*$E4BB EXX
 $E4BC POP HL        ; POP HLdash
 $E4BD LD C,A        ; Cdash = Adash;
 $E4BE EX AF,AF'
; Set the addresses in the jump table to NOP or LD (HL),A.
@label=setup_vischar_plotting_enables_iters
 $E4BF LD B,$03      ; Bdash = 3; // 3 iterations // self modified by $E4A9
*$E4C1 LD E,(HL)     ; {do <% Edash = *HLdash++;
 $E4C2 INC HL        ; }
 $E4C3 LD D,(HL)     ;   Ddash = *HLdash++;
 $E4C4 LD (DE),A     ; {  *DEdash = A;
 $E4C5 INC HL        ; }
 $E4C6 LD E,(HL)     ; {  Edash = *HLdash++;
 $E4C7 INC HL        ; }
 $E4C8 LD D,(HL)     ; {  Ddash = *HLdash++;
 $E4C9 INC HL        ; }
 $E4CA LD (DE),A     ;   *DEdash = A;
 $E4CB DEC C         ;   Cdash--;
 $E4CC JR NZ,$E4D0   ; {  if (Z) A ^= 0x77; /* Toggle between LD and NOP. */
 $E4CE XOR $77       ; }
*$E4D0 DJNZ $E4C1    ; %> while (--Bdash);
 $E4D2 EXX
 $E4D3 LD A,D        ; A = D;
 $E4D4 AND A         ; A &= A;
 $E4D5 LD DE,$0000   ; DE = 0;
 $E4D8 JR NZ,$E4F5   ; if (Z) <%
 $E4DA LD A,($81BC)  ; {  HL = $81BC * 8; // &map_position + 1;
 $E4DD LD L,A        ;
 $E4DE LD H,$00      ;
 $E4E0 ADD HL,HL     ;
 $E4E1 ADD HL,HL     ;
 $E4E2 ADD HL,HL     ; }
 $E4E3 EX DE,HL
 $E4E4 LD L,(IY+$1A) ;   L = IY[26];
 $E4E7 LD H,(IY+$1B) ;   H = IY[27];
 $E4EA AND A         ;   A &= A;
 $E4EB SBC HL,DE     ;
 $E4ED ADD HL,HL     ; {  HL *= 24;
 $E4EE ADD HL,HL     ;
 $E4EF ADD HL,HL     ;
 $E4F0 LD E,L        ;
 $E4F1 LD D,H        ;
 $E4F2 ADD HL,HL     ;
 $E4F3 ADD HL,DE     ; }
 $E4F4 EX DE,HL      ; %>
*$E4F5 LD A,($81B5)  ; {HL = screenpos_x - (map_position & 0xFF); // ie. low byte of map_position // signed subtract + extend to 16-bit
 $E4F8 LD HL,$81BB   ;
 $E4FB SUB (HL)      ;
 $E4FC LD L,A        ;
 $E4FD LD H,$00      ; }
 $E4FF JR NC,$E503   ; {if (HL < 0) H = 0xFF;
 $E501 LD H,$FF      ; }
*$E503 ADD HL,DE     ; {HL += DE + 0xF290; // screen buffer start address
 $E504 LD DE,$F290   ;
 $E507 ADD HL,DE     ; }
@nowarn
 $E508 LD ($81A2),HL ; ($81A2) = HL;
@nowarn
 $E50B LD HL,$8100   ; HL = mask_buffer;
 $E50E POP DE
 $E50F PUSH DE
 $E510 LD A,D        ; {L += D * 4 + (IY[26] & 7) * 4;
 $E511 ADD A,A       ;
 $E512 ADD A,A       ;
 $E513 ADD A,L       ;
 $E514 LD L,A        ;
 $E515 LD A,(IY+$1A) ;
 $E518 AND $07       ;
 $E51A ADD A,A       ;
 $E51B ADD A,A       ;
 $E51C ADD A,L       ;
 $E51D LD L,A        ; }
 $E51E LD ($81B0),HL ; foreground_mask_pointer = HL;
 $E521 POP DE
 $E522 LD A,D        ; A = D;
 $E523 AND A         ; {if (A) <%
 $E524 JR Z,$E531    ; }
; Generic multiply loop.
 $E526 LD D,A        ;   D = A;
 $E527 XOR A         ;   A = 0;
 $E528 LD E,(IY+$1E) ; {  E = IY[30] - 1;
 $E52B DEC E         ; }
; D ends up as zero either way.
*$E52C ADD A,E       ; {  do <% A += E; %> while (--D); %>
 $E52D DEC D         ;
 $E52E JP NZ,$E52C   ; }
*$E531 LD E,A        ; E = A;
 $E532 LD HL,($81AC) ; {bitmap_pointer += DE;
 $E535 ADD HL,DE     ;
 $E536 LD ($81AC),HL ; }
 $E539 LD HL,($81AE) ; {mask_pointer += DE;
 $E53C ADD HL,DE     ;
 $E53D LD ($81AE),HL ; }
 $E540 POP BC
 $E541 RET           ; return; /* visible */

; Scale down a pos_t and assign result to a tinypos_t.
;
; Used by the routines at #R$7BB5, #R$9F21, #R$C5D3, #R$C918 and #R$CC37.
; .
; Divides the three input 16-bit words by 8, with rounding to nearest, storing
; the result as bytes.
;
; I:HL Pointer to input words.
; I:DE Pointer to output bytes.
; O:HL Updated.
; O:DE Updated.
@label=pos_to_tinypos
c$E542 LD B,$03      ; B = 3;
*$E544 LD A,(HL)     ; {do <% A = *HL++;
 $E545 INC L         ; }
 $E546 LD C,(HL)     ;   C = *HL++;
 $E547 CALL $E550    ;   divide_by_8_with_rounding(C,A);
 $E54A LD (DE),A     ; {  *DE++ = A;
 $E54B INC L         ;
 $E54C INC DE        ; }
 $E54D DJNZ $E544    ; %> while (--B);
 $E54F RET           ; return;

; Divide AC by 8, with rounding to nearest.
;
; Used by the routines at #R$7BF2, #R$C47E, #R$E420 and #R$E542.
;
; I:A Low.
; I:C High.
; O:A Result.
@label=divide_by_8_with_rounding
c$E550 ADD A,$04     ; A += 4;
 $E552 JR NC,$E555   ; {if (carry) C++;
 $E554 INC C         ; }
; FALL THROUGH into divide_by_8.

; Divide AC by 8.
;
; Used by the routines at #R$B2FC, #R$C47E, #R$E420 and #R$E550.
@label=divide_by_8
c$E555 SRL C         ; {A = (A >> 3) | (C << 5); C >>= 3;
 $E557 RRA           ;
 $E558 SRL C         ;
 $E55A RRA           ;
 $E55B SRL C         ;
 $E55D RRA           ; }
 $E55E RET           ; return;

; Masks
;
; Mask encoding: A top-bit-set byte indicates a repetition, the count of which
; is in the bottom seven bits. The subsequent byte is the value to repeat.
; .
; { byte count+flags; ... }
@label=masks
@label=exterior_mask_0
b$E55F DEFB $2A,$A0,$00,$05,$07,$08,$09,$01 ; {exterior_mask_0
 $E567 DEFB $0A,$A2,$00,$05,$06,$04,$85,$01
 $E56F DEFB $0B,$9F,$00,$05,$06,$04,$88,$01
 $E577 DEFB $0C,$9C,$00,$05,$06,$04,$8A,$01
 $E57F DEFB $0D,$0E,$99,$00,$05,$06,$04,$8D
 $E587 DEFB $01,$0F,$10,$96,$00,$05,$06,$04
 $E58F DEFB $90,$01,$11,$94,$00,$05,$06,$04
 $E597 DEFB $92,$01,$12,$92,$00,$05,$06,$04
 $E59F DEFB $94,$01,$12,$90,$00,$05,$06,$04
 $E5A7 DEFB $96,$01,$12,$8E,$00,$05,$06,$04
 $E5AF DEFB $98,$01,$12,$8C,$00,$05,$06,$04
 $E5B7 DEFB $9A,$01,$12,$8A,$00,$05,$06,$04
 $E5BF DEFB $9C,$01,$12,$88,$00,$05,$06,$04
 $E5C7 DEFB $9E,$01,$18,$86,$00,$05,$06,$04
 $E5CF DEFB $A1,$01,$84,$00,$05,$06,$04,$A3
 $E5D7 DEFB $01,$00,$00,$05,$06,$04,$A5,$01
 $E5DF DEFB $05,$03,$04,$A7,$01,$02,$A9,$01
 $E5E7 DEFB $02,$A9,$01,$02,$A9,$01,$02,$A9
 $E5EF DEFB $01,$02,$A9,$01,$02,$A9,$01,$02
 $E5F7 DEFB $A9,$01,$02,$A9,$01,$02,$A9,$01 ; }
@label=exterior_mask_1
 $E5FF DEFB $12,$02,$91,$01,$02,$91,$01,$02 ; {exterior_mask_1
 $E607 DEFB $91,$01,$02,$91,$01,$02,$91,$01
 $E60F DEFB $02,$91,$01,$02,$91,$01,$02,$91
 $E617 DEFB $01,$02,$91,$01,$02,$91,$01     ; }
@label=exterior_mask_2
 $E61E DEFB $10,$13,$14,$15,$8D,$00,$16,$17 ; {exterior_mask_2
 $E626 DEFB $18,$17,$15,$8B,$00,$19,$1A,$1B
 $E62E DEFB $17,$18,$17,$15,$89,$00,$19,$1A
 $E636 DEFB $1C,$1A,$1B,$17,$18,$17,$15,$87
 $E63E DEFB $00,$19,$1A,$1C,$1A,$1C,$1A,$1B
 $E646 DEFB $17,$13,$14,$15,$85,$00,$19,$1A
 $E64E DEFB $1C,$1A,$1C,$1A,$1C,$1D,$16,$17
 $E656 DEFB $18,$17,$15,$83,$00,$19,$1A,$1C
 $E65E DEFB $1A,$1C,$1A,$1C,$1D,$19,$1A,$1B
 $E666 DEFB $17,$18,$17,$15,$00,$19,$1A,$1C
 $E66E DEFB $1A,$1C,$1A,$1C,$1D,$19,$1A,$1C
 $E676 DEFB $1A,$1B,$17,$18,$17,$00,$20,$1C
 $E67E DEFB $1A,$1C,$1A,$1C,$1D,$19,$1A,$1C
 $E686 DEFB $1A,$1C,$1A,$1B,$17,$83,$00,$20
 $E68E DEFB $1C,$1A,$1C,$1D,$19,$1A,$1C,$1A
 $E696 DEFB $1C,$1A,$1C,$1D,$85,$00,$20,$1C
 $E69E DEFB $1D,$19,$1A,$1C,$1A,$1C,$1A,$1C
 $E6A6 DEFB $1D,$87,$00,$1F,$19,$1A,$1C,$1A
 $E6AE DEFB $1C,$1A,$1C,$1D,$89,$00,$20,$1C
 $E6B6 DEFB $1A,$1C,$1A,$1C,$1D,$8B,$00,$20
 $E6BE DEFB $1C,$1A,$1C,$1D,$8D,$00,$20,$1C
 $E6C6 DEFB $1D,$8F,$00,$1F                 ; }
@label=exterior_mask_3
 $E6CA DEFB $1A,$88,$00,$05,$4C,$90,$00,$86 ; {exterior_mask_3
 $E6D2 DEFB $00,$05,$06,$04,$32,$30,$4C,$8E
 $E6DA DEFB $00,$84,$00,$05,$06,$04,$84,$01
 $E6E2 DEFB $32,$30,$4C,$8C,$00,$00,$00,$05
 $E6EA DEFB $06,$04,$88,$01,$32,$30,$4C,$8A
 $E6F2 DEFB $00,$00,$06,$04,$8C,$01,$32,$30
 $E6FA DEFB $4C,$88,$00,$02,$90,$01,$32,$30
 $E702 DEFB $4C,$86,$00,$02,$92,$01,$32,$30
 $E70A DEFB $4C,$84,$00,$02,$94,$01,$32,$30
 $E712 DEFB $4C,$00,$00,$02,$96,$01,$32,$30
 $E71A DEFB $00,$02,$98,$01,$12,$02,$98,$01
 $E722 DEFB $12,$02,$98,$01,$12,$02,$98,$01
 $E72A DEFB $12,$02,$98,$01,$12,$02,$98,$01
 $E732 DEFB $12,$02,$98,$01,$12,$02,$98,$01
 $E73A DEFB $12,$02,$98,$01,$12,$02,$98,$01
 $E742 DEFB $12,$02,$98,$01,$12,$02,$98,$01
 $E74A DEFB $12                             ; }
@label=exterior_mask_4
 $E74B DEFB $0D,$02,$8C,$01,$02,$8C,$01,$02 ; {exterior_mask_4
 $E753 DEFB $8C,$01,$02,$8C,$01             ; }
@label=exterior_mask_5
 $E758 DEFB $0E,$02,$8C,$01,$12,$02,$8C,$01 ; {exterior_mask_5
 $E760 DEFB $12,$02,$8C,$01,$12,$02,$8C,$01
 $E768 DEFB $12,$02,$8C,$01,$12,$02,$8C,$01
 $E770 DEFB $12,$02,$8C,$01,$12,$02,$8C,$01
 $E778 DEFB $12,$02,$8D,$01,$02,$8D,$01     ; }
@label=exterior_mask_6
 $E77F DEFB $08,$5B,$5A,$86,$00,$01,$01,$5B ; {exterior_mask_6
 $E787 DEFB $5A,$84,$00,$84,$01,$5B,$5A,$00
 $E78F DEFB $00,$86,$01,$5B,$5A,$D8,$01     ; }
@label=exterior_mask_7
 $E796 DEFB $09,$88,$01,$12,$88,$01,$12,$88 ; {exterior_mask_7
 $E79E DEFB $01,$12,$88,$01,$12,$88,$01,$12
 $E7A6 DEFB $88,$01,$12,$88,$01,$12,$88,$01
 $E7AE DEFB $12                             ; }
@label=exterior_mask_8
 $E7AF DEFB $10,$8D,$00,$23,$24,$25,$8B,$00 ; {exterior_mask_8
 $E7B7 DEFB $23,$26,$27,$26,$28,$89,$00,$23
 $E7BF DEFB $26,$27,$26,$22,$29,$2A,$87,$00
 $E7C7 DEFB $23,$26,$27,$26,$22,$29,$2B,$29
 $E7CF DEFB $2A,$85,$00,$23,$24,$25,$26,$22
 $E7D7 DEFB $29,$2B,$29,$2B,$29,$2A,$83,$00
 $E7DF DEFB $23,$26,$27,$26,$28,$2F,$2B,$29
 $E7E7 DEFB $2B,$29,$2B,$29,$2A,$00,$23,$26
 $E7EF DEFB $27,$26,$22,$29,$2A,$2F,$2B,$29
 $E7F7 DEFB $2B,$29,$2B,$29,$2A,$26,$27,$26
 $E7FF DEFB $22,$29,$2B,$29,$2A,$2F,$2B,$29
 $E807 DEFB $2B,$29,$2B,$29,$2A,$26,$22,$29
 $E80F DEFB $2B,$29,$2B,$29,$2A,$2F,$2B,$29
 $E817 DEFB $2B,$29,$2B,$31,$2D,$2F,$2B,$29
 $E81F DEFB $2B,$29,$2B,$29,$2A,$2F,$2B,$29
 $E827 DEFB $2B,$31,$83,$00,$2F,$2B,$29,$2B
 $E82F DEFB $29,$2B,$29,$2A,$2F,$2B,$31,$85
 $E837 DEFB $00,$2F,$2B,$29,$2B,$29,$2B,$29
 $E83F DEFB $2A,$2E,$87,$00,$2F,$2B,$29,$2B
 $E847 DEFB $29,$2B,$31,$2D,$88,$00,$2F,$2B
 $E84F DEFB $29,$2B,$31,$8B,$00,$2F,$2B,$31
 $E857 DEFB $8D,$00,$2E,$8F,$00             ; }
@label=exterior_mask_9
 $E85C DEFB $0A,$83,$00,$05,$06,$30,$4C,$83 ; {exterior_mask_9
 $E864 DEFB $00,$00,$05,$06,$04,$01,$01,$32
 $E86C DEFB $30,$4C,$00,$34,$04,$86,$01,$32
 $E874 DEFB $33,$83,$00,$40,$01,$01,$3F,$83
 $E87C DEFB $00,$02,$46,$47,$48,$49,$42,$41
 $E884 DEFB $45,$44,$12,$34,$01,$01,$46,$4B
 $E88C DEFB $43,$44,$01,$01,$33,$00,$3C,$3E
 $E894 DEFB $40,$01,$01,$3F,$37,$39,$00,$83
 $E89C DEFB $00,$3D,$3A,$3B,$38,$83,$00     ; }
@label=exterior_mask_10
 $E8A3 DEFB $08,$35,$86,$01,$36,$90,$01,$88 ; {exterior_mask_10
 $E8AB DEFB $00,$3C,$86,$00,$39,$3C,$00,$02
 $E8B3 DEFB $36,$35,$12,$00,$39,$3C,$00,$02
 $E8BB DEFB $01,$01,$12,$00,$39,$3C,$00,$02
 $E8C3 DEFB $01,$01,$12,$00,$39,$3C,$00,$02
 $E8CB DEFB $01,$01,$12,$00,$39,$3C,$00,$02
 $E8D3 DEFB $01,$01,$12,$00,$39,$3C,$00,$02
 $E8DB DEFB $01,$01,$12,$00,$39,$3C,$00,$02
 $E8E3 DEFB $01,$01,$12,$00,$39,$3C,$00,$02
 $E8EB DEFB $01,$01,$12,$00,$39             ; }
@label=exterior_mask_11
 $E8F0 DEFB $08,$01,$4F,$86,$00,$01,$50,$01 ; {exterior_mask_11
 $E8F8 DEFB $4F,$84,$00,$01,$00,$00,$51,$01
 $E900 DEFB $4F,$00,$00,$01,$00,$00,$53,$19
 $E908 DEFB $50,$01,$4F,$01,$00,$00,$53,$19
 $E910 DEFB $00,$00,$52,$01,$00,$00,$53,$19
 $E918 DEFB $00,$00,$52,$01,$54,$00,$53,$19
 $E920 DEFB $00,$00,$52,$83,$00,$55,$19,$00
 $E928 DEFB $00,$52,$85,$00,$54,$00,$52     ; }
@label=exterior_mask_12
 $E92F DEFB $02,$56,$57,$56,$57,$58,$59,$58 ; {exterior_mask_12
 $E937 DEFB $59,$58,$59,$58,$59,$58,$59,$58
 $E93F DEFB $59                             ; }
@label=exterior_mask_13
 $E940 DEFB $05,$00,$00,$23,$24,$25,$02,$00 ; {exterior_mask_13
 $E948 DEFB $27,$26,$28,$02,$00,$22,$26,$28
 $E950 DEFB $02,$00,$2B,$29,$2A,$02,$00,$2B
 $E958 DEFB $29,$2A,$02,$00,$2B,$29,$2A,$02
 $E960 DEFB $00,$2B,$29,$2A,$02,$00,$2B,$29
 $E968 DEFB $2A,$02,$00,$2B,$31,$00,$02,$00
 $E970 DEFB $83,$00                         ; }
@label=exterior_mask_14
 $E972 DEFB $04,$19,$83,$00,$19,$17,$15,$00 ; {exterior_mask_14
 $E97A DEFB $19,$17,$18,$17,$19,$1A,$1B,$17
 $E982 DEFB $19,$1A,$1C,$1D,$19,$1A,$1C,$1D
 $E98A DEFB $19,$1A,$1C,$1D,$19,$1A,$1C,$1D
 $E992 DEFB $19,$1A,$1C,$1D,$00,$20,$1C,$1D ; }
@label=interior_mask_15
 $E99A DEFB $02,$04,$32,$01,$01             ; interior_mask_15
@label=interior_mask_16
 $E99F DEFB $09,$86,$00,$5D,$5C,$54,$84,$00 ; {interior_mask_16
 $E9A7 DEFB $5D,$5C,$01,$01,$01,$00,$00,$5D
 $E9AF DEFB $5C,$85,$01,$5D,$5C,$87,$01,$2B
 $E9B7 DEFB $88,$01                         ; }
@label=interior_mask_17
 $E9B9 DEFB $05,$00,$00,$5D,$5C,$67,$5D,$5C ; {interior_mask_17
 $E9C1 DEFB $83,$01,$3C,$84,$01             ; }
@label=interior_mask_18
 $E9C6 DEFB $02,$5D,$68,$3C,$69             ; interior_mask_18
@label=interior_mask_19
 $E9CB DEFB $0A,$86,$00,$5D,$5C,$46,$47,$84 ; {interior_mask_19
 $E9D3 DEFB $00,$5D,$5C,$83,$01,$39,$00,$00
 $E9DB DEFB $5D,$5C,$86,$01,$5D,$5C,$88,$01
 $E9E3 DEFB $4A,$89,$01                     ; }
@label=interior_mask_20
 $E9E6 DEFB $06,$5D,$5C,$01,$47,$6A,$00,$4A ; {interior_mask_20
 $E9EE DEFB $84,$01,$6B,$00,$84,$01,$5F     ; }
@label=interior_mask_21
 $E9F5 DEFB $04,$05,$4C,$00,$00,$61,$65,$66 ; {interior_mask_21
 $E9FD DEFB $4C,$61,$12,$02,$60,$61,$12,$02
 $EA05 DEFB $60,$61,$12,$02,$60,$61,$12,$02
 $EA0D DEFB $60                             ; }
@label=interior_mask_22
 $EA0E DEFB $04,$00,$00,$05,$4C,$05,$63,$64 ; {interior_mask_22
 $EA16 DEFB $60,$61,$12,$02,$60,$61,$12,$02
 $EA1E DEFB $60,$61,$12,$02,$60,$61,$12,$02
 $EA26 DEFB $60,$61,$12,$62,$00             ; }
@label=interior_mask_23
 $EA2B DEFB $03,$00,$6C,$00,$02,$01,$68,$02 ; {interior_mask_23
 $EA33 DEFB $01,$69                         ; }
@label=interior_mask_24
 $EA35 DEFB $05,$01,$5E,$4C,$00,$00,$01,$01 ; {interior_mask_24
 $EA3D DEFB $32,$30,$00,$84,$01,$5F         ; }
@label=interior_mask_25
 $EA43 DEFB $02,$6E,$5A,$6D,$39,$3C,$39     ; interior_mask_25
@label=interior_mask_26
 $EA4A DEFB $04,$5D,$5C,$46,$47,$4A,$01,$01 ; {interior_mask_26
 $EA52 DEFB $39                             ; }
@label=interior_mask_27
 $EA53 DEFB $03,$2C,$47,$00,$00,$61,$12,$00 ; {interior_mask_27
 $EA5B DEFB $61,$12                         ; }
@label=interior_mask_28
 $EA5D DEFB $03,$00,$45,$1E,$02,$60,$00,$02 ; {interior_mask_28
 $EA65 DEFB $60,$00                         ; }
@label=interior_mask_29
 $EA67 DEFB $05,$45,$1E,$2C,$47,$00,$2C,$47 ; {interior_mask_29
 $EA6F DEFB $45,$1E,$12,$00,$61,$12,$61,$12
 $EA77 DEFB $00,$61,$5F,$00,$00             ; }

; Interior masking data.
;
; Used only by setup_room.
; .
; 47 mask structs with the constant final height byte omitted.
; .
; Copied to $81DB by setup_room.
@label=interior_mask_data_source
b$EA7C DEFB $1B,$7B,$7F,$F1,$F3,$36,$28 ; $1B, { $7B, $7F, $F1, $F3 }, { $36, $28 }
 $EA83 DEFB $1B,$77,$7B,$F3,$F5,$36,$18 ; $1B, { $77, $7B, $F3, $F5 }, { $36, $18 }
 $EA8A DEFB $1B,$7C,$80,$F1,$F3,$32,$2A ; $1B, { $7C, $80, $F1, $F3 }, { $32, $2A }
 $EA91 DEFB $19,$83,$86,$F2,$F7,$18,$24 ; $19, { $83, $86, $F2, $F7 }, { $18, $24 }
 $EA98 DEFB $19,$81,$84,$F4,$F9,$18,$1A ; $19, { $81, $84, $F4, $F9 }, { $18, $1A }
 $EA9F DEFB $19,$81,$84,$F3,$F8,$1C,$17 ; $19, { $81, $84, $F3, $F8 }, { $1C, $17 }
 $EAA6 DEFB $19,$83,$86,$F4,$F8,$16,$20 ; $19, { $83, $86, $F4, $F8 }, { $16, $20 }
 $EAAD DEFB $18,$7D,$80,$F4,$F9,$18,$1A ; $18, { $7D, $80, $F4, $F9 }, { $18, $1A }
 $EAB4 DEFB $18,$7B,$7E,$F3,$F8,$22,$1A ; $18, { $7B, $7E, $F3, $F8 }, { $22, $1A }
 $EABB DEFB $18,$79,$7C,$F4,$F9,$22,$10 ; $18, { $79, $7C, $F4, $F9 }, { $22, $10 }
 $EAC2 DEFB $18,$7B,$7E,$F4,$F9,$1C,$17 ; $18, { $7B, $7E, $F4, $F9 }, { $1C, $17 }
 $EAC9 DEFB $18,$79,$7C,$F1,$F6,$2C,$1E ; $18, { $79, $7C, $F1, $F6 }, { $2C, $1E }
 $EAD0 DEFB $18,$7D,$80,$F2,$F7,$24,$22 ; $18, { $7D, $80, $F2, $F7 }, { $24, $22 }
 $EAD7 DEFB $1D,$7F,$82,$F6,$F7,$1C,$1E ; $1D, { $7F, $82, $F6, $F7 }, { $1C, $1E }
 $EADE DEFB $1D,$82,$85,$F2,$F3,$23,$30 ; $1D, { $82, $85, $F2, $F3 }, { $23, $30 }
 $EAE5 DEFB $1D,$86,$89,$F2,$F3,$1C,$37 ; $1D, { $86, $89, $F2, $F3 }, { $1C, $37 }
 $EAEC DEFB $1D,$86,$89,$F4,$F5,$18,$30 ; $1D, { $86, $89, $F4, $F5 }, { $18, $30 }
 $EAF3 DEFB $1D,$80,$83,$F1,$F2,$28,$30 ; $1D, { $80, $83, $F1, $F2 }, { $28, $30 }
 $EAFA DEFB $1C,$81,$82,$F4,$F6,$1C,$20 ; $1C, { $81, $82, $F4, $F6 }, { $1C, $20 }
 $EB01 DEFB $1C,$83,$84,$F4,$F6,$1C,$2E ; $1C, { $83, $84, $F4, $F6 }, { $1C, $2E }
 $EB08 DEFB $1A,$7E,$80,$F5,$F7,$1C,$20 ; $1A, { $7E, $80, $F5, $F7 }, { $1C, $20 }
 $EB0F DEFB $12,$7A,$7B,$F2,$F3,$3A,$28 ; $12, { $7A, $7B, $F2, $F3 }, { $3A, $28 }
 $EB16 DEFB $12,$7A,$7B,$EF,$F0,$45,$35 ; $12, { $7A, $7B, $EF, $F0 }, { $45, $35 }
 $EB1D DEFB $17,$80,$85,$F4,$F6,$1C,$24 ; $17, { $80, $85, $F4, $F6 }, { $1C, $24 }
 $EB24 DEFB $14,$80,$84,$F3,$F5,$26,$28 ; $14, { $80, $84, $F3, $F5 }, { $26, $28 }
 $EB2B DEFB $15,$84,$85,$F6,$F7,$1A,$1E ; $15, { $84, $85, $F6, $F7 }, { $1A, $1E }
 $EB32 DEFB $15,$7E,$7F,$F3,$F4,$2E,$26 ; $15, { $7E, $7F, $F3, $F4 }, { $2E, $26 }
 $EB39 DEFB $16,$7C,$85,$EF,$F3,$32,$22 ; $16, { $7C, $85, $EF, $F3 }, { $32, $22 }
 $EB40 DEFB $16,$79,$82,$F0,$F4,$34,$1A ; $16, { $79, $82, $F0, $F4 }, { $34, $1A }
 $EB47 DEFB $16,$7D,$86,$F2,$F6,$24,$1A ; $16, { $7D, $86, $F2, $F6 }, { $24, $1A }
 $EB4E DEFB $10,$76,$78,$F5,$F7,$36,$0A ; $10, { $76, $78, $F5, $F7 }, { $36, $0A }
 $EB55 DEFB $10,$7A,$7C,$F3,$F5,$36,$0A ; $10, { $7A, $7C, $F3, $F5 }, { $36, $0A }
 $EB5C DEFB $10,$7E,$80,$F1,$F3,$36,$0A ; $10, { $7E, $80, $F1, $F3 }, { $36, $0A }
 $EB63 DEFB $10,$82,$84,$EF,$F1,$36,$0A ; $10, { $82, $84, $EF, $F1 }, { $36, $0A }
 $EB6A DEFB $10,$86,$88,$ED,$EF,$36,$0A ; $10, { $86, $88, $ED, $EF }, { $36, $0A }
 $EB71 DEFB $10,$8A,$8C,$EB,$ED,$36,$0A ; $10, { $8A, $8C, $EB, $ED }, { $36, $0A }
 $EB78 DEFB $11,$73,$75,$EB,$ED,$0A,$30 ; $11, { $73, $75, $EB, $ED }, { $0A, $30 }
 $EB7F DEFB $11,$77,$79,$ED,$EF,$0A,$30 ; $11, { $77, $79, $ED, $EF }, { $0A, $30 }
 $EB86 DEFB $11,$7B,$7D,$EF,$F1,$0A,$30 ; $11, { $7B, $7D, $EF, $F1 }, { $0A, $30 }
 $EB8D DEFB $11,$7F,$81,$F1,$F3,$0A,$30 ; $11, { $7F, $81, $F1, $F3 }, { $0A, $30 }
 $EB94 DEFB $11,$83,$85,$F3,$F5,$0A,$30 ; $11, { $83, $85, $F3, $F5 }, { $0A, $30 }
 $EB9B DEFB $11,$87,$89,$F5,$F7,$0A,$30 ; $11, { $87, $89, $F5, $F7 }, { $0A, $30 }
 $EBA2 DEFB $10,$84,$86,$F4,$F7,$0A,$30 ; $10, { $84, $86, $F4, $F7 }, { $0A, $30 }
 $EBA9 DEFB $11,$87,$89,$ED,$EF,$0A,$30 ; $11, { $87, $89, $ED, $EF }, { $0A, $30 }
 $EBB0 DEFB $11,$7B,$7D,$F3,$F5,$0A,$0A ; $11, { $7B, $7D, $F3, $F5 }, { $0A, $0A }
 $EBB7 DEFB $11,$79,$7B,$F4,$F6,$0A,$0A ; $11, { $79, $7B, $F4, $F6 }, { $0A, $0A }
 $EBBE DEFB $0F,$88,$8C,$F5,$F8,$0A,$0A ; $0F, { $88, $8C, $F5, $F8 }, { $0A, $0A }

; Pointers to run-length encoded mask data.
;
; 30 pointers to byte arrays.
@label=mask_pointers
w$EBC5 DEFW $E55F
 $EBC7 DEFW $E5FF
 $EBC9 DEFW $E61E
 $EBCB DEFW $E6CA
 $EBCD DEFW $E74B
 $EBCF DEFW $E758
 $EBD1 DEFW $E77F
 $EBD3 DEFW $E796
 $EBD5 DEFW $E7AF
 $EBD7 DEFW $E85C
 $EBD9 DEFW $E8A3
 $EBDB DEFW $E8F0
 $EBDD DEFW $E940
 $EBDF DEFW $E972
 $EBE1 DEFW $E92F
 $EBE3 DEFW $EA67
 $EBE5 DEFW $EA53
 $EBE7 DEFW $EA5D
 $EBE9 DEFW $E99A
 $EBEB DEFW $E99F
 $EBED DEFW $E9B9
 $EBEF DEFW $E9C6
 $EBF1 DEFW $E9CB
 $EBF3 DEFW $E9E6
 $EBF5 DEFW $E9F5
 $EBF7 DEFW $EA0E
 $EBF9 DEFW $EA2B
 $EBFB DEFW $EA35
 $EBFD DEFW $EA43
 $EBFF DEFW $EA4A

; mask_t structs for the exterior scene.
;
; 58 mask_t structs.
; .
; Used by render_mask_buffer. Used in outdoor mode only.
@label=exterior_mask_data
b$EC01 DEFB $00,$47,$70,$27,$3F,$6A,$52,$0C
 $EC09 DEFB $00,$5F,$88,$33,$4B,$5E,$52,$0C
 $EC11 DEFB $00,$77,$A0,$3F,$57,$52,$52,$0C
 $EC19 DEFB $01,$9F,$B0,$28,$31,$3E,$6A,$3C
 $EC21 DEFB $01,$9F,$B0,$32,$3B,$3E,$6A,$3C
 $EC29 DEFB $02,$40,$4F,$4C,$5B,$46,$46,$08
 $EC31 DEFB $02,$50,$5F,$54,$63,$46,$46,$08
 $EC39 DEFB $02,$60,$6F,$5C,$6B,$46,$46,$08
 $EC41 DEFB $02,$70,$7F,$64,$73,$46,$46,$08
 $EC49 DEFB $02,$30,$3F,$54,$63,$3E,$3E,$08
 $EC51 DEFB $02,$40,$4F,$5C,$6B,$3E,$3E,$08
 $EC59 DEFB $02,$50,$5F,$64,$73,$3E,$3E,$08
 $EC61 DEFB $02,$60,$6F,$6C,$7B,$3E,$3E,$08
 $EC69 DEFB $02,$70,$7F,$74,$83,$3E,$3E,$08
 $EC71 DEFB $02,$10,$1F,$64,$73,$4A,$2E,$08
 $EC79 DEFB $02,$20,$2F,$6C,$7B,$4A,$2E,$08
 $EC81 DEFB $02,$30,$3F,$74,$83,$4A,$2E,$08
 $EC89 DEFB $03,$2B,$44,$33,$47,$67,$45,$12
 $EC91 DEFB $04,$2B,$37,$48,$4B,$6D,$45,$08
 $EC99 DEFB $05,$37,$44,$48,$51,$67,$45,$08
 $ECA1 DEFB $06,$08,$0F,$2A,$3C,$6E,$46,$0A
 $ECA9 DEFB $06,$10,$17,$2E,$40,$6E,$46,$0A
 $ECB1 DEFB $06,$18,$1F,$32,$44,$6E,$46,$0A
 $ECB9 DEFB $06,$20,$27,$36,$48,$6E,$46,$0A
 $ECC1 DEFB $06,$28,$2F,$3A,$4C,$6E,$46,$0A
 $ECC9 DEFB $07,$08,$10,$1F,$26,$82,$46,$12
 $ECD1 DEFB $07,$08,$10,$27,$2D,$82,$46,$12
 $ECD9 DEFB $08,$80,$8F,$64,$73,$46,$46,$08
 $ECE1 DEFB $08,$90,$9F,$5C,$6B,$46,$46,$08
 $ECE9 DEFB $08,$A0,$B0,$54,$63,$46,$46,$08
 $ECF1 DEFB $08,$B0,$BF,$4C,$5B,$46,$46,$08
 $ECF9 DEFB $08,$C0,$CF,$44,$53,$46,$46,$08
 $ED01 DEFB $08,$80,$8F,$74,$83,$3E,$3E,$08
 $ED09 DEFB $08,$90,$9F,$6C,$7B,$3E,$3E,$08
 $ED11 DEFB $08,$A0,$B0,$64,$73,$3E,$3E,$08
 $ED19 DEFB $08,$B0,$BF,$5C,$6B,$3E,$3E,$08
 $ED21 DEFB $08,$C0,$CF,$54,$63,$3E,$3E,$08
 $ED29 DEFB $08,$D0,$DF,$4C,$5B,$3E,$3E,$08
 $ED31 DEFB $08,$40,$4F,$74,$83,$4E,$2E,$08
 $ED39 DEFB $08,$50,$5F,$6C,$7B,$4E,$2E,$08
 $ED41 DEFB $08,$10,$1F,$58,$67,$68,$2E,$08
 $ED49 DEFB $08,$20,$2F,$50,$5F,$68,$2E,$08
 $ED51 DEFB $08,$30,$3F,$48,$57,$68,$2E,$08
 $ED59 DEFB $09,$1B,$24,$4E,$55,$68,$37,$0F
 $ED61 DEFB $0A,$1C,$23,$51,$5D,$68,$38,$0A
 $ED69 DEFB $09,$3B,$44,$72,$79,$4E,$2D,$0F
 $ED71 DEFB $0A,$3C,$43,$75,$81,$4E,$2E,$0A
 $ED79 DEFB $09,$7B,$84,$62,$69,$46,$45,$0F
 $ED81 DEFB $0A,$7C,$83,$65,$71,$46,$46,$0A
 $ED89 DEFB $09,$AB,$B4,$4A,$51,$46,$5D,$0F
 $ED91 DEFB $0A,$AC,$B3,$4D,$59,$46,$5E,$0A
 $ED99 DEFB $0B,$58,$5F,$5A,$62,$46,$46,$08
 $EDA1 DEFB $0B,$48,$4F,$62,$6A,$3E,$3E,$08
 $EDA9 DEFB $0C,$0B,$0F,$60,$67,$68,$2E,$08
 $EDB1 DEFB $0D,$0C,$0F,$61,$6A,$4E,$2E,$08
 $EDB9 DEFB $0E,$7F,$80,$7C,$83,$3E,$3E,$08
 $EDC1 DEFB $0D,$2C,$2F,$51,$5A,$3E,$3E,$08
 $EDC9 DEFB $0D,$3C,$3F,$49,$52,$46,$46,$08

; Saved stack pointer.
;
; Used by plot_game_window and wipe_game_window.
@label=saved_sp
g$EDD1 DEFW $0000    ; saved_sp

; Game screen start addresses.
;
; 128 screen pointers.
@label=game_window_start_addresses
w$EDD3 DEFW $4047
 $EDD5 DEFW $4147
 $EDD7 DEFW $4247
 $EDD9 DEFW $4347
 $EDDB DEFW $4447
 $EDDD DEFW $4547
 $EDDF DEFW $4647
 $EDE1 DEFW $4747
 $EDE3 DEFW $4067
 $EDE5 DEFW $4167
 $EDE7 DEFW $4267
 $EDE9 DEFW $4367
 $EDEB DEFW $4467
 $EDED DEFW $4567
 $EDEF DEFW $4667
 $EDF1 DEFW $4767
 $EDF3 DEFW $4087
 $EDF5 DEFW $4187
 $EDF7 DEFW $4287
 $EDF9 DEFW $4387
 $EDFB DEFW $4487
 $EDFD DEFW $4587
 $EDFF DEFW $4687
 $EE01 DEFW $4787
 $EE03 DEFW $40A7
 $EE05 DEFW $41A7
 $EE07 DEFW $42A7
 $EE09 DEFW $43A7
 $EE0B DEFW $44A7
 $EE0D DEFW $45A7
 $EE0F DEFW $46A7
 $EE11 DEFW $47A7
 $EE13 DEFW $40C7
 $EE15 DEFW $41C7
 $EE17 DEFW $42C7
 $EE19 DEFW $43C7
 $EE1B DEFW $44C7
 $EE1D DEFW $45C7
 $EE1F DEFW $46C7
 $EE21 DEFW $47C7
 $EE23 DEFW $40E7
 $EE25 DEFW $41E7
 $EE27 DEFW $42E7
 $EE29 DEFW $43E7
 $EE2B DEFW $44E7
 $EE2D DEFW $45E7
 $EE2F DEFW $46E7
 $EE31 DEFW $47E7
 $EE33 DEFW $4807
 $EE35 DEFW $4907
 $EE37 DEFW $4A07
 $EE39 DEFW $4B07
 $EE3B DEFW $4C07
 $EE3D DEFW $4D07
 $EE3F DEFW $4E07
 $EE41 DEFW $4F07
 $EE43 DEFW $4827
 $EE45 DEFW $4927
 $EE47 DEFW $4A27
 $EE49 DEFW $4B27
 $EE4B DEFW $4C27
 $EE4D DEFW $4D27
 $EE4F DEFW $4E27
 $EE51 DEFW $4F27
 $EE53 DEFW $4847
 $EE55 DEFW $4947
 $EE57 DEFW $4A47
 $EE59 DEFW $4B47
 $EE5B DEFW $4C47
 $EE5D DEFW $4D47
 $EE5F DEFW $4E47
 $EE61 DEFW $4F47
 $EE63 DEFW $4867
 $EE65 DEFW $4967
 $EE67 DEFW $4A67
 $EE69 DEFW $4B67
 $EE6B DEFW $4C67
 $EE6D DEFW $4D67
 $EE6F DEFW $4E67
 $EE71 DEFW $4F67
 $EE73 DEFW $4887
 $EE75 DEFW $4987
 $EE77 DEFW $4A87
 $EE79 DEFW $4B87
 $EE7B DEFW $4C87
 $EE7D DEFW $4D87
 $EE7F DEFW $4E87
 $EE81 DEFW $4F87
 $EE83 DEFW $48A7
 $EE85 DEFW $49A7
 $EE87 DEFW $4AA7
 $EE89 DEFW $4BA7
 $EE8B DEFW $4CA7
 $EE8D DEFW $4DA7
 $EE8F DEFW $4EA7
 $EE91 DEFW $4FA7
 $EE93 DEFW $48C7
 $EE95 DEFW $49C7
 $EE97 DEFW $4AC7
 $EE99 DEFW $4BC7
 $EE9B DEFW $4CC7
 $EE9D DEFW $4DC7
 $EE9F DEFW $4EC7
 $EEA1 DEFW $4FC7
 $EEA3 DEFW $48E7
 $EEA5 DEFW $49E7
 $EEA7 DEFW $4AE7
 $EEA9 DEFW $4BE7
 $EEAB DEFW $4CE7
 $EEAD DEFW $4DE7
 $EEAF DEFW $4EE7
 $EEB1 DEFW $4FE7
 $EEB3 DEFW $5007
 $EEB5 DEFW $5107
 $EEB7 DEFW $5207
 $EEB9 DEFW $5307
 $EEBB DEFW $5407
 $EEBD DEFW $5507
 $EEBF DEFW $5607
 $EEC1 DEFW $5707
 $EEC3 DEFW $5027
 $EEC5 DEFW $5127
 $EEC7 DEFW $5227
 $EEC9 DEFW $5327
 $EECB DEFW $5427
 $EECD DEFW $5527
 $EECF DEFW $5627
 $EED1 DEFW $5727

; Plot the game screen.
;
; Used by the routines at #R$9D7B and #R$A50B.
@label=plot_game_window
c$EED3 LD ($EDD1),SP ; saved_sp = SP;
 $EED7 LD A,($A7C8)  ; A = *(&game_window_offset + 1);
 $EEDA AND A         ; {if (A) goto unaligned;
 $EEDB JP NZ,$EF27   ; }
@nowarn
 $EEDE LD HL,$F291   ; {HL = $F291 + game_window_offset;
 $EEE1 LD A,($A7C7)  ;
 $EEE4 ADD A,L       ;
 $EEE5 JR NC,$EEE8   ;
 $EEE7 INC H         ;
*$EEE8 LD L,A        ; }
 $EEE9 LD SP,$EDD3   ; SP = game_window_start_addresses;
 $EEEC LD A,$80      ; A = 128; // 128 rows
*$EEEE POP DE        ; do <% DE = *SP++; // output address
 $EEEF LDI           ;   *DE++ = *HL++; /* unrolled: 23 copies */
 $EEF1 LDI           ;   *DE++ = *HL++;
 $EEF3 LDI           ;   *DE++ = *HL++;
 $EEF5 LDI           ;   *DE++ = *HL++;
 $EEF7 LDI           ;   *DE++ = *HL++;
 $EEF9 LDI           ;   *DE++ = *HL++;
 $EEFB LDI           ;   *DE++ = *HL++;
 $EEFD LDI           ;   *DE++ = *HL++;
 $EEFF LDI           ;   *DE++ = *HL++;
 $EF01 LDI           ;   *DE++ = *HL++;
 $EF03 LDI           ;   *DE++ = *HL++;
 $EF05 LDI           ;   *DE++ = *HL++;
 $EF07 LDI           ;   *DE++ = *HL++;
 $EF09 LDI           ;   *DE++ = *HL++;
 $EF0B LDI           ;   *DE++ = *HL++;
 $EF0D LDI           ;   *DE++ = *HL++;
 $EF0F LDI           ;   *DE++ = *HL++;
 $EF11 LDI           ;   *DE++ = *HL++;
 $EF13 LDI           ;   *DE++ = *HL++;
 $EF15 LDI           ;   *DE++ = *HL++;
 $EF17 LDI           ;   *DE++ = *HL++;
 $EF19 LDI           ;   *DE++ = *HL++;
 $EF1B LDI           ;   *DE++ = *HL++;
 $EF1D INC HL        ;   HL++; // skip 24th
 $EF1E DEC A         ; {%> while (--A);
 $EF1F JP NZ,$EEEE   ; }
 $EF22 LD SP,($EDD1) ; SP = saved_sp;
 $EF26 RET           ; return;
*$EF27 LD HL,$F290   ; {unaligned: HL = $F290 + game_window_offset; // screen buffer start address
 $EF2A LD A,($A7C7)  ;
 $EF2D ADD A,L       ;
 $EF2E JR NC,$EF31   ;
 $EF30 INC H         ;
*$EF31 LD L,A        ; }
 $EF32 LD A,(HL)     ; {A = *HL++; // prime A
 $EF33 INC L         ; }
 $EF34 LD SP,$EDD3   ; SP = game_window_start_addresses;
 $EF37 EXX           ; {Bdash = 128; // 128 rows
 $EF38 LD B,$80      ; }
*$EF3A EXX           ; do <%
 $EF3B POP DE        ;   // output address
 $EF3C LD B,$04      ;   B = 4; // 4 iterations of 5 plus 3 at the end == 23
*$EF3E LD C,(HL)     ;   do <% C = *HL;
 $EF3F RRD           ; RRD does this: tmp = *HL & 0x0F; *HL = (*HL >> 4) | (A << 4); A = (A & 0xF0) | tmp;
 $EF41 EX AF,AF'     ;
 $EF42 LD A,(HL)     ;     Adash = *HL;
 $EF43 LD (DE),A     ;     *DE++ = Adash;
 $EF44 LD (HL),C     ; {    *HL++ = C;
 $EF45 EX AF,AF'
 $EF46 INC HL        ;
 $EF47 INC E         ; }
 $EF48 LD C,(HL)     ;     C = *HL;
 $EF49 RRD           ; {    RRD
 $EF4B EX AF,AF'     ; }
 $EF4C LD A,(HL)     ;     Adash = *HL;
 $EF4D LD (DE),A     ;     *DE++ = Adash;
 $EF4E LD (HL),C     ; {    *HL++ = C;
 $EF4F EX AF,AF'
 $EF50 INC HL        ;
 $EF51 INC E         ; }
 $EF52 LD C,(HL)     ;     C = *HL;
 $EF53 RRD           ; {    RRD
 $EF55 EX AF,AF'     ; }
 $EF56 LD A,(HL)     ;     Adash = *HL;
 $EF57 LD (DE),A     ;     *DE++ = Adash;
 $EF58 LD (HL),C     ; {    *HL++ = C;
 $EF59 EX AF,AF'
 $EF5A INC HL        ;
 $EF5B INC E         ; }
 $EF5C LD C,(HL)     ;     C = *HL;
 $EF5D RRD           ; {    RRD
 $EF5F EX AF,AF'     ; }
 $EF60 LD A,(HL)     ;     Adash = *HL;
 $EF61 LD (DE),A     ;     *DE++ = Adash;
 $EF62 LD (HL),C     ; {    *HL++ = C;
 $EF63 EX AF,AF'
 $EF64 INC HL        ;
 $EF65 INC E         ; }
 $EF66 LD C,(HL)     ;     C = *HL;
 $EF67 RRD           ; {    RRD
 $EF69 EX AF,AF'     ; }
 $EF6A LD A,(HL)     ;     Adash = *HL;
 $EF6B LD (DE),A     ;     *DE++ = Adash;
 $EF6C LD (HL),C     ; {    *HL++ = C;
 $EF6D EX AF,AF'
 $EF6E INC HL        ;
 $EF6F INC E         ; }
 $EF70 DJNZ $EF3E    ;   %> while (--B);
 $EF72 LD C,(HL)     ;   C = *HL;
 $EF73 RRD           ; {  RRD
 $EF75 EX AF,AF'     ; }
 $EF76 LD A,(HL)     ;   Adash = *HL;
 $EF77 LD (DE),A     ;   *DE++ = Adash;
 $EF78 LD (HL),C     ; {  *HL++ = C;
 $EF79 EX AF,AF'
 $EF7A INC HL        ;
 $EF7B INC E         ; }
 $EF7C LD C,(HL)     ;   C = *HL;
 $EF7D RRD           ; {  RRD
 $EF7F EX AF,AF'     ; }
 $EF80 LD A,(HL)     ;   Adash = *HL;
 $EF81 LD (DE),A     ;   *DE++ = Adash;
 $EF82 LD (HL),C     ; {  *HL++ = C;
 $EF83 EX AF,AF'
 $EF84 INC HL        ;
 $EF85 INC E         ; }
 $EF86 LD C,(HL)     ;   C = *HL;
 $EF87 RRD           ; {  RRD
 $EF89 EX AF,AF'     ; }
 $EF8A LD A,(HL)     ;   Adash = *HL;
 $EF8B LD (DE),A     ;   *DE++ = Adash;
 $EF8C LD (HL),C     ; {  *HL++ = C;
 $EF8D EX AF,AF'
 $EF8E INC HL        ;
 $EF8F INC E         ; }
 $EF90 LD A,(HL)     ; {  A = *HL++;
 $EF91 INC HL        ;
 $EF92 EXX           ; }
 $EF93 DJNZ $EF3A    ; %> while (--Bdash);
 $EF95 LD SP,($EDD1) ; SP = saved_sp;
 $EF99 RET           ; return;

; Event: roll call.
;
; Range checking. X in (0x72..0x7C) and Y in (0x6A..0x72).
;
; .
;
; Is the hero within the roll call area bounds?
@label=event_roll_call
@keep
c$EF9A LD DE,$727C   ; DE = map_ROLL_CALL_X;
 $EF9D LD HL,$81B8   ; HL = &hero_map_position.x;
 $EFA0 LD B,$02      ; B = 2; // iterations
*$EFA2 LD A,(HL)     ; do <% A = *HL++;
 $EFA3 CP D          ; {  if (A < D || A >= E) goto not_at_roll_call;
 $EFA4 JR C,$EFC0    ;
 $EFA6 CP E          ;
 $EFA7 JR NC,$EFC0   ;
 $EFA9 INC HL        ; }
@keep
 $EFAA LD DE,$6A72   ;   DE = map_ROLL_CALL_Y;
 $EFAD DJNZ $EFA2    ; %> while (--B);
; All visible characters turn forward.
@nowarn
 $EFAF LD HL,$800D   ; HL = $800D;
 $EFB2 LD B,$08      ; B = 8; // iterations
*$EFB4 LD (HL),$80   ; {do <% *HL++ = input_KICK;
 $EFB6 INC L         ; }
 $EFB7 LD (HL),$03   ;   *HL = 0x03; // direction (3 => face bottom left)
 $EFB9 LD A,L        ; {  HL += 31;
 $EFBA ADD A,$1F     ;
 $EFBC LD L,A        ; }
 $EFBD DJNZ $EFB4    ; %> while (--B);
 $EFBF RET           ; return;
*$EFC0 XOR A         ; {not_at_roll_call: bell = bell_RING_PERPETUAL;
 $EFC1 LD ($A130),A  ; }
 $EFC4 LD B,A        ; {queue_message_for_display(message_MISSED_ROLL_CALL);
 $EFC5 CALL $7D15    ; }
 $EFC8 JP $CCAB      ; hostiles_persue(); // exit via

; Use papers.
;
; Is the hero within the main gate bounds?
; .
; Range checking. X in (0x69..0x6D) and Y in (0x49..0x4B).
@label=action_papers
@keep
c$EFCB LD DE,$696D      ; DE = map_MAIN_GATE_X;
 $EFCE LD HL,$81B8      ; HL = &hero_map_position.y;
 $EFD1 LD B,$02         ; B = 2; // iterations
*$EFD3 LD A,(HL)        ; do <% A = *HL++;
 $EFD4 CP D             ; {  if (A < D || A >= E) return;
 $EFD5 RET C            ;
 $EFD6 CP E             ;
 $EFD7 RET NC           ;
 $EFD8 INC HL           ; }
@keep
 $EFD9 LD DE,$494B      ;   DE = map_MAIN_GATE_Y;
 $EFDC DJNZ $EFD3       ; %> while (--B);
; Using the papers at the main gate when not in uniform causes the hero to be
; sent to solitary.
 $EFDE LD DE,$CEA6      ; {if ($8015 != sprite_guard) goto solitary; // exit via
 $EFE1 LD A,($8015)     ;
 $EFE4 CP E             ;
 $EFE5 JP NZ,$CB98      ; }
 $EFE8 CALL $A0E9       ; increase_morale_by_10_score_by_50();
 $EFEB XOR A            ; {$801C = room_0_OUTDOORS; // set room index
 $EFEC LD ($801C),A     ; }
; Transition to outside the main gate.
@nowarn
 $EFEF LD HL,$EFF9      ; HL = &outside_main_gate; // pointer to location
 $EFF2 LD IY,$8000      ; IY = $8000; // hero character
 $EFF6 JP $68A2         ; transition(); return; // doesn't return: exits with goto main_loop
; Position outside the main gate.
@label=outside_main_gate
 $EFF9 DEFB $D6,$8A,$06 ; static const tinypos_t outside_main_gate = <% 0xD6, 0x8A, 0x06 %>;

; Waits for the user to press Y or N.
;
; Used by the routines at #R$9DE5 and #R$F350.
;
; O:F 'Y'/'N' pressed => return Z/NZ
@label=user_confirm
c$EFFC LD HL,$F014   ; HL = &screenlocstring_confirm_y_or_n[0];
 $EFFF CALL $A5BF    ; screenlocstring_plot();
*$F002 LD BC,$DFFE   ; for (;;) <% BC = port_KEYBOARD_POIUY;
 $F005 IN A,(C)      ;
 $F007 BIT 4,A       ; {  if ((A & (1<<4)) == 0) return; // is 'Y' pressed? return Z
 $F009 RET Z         ; }
 $F00A LD B,$7F      ;   BC = port_KEYBOARD_SPACESYMSHFTMNB;
 $F00C IN A,(C)      ;
 $F00E CPL           ;   A = ~A;
 $F00F BIT 3,A       ; {  if ((A & (1<<3)) != 0) return; // is 'N' pressed? return NZ
 $F011 RET NZ        ; }
 $F012 JR $F002      ; %>

; Confirm query.
t$F014 DEFB $0B,$50,$0F,$0C,$00,$17,$0F,$12,$1A,$16,$24,$23,$21,$23,$00,$1A,$23,$17 ; "CONFIRM. Y OR N" #HTML[/ #CALL:decode_screenlocstring($F014)]

; Further game messages.
@label=more_messages_he_takes_the_bribe
t$F026 DEFB $11,$0E,$23,$1C,$0A,$14,$0E,$1B,$23,$1C,$11,$0E,$23,$0B,$1A,$12,$0B,$0E,$FF ; "HE TAKES THE BRIBE" #HTML[/ #CALL:decode_stringFF($F026)]
@label=more_messages_and_acts_as_decoy
 $F039 DEFB $0A,$17,$0D,$23,$0A,$0C,$1C,$1B,$23,$0A,$1B,$23,$0D,$0E,$0C,$00,$21,$FF     ; "AND ACTS AS DECOY" #HTML[/ #CALL:decode_stringFF($F039)]
@label=more_messages_another_day_dawns
 $F04B DEFB $0A,$17,$00,$1C,$11,$0E,$1A,$23,$0D,$0A,$21,$23,$0D,$0A,$1F,$17,$1B,$FF     ; "ANOTHER DAY DAWNS" #HTML[/ #CALL:decode_stringFF($F04B)]

; Locked gates and doors.
@label=locked_doors
b$F05D DEFB $80,$81                     ; gates
 $F05F DEFB $8D,$8C,$8E,$A2,$98,$9F,$96 ; doors
 $F066 DEFB $00,$00                     ; unused

; Jump to main.
;
; Used by the routine at #R$FDE1.
@label=jump_to_main
c$F068 JP $F163      ;

; User-defined keys.
;
; Pairs of (port, key mask).
@label=keydefs
g$F06B DEFB $00,$00,$00,$00,$00,$00,$00,$00,$00,$00

; Static tiles plot direction.
;
; #TABLE(default,centre)
; { =h Value | =h Meaning }
; { 0 | Horizontal }
; { 255 | Vertical }
; TABLE#
@label=static_tiles_plot_direction
g$F075 DEFB $00      ; static_tiles_plot_direction

; Definitions of fixed graphic elements.
;
; Only used by #R$F1E0.
; .
; struct: w(addr), flags+length, attrs[length]
@label=static_graphic_defs
@label=statics_flagpole
b$F076 DEFB $21,$40,$94,$18,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$19,$1A,$1A
@label=statics_game_window_left_border
 $F08D DEFB $06,$40,$94,$02,$04,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$0E,$10
@label=statics_game_window_right_border
 $F0A4 DEFB $1E,$40,$94,$05,$07,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$11,$12,$09,$0B
@label=statics_game_window_top_border
 $F0BB DEFB $27,$40,$17,$13,$14,$13,$14,$13,$14,$13,$14,$13,$14,$15,$16,$17,$13,$14,$13,$14,$13,$14,$13,$14,$13,$14
@label=statics_game_window_bottom
 $F0D5 DEFB $47,$50,$17,$13,$14,$13,$14,$13,$14,$13,$14,$13,$14,$15,$16,$17,$13,$14,$13,$14,$13,$14,$13,$14,$13,$14
@label=statics_flagpole_grass
 $F0EF DEFB $A0,$50,$05,$1F,$1B,$1C,$1D,$1E
@label=statics_medals_row0
 $F0F7 DEFB $73,$50,$0D,$20,$21,$22,$21,$23,$21,$24,$21,$22,$21,$25,$0B,$0C
@label=statics_medals_row1
 $F107 DEFB $93,$50,$0B,$26,$4E,$27,$4E,$28,$4E,$29,$4E,$27,$4E,$2A
@label=statics_medals_row2
 $F115 DEFB $B3,$50,$0B,$2B,$2C,$2D,$2C,$2E,$2C,$2F,$2C,$2D,$2C,$30
@label=statics_medals_row3
 $F123 DEFB $D3,$50,$0B,$31,$32,$33,$34,$35,$36,$37,$38,$39,$3A,$3B
@label=statics_medals_row4
 $F131 DEFB $F3,$50,$0A,$3C,$3D,$3E,$3F,$40,$41,$42,$43,$44,$45
@label=statics_bell_row0
 $F13E DEFB $6E,$50,$03,$46,$47,$48
@label=statics_bell_row1
 $F144 DEFB $8E,$50,$03,$49,$4A,$4B
@label=statics_bell_row2
 $F14A DEFB $AE,$50,$02,$4C,$4D
@label=statics_corner_tl
 $F14F DEFB $05,$40,$82,$01,$03
@label=statics_corner_tr
 $F154 DEFB $1F,$40,$82,$06,$08
@label=statics_corner_bl
 $F159 DEFB $45,$50,$82,$0D,$0F
@label=statics_corner_br
 $F15E DEFB $5F,$50,$82,$0A,$0C

; Main.
;
; Used by the routine at #R$F068.
; .
; Disable interrupts and set up stack pointer.
@label=main
c$F163 DI                     ; {-
 $F164 LD SP,$FFFE            ; }
; Set up screen.
 $F167 CALL $F257             ; wipe_full_screen_and_attributes();
 $F16A LD A,$44               ; {set_morale_flag_screen_attributes(attribute_BRIGHT_GREEN_OVER_BLACK);
 $F16C CALL $A071             ; }
 $F16F LD E,$46               ; {set_menu_item_attributes(attribute_BRIGHT_YELLOW_OVER_BLACK);
 $F171 CALL $F408             ; }
 $F174 CALL $F1E0             ; plot_statics_and_menu_text();
 $F177 CALL $A10B             ; plot_score();
 $F17A CALL $F4B7             ; menu_screen();
; Construct a table of 256 bit-reversed bytes at 0x7F00.
 $F17D LD HL,$7F00            ; HL = 0x7F00;
*$F180 LD A,L                 ; do <% A = L;
 $F181 LD C,$00               ;   C = 0;
 $F183 LD B,$08               ;   B = 8; // iterations
*$F185 RRA                    ;   do <% carry = A & 1; A >>= 1; // flips a byte
 $F186 RL C                   ;     C = (C << 1) | carry;
 $F188 DJNZ $F185             ;   %> while (--B);
 $F18A LD (HL),C              ; {  *HL++ = C;
 $F18B INC L                  ;
 $F18C JP NZ,$F180            ; }
 $F18F INC H                  ; %> while ((HL & 0xFF) != 0);
; Initialise visible characters (HL is $8000).
@nowarn
 $F190 LD DE,$F1C9            ; DE = &vischar_initial;
 $F193 LD B,$08               ; B = 8; // iterations
*$F195 PUSH BC                ; do <%
 $F196 PUSH DE                ; {
 $F197 PUSH HL                ; }
 $F198 LD BC,$0017            ; {  memcpy(HL, DE, 23);
 $F19B EX DE,HL
 $F19C LDIR                   ; }
 $F19E POP HL
 $F19F LD A,$20               ; {  HL += 32;
 $F1A1 ADD A,L                ;
 $F1A2 LD L,A                 ; }
 $F1A3 POP DE
 $F1A4 POP BC                 ; {%> while (--B);
 $F1A5 DJNZ $F195             ; }
; Write 0xFF 0xFF at 0x8020 and every 32 bytes after.
 $F1A7 LD B,$07               ; B = 7; // iterations
@nowarn
 $F1A9 LD HL,$8020            ; HL = 0x8020; // iterate over non-player characters
 $F1AC LD DE,$001F
 $F1AF LD A,$FF
*$F1B1 LD (HL),A              ; {do <% HL[0] = character_NONE;
 $F1B2 INC L                  ; }
 $F1B3 LD (HL),A              ;   HL[1] = 0xFF; // flags
 $F1B4 ADD HL,DE              ;   HL += 32;
 $F1B5 DJNZ $F1B1             ; %> while (--B);
; Zero 0x118 bytes at HL (== $8100 == mask_buffer) onwards.
; .
; This is likely wiping everything up until the start of tiles ($8218).
 $F1B7 LD BC,$0118            ; BC = 0x118;
*$F1BA LD (HL),$00            ; {do <% *HL++ = 0; %> while (--BC != 0); // turn into memset
 $F1BC INC HL                 ;
 $F1BD DEC BC                 ;
 $F1BE LD A,C                 ;
 $F1BF OR B                   ;
 $F1C0 JP NZ,$F1BA            ; }
 $F1C3 CALL $B75A             ; reset_game();
 $F1C6 JP $9D78               ; goto main_loop_setup;
; Initial state of a visible character.
@label=vischar_initial
 $F1C9 DEFB $00               ; character
 $F1CA DEFB $00               ; flags
 $F1CB DEFW $012C             ; target
 $F1CD DEFB $2E,$2E,$18       ; pos
 $F1D0 DEFB $00               ; b07
 $F1D1 DEFW $CDF2             ; w08
 $F1D3 DEFW $CF76             ; w0A
 $F1D5 DEFB $00               ; animindex
 $F1D6 DEFB $00               ; b0D
 $F1D7 DEFB $00               ; b0E
 $F1D8 DEFW $0000,$0000,$0018 ; mi.pos
 $F1DE DEFW $CE2E             ; mi.spriteset

; Plot statics and menu text.
;
; Used by the routine at #R$F163.
@label=plot_statics_and_menu_text
c$F1E0 LD HL,$F076   ; HL = &static_graphic_defs[0];
 $F1E3 LD B,$12      ; B = NELEMS(static_graphic_defs); // 18 iterations
*$F1E5 PUSH BC       ; do <%
; Fetch screen address.
 $F1E6 LD E,(HL)     ; {  E = *HL++;
 $F1E7 INC HL        ; }
 $F1E8 LD D,(HL)     ; {  D = *HL++;
 $F1E9 INC HL        ; }
 $F1EA BIT 7,(HL)    ; {  if (*HL & statictiles_VERTICAL)
 $F1EC JR Z,$F1F3    ; }
 $F1EE CALL $F209    ;     plot_static_tiles_vertical();
 $F1F1 JR $F1F6      ;   else
*$F1F3 CALL $F206    ;     plot_static_tiles_horizontal();
*$F1F6 POP BC
 $F1F7 DJNZ $F1E5    ; %> while (--B);
; Plot menu text.
 $F1F9 LD B,$08      ; B = 8; // 8 iterations
 $F1FB LD HL,$F446   ; HL = &key_choice_screenlocstrings;
*$F1FE PUSH BC       ; do <%
 $F1FF CALL $A5BF    ;   screenlocstring_plot();
 $F202 POP BC
 $F203 DJNZ $F1FE    ; %> while (--B);
 $F205 RET           ; return;

; Plot static tiles horizontally.
;
; Used by the routine at #R$F1E0.
;
; I:DE Pointer to screen address.
; I:HL Pointer to [count, tile indices, ...].
@label=plot_static_tiles_horizontal
c$F206 XOR A         ; A = 0;
 $F207 JR $F20B      ; goto plot_static_tiles;

; Plot static tiles vertically.
;
; Used by the routine at #R$F1E0.
;
; I:DE Pointer to screen address.
; I:HL Pointer to [count, tile indices, ...].
; I:HL Pointer to [count, tile indices, ...].
; I:A Orientation: 0/255 = horizontal/vertical.
@label=plot_static_tiles_vertical
c$F209 LD A,$FF      ; A = 255;

; Plot static tiles.
;
; Used by the routine at #R$F206.
;
; I:DE Pointer to screen address.
@label=plot_static_tiles
c$F20B LD ($F075),A  ; static_tiles_plot_direction = A;
 $F20E LD A,(HL)     ; {B = *HL++ & statictiles_COUNT_MASK; // loop iterations
 $F20F AND $7F       ;
 $F211 LD B,A        ;
 $F212 INC HL        ; }
 $F213 PUSH DE
 $F214 EXX
 $F215 POP DE        ; POP DEdash
 $F216 EXX
*$F217 LD A,(HL)     ; do <% A = *HL;
 $F218 EXX
 $F219 LD C,A        ; {  HLdash = &static_tiles[A]; // elements: 9 bytes each
 $F21A LD B,$00      ;
 $F21C LD L,A        ;
 $F21D LD H,$00      ;
 $F21F ADD HL,HL     ;
 $F220 ADD HL,HL     ;
 $F221 ADD HL,HL     ;
 $F222 ADD HL,BC     ;
 $F223 LD BC,$7F00   ;
 $F226 ADD HL,BC     ; }
 $F227 LD B,$08      ;   Bdash = 8; // 8 iterations
; Plot a tile.
*$F229 LD A,(HL)     ; {  do <% *DEdash = *HLdash++;
 $F22A LD (DE),A     ; }
 $F22B INC D         ; {    DEdash += 256; // next row
 $F22C INC HL        ; }
 $F22D DJNZ $F229    ;   %> while (--Bdash);
 $F22F DEC D         ;   DEdash -= 256;
 $F230 PUSH DE       ;   PUSH DEdash
; Calculate screen attribute address of tile.
 $F231 LD A,D        ;   A = Ddash;
 $F232 LD D,$58      ;   Ddash = 0x58; // screen attributes base
 $F234 CP $48        ; {  if (A >= 0x48) DEdash += 256;
 $F236 JR C,$F23E    ;
 $F238 INC D         ; }
 $F239 CP $50        ; {  if (A >= 0x50) DEdash += 256;
 $F23B JR C,$F23E    ;
 $F23D INC D         ; }
*$F23E LD A,(HL)     ; {  *DEdash = *HLdash; // copy attribute byte
 $F23F LD (DE),A     ; }
 $F240 POP HL        ;   POP HLdash
 $F241 LD A,($F075)  ;   A = static_tiles_plot_direction;
 $F244 AND A         ; {  if (A == 0) <% // horizontal
 $F245 JR NZ,$F24E   ; }
 $F247 LD A,H        ; {    Hdash -= 7;  // HLdash -= 7 * 256;
 $F248 SUB $07       ;
 $F24A LD H,A        ; }
 $F24B INC L         ;     Ldash++; %>
 $F24C JR $F251      ;   else <% // vertical
*$F24E CALL $7CE9    ;     get_next_scanline(); %>
*$F251 EX DE,HL      ;   EX DEdash,HLdash
 $F252 EXX
 $F253 INC HL        ;   HL++;
 $F254 DJNZ $F217    ; %> while (--B);
 $F256 RET           ; return;

; Clear the screen and attributes and set the screen border to black.
;
; Used by the routine at #R$F163.
@label=wipe_full_screen_and_attributes
c$F257 LD HL,$4000   ; {memset(screen, 0, 0x1800);
 $F25A LD DE,$4001   ;
 $F25D LD (HL),$00   ;
 $F25F LD BC,$17FF   ;
 $F262 LDIR          ;
 $F264 INC HL        ; }
 $F265 INC DE        ; {memset(atttributes, attribute_WHITE_OVER_BLACK, 0x300);
 $F266 LD (HL),$07   ;
 $F268 LD BC,$02FF   ;
 $F26B LDIR          ; }
 $F26D XOR A         ; {border = 0; // black
 $F26E OUT ($FE),A   ; }
 $F270 RET           ; return;

; Menu screen key handling.
;
; Used by the routine at #R$F4B7.
; .
; Scan for a keypress which either starts the game or selects an input device.
; If an input device is chosen, update the menu highlight to match and record
; which input device was chosen.
; .
; If the game is started then copy the input routine to $F075. If the chosen
; input device is keyboard, then exit via choose_keys.
@label=check_menu_keys
c$F271 CALL $F41C    ; A = menu_keyscan();
 $F274 CP $FF        ; {if (A == 0xFF) return; /* no keypress */
 $F276 RET Z         ; }
 $F277 AND A         ; {if (A) <%
 $F278 JR Z,$F28E    ; }
 $F27A DEC A         ;   A--; // 1..4 -> 0..3
; Clear old selection.
 $F27B PUSH AF
 $F27C LD A,($F445)  ;   A = chosen_input_device;
 $F27F LD E,$07      ; {
 $F281 CALL $F408    ; set_menu_item_attributes(attribute_WHITE_OVER_BLACK);}
 $F284 POP AF
; Highlight new selection.
 $F285 LD ($F445),A  ;   chosen_input_device = A;
 $F288 LD E,$46      ; {
 $F28A CALL $F408    ; set_menu_item_attributes(attribute_BRIGHT_YELLOW_OVER_BLACK);}
 $F28D RET           ;   return; %>
; Zero pressed to start game.
*$F28E LD A,($F445)  ; {else <% A = chosen_input_device;
 $F291 ADD A,A       ; }
; This is tricky. A' is left with the low byte of the inputroutine address. In
; the case of the keyboard, it's zero. choose_keys relies on that in a
; nonobvious way.
 $F292 LD C,A        ; {  memcpy($F075, inputroutine[A], 0x4A); // copy input routine to $F075, length 0x4A
 $F293 LD B,$00      ;
 $F295 EX AF,AF'
 $F296 LD HL,$F43D   ;
 $F299 ADD HL,BC     ;
 $F29A LD A,(HL)     ;
 $F29B INC HL        ;
 $F29C LD H,(HL)     ;
 $F29D LD L,A        ;
 $F29E LD DE,$F075   ;
 $F2A1 LD BC,$004A   ;
 $F2A4 LDIR          ;
 $F2A6 EX AF,AF'     ; }
 $F2A7 AND A         ; {  if (A == inputdevice_KEYBOARD) { choose_keys(); }
 $F2A8 CALL Z,$F350  ; }
 $F2AB POP BC        ;   /* Discard previous frame and resume at main:$F17D. */
 $F2AC RET           ;   return; %>

; Key choice prompt strings.
;
t$F2AD DEFB $6D,$40,$0B,$0C,$11,$00,$00,$1B,$0E,$23,$14,$0E,"!",$1B ; "CHOOSE KEYS" #HTML[/ #CALL:decode_screenlocstring($F2AD)]
 $F2BB DEFB $CD,$40,$05,$15,$0E,$0F,$1C,"$"                         ; "LEFT." #HTML[/ #CALL:decode_screenlocstring($F2BB)]
 $F2C3 DEFB $0D,$48,$06,$1A,$12,$10,$11,$1C,"$"                     ; "RIGHT." #HTML[/ #CALL:decode_screenlocstring($F2C3)]
 $F2CC DEFB $4D,$48,$03,$1D,$18,"$"                                 ; "UP." #HTML[/ #CALL:decode_screenlocstring($F2CC)]
 $F2D2 DEFB $8D,$48,$05,$0D,$00,$1F,$17,"$"                         ; "DOWN." #HTML[/ #CALL:decode_screenlocstring($F2D2)]
 $F2DA DEFB $CD,$48,$05,$0F,$12,$1A,$0E                             ; "FIRE." #HTML[/ #CALL:decode_screenlocstring($F2DA)]

; byte_F2E1
;
; Unsure if anything reads this byte for real, but its address is taken prior
; to accessing keyboard_port_hi_bytes.
; .
; (<- choose_keys)
@label=byte_F2E1
b$F2E1 DEFB $24

; Table of keyscan high bytes.
;
; Zero terminated.
; .
; (<- choose_keys)
@label=keyboard_port_hi_bytes
b$F2E2 DEFB $F7,$EF,$FB,$DF,$FD,$BF,$FE,$7F,$00

; Table of special key name strings, prefixed by their length.
;
@label=special_key_names
t$F2EB DEFB $05,$0E,$17,$1C,$0E,$1A     ; "ENTER" #HTML[/ #CALL:decode_stringcounted($F2EB)]
 $F2F1 DEFB $04,$0C,$0A,$18,$1B         ; "CAPS" #HTML[/ #CALL:decode_stringcounted($F2F1)]
 $F2F6 DEFB $06,$1B,$21,$16,$0B,$00,$15 ; "SYMBOL" #HTML[/ #CALL:decode_stringcounted($F2F6)]
 $F2FD DEFB $05,$1B,$18,$0A,$0C,$0E     ; "SPACE" #HTML[/ #CALL:decode_stringcounted($F2FD)]

; Table mapping key codes to glyph indices.
;
; Each table entry is a character (in original code: a glyph index) OR if its
; top bit is set then bottom seven bits are an index into special_key_names.
@label=key_tables
b$F303 DEFB $01,$02,$03,$04,$05 ; table_12345
 $F308 DEFB $00,$09,$08,$07,$06 ; table_09876
 $F30D DEFB $19,$1F,$0E,$1A,$1C ; table_QWERT
 $F312 DEFB $18,$00,$12,$1D,$21 ; table_POIUY
 $F317 DEFB $0A,$1B,$0D,$0F,$10 ; table_ASDFG
 $F31C DEFB $80,$15,$14,$13,$11 ; table_ENTERLKJH
 $F321 DEFB $86,$22,$20,$0C,$1E ; table_SHIFTZXCV
 $F326 DEFB $92,$8B,$16,$17,$0B ; table_SPACESYMSHFTMNB

; Screen addresses where chosen key names are plotted.
@label=key_name_screen_addrs
w$F32B DEFW $40D5
 $F32D DEFW $4815
 $F32F DEFW $4855
 $F331 DEFW $4895
 $F333 DEFW $48D5

; Wipe the game screen.
;
; Used by the routine at #R$F350.
@label=wipe_game_window
c$F335 DI            ; DI
 $F336 LD ($EDD1),SP ; saved_sp = SP;
 $F33A LD SP,$EDD3   ; sp = game_window_start_addresses;
 $F33D LD A,$80      ; A = 128; // 128 rows
*$F33F POP HL        ; do <% // start address
 $F340 LD B,$17      ;   B = 23; // 23 columns
*$F342 LD (HL),$00   ;   do <% *HL = 0;
 $F344 INC L         ;     HL++;
 $F345 DJNZ $F342    ;   %> while (--B);
 $F347 DEC A         ; {%> while (--A);
 $F348 JP NZ,$F33F   ; }
 $F34B LD SP,($EDD1) ; SP = saved_sp;
 $F34F RET           ; return;

; Choose keys.
;
; Used by the routine at #R$F271.
;
; .
;
; Loop while the user does not confirm.
; .
; Clear the game window.
@label=choose_keys
c$F350 CALL $F335    ; for (;;) <% wipe_game_window();
 $F353 LD A,$07      ; {
 $F355 CALL $A15F    ; set_game_window_attributes(attribute_WHITE_OVER_BLACK);}
; Draw key choice prompt strings.
 $F358 LD B,$06      ;   B = 6; // iterations
 $F35A LD HL,$F2AD   ;   HL = &define_key_prompts[0];
*$F35D PUSH BC       ;   do <%
 $F35E LD E,(HL)     ; {    E = *HL++;
 $F35F INC HL        ; }
 $F360 LD D,(HL)     ; {    D = *HL++;
 $F361 INC HL        ; }
 $F362 LD B,(HL)     ; {    B = *HL++; // iterations
 $F363 INC HL        ; }
*$F364 PUSH BC       ;     do <%
 $F365 LD A,(HL)     ;       A = *HL; // redundant
 $F366 CALL $7D2F    ;       plot_glyph();
 $F369 INC HL        ;       HL++;
 $F36A POP BC
 $F36B DJNZ $F364    ;     %> while (--B);
 $F36D POP BC
 $F36E DJNZ $F35D    ;   %> while (--B);
; Wipe keydefs.
 $F370 LD HL,$F06B   ;   HL = &keydefs[0];
 $F373 LD B,$0A      ;   B = 10; // iterations
 $F375 XOR A         ;   A = 0;
*$F376 LD (HL),A     ; {  do <% *HL++ = A;
 $F377 INC HL        ; }
 $F378 DJNZ $F376    ;   %> while (--B);
 $F37A LD B,$05      ;   B = 5; // iterations L/R/U/D/F
 $F37C LD HL,$F32B   ;   HL = &key_name_screen_addrs[0];
*$F37F PUSH BC       ;   do <%
 $F380 LD E,(HL)     ; {    E = *HL++;
 $F381 INC HL        ; }
 $F382 LD D,(HL)     ; {    D = *HL++;
 $F383 INC HL        ; }
 $F384 PUSH HL
 $F385 LD ($F3E9),DE ;     ($F3E9) = DE; // self modify screen addr
 $F389 LD A,$FF      ;     A = 0xFF;
*$F38B EX AF,AF'     ;     for (;;) <%
 $F38C LD HL,$F2E1   ;       HL = &keyboard_port_hi_bytes[-1]; // &byte_F2E1
 $F38F LD D,$FF      ;       D = 0xFF;
*$F391 INC HL        ;       do <% HL++;
 $F392 INC D         ;         D++;
 $F393 LD A,(HL)     ;         Adash = *HL;
 $F394 OR A          ; {        if (Adash == 0) goto $F38B; // end of keyboard_port_hi_bytes
 $F395 JR Z,$F38B    ; }
 $F397 LD B,A        ;         B = Adash;
 $F398 LD C,$FE      ;         C = 0xFE;
 $F39A IN A,(C)      ;         IN Adash,(C)
 $F39C CPL           ;         Adash = ~Adash;
 $F39D LD E,A        ;         E = Adash;
 $F39E LD C,$20      ;         C = 0x20; // mask
*$F3A0 SRL C         ;         C >>= 1;
 $F3A2 JR C,$F391    ;       %> while (carry);  // loop structure is not quite right
 $F3A4 LD A,C        ; {      Adash = C & E;
 $F3A5 AND E         ; }
 $F3A6 JR Z,$F3A0    ;       if (Adash == 0) goto $F3A0;
 $F3A8 EX AF,AF'
 $F3A9 OR A          ; {      if (A) goto $F38B;
 $F3AA JR NZ,$F38B   ; }
 $F3AC LD A,D        ;       A = D;
 $F3AD EX AF,AF'
 $F3AE LD HL,$F06A   ;       HL = 0xF06A;
*$F3B1 INC HL        ;       HL++;
 $F3B2 LD A,(HL)     ;       Adash = *HL;
 $F3B3 OR A          ; {      if (Adash == 0) goto $F3C1;
 $F3B4 JR Z,$F3C1    ; }
 $F3B6 CP B          ;       if (A != B) ...
 $F3B7 INC HL        ;       HL++; // interleaved
 $F3B8 JR NZ,$F3B1   ;       ... goto $F3B1;
 $F3BA LD A,(HL)     ;       Adash = *HL;
 $F3BB CP C          ; {      if (A != C) goto $F3B1;
 $F3BC JR NZ,$F3B1   ; }
 $F3BE JP $F38B      ;     %>
; Assign key def.
@label=assign_keydef
*$F3C1 LD (HL),B     ; {    *HL++ = B;
 $F3C2 INC L         ; }
 $F3C3 LD (HL),C     ;     *HL = C;
 $F3C4 EX AF,AF'
 $F3C5 LD B,A        ; {    A *= 5;
 $F3C6 ADD A,A       ;
 $F3C7 ADD A,A       ;
 $F3C8 ADD A,B       ; }
@nowarn
 $F3C9 LD HL,$F302   ;     HL = 0xF302;  // &key_tables[0] - 1 byte + A // strange: off by one
 $F3CC ADD A,L       ; {    HL += A;
 $F3CD LD L,A        ;
 $F3CE JR NC,$F3D1   ;
 $F3D0 INC H         ; }
*$F3D1 INC HL        ;     HL++;
 $F3D2 RR C          ;     RR C
 $F3D4 JR NC,$F3D1   ;     JR NC,$F3D1
 $F3D6 LD B,$01      ;     B = 1;
 $F3D8 LD A,(HL)     ;     A = *HL;
 $F3D9 OR A          ;     A |= A;
 $F3DA JP P,$F3E8    ;     JP P,$F3E8
; If the top bit was set then it's a modifier key.
 $F3DD AND $7F       ;     A &= 0x7F;
 $F3DF LD DE,$F2EB   ; {    HL = &special_key_names[0] + A;
 $F3E2 LD L,A        ;
 $F3E3 LD H,$00      ;
 $F3E5 ADD HL,DE     ; }
 $F3E6 LD B,(HL)     ; {    B = *HL++;
 $F3E7 INC HL        ; }
; Plot.
*$F3E8 LD DE,$40D5   ;     DE = 0x40D5; // self modified // screen address
*$F3EB PUSH BC       ;     do <%
 $F3EC LD A,(HL)     ;       A = *HL; // Bug: Redundant.
 $F3ED CALL $7D2F    ;       plot_glyph();
 $F3F0 INC HL        ;       HL++;
 $F3F1 POP BC
 $F3F2 DJNZ $F3EB    ;     %> while (--B);
 $F3F4 POP HL
 $F3F5 POP BC
 $F3F6 DEC B         ; {  %> while (--B);
 $F3F7 JR NZ,$F37F   ; }
; Delay loop.
 $F3F9 LD BC,$FFFF   ;   BC = 0xFFFF;
*$F3FC DEC BC        ; {  while (--BC);
 $F3FD LD A,B        ;
 $F3FE OR C          ;
 $F3FF JR NZ,$F3FC   ; }
; Wait for user's input.
 $F401 CALL $EFFC    ;   user_confirm();
 $F404 RET Z         ;   if (Z) return; // confirmed
 $F405 JP NZ,$F350   ; %>

; Set the screen attributes of the specified menu item.
;
; Used by the routines at #R$F163 and #R$F271.
;
; I:A Item index.
; I:E Attributes.
@label=set_menu_item_attributes
c$F408 LD HL,$590D   ; HL = 0x590D; // initial screen attribute address
; Skip to the item's row.
 $F40B AND A         ; {if (A) <%
 $F40C JR Z,$F415    ; }
 $F40E LD B,A        ;   B = A;
*$F40F LD A,L        ; {  do <% L += 32 * 2; %> while (--B); %> // skip two rows per iteration
 $F410 ADD A,$40     ;
 $F412 LD L,A        ;
 $F413 DJNZ $F40F    ; }
; Draw.
*$F415 LD B,$0A      ; B = 10;
*$F417 LD (HL),E     ; {do <% *HL++ = E; %> while (--B);
 $F418 INC L         ;
 $F419 DJNZ $F417    ; }
 $F41B RET           ; return;

; Scan for keys to select an input device.
;
; Used by the routine at #R$F271.
;
; O:A 0/1/2/3/4 = keypress, or 255 = no keypress.
@label=menu_keyscan
c$F41C LD BC,$F7FE   ; BC = port_KEYBOARD_12345;
 $F41F LD E,$00      ; E = 0;
 $F421 IN A,(C)      ;
 $F423 CPL           ; {A = ~A & 0x0F;
 $F424 AND $0F       ; }
 $F426 JR Z,$F432    ; if (A) <%
 $F428 LD B,$04      ;   B = 4; /* iterations */
*$F42A RRA           ;   do <% A >>= 1;
 $F42B INC E         ;     E++;
 $F42C JR C,$F430    ;     if (carry) goto found;
 $F42E DJNZ $F42A    ;   %> while (--B);
*$F430 LD A,E        ;   found: A = E;
 $F431 RET           ;   return; %> /* 1..4 */
*$F432 LD B,$EF      ; else <% B = 0xEF; /* port_KEYBOARD_09876 */
 $F434 IN A,(C)      ;
 $F436 AND $01       ;   A &= 1;
 $F438 LD A,E        ;   A = E; /* interleaved */
 $F439 RET Z         ;   if (Z) return; /* always zero */
 $F43A LD A,$FF      ;   A = 0xFF; /* no keypress */
 $F43C RET           ;   return; %>

; Available input routines.
;
; Array [4] of pointers to input routines.
@label=inputroutines
w$F43D DEFW $FE00    ; &inputroutine_keyboard,
 $F43F DEFW $FE7E    ; &inputroutine_kempston,
 $F441 DEFW $FECD    ; &inputroutine_sinclair,
 $F443 DEFW $FE47    ; &inputroutine_protek,

; Chosen input device.
;
; #TABLE(default,centre)
; { =h Value | =h Meaning }
; { 0 | Keyboard }
; { 1 | Kempston }
; { 2 | Sinclair }
; { 3 | Protek }
; TABLE#
@label=chosen_input_device
g$F445 DEFB $00      ; chosen_input_device

; Key choice screenlocstrings.
;
@label=key_choice_screenlocstrings
t$F446 DEFB $8E,$40,$08,$0C,$00,$17,$1C,$1A,$00,$15,$1B                                                             ; "CONTROLS" #HTML[/ #CALL:decode_screenlocstring($F446)]
 $F451 DEFB $CD,$40,$08,$00,$23,$1B,$0E,$15,$0E,$0C,$1C                                                             ; "0 SELECT" #HTML[/ #CALL:decode_screenlocstring($F451)]
 $F45C DEFB $0D,$48,$0A,$01,$23,$14,$0E,$21,$0B,$00,$0A,$1A,$0D                                                     ; "1 KEYBOARD" #HTML[/ #CALL:decode_screenlocstring($F45C)]
 $F469 DEFB $4D,$48,$0A,$02,$23,$14,$0E,$16,$18,$1B,$1C,$00,$17                                                     ; "2 KEMPSTON" #HTML[/ #CALL:decode_screenlocstring($F469)]
 $F476 DEFB $8D,$48,$0A,$03,$23,$1B,$12,$17,$0C,$15,$0A,$12,$1A                                                     ; "3 SINCLAIR" #HTML[/ #CALL:decode_screenlocstring($F476)]
 $F483 DEFB $CD,$48,$08,$04,$23,$18,$1A,$00,$1C,$0E,$14                                                             ; "4 PROTEK" #HTML[#CALL:decode_screenlocstring($F483)]
 $F48E DEFB $07,$50,$17,$0B,$1A,$0E,$0A,$14,$23,$00,$1A,$23,$0C,$0A,$18,$1B,$23,$0A,$17,$0D,$23,$1B,$18,$0A,$0C,$0E ; "BREAK OR CAPS AND SPACE" #HTML[/ #CALL:decode_screenlocstring($F48E)]
 $F4A8 DEFB $2C,$50,$0C,$0F,$00,$1A,$23,$17,$0E,$1F,$23,$10,$0A,$16,$0E                                             ; "FOR NEW GAME" #HTML[/ #CALL:decode_screenlocstring($F4A8)]


; Runs the menu screen.
;
; Used by the routine at #R$F163.
; .
; While waiting for user to select an input device this waves the morale flag
; and plays the title tune.
@label=menu_screen
c$F4B7 CALL $F271    ; for (;;) <% check_menu_keys();
 $F4BA CALL $A035    ;   wave_morale_flag();
; Play music.
 $F4BD LD HL,($F541) ; {  HL = music_channel0_index + 1;
 $F4C0 INC HL        ; }
; Loop until the end marker is encountered.
*$F4C1 LD ($F541),HL ;   for (;;) <% music_channel0_index = HL;
 $F4C4 LD DE,$F546   ; {    A = music_channel0_data[HL];
 $F4C7 ADD HL,DE     ;
 $F4C8 LD A,(HL)     ; }
 $F4C9 CP $FF        ; {    if (A != 0xFF) break; /* end marker */
 $F4CB JR NZ,$F4D2   ; }
 $F4CD LD HL,$0000   ;     HL = 0;
 $F4D0 JR $F4C1      ;   %>
*$F4D2 CALL $F52C    ;   get_tuning();
 $F4D5 EXX
; Loop until the end marker is encountered.
 $F4D6 LD HL,($F543) ; {  HLdash = music_channel1_index + 1;
 $F4D9 INC HL        ; }
*$F4DA LD ($F543),HL ;   for (;;) <% music_channel1_index = HLdash;
 $F4DD LD DE,$F7C7   ; {    A = music_channel1_data[HLdash];
 $F4E0 ADD HL,DE     ;
 $F4E1 LD A,(HL)     ; }
 $F4E2 CP $FF        ; {    if (A != 0xFF) break; /* end marker */
 $F4E4 JR NZ,$F4EB   ; }
 $F4E6 LD HL,$0000   ;     HLdash = 0;
 $F4E9 JR $F4DA      ;   %>
*$F4EB CALL $F52C    ;   get_tuning(); /* using banked registers */
 $F4EE LD A,B        ;   A = Bdash;
 $F4EF EXX
 $F4F0 PUSH BC
 $F4F1 CP $FF        ; {  if (A == 0xFF) <%
 $F4F3 JR NZ,$F4FC   ; }
 $F4F5 EXX
 $F4F6 POP BC        ;     POP BCdash
 $F4F7 LD E,C        ; {    DEdash = BCdash;
 $F4F8 LD D,B        ; }
 $F4F9 EXX           ;     - %>
 $F4FA JR $F4FD      ;   else <%
*$F4FC POP BC        ;     %>
*$F4FD LD A,$18      ;   A = 24; /* overall tune speed (a delay: lower values are faster) */
*$F4FF EX AF,AF'     ;   do <%
 $F500 LD H,$FF      ;     H = 0xFF; /* iterations */
*$F502 DJNZ $F510    ;     do <% if (--B == 0) <%
 $F504 DEC C         ; {        if (--C == 0) <%
 $F505 JP NZ,$F510   ; }
 $F508 LD A,L        ; {          L ^= 16;
 $F509 XOR $10       ;
 $F50B LD L,A        ; }
 $F50C OUT ($FE),A   ;           OUT ($FE),L
 $F50E LD C,E        ; {          BC = DE; %> %>
 $F50F LD B,D        ; }
*$F510 EXX
 $F511 DJNZ $F51F    ;       if (--Bdash == 0) <%
 $F513 DEC C         ; {        if (--Cdash == 0) <%
 $F514 JP NZ,$F51F   ; }
 $F517 LD A,L        ; {          Ldash ^= 16;
 $F518 XOR $10       ;
 $F51A LD L,A        ; }
 $F51B OUT ($FE),A   ;           OUT ($FE),Ldash
 $F51D LD C,E        ; {          BCdash = DEdash; %> %>
 $F51E LD B,D        ; }
*$F51F EXX
 $F520 DEC H         ; {    %> while (--H);
 $F521 JP NZ,$F502   ; }
 $F524 EX AF,AF'
 $F525 DEC A         ; {  %> while (--A);
 $F526 JP NZ,$F4FF   ; }
 $F529 JP $F4B7      ; %>

; Get tuning.
;
; Used by the routine at #R$F4B7.
;
; I:A Index (never larger than 42?).
; O:BC ...
; O:DE ...
; O:HL ...
@label=get_tuning
c$F52C ADD A,A       ; {BC = music_tuning_table[A];
 $F52D LD HL,$FA48   ;
 $F530 LD E,A        ;
 $F531 LD D,$00      ;
 $F533 ADD HL,DE     ;
 $F534 LD B,(HL)     ;
 $F535 INC HL        ;
 $F536 LD C,(HL)     ; }
 $F537 INC C         ; C++;
 $F538 INC B         ; B++;
 $F539 JR NZ,$F53C   ; {if (B == 0) C++;
 $F53B INC C         ; }
*$F53C LD L,$00      ; L = 0;
 $F53E LD D,B        ; {DE = BC;
 $F53F LD E,C        ; }
 $F540 RET           ; return;

; Music channel indices.
@label=music_channel0_index
g$F541 DEFW $0000    ; music_channel0_index
@label=music_channel1_index
 $F543 DEFW $0000    ; music_channel1_index

; Unreferenced byte.
u$F545 DEFB $00      ; unused_F545

; Music data.
@label=music_channel0_data
b$F546 DEFB $13,$00,$14,$00,$00,$15,$16,$00 ; {music_channel0_data
 $F54E DEFB $1B,$00,$00,$00,$00,$00,$00,$00
 $F556 DEFB $16,$00,$1F,$00,$00,$1D,$1B,$00
 $F55E DEFB $18,$00,$00,$00,$00,$00,$00,$00
 $F566 DEFB $00,$00,$00,$00,$00,$00,$1D,$00
 $F56E DEFB $00,$00,$1D,$00,$00,$1B,$1A,$00
 $F576 DEFB $1B,$00,$1A,$00,$18,$00,$16,$00
 $F57E DEFB $13,$00,$00,$00,$00,$00,$00,$00
 $F586 DEFB $13,$00,$14,$00,$00,$15,$16,$00
 $F58E DEFB $1B,$00,$00,$00,$00,$00,$00,$00
 $F596 DEFB $16,$00,$1F,$00,$00,$1D,$1B,$00
 $F59E DEFB $18,$00,$00,$00,$00,$00,$00,$00
 $F5A6 DEFB $00,$00,$00,$00,$00,$00,$1D,$00
 $F5AE DEFB $00,$00,$1D,$00,$00,$1B,$1A,$00
 $F5B6 DEFB $16,$00,$00,$00,$1D,$00,$1B,$00
 $F5BE DEFB $00,$00,$1F,$00,$00,$1D,$1B,$00
 $F5C6 DEFB $19,$00,$18,$00,$16,$00,$1B,$00
 $F5CE DEFB $00,$00,$1B,$00,$1D,$00,$1B,$00
 $F5D6 DEFB $19,$00,$18,$00,$19,$00,$1B,$00
 $F5DE DEFB $00,$00,$24,$00,$00,$00,$24,$00
 $F5E6 DEFB $00,$00,$22,$00,$00,$00,$20,$00
 $F5EE DEFB $00,$00,$00,$00,$00,$00,$1D,$00
 $F5F6 DEFB $00,$00,$00,$00,$00,$00,$1B,$00
 $F5FE DEFB $00,$00,$1B,$00,$00,$1D,$1B,$00
 $F606 DEFB $19,$00,$18,$00,$16,$00,$1B,$00
 $F60E DEFB $00,$00,$1B,$00,$1D,$00,$1B,$00
 $F616 DEFB $19,$00,$18,$00,$19,$00,$1B,$00
 $F61E DEFB $00,$00,$24,$00,$00,$00,$20,$00
 $F626 DEFB $1F,$00,$20,$00,$21,$00,$22,$00
 $F62E DEFB $00,$00,$1D,$00,$00,$00,$1F,$00
 $F636 DEFB $00,$00,$20,$00,$00,$00,$22,$00
 $F63E DEFB $00,$00,$22,$00,$00,$20,$1F,$00
 $F646 DEFB $1B,$00,$1D,$00,$1F,$00,$20,$00
 $F64E DEFB $00,$00,$00,$00,$22,$00,$24,$00
 $F656 DEFB $00,$00,$20,$00,$00,$00,$1F,$00
 $F65E DEFB $20,$00,$22,$00,$1B,$1D,$1F,$00
 $F666 DEFB $20,$00,$22,$00,$24,$00,$25,$00
 $F66E DEFB $00,$00,$22,$00,$00,$00,$24,$00
 $F676 DEFB $00,$00,$20,$00,$00,$00,$22,$00
 $F67E DEFB $00,$00,$1B,$00,$00,$1D,$1B,$00
 $F686 DEFB $19,$00,$18,$00,$19,$00,$1B,$00
 $F68E DEFB $00,$00,$1B,$00,$1D,$00,$1B,$00
 $F696 DEFB $19,$00,$18,$00,$19,$00,$1B,$00
 $F69E DEFB $00,$00,$27,$00,$00,$00,$27,$00
 $F6A6 DEFB $00,$00,$25,$00,$00,$00,$24,$00
 $F6AE DEFB $1B,$1B,$1A,$00,$1B,$00,$22,$00
 $F6B6 DEFB $1B,$1B,$1A,$00,$1B,$00,$20,$00
 $F6BE DEFB $1B,$00,$18,$00,$1B,$00,$14,$00
 $F6C6 DEFB $1D,$00,$1E,$00,$1F,$00,$20,$00
 $F6CE DEFB $00,$00,$20,$00,$00,$00,$00,$00
 $F6D6 DEFB $20,$00,$22,$00,$24,$00,$25,$00
 $F6DE DEFB $00,$00,$29,$00,$00,$00,$00,$00
 $F6E6 DEFB $00,$00,$29,$00,$27,$00,$25,$00
 $F6EE DEFB $00,$00,$22,$00,$00,$00,$00,$00
 $F6F6 DEFB $00,$00,$25,$00,$00,$00,$20,$00
 $F6FE DEFB $00,$00,$20,$00,$00,$22,$20,$00
 $F706 DEFB $1E,$00,$1D,$00,$1E,$00,$20,$00
 $F70E DEFB $00,$00,$20,$00,$00,$00,$20,$00
 $F716 DEFB $20,$00,$22,$00,$24,$00,$25,$00
 $F71E DEFB $00,$00,$29,$00,$00,$00,$00,$00
 $F726 DEFB $24,$00,$25,$00,$26,$00,$27,$00
 $F72E DEFB $00,$00,$22,$00,$00,$00,$24,$00
 $F736 DEFB $00,$00,$25,$00,$00,$00,$27,$00
 $F73E DEFB $00,$00,$27,$00,$00,$29,$27,$00
 $F746 DEFB $25,$00,$24,$00,$22,$00,$20,$00
 $F74E DEFB $00,$00,$20,$00,$00,$00,$20,$00
 $F756 DEFB $20,$00,$22,$00,$24,$00,$25,$00
 $F75E DEFB $00,$00,$29,$00,$00,$00,$00,$00
 $F766 DEFB $25,$00,$27,$00,$29,$00,$2A,$00
 $F76E DEFB $00,$00,$22,$00,$00,$00,$25,$00
 $F776 DEFB $00,$00,$2A,$00,$00,$00,$29,$00
 $F77E DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $F786 DEFB $00,$00,$25,$00,$27,$00,$29,$00
 $F78E DEFB $00,$00,$29,$00,$00,$00,$29,$00
 $F796 DEFB $25,$00,$27,$00,$25,$00,$22,$00
 $F79E DEFB $00,$00,$00,$00,$00,$00,$20,$00
 $F7A6 DEFB $00,$00,$25,$00,$00,$00,$29,$00
 $F7AE DEFB $00,$00,$25,$00,$00,$00,$00,$00
 $F7B6 DEFB $00,$00,$27,$00,$00,$00,$25,$00
 $F7BE DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $F7C6 DEFB $FF                             ; }
@label=music_channel1_data
 $F7C7 DEFB $0A,$00,$0C,$00,$00,$0E,$0F,$00 ; {music_channel1_data
 $F7CF DEFB $13,$00,$0A,$00,$13,$00,$0F,$00
 $F7D7 DEFB $13,$00,$0A,$00,$13,$00,$14,$00
 $F7DF DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F7E7 DEFB $18,$00,$14,$00,$15,$00,$16,$00
 $F7EF DEFB $1A,$00,$11,$00,$1A,$00,$16,$00
 $F7F7 DEFB $1A,$00,$11,$00,$1A,$00,$0F,$00
 $F7FF DEFB $13,$00,$00,$00,$00,$00,$00,$00
 $F807 DEFB $0A,$00,$0C,$00,$00,$0E,$0F,$00
 $F80F DEFB $13,$00,$0A,$00,$13,$00,$0F,$00
 $F817 DEFB $13,$00,$0A,$00,$13,$00,$14,$00
 $F81F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F827 DEFB $18,$00,$14,$00,$15,$00,$16,$00
 $F82F DEFB $1A,$00,$11,$00,$1A,$00,$16,$00
 $F837 DEFB $1A,$00,$11,$00,$1A,$00,$0F,$00
 $F83F DEFB $13,$00,$0A,$00,$13,$00,$0F,$00
 $F847 DEFB $13,$00,$0A,$00,$13,$00,$14,$00
 $F84F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F857 DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F85F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F867 DEFB $14,$00,$16,$00,$18,$00,$0D,$00
 $F86F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F877 DEFB $11,$00,$08,$00,$11,$00,$14,$00
 $F87F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F887 DEFB $0F,$00,$11,$00,$13,$00,$14,$00
 $F88F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F897 DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F89F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F8A7 DEFB $0F,$00,$14,$00,$15,$00,$16,$00
 $F8AF DEFB $1A,$00,$11,$00,$1A,$00,$16,$00
 $F8B7 DEFB $1A,$00,$11,$00,$1A,$00,$0F,$00
 $F8BF DEFB $13,$00,$0A,$00,$13,$00,$0F,$00
 $F8C7 DEFB $13,$00,$0A,$00,$13,$00,$14,$00
 $F8CF DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F8D7 DEFB $18,$00,$0F,$00,$14,$00,$13,$00
 $F8DF DEFB $16,$00,$0F,$00,$13,$00,$0A,$00
 $F8E7 DEFB $13,$00,$16,$00,$18,$00,$19,$00
 $F8EF DEFB $14,$00,$11,$00,$19,$00,$18,$00
 $F8F7 DEFB $14,$00,$0F,$00,$18,$00,$13,$00
 $F8FF DEFB $16,$00,$0F,$00,$13,$00,$0A,$00
 $F907 DEFB $13,$00,$0F,$00,$13,$00,$14,$00
 $F90F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F917 DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F91F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F927 DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F92F DEFB $18,$00,$0F,$00,$18,$00,$13,$00
 $F937 DEFB $16,$00,$0F,$00,$16,$00,$14,$00
 $F93F DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F947 DEFB $00,$00,$00,$00,$00,$00,$0D,$00
 $F94F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F957 DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F95F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F967 DEFB $11,$00,$0F,$00,$11,$00,$12,$00
 $F96F DEFB $16,$00,$0D,$00,$16,$00,$12,$00
 $F977 DEFB $16,$00,$0D,$00,$16,$00,$0D,$00
 $F97F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F987 DEFB $08,$00,$0A,$00,$0C,$00,$0D,$00
 $F98F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F997 DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F99F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F9A7 DEFB $11,$00,$0D,$00,$0E,$00,$0F,$00
 $F9AF DEFB $13,$00,$0A,$00,$13,$00,$0F,$00
 $F9B7 DEFB $13,$00,$0A,$00,$13,$00,$14,$00
 $F9BF DEFB $18,$00,$0F,$00,$18,$00,$14,$00
 $F9C7 DEFB $08,$00,$0A,$00,$0C,$00,$0D,$00
 $F9CF DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F9D7 DEFB $11,$00,$0A,$00,$11,$00,$0D,$00
 $F9DF DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $F9E7 DEFB $0D,$00,$0F,$00,$11,$00,$12,$00
 $F9EF DEFB $16,$00,$0D,$00,$16,$00,$12,$00
 $F9F7 DEFB $16,$00,$12,$00,$12,$00,$11,$00
 $F9FF DEFB $15,$00,$0C,$00,$15,$00,$11,$00
 $FA07 DEFB $15,$00,$11,$00,$0C,$00,$0D,$00
 $FA0F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $FA17 DEFB $11,$00,$08,$00,$11,$00,$12,$00
 $FA1F DEFB $16,$00,$0D,$00,$16,$00,$0D,$00
 $FA27 DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $FA2F DEFB $11,$00,$08,$00,$11,$00,$0F,$00
 $FA37 DEFB $08,$00,$0A,$00,$0C,$00,$0D,$00
 $FA3F DEFB $11,$00,$08,$00,$11,$00,$0D,$00
 $FA47 DEFB $FF                             ; }
@label=music_tuning_table
 $FA48 DEFW $FEFE                           ; {music_tuning_table
 $FA4A DEFW $0000
 $FA4C DEFW $0000
 $FA4E DEFW $0000
 $FA50 DEFW $0000
 $FA52 DEFW $0218
 $FA54 DEFW $01FA
 $FA56 DEFW $01DE
 $FA58 DEFW $01C3
 $FA5A DEFW $01A9
 $FA5C DEFW $0192
 $FA5E DEFW $017B
 $FA60 DEFW $0166
 $FA62 DEFW $0152
 $FA64 DEFW $013F
 $FA66 DEFW $012D
 $FA68 DEFW $011C
 $FA6A DEFW $010C
 $FA6C DEFW $00FD
 $FA6E DEFW $00EF
 $FA70 DEFW $00E1
 $FA72 DEFW $00D5
 $FA74 DEFW $00C9
 $FA76 DEFW $00BE
 $FA78 DEFW $00B3
 $FA7A DEFW $00A9
 $FA7C DEFW $009F
 $FA7E DEFW $0096
 $FA80 DEFW $008E
 $FA82 DEFW $0086
 $FA84 DEFW $007E
 $FA86 DEFW $0077
 $FA88 DEFW $0071
 $FA8A DEFW $006A
 $FA8C DEFW $0064
 $FA8E DEFW $005F
 $FA90 DEFW $0059
 $FA92 DEFW $0054
 $FA94 DEFW $0050
 $FA96 DEFW $004B
 $FA98 DEFW $0047
 $FA9A DEFW $0043
 $FA9C DEFW $003F
 $FA9E DEFW $003C
 $FAA0 DEFW $0038
 $FAA2 DEFW $0035
 $FAA4 DEFW $0032
 $FAA6 DEFW $002F
 $FAA8 DEFW $002D
 $FAAA DEFW $002A
 $FAAC DEFW $0028
 $FAAE DEFW $0026
 $FAB0 DEFW $0023
 $FAB2 DEFW $0021
 $FAB4 DEFW $0020
 $FAB6 DEFW $001E
 $FAB8 DEFW $001C
 $FABA DEFW $001B
 $FABC DEFW $0019
 $FABE DEFW $0018
 $FAC0 DEFW $0016
 $FAC2 DEFW $0015
 $FAC4 DEFW $0014
 $FAC6 DEFW $0013
 $FAC8 DEFW $0012
 $FACA DEFW $0011
 $FACC DEFW $0000
 $FACE DEFW $0000
 $FAD0 DEFW $0000
 $FAD2 DEFW $0000
 $FAD4 DEFW $0000
 $FAD6 DEFW $0000
 $FAD8 DEFW $0000
 $FADA DEFW $0000
 $FADC DEFW $0000
 $FADE DEFW $0000                           ; }

; 769 bytes of apparently unreferenced bytes.
u$FAE0 DEFB $00,$0F,$00,$18,$00,$14,$00,$18 ; {unused_FAE0
 $FAE8 DEFB $00,$14,$00,$15,$00,$16,$00,$1A
 $FAF0 DEFB $00,$11,$00,$1A,$00,$16,$00,$1A
 $FAF8 DEFB $00,$11,$00,$1A,$00,$0F,$00,$13
 $FB00 DEFB $00,$00,$00,$00,$00,$00,$00,$0A
 $FB08 DEFB $00,$0C,$00,$00,$0E,$0F,$00,$13
 $FB10 DEFB $00,$0A,$00,$13,$00,$0F,$00,$13
 $FB18 DEFB $00,$0A,$00,$13,$00,$14,$00,$18
 $FB20 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FB28 DEFB $00,$14,$00,$15,$00,$16,$00,$1A
 $FB30 DEFB $00,$11,$00,$1A,$00,$16,$00,$1A
 $FB38 DEFB $00,$11,$00,$1A,$00,$0F,$00,$13
 $FB40 DEFB $00,$0A,$00,$13,$00,$0F,$00,$13
 $FB48 DEFB $00,$0A,$00,$13,$00,$14,$00,$18
 $FB50 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FB58 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FB60 DEFB $00,$0F,$00,$18,$00,$14,$00,$14
 $FB68 DEFB $00,$16,$00,$18,$00,$0D,$00,$11
 $FB70 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FB78 DEFB $00,$08,$00,$11,$00,$14,$00,$18
 $FB80 DEFB $00,$0F,$00,$18,$00,$14,$00,$0F
 $FB88 DEFB $00,$11,$00,$13,$00,$14,$00,$18
 $FB90 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FB98 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FBA0 DEFB $00,$0F,$00,$18,$00,$14,$00,$0F
 $FBA8 DEFB $00,$14,$00,$15,$00,$16,$00,$1A
 $FBB0 DEFB $00,$11,$00,$1A,$00,$16,$00,$1A
 $FBB8 DEFB $00,$11,$00,$1A,$00,$0F,$00,$13
 $FBC0 DEFB $00,$0A,$00,$13,$00,$0F,$00,$13
 $FBC8 DEFB $00,$0A,$00,$13,$00,$14,$00,$18
 $FBD0 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FBD8 DEFB $00,$0F,$00,$14,$00,$13,$00,$16
 $FBE0 DEFB $00,$0F,$00,$13,$00,$0A,$00,$13
 $FBE8 DEFB $00,$16,$00,$18,$00,$19,$00,$14
 $FBF0 DEFB $00,$11,$00,$19,$00,$18,$00,$14
 $FBF8 DEFB $00,$0F,$00,$18,$00,$13,$00,$16
 $FC00 DEFB $00,$0F,$00,$13,$00,$0A,$00,$13
 $FC08 DEFB $00,$0F,$00,$13,$00,$14,$00,$18
 $FC10 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FC18 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FC20 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FC28 DEFB $00,$0F,$00,$18,$00,$14,$00,$18
 $FC30 DEFB $00,$0F,$00,$18,$00,$13,$00,$16
 $FC38 DEFB $00,$0F,$00,$16,$00,$14,$00,$18
 $FC40 DEFB $00,$0F,$00,$18,$00,$14,$00,$00
 $FC48 DEFB $00,$00,$00,$00,$00,$0D,$00,$11
 $FC50 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FC58 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FC60 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FC68 DEFB $00,$0F,$00,$11,$00,$12,$00,$16
 $FC70 DEFB $00,$0D,$00,$16,$00,$12,$00,$16
 $FC78 DEFB $00,$0D,$00,$16,$00,$0D,$00,$11
 $FC80 DEFB $00,$08,$00,$11,$00,$0D,$00,$08
 $FC88 DEFB $00,$0A,$00,$0C,$00,$0D,$00,$11
 $FC90 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FC98 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FCA0 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FCA8 DEFB $00,$0D,$00,$0E,$00,$0F,$00,$13
 $FCB0 DEFB $00,$0A,$00,$13,$00,$0F,$00,$13
 $FCB8 DEFB $00,$0A,$00,$13,$00,$14,$00,$18
 $FCC0 DEFB $00,$0F,$00,$18,$00,$14,$00,$08
 $FCC8 DEFB $00,$0A,$00,$0C,$00,$0D,$00,$11
 $FCD0 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FCD8 DEFB $00,$0A,$00,$11,$00,$0D,$00,$11
 $FCE0 DEFB $00,$08,$00,$11,$00,$0D,$00,$0D
 $FCE8 DEFB $00,$0F,$00,$11,$00,$12,$00,$16
 $FCF0 DEFB $00,$0D,$00,$16,$00,$12,$00,$16
 $FCF8 DEFB $00,$12,$00,$12,$00,$11,$00,$15
 $FD00 DEFB $00,$0C,$00,$15,$00,$11,$00,$15
 $FD08 DEFB $00,$11,$00,$0C,$00,$0D,$00,$11
 $FD10 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FD18 DEFB $00,$08,$00,$11,$00,$12,$00,$16
 $FD20 DEFB $00,$0D,$00,$16,$00,$0D,$00,$11
 $FD28 DEFB $00,$08,$00,$11,$00,$0D,$00,$11
 $FD30 DEFB $00,$08,$00,$11,$00,$0F,$00,$08
 $FD38 DEFB $00,$0A,$00,$0C,$00,$0D,$00,$11
 $FD40 DEFB $00,$08,$00,$11,$00,$0D,$00,$FF
 $FD48 DEFB $FE,$FE,$00,$00,$00,$00,$00,$00
 $FD50 DEFB $00,$00,$18,$02,$FA,$01,$DE,$01
 $FD58 DEFB $C3,$01,$A9,$01,$92,$01,$7B,$01
 $FD60 DEFB $66,$01,$52,$01,$3F,$01,$2D,$01
 $FD68 DEFB $1C,$01,$0C,$01,$FD,$00,$EF,$00
 $FD70 DEFB $E1,$00,$D5,$00,$C9,$00,$BE,$00
 $FD78 DEFB $B3,$00,$A9,$00,$9F,$00,$96,$00
 $FD80 DEFB $8E,$00,$86,$00,$7E,$00,$77,$00
 $FD88 DEFB $71,$00,$6A,$00,$64,$00,$5F,$00
 $FD90 DEFB $59,$00,$54,$00,$50,$00,$4B,$00
 $FD98 DEFB $47,$00,$43,$00,$3F,$00,$3C,$00
 $FDA0 DEFB $38,$00,$35,$00,$32,$00,$2F,$00
 $FDA8 DEFB $2D,$00,$2A,$00,$28,$00,$26,$00
 $FDB0 DEFB $23,$00,$21,$00,$20,$00,$1E,$00
 $FDB8 DEFB $1C,$00,$1B,$00,$19,$00,$18,$00
 $FDC0 DEFB $16,$00,$15,$00,$14,$00,$13,$00
 $FDC8 DEFB $12,$00,$11,$00,$00,$00,$00,$00
 $FDD0 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FDD8 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FDE0 DEFB $C9                             ; }

; Loaded.
;
; Very first entry point used to shunt the game image down into its proper
; position.
@label=loaded
c$FDE1 DI            ; Disable interrupts.
 $FDE2 LD SP,$FFFF   ; SP = 0xFFFF;
 $FDE5 LD BC,$9FE0   ; {memmove(0x5B00, 0x5E00, 0x9FE0);
@nowarn
 $FDE8 LD HL,$5E00   ;
 $FDEB LD DE,$5B00   ;
 $FDEE LDIR          ; }
 $FDF0 JP $F068      ; goto jump_to_main; /* exit via */

; Unreferenced bytes.
u$FDF3 DEFB $00,$00,$00,$00,$00,$00,$00,$00 ; {unused_FDF3
 $FDFB DEFB $00,$00,$00,$00,$00             ; }

; Keyboard input routine.
;
; .
;
; O:A Input value (as per enum input).
@label=inputroutine_keyboard
c$FE00 LD HL,$F06B   ; HL = keydefs; /* A list of (port high byte, key mask) */
; Left or right?
 $FE03 LD C,$FE      ; C = 0xFE; /* Port 0xXXFE */
 $FE05 LD B,(HL)     ; {B = *HL++;
 $FE06 INC HL        ; }
 $FE07 IN A,(C)      ;
 $FE09 CPL           ; {A = ~A & *HL++;
 $FE0A AND (HL)      ;
 $FE0B INC HL        ; }
 $FE0C JR Z,$FE14    ; if (A) <%
 $FE0E INC HL        ; {  HL += 2; /* Skip right keydef */
 $FE0F INC HL        ; }
 $FE10 LD E,$03      ;   E = input_LEFT;
 $FE12 JR $FE22      ; %>
; Right.
*$FE14 LD B,(HL)     ; {else <% B = *HL++;
 $FE15 INC HL        ; }
 $FE16 IN A,(C)      ;
 $FE18 CPL           ; {  A = ~A & *HL++;
 $FE19 AND (HL)      ;
 $FE1A INC HL        ; }
 $FE1B JR Z,$FE21    ;   if (A) <%
 $FE1D LD E,$06      ;     E = input_RIGHT;
 $FE1F JR $FE22      ;   %>
*$FE21 LD E,A        ;   else <% E = A; /* == 0 */ %> %>
; Up or down?
*$FE22 LD B,(HL)     ; {B = *HL++;
 $FE23 INC HL        ; }
 $FE24 IN A,(C)      ;
 $FE26 CPL           ; {A = ~A & *HL++;
 $FE27 AND (HL)      ;
 $FE28 INC HL        ; }
 $FE29 JR Z,$FE30    ; if (A) <%
 $FE2B INC HL        ; {  HL += 2; /* Skip down keydef */
 $FE2C INC HL        ; }
 $FE2D INC E         ;   E += input_UP;
 $FE2E JR $FE3B      ; %>
; Down.
*$FE30 LD B,(HL)     ; {else <% B = *HL++;
 $FE31 INC HL        ; }
 $FE32 IN A,(C)      ;
 $FE34 CPL           ; {  A = ~A & *HL++;
 $FE35 AND (HL)      ;
 $FE36 INC HL        ; }
 $FE37 JR Z,$FE3B    ;   if (A) <%
 $FE39 INC E         ; {    E += input_DOWN; %> %>
 $FE3A INC E         ; }
; Fire?
*$FE3B LD B,(HL)     ; {B = *HL++;
 $FE3C INC HL        ; }
 $FE3D IN A,(C)      ;
 $FE3F CPL           ; {A = ~A & *HL++;
 $FE40 AND (HL)      ;
 $FE41 INC HL        ; }
 $FE42 LD A,E        ; A = E;
 $FE43 RET Z         ; if (A)
 $FE44 ADD A,$09     ;   A += input_FIRE;
 $FE46 RET           ; return;

; Protek (cursor) joystick input routine.
;
; .
;
; O:A Input value (as per enum input).
;
; Horizontal.
@label=inputroutine_protek
c$FE47 LD BC,$F7FE   ; BC = port_KEYBOARD_12345;
 $FE4A IN A,(C)      ;
 $FE4C CPL           ; {A = ~A & (1<<4); /* 5 == left */
 $FE4D AND $10       ; }
 $FE4F LD E,$03      ; E = input_LEFT;
 $FE51 LD B,$EF      ; B = 0xEF; /* port_KEYBOARD_09876 */
 $FE53 JR NZ,$FE60   ; if (Z) <%
 $FE55 IN A,(C)      ;
 $FE57 CPL           ; {  A = ~A & (1<<2);
 $FE58 AND $04       ; }
 $FE5A LD E,$06      ;   E = input_RIGHT;
 $FE5C JR NZ,$FE60   ;   if (Z)
 $FE5E LD E,$00      ;     E = 0; %>
; Vertical.
*$FE60 IN A,(C)      ;
 $FE62 CPL           ; A = ~A;
 $FE63 LD D,A        ; D = A;
 $FE64 AND $08       ; A &= (1<<3);
 $FE66 LD A,$01      ; A = input_UP; /* interleaved */
 $FE68 JR NZ,$FE72   ; if (Z) <%
 $FE6A LD A,D        ;   A = D;
 $FE6B AND $10       ;   A &= (1<<4);
 $FE6D LD A,$02      ;   A = input_DOWN; /* interleaved */
 $FE6F JR NZ,$FE72   ;   if (Z)
 $FE71 XOR A         ;     A = input_NONE; %>
*$FE72 ADD A,E       ; {E += A; /* Combine axis */
 $FE73 LD E,A        ; }
; Fire.
 $FE74 LD A,D        ; {A = D & (1<<0);
 $FE75 AND $01       ; }
 $FE77 LD A,$09      ; A = input_FIRE; /* interleaved */
 $FE79 JR NZ,$FE7C   ; {if (Z) A = 0;
 $FE7B XOR A         ; }
*$FE7C ADD A,E       ; A += E; /* Combine axis */
 $FE7D RET           ; return;

; Kempston joystick input routine.
;
; Reading port 0x1F yields 000FUDLR active high.
;
; O:A Input value (as per enum input).
@label=inputroutine_kempston
c$FE7E LD BC,$001F   ; BC = 0x001F;
 $FE81 IN A,(C)      ;
 $FE83 LD BC,$0000   ; BC = 0;
 $FE86 RRA           ; carry = A & 1; A >>= 1;
 $FE87 JR NC,$FE8B   ; {if (carry) B = input_RIGHT;
 $FE89 LD B,$06      ; }
*$FE8B RRA           ; carry = A & 1; A >>= 1;
 $FE8C JR NC,$FE90   ; {if (carry) B = input_LEFT;
 $FE8E LD B,$03      ; }
*$FE90 RRA           ; carry = A & 1; A >>= 1;
 $FE91 JR NC,$FE95   ; {if (carry) C = input_DOWN;
 $FE93 LD C,$02      ; }
*$FE95 RRA           ; carry = A & 1; A >>= 1;
 $FE96 JR NC,$FE9A   ; {if (carry) C = input_UP;
 $FE98 LD C,$01      ; }
*$FE9A RRA           ; carry = A & 1; A >>= 1;
 $FE9B LD A,$09      ; A = input_FIRE;
 $FE9D JR C,$FEA0    ; {if (!carry) A = 0;
 $FE9F XOR A         ; }
*$FEA0 ADD A,B       ; {A += B + C;
 $FEA1 ADD A,C       ; }
 $FEA2 RET           ; return; /* Combine axis */

; Fuller joystick input routine.
;
; Reading port 0x7F yields F---RLDU active low.
;
;   This is unused by the game.
; O:A Input value (as per enum input).
@label=inputroutine_fuller
c$FEA3 LD BC,$007F   ; BC = 0x007F;
 $FEA6 IN A,(C)      ;
 $FEA8 LD BC,$0000   ; BC = 0;
 $FEAB BIT 4,A       ; {if (A & (1<<4)) A = ~A;
 $FEAD JR Z,$FEB0    ;
 $FEAF CPL           ; }
*$FEB0 RRA           ; carry = A & 1; A >>= 1;
 $FEB1 JR NC,$FEB5   ; {if (carry) C = input_UP;
 $FEB3 LD C,$01      ; }
*$FEB5 RRA           ; carry = A & 1; A >>= 1;
 $FEB6 JR NC,$FEBA   ; {if (carry) C = input_DOWN;
 $FEB8 LD C,$02      ; }
*$FEBA RRA           ; carry = A & 1; A >>= 1;
 $FEBB JR NC,$FEBF   ; {if (carry) B = input_LEFT;
 $FEBD LD B,$03      ; }
*$FEBF RRA           ; carry = A & 1; A >>= 1;
 $FEC0 JR NC,$FEC4   ; {if (carry) B = input_RIGHT;
 $FEC2 LD B,$06      ; }
*$FEC4 AND $08       ; {if (A & (1<<3)) A = input_FIRE; /* otherwise A is zero */
 $FEC6 JR Z,$FECA    ;
 $FEC8 LD A,$09      ; }
*$FECA ADD A,B       ; {A += B + C; /* Combine axis */
 $FECB ADD A,C       ; }
 $FECC RET           ; return;

; Sinclair joystick input routine.
;
; Up/Down/Left/Right/Fire = keys 9/8/6/7/0.
;
; O:A Input value (as per enum input).
@label=inputroutine_sinclair
c$FECD LD BC,$EFFE   ; BC = port_KEYBOARD_09876;
 $FED0 IN A,(C)      ;
 $FED2 CPL           ; A = ~A; /* xxx67890 */
 $FED3 LD BC,$0000   ; BC = 0;
 $FED6 RRCA          ; RRCA /* 0xxx6789 */
 $FED7 RRCA          ; RRCA /* 90xxx678 */
 $FED8 JR NC,$FEDC   ; {if (carry) C = input_UP;
 $FEDA LD C,$01      ; }
*$FEDC RRCA          ; RRCA /* 890xxx67 */
 $FEDD JR NC,$FEE1   ; {if (carry) C = input_DOWN;
 $FEDF LD C,$02      ; }
*$FEE1 RRCA          ; RRCA /* 7890xxx6 */
 $FEE2 JR NC,$FEE6   ; {if (carry) B = input_RIGHT;
 $FEE4 LD B,$06      ; }
*$FEE6 RRCA          ; RRCA /* 67890xxx */
 $FEE7 JR NC,$FEEB   ; {if (carry) B = input_LEFT;
 $FEE9 LD B,$03      ; }
*$FEEB AND $08       ; {if ((A & (1<<3)) == 0) A = input_FIRE;
 $FEED JR Z,$FEF1    ;
 $FEEF LD A,$09      ; }
*$FEF1 ADD A,B       ; {A += B + C; /* Combine axis */
 $FEF2 ADD A,C       ; }
 $FEF3 RET           ; return;

; Data block at FEF4.
;
; The final standard speed data block on the tape is loaded at $FC60..$FF81.
; The bytes from here up to $FF81 come from that block.
;
b$FEF4 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FEFC DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FF04 DEFB $00,$00,$00,$00,$00,$00,$E0,$57
 $FF0C DEFB $DB,$02,$DB,$02,$4D,$00,$EC,$55
 $FF14 DEFB $00,$00,$05,$3D,$F3,$0D,$CE,$0B
 $FF1C DEFB $F0,$50,$DB,$02,$4D,$00,$F9,$55
 $FF24 DEFB $00,$00,$CE,$0B,$FB,$50,$06,$17
 $FF2C DEFB $DC,$0A,$D7,$18,$38,$00,$38,$00
 $FF34 DEFB $0D,$19,$DB,$02,$DB,$02,$4D,$00
 $FF3C DEFB $F7,$54,$09,$00,$F6,$54,$0C,$02
 $FF44 DEFB $5C,$0E,$C0,$57,$71,$0E,$F3,$0D
 $FF4C DEFB $21,$17,$C6,$1E,$FF,$5D,$76,$1B
 $FF54 DEFB $03,$13,$00,$3E
; UDGs 'A' to 'E' follow, with 'F' truncated at its second byte.
@label=map_buf
 $FF58 DEFB $00,$3C,$42,$42,$7E,$42,$42,$00 ; A #HTML[#UDG$FF58]
 $FF60 DEFB $00,$7C,$42,$7C,$42,$42,$7C,$00 ; B #HTML[#UDG$FF60]
 $FF68 DEFB $00,$3C,$42,$40,$40,$42,$3C,$00 ; C #HTML[#UDG$FF68]
 $FF70 DEFB $00,$78,$44,$42,$42,$44,$78,$00 ; D #HTML[#UDG$FF70]
 $FF78 DEFB $00,$7E,$40,$7C,$40,$40,$7E,$00 ; E #HTML[#UDG$FF78]
 $FF80 DEFB $00,$7E ; Truncated F
; NUL bytes
 $FF82 DEFB $00,$00
 $FF84 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FF8C DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FF94 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FF9C DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFA4 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFAC DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFB4 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFBC DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFC4 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFCC DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFD4 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFDC DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFE4 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFEC DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFF4 DEFB $00,$00,$00,$00,$00,$00,$00,$00
 $FFFC DEFB $00,$00,$00,$00
