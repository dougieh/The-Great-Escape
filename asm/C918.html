<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at C918</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="C892.html">C892</a></span></td>
<td class="up">Up: <a href="../maps/all.html#c918">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="CA11.html">CA11</a></span></td>
</tr>
</table>
<div class="description">C918: Character behaviour stuff.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="C4E0.html">C4E0</a> and <a href="C892.html">C892</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Pointer to visible character.</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c918"></span>C918</td>
<td class="instruction">LD A,(IY+$07)</td>
<td class="comment-11" rowspan="1">A = IY[7]; // $8007 etc. // more flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c91b"></span>C91B</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">B = A;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c91c"></span>
<div class="comments">
<div class="paragraph">
If the bottom nibble is set then decrement it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c91c"></span>C91C</td>
<td class="instruction">AND $0F</td>
<td class="comment-11" rowspan="1">A &amp;= vischar_BYTE7_MASK_LO;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c91e"></span>C91E</td>
<td class="instruction">JR Z,$C925</td>
<td class="comment-11" rowspan="1">if (A) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c920"></span>C920</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="2">IY[7] = --B; // decrement but don't affect flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c921"></span>C921</td>
<td class="instruction">LD (IY+$07),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c924"></span>C924</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c925"></span>C925</td>
<td class="instruction">PUSH IY</td>
<td class="comment-11" rowspan="2">HL = IY;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c927"></span>C927</td>
<td class="instruction">POP HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c928"></span>C928</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">A = *++HL; // incremented HL is $8021 $8041 $8061</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c929"></span>C929</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c92a"></span>C92A</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A != 0) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c92b"></span>C92B</td>
<td class="instruction">JP Z,$C9BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c92e"></span>C92E</td>
<td class="instruction">CP $01</td>
<td class="comment-11" rowspan="2">if (A == vischar_FLAGS_BRIBE_PENDING) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c930"></span>C930</td>
<td class="instruction">JR NZ,$C943</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c932"></span>C932</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c933"></span>C933</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c934"></span>C934</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">POP DEdash // ie. DEdash = HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c935"></span>C935</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="3">DEdash += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c936"></span>C936</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c937"></span>C937</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c938"></span>C938</td>
<td class="instruction">LD HL,$81B8</td>
<td class="comment-11" rowspan="1">HLdash = &amp;hero_map_position.x;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c93b"></span>C93B</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DEdash++ = *HLdash++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c93d"></span>C93D</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DEdash++ = *HLdash++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c93f"></span>C93F</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c940"></span>C940</td>
<td class="instruction">JP $C9C0</td>
<td class="comment-11" rowspan="1">goto jump_c9c0; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c943"></span>C943</td>
<td class="instruction">CP $02</td>
<td class="comment-11" rowspan="2">else if (A == vischar_FLAGS_BIT1) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c945"></span>C945</td>
<td class="instruction">JR NZ,$C953</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c947"></span>C947</td>
<td class="instruction">LD A,($A139)</td>
<td class="comment-11" rowspan="3">if (automatic_player_counter) goto $C932; // jump into case 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c94a"></span>C94A</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c94b"></span>C94B</td>
<td class="instruction">JR NZ,$C932</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c94d"></span>C94D</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-11" rowspan="2">*HL++ = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c94f"></span>C94F</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c950"></span>C950</td>
<td class="instruction">JP <a href="CB23.html">$CB23</a></td>
<td class="comment-11" rowspan="1">get_next_target_and_handle_it(); return; %&gt; // exit via</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c953"></span>C953</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1">else if (A == (vischar_FLAGS_BRIBE_PENDING + vischar_FLAGS_BIT1)) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c955"></span>C955</td>
<td class="instruction">JR NZ,$C979</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c957"></span>C957</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c958"></span>C958</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c959"></span>C959</td>
<td class="instruction">LD HL,$76FA</td>
<td class="comment-11" rowspan="3">if (item_structs[item_FOOD].room &amp; itemstruct_ROOM_FLAG_NEARBY_7) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c95c"></span>C95C</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c95e"></span>C95E</td>
<td class="instruction">JR Z,$C96C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c960"></span>
<div class="comments">
<div class="paragraph">
Moves dog toward poisoned food?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c960"></span>C960</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c961"></span>C961</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="3">DE += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c962"></span>C962</td>
<td class="instruction">ADD A,$03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c964"></span>C964</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c965"></span>C965</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c967"></span>C967</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c969"></span>C969</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c96a"></span>C96A</td>
<td class="instruction">JR $C9C0</td>
<td class="comment-11" rowspan="1">goto jump_c9c0; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c96c"></span>C96C</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">else &lt;% A = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c96d"></span>C96D</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">*DE = A;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c96e"></span>C96E</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c96f"></span>C96F</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">*++HL = 0xFF;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c970"></span>C970</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c972"></span>C972</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">*++HL = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c973"></span>C973</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c975"></span>C975</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c976"></span>C976</td>
<td class="instruction">JP <a href="CB23.html">$CB23</a></td>
<td class="comment-11" rowspan="1">get_next_target_and_handle_it(); return; %&gt; %&gt; // exit via</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c979"></span>C979</td>
<td class="instruction">CP $04</td>
<td class="comment-11" rowspan="2">else if (A == vischar_FLAGS_SAW_BRIBE) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c97b"></span>C97B</td>
<td class="instruction">JR NZ,$C9BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c97d"></span>C97D</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c97e"></span>C97E</td>
<td class="instruction">LD A,($AF8E)</td>
<td class="comment-11" rowspan="1">A = bribed_character;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c981"></span>C981</td>
<td class="instruction">CP $FF</td>
<td class="comment-11" rowspan="2">if (A != character_NONE) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c983"></span>C983</td>
<td class="instruction">JR Z,$C995</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c985"></span>C985</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c986"></span>C986</td>
<td class="instruction">LD B,$07</td>
<td class="comment-11" rowspan="1">B = 7; // 7 iterations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c988"></span>C988</td>
<td class="instruction">LD HL,$8020</td>
<td class="comment-11" rowspan="1">HL = $8020; // iterate over non-player characters</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c98b"></span>C98B</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1">do &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c98c"></span>C98C</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="2">if (*HL == A) goto found_bribed;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c98d"></span>C98D</td>
<td class="instruction">JR Z,$C99C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c98f"></span>C98F</td>
<td class="instruction">LD A,$20</td>
<td class="comment-11" rowspan="3">HL += 32;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c991"></span>C991</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c992"></span>C992</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c993"></span>C993</td>
<td class="instruction">DJNZ $C98B</td>
<td class="comment-11" rowspan="1">%&gt; while (--B); %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c995"></span>C995</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c996"></span>
<div class="comments">
<div class="paragraph">
Bribed character was not visible.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c996"></span>C996</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-11" rowspan="2">*HL++ = 0;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c998"></span>C998</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c999"></span>C999</td>
<td class="instruction">JP <a href="CB23.html">$CB23</a></td>
<td class="comment-11" rowspan="1">get_next_target_and_handle_it(); return; // exit via</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c99c"></span>
<div class="comments">
<div class="paragraph">
Found bribed character.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c99c"></span>C99C</td>
<td class="instruction">LD A,$0F</td>
<td class="comment-11" rowspan="3">found_bribed: HL += 15;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c99e"></span>C99E</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c99f"></span>C99F</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9a0"></span>C9A0</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9a1"></span>C9A1</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9a2"></span>C9A2</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="3">DE += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9a3"></span>C9A3</td>
<td class="instruction">ADD A,$03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9a5"></span>C9A5</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9a6"></span>C9A6</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-11" rowspan="3">if (room_index) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9a9"></span>C9A9</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9aa"></span>C9AA</td>
<td class="instruction">JP NZ,$C9B2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c9ad"></span>
<div class="comments">
<div class="paragraph">
Indoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9ad"></span>C9AD</td>
<td class="instruction">CALL <a href="E542.html">$E542</a></td>
<td class="comment-11" rowspan="1">pos_to_tinypos(HL,DE); %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9b0"></span>C9B0</td>
<td class="instruction">JR $C9B7</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c9b2"></span>
<div class="comments">
<div class="paragraph">
Outdoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9b2"></span>C9B2</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9b4"></span>C9B4</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">HL++;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9b5"></span>C9B5</td>
<td class="instruction">LDI</td>
<td class="comment-11" rowspan="1">*DE++ = *HL++; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9b7"></span>C9B7</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9b8"></span>C9B8</td>
<td class="instruction">JR $C9C0</td>
<td class="comment-11" rowspan="1">goto jump_c9c0; %&gt; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9ba"></span>C9BA</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="3">A = HL[1];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9bb"></span>C9BB</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9bc"></span>C9BC</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9bd"></span>C9BD</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A == 0) goto character_behaviour_end_1;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9be"></span>C9BE</td>
<td class="instruction">JR Z,$C9F5</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9c0"></span>C9C0</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">jump_c9c0: A = *HL; // HL is $8001</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9c1"></span>C9C1</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9c2"></span>C9C2</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Cdash = A;</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c9c3"></span>
<div class="comments">
<div class="paragraph">
Self modify vischar_at_pos_x/y routines.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9c3"></span>C9C3</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-11" rowspan="3">if (room_index &gt; room_0_OUTDOORS) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9c6"></span>C9C6</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9c7"></span>C9C7</td>
<td class="instruction">JR Z,$C9CE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9c9"></span>C9C9</td>
<td class="instruction">LD HL,$CB75</td>
<td class="comment-11" rowspan="1">HLdash = &amp;multiply_by_1; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9cc"></span>C9CC</td>
<td class="instruction">JR $C9DA</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9ce"></span>C9CE</td>
<td class="instruction">BIT 6,C</td>
<td class="comment-11" rowspan="2">if (Cdash &amp; vischar_FLAGS_DOOR_THING) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9d0"></span>C9D0</td>
<td class="instruction">JR Z,$C9D7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9d2"></span>C9D2</td>
<td class="instruction">LD HL,$B295</td>
<td class="comment-11" rowspan="1">HLdash = &amp;multiply_by_4; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9d5"></span>C9D5</td>
<td class="instruction">JR $C9DA</td>
<td class="comment-11" rowspan="1">else &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9d7"></span>C9D7</td>
<td class="instruction">LD HL,$B1C7</td>
<td class="comment-11" rowspan="1">HLdash = &amp;multiply_by_8; %&gt; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9da"></span>C9DA</td>
<td class="instruction">LD ($CA13),HL</td>
<td class="comment-11" rowspan="1">($CA13) = HLdash; // self-modify vischar_at_pos_x:$CA13</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9dd"></span>C9DD</td>
<td class="instruction">LD ($CA4B),HL</td>
<td class="comment-11" rowspan="1">($CA4B) = HLdash; // self-modify vischar_at_pos_y:$CA4B</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9e0"></span>C9E0</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9e1"></span>C9E1</td>
<td class="instruction">BIT 5,(IY+$07)</td>
<td class="comment-11" rowspan="2">if (IY[7] &amp; vischar_BYTE7_IMPEDED) goto character_behaviour_end_2; // hit a wall etc.</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9e5"></span>C9E5</td>
<td class="instruction">JR NZ,$C9FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9e7"></span>C9E7</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="3">HL += 3;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9e8"></span>C9E8</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9e9"></span>C9E9</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9ea"></span>C9EA</td>
<td class="instruction">CALL <a href="CA11.html">$CA11</a></td>
<td class="comment-11" rowspan="1">vischar_at_pos_x();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9ed"></span>C9ED</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment-11" rowspan="1">if (Z) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9ef"></span>C9EF</td>
<td class="instruction">CALL <a href="CA49.html">$CA49</a></td>
<td class="comment-11" rowspan="1">vischar_at_pos_y();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9f2"></span>C9F2</td>
<td class="instruction">JP Z,<a href="CA81.html">$CA81</a></td>
<td class="comment-11" rowspan="1">if (Z) goto bribes_solitary_food; %&gt; // exit via // character couldn't move?</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="c9f5"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="CA81.html">CA81</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9f5"></span>C9F5</td>
<td class="instruction">CP (IY+$0D)</td>
<td class="comment-11" rowspan="4">character_behaviour_end_1: if (A != IY[13]) IY[13] = A | input_KICK; // sampled IY=$8040,$8020,$8000</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9f8"></span>C9F8</td>
<td class="instruction">RET Z</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9f9"></span>C9F9</td>
<td class="instruction">OR $80</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9fb"></span>C9FB</td>
<td class="instruction">LD (IY+$0D),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="c9fe"></span>C9FE</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="c9ff"></span>C9FF</td>
<td class="instruction">LD A,$04</td>
<td class="comment-11" rowspan="3">character_behaviour_end_2: L += 4;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca01"></span>CA01</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca02"></span>CA02</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca03"></span>CA03</td>
<td class="instruction">CALL <a href="CA49.html">$CA49</a></td>
<td class="comment-11" rowspan="1">vischar_at_pos_y();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca06"></span>CA06</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment-11" rowspan="2">if (Z) vischar_at_pos_x();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca08"></span>CA08</td>
<td class="instruction">CALL <a href="CA11.html">$CA11</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca0b"></span>CA0B</td>
<td class="instruction">JR NZ,$C9F5</td>
<td class="comment-11" rowspan="1">if (!Z) goto character_behaviour_end_1; // likely: couldn't move, so .. do something</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca0d"></span>CA0D</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1">HL--;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="ca0e"></span>CA0E</td>
<td class="instruction">JP <a href="CA81.html">$CA81</a></td>
<td class="comment-11" rowspan="1">bribes_solitary_food(); return; // exit via</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="C892.html">C892</a></span></td>
<td class="up">Up: <a href="../maps/all.html#c918">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="CA11.html">CA11</a></span></td>
</tr>
</table>
<footer>
<div class="release">The incomplete The Great Escape disassembly 20170325</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.4.</div>
</footer>
</body>
</html>