<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at A51C</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="A50B.html">A50B</a></span></td>
<td class="up">Up: <a href="../maps/all.html#a51c">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="A58C.html">A58C</a></span></td>
</tr>
</table>
<div class="description">A51C: Hero has escaped.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="9F21.html">9F21</a>.
</div>
<div class="paragraph">
Print 'well done' message then test to see if the correct objects were used in the escape attempt.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="a51c"></span>A51C</td>
<td class="instruction">CALL <a href="A50B.html">$A50B</a></td>
<td class="comment-11" rowspan="1">screen_reset();</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="a51f"></span>
<div class="comments">
<div class="paragraph">
Print standard prefix messages.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a51f"></span>A51F</td>
<td class="instruction">LD HL,$A5CE</td>
<td class="comment-11" rowspan="1">HL = &amp;escape_strings[0];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a522"></span>A522</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">screenlocstring_plot(); // WELL DONE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a525"></span>A525</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">screenlocstring_plot(); // YOU HAVE ESCAPED</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a528"></span>A528</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">screenlocstring_plot(); // FROM THE CAMP</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="a52b"></span>
<div class="comments">
<div class="paragraph">
Form escape items bitfield.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a52b"></span>A52B</td>
<td class="instruction">LD C,$00</td>
<td class="comment-11" rowspan="1">C = 0; // zero flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a52d"></span>A52D</td>
<td class="instruction">LD HL,$8215</td>
<td class="comment-11" rowspan="1">HL = &amp;items_held[0];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a530"></span>A530</td>
<td class="instruction">CALL <a href="A59C.html">$A59C</a></td>
<td class="comment-11" rowspan="1">join_item_to_escapeitem();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a533"></span>A533</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">HL++; // &amp;items_held[1];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a534"></span>A534</td>
<td class="instruction">CALL <a href="A59C.html">$A59C</a></td>
<td class="comment-11" rowspan="1">join_item_to_escapeitem();</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="a537"></span>
<div class="comments">
<div class="paragraph">
Print item-tailored messages.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a537"></span>A537</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1">A = C;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a538"></span>A538</td>
<td class="instruction">CP $05</td>
<td class="comment-11" rowspan="2">if (A == escapeitem_COMPASS + escapeitem_PURSE) goto success;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a53a"></span>A53A</td>
<td class="instruction">JR Z,$A540</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a53c"></span>A53C</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="2">else if (A != escapeitem_COMPASS + escapeitem_PAPERS) goto captured;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a53e"></span>A53E</td>
<td class="instruction">JR NZ,$A54E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="a540"></span>A540</td>
<td class="instruction">LD HL,$A5FD</td>
<td class="comment-11" rowspan="1">success: HL = &amp;escape_strings[3];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a543"></span>A543</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">screenlocstring_plot(); // AND WILL CROSS THE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a546"></span>A546</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">screenlocstring_plot(); // BORDER SUCCESSFULLY</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a549"></span>A549</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-11" rowspan="1">A = 0xFF; // success - reset game</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a54b"></span>A54B</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a54c"></span>A54C</td>
<td class="instruction">JR $A56E</td>
<td class="comment-11" rowspan="1">goto press_any_key;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="a54e"></span>A54E</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">captured:</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a54f"></span>A54F</td>
<td class="instruction">LD HL,$A628</td>
<td class="comment-11" rowspan="1">HL = &amp;escape_strings[5];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a552"></span>A552</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">screenlocstring_plot(); // BUT WERE RECAPTURED</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a555"></span>A555</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a556"></span>A556</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a557"></span>A557</td>
<td class="instruction">CP $08</td>
<td class="comment-11" rowspan="2">if (A &gt;= escapeitem_UNIFORM) goto plot; // at least a uniform =&gt; 'but were recaptured' // bug? plotting twice</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a559"></span>A559</td>
<td class="instruction">JR NC,$A56B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a55b"></span>A55B</td>
<td class="instruction">LD HL,$A652</td>
<td class="comment-11" rowspan="1">HL = &amp;escape_strings[7];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a55e"></span>A55E</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">if (A == 0) goto plot; // no objects =&gt; 'totally unprepared'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a55f"></span>A55F</td>
<td class="instruction">JR Z,$A56B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a561"></span>A561</td>
<td class="instruction">LD HL,$A667</td>
<td class="comment-11" rowspan="1">HL = &amp;escape_strings[8];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a564"></span>A564</td>
<td class="instruction">BIT 0,A</td>
<td class="comment-11" rowspan="2">if ((A &amp; escapeitem_COMPASS) == 0) goto plot; // no compass =&gt; 'totally lost'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a566"></span>A566</td>
<td class="instruction">JR Z,$A56B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a568"></span>A568</td>
<td class="instruction">LD HL,$A676</td>
<td class="comment-11" rowspan="1">HL = &amp;escape_strings[9];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="a56b"></span>A56B</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">plot: screenlocstring_plot();</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="a56e"></span>A56E</td>
<td class="instruction">LD HL,$A68E</td>
<td class="comment-11" rowspan="1">press_any_key: HL = &amp;escape_strings[10];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a571"></span>A571</td>
<td class="instruction">CALL <a href="A5BF.html">$A5BF</a></td>
<td class="comment-11" rowspan="1">screenlocstring_plot(); // PRESS ANY KEY</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="a574"></span>
<div class="comments">
<div class="paragraph">
Wait for a keypress.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="a574"></span>A574</td>
<td class="instruction">CALL <a href="A58C.html">$A58C</a></td>
<td class="comment-11" rowspan="2">do &lt;% keyscan_all(); %&gt; while (!Z); // down press</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a577"></span>A577</td>
<td class="instruction">JR NZ,$A574</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="a579"></span>A579</td>
<td class="instruction">CALL <a href="A58C.html">$A58C</a></td>
<td class="comment-11" rowspan="2">do &lt;% keyscan_all(); %&gt; while (Z); // up press</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a57c"></span>A57C</td>
<td class="instruction">JR Z,$A579</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a57e"></span>A57E</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="a57f"></span>
<div class="comments">
<div class="paragraph">
Reset the game, or send the hero to solitary.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a57f"></span>A57F</td>
<td class="instruction">CP $FF</td>
<td class="comment-11" rowspan="4">if (A == 0xFF || A &gt;= escapeitem_UNIFORM) &lt;% reset_game(); return; %&gt; // exit via</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a581"></span>A581</td>
<td class="instruction">JP Z,<a href="B75A.html">$B75A</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a584"></span>A584</td>
<td class="instruction">CP $08</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a586"></span>A586</td>
<td class="instruction">JP NC,<a href="B75A.html">$B75A</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="a589"></span>A589</td>
<td class="instruction">JP <a href="CB98.html">$CB98</a></td>
<td class="comment-11" rowspan="1">solitary(); return; // exit via</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="A50B.html">A50B</a></span></td>
<td class="up">Up: <a href="../maps/all.html#a51c">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="A58C.html">A58C</a></span></td>
</tr>
</table>
<footer>
<div class="release">The incomplete The Great Escape disassembly 20170325</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.4.</div>
</footer>
</body>
</html>