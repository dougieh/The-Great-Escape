<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at B14C</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="B107.html">B107</a></span></td>
<td class="up">Up: <a href="../maps/all.html#b14c">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="B1C7.html">B1C7</a></span></td>
</tr>
</table>
<div class="description">B14C: Check the character is inside of permitted areas.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="AF8F.html">AF8F</a> and <a href="C4E0.html">C4E0</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">IY</td>
<td class="register-desc">Pointer to visible character.</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="b14c"></span>B14C</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-11" rowspan="3">if (room_index) &lt;% interior_bounds_check(); return; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b14f"></span>B14F</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b150"></span>B150</td>
<td class="instruction">JP NZ,<a href="B29F.html">$B29F</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b153"></span>B153</td>
<td class="instruction">LD B,$18</td>
<td class="comment-11" rowspan="1">B = 24; // 24 iterations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b155"></span>B155</td>
<td class="instruction">LD DE,$B53E</td>
<td class="comment-11" rowspan="1">DE = &amp;walls[0];</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="b158"></span>B158</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">do &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b159"></span>B159</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b15a"></span>B15A</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="2"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b15b"></span>B15B</td>
<td class="instruction">CALL <a href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b15e"></span>B15E</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="5">if ((saved_pos_x &gt;= DE[0] * 8 + 2) &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b15f"></span>B15F</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b160"></span>B160</td>
<td class="instruction">LD HL,($81A4)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b163"></span>B163</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b165"></span>B165</td>
<td class="instruction">JR C,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b167"></span>B167</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b168"></span>B168</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b169"></span>B169</td>
<td class="instruction">CALL <a href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b16c"></span>B16C</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="7">(saved_pos_x &lt;  DE[1] * 8 + 4) &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b16d"></span>B16D</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b16e"></span>B16E</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b16f"></span>B16F</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b170"></span>B170</td>
<td class="instruction">LD HL,($81A4)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b173"></span>B173</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b175"></span>B175</td>
<td class="instruction">JR NC,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b177"></span>B177</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b178"></span>B178</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b179"></span>B179</td>
<td class="instruction">CALL <a href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b17c"></span>B17C</td>
<td class="instruction">LD HL,($81A6)</td>
<td class="comment-11" rowspan="3">(saved_pos_y &gt;= DE[2] * 8)     &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b17f"></span>B17F</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b181"></span>B181</td>
<td class="instruction">JR C,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b183"></span>B183</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b184"></span>B184</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b185"></span>B185</td>
<td class="instruction">CALL <a href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b188"></span>B188</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="7">(saved_pos_y &lt;  DE[3] * 8 + 4) &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b189"></span>B189</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b18a"></span>B18A</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b18b"></span>B18B</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b18c"></span>B18C</td>
<td class="instruction">LD HL,($81A6)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b18f"></span>B18F</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b191"></span>B191</td>
<td class="instruction">JR NC,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b193"></span>B193</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b194"></span>B194</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b195"></span>B195</td>
<td class="instruction">CALL <a href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b198"></span>B198</td>
<td class="instruction">LD HL,($81A8)</td>
<td class="comment-11" rowspan="3">(saved_height &gt;= DE[4] * 8)     &amp;&amp;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b19b"></span>B19B</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b19d"></span>B19D</td>
<td class="instruction">JR C,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b19f"></span>B19F</td>
<td class="instruction">INC DE</td>
<td class="comment-11" rowspan="3"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1a0"></span>B1A0</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1a1"></span>B1A1</td>
<td class="instruction">CALL <a href="B1C7.html">$B1C7</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1a4"></span>B1A4</td>
<td class="instruction">INC BC</td>
<td class="comment-11" rowspan="5">(saved_height &lt;  DE[5] * 8 + 2)) &lt;%</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1a5"></span>B1A5</td>
<td class="instruction">INC BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1a6"></span>B1A6</td>
<td class="instruction">LD HL,($81A8)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1a9"></span>B1A9</td>
<td class="instruction">SBC HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1ab"></span>B1AB</td>
<td class="instruction">JR NC,$B1BA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b1ad"></span>
<div class="comments">
<div class="paragraph">
Found it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1ad"></span>B1AD</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1ae"></span>B1AE</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1af"></span>B1AF</td>
<td class="instruction">LD A,(IY+$07)</td>
<td class="comment-11" rowspan="3">IY[7] ^= vischar_BYTE7_IMPEDED; // sampled IY=$80A0,$8080,$8060</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1b2"></span>B1B2</td>
<td class="instruction">XOR $20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1b4"></span>B1B4</td>
<td class="instruction">LD (IY+$07),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1b7"></span>B1B7</td>
<td class="instruction">OR $01</td>
<td class="comment-11" rowspan="1">A |= 1; // return NZ</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1b9"></span>B1B9</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return; %&gt;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="b1ba"></span>B1BA</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1bb"></span>B1BB</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1bc"></span>B1BC</td>
<td class="instruction">LD HL,$0006</td>
<td class="comment-11" rowspan="3">DE += 6;</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1bf"></span>B1BF</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1c0"></span>B1C0</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1c1"></span>B1C1</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="2">%&gt; while (--B);</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1c2"></span>B1C2</td>
<td class="instruction">JP NZ,$B158</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1c5"></span>B1C5</td>
<td class="instruction">AND B</td>
<td class="comment-11" rowspan="1">A &amp;= B; // return Z</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="b1c6"></span>B1C6</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="B107.html">B107</a></span></td>
<td class="up">Up: <a href="../maps/all.html#b14c">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="B1C7.html">B1C7</a></span></td>
</tr>
</table>
<footer>
<div class="release">The incomplete The Great Escape disassembly 20170325</div>
<div class="copyright">&copy; Denton Designs. Ocean. David Thomas.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 5.4.</div>
</footer>
</body>
</html>