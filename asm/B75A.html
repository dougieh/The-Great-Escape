<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at B75A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="The Great Escape" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="B729.html">B729</a></span></td>
<td class="up">Up: <a href="../maps/all.html#b75a">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="B79B.html">B79B</a></span></td>
</tr>
</table>
<div class="description">B75A: Reset the game.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="9DE5.html">keyscan_break</a>, <a href="A51C.html">escaped</a> and <a href="F163.html">main</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b75a"></span>
<div class="comments">
<div class="paragraph">
Cause discovery of all items.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1">reset_game</td>
<td class="address-2"><span id="b75a"></span>B75A</td>
<td class="instruction">LD BC,$1000</td>
<td class="comment-11" rowspan="1">B = item__LIMIT; C = 0;</td>
</tr>
<tr>
<td class="asm-label-1">reset_game_0</td>
<td class="address-2"><span id="b75d"></span>B75D</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">do &lt;%</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b75e"></span>B75E</td>
<td class="instruction">CALL <a href="CD31.html">item_discovered</a></td>
<td class="comment-11" rowspan="1">item_discovered(C); // pass C as C</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b761"></span>B761</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b762"></span>B762</td>
<td class="instruction">INC C</td>
<td class="comment-11" rowspan="1">C++;</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b763"></span>B763</td>
<td class="instruction">DJNZ <a href="B75A.html#b75d">reset_game_0</a></td>
<td class="comment-11" rowspan="1">%&gt; while (--B);</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b765"></span>
<div class="comments">
<div class="paragraph">
Reset message queue.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b765"></span>B765</td>
<td class="instruction">LD HL,$7CFE</td>
<td class="comment-11" rowspan="2">message_queue_pointer = message_queue + 2;</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b768"></span>B768</td>
<td class="instruction">LD ($7D11),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b76b"></span>B76B</td>
<td class="instruction">CALL <a href="B79B.html">reset_map_and_characters</a></td>
<td class="comment-11" rowspan="1">reset_map_and_characters();</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b76e"></span>B76E</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">$8001 = 0; // vischars[0].flags = 0</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b76f"></span>B76F</td>
<td class="instruction">LD ($8001),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b772"></span>
<div class="comments">
<div class="paragraph">
Reset score digits, hero_in_breakfast, red_flag, automatic_player_counter, in_solitary, morale_exhausted.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b772"></span>B772</td>
<td class="instruction">LD HL,$A132</td>
<td class="comment-11" rowspan="1">HL = &amp;score_digits[0];</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b775"></span>B775</td>
<td class="instruction">LD B,$0A</td>
<td class="comment-11" rowspan="1">B = 10; // iterations</td>
</tr>
<tr>
<td class="asm-label-1">reset_game_1</td>
<td class="address-2"><span id="b777"></span>B777</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="2">do &lt;% *HL++ = 0;</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b778"></span>B778</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b779"></span>B779</td>
<td class="instruction">DJNZ <a href="B75A.html#b777">reset_game_1</a></td>
<td class="comment-11" rowspan="1">%&gt; while (--B); // could do a memset</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b77b"></span>
<div class="comments">
<div class="paragraph">
Reset morale.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b77b"></span>B77B</td>
<td class="instruction">LD (HL),$70</td>
<td class="comment-11" rowspan="1">morale = morale_MAX;</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b77d"></span>B77D</td>
<td class="instruction">CALL <a href="A10B.html">plot_score</a></td>
<td class="comment-11" rowspan="1">plot_score();</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b780"></span>
<div class="comments">
<div class="paragraph">
Reset and redraw items.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b780"></span>B780</td>
<td class="instruction">LD HL,$FFFF</td>
<td class="comment-11" rowspan="2">items_held = item_NONE | (item_NONE &lt;&lt; 8);</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b783"></span>B783</td>
<td class="instruction">LD ($8215),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b786"></span>B786</td>
<td class="instruction">CALL <a href="7C33.html">draw_all_items</a></td>
<td class="comment-11" rowspan="1">draw_all_items();</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b789"></span>
<div class="comments">
<div class="paragraph">
Reset the hero's sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b789"></span>B789</td>
<td class="instruction">LD HL,$CE2E</td>
<td class="comment-11" rowspan="2">$8015 = sprite_prisoner;</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b78c"></span>B78C</td>
<td class="instruction">LD ($8015),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b78f"></span>B78F</td>
<td class="instruction">LD A,$02</td>
<td class="comment-11" rowspan="2">room_index = room_2_HUT2LEFT;</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b791"></span>B791</td>
<td class="instruction">LD ($68A0),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="b794"></span>
<div class="comments">
<div class="paragraph">
Put the hero to bed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b794"></span>B794</td>
<td class="instruction">CALL <a href="A489.html">hero_sleeps</a></td>
<td class="comment-11" rowspan="1">hero_sleeps();</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b797"></span>B797</td>
<td class="instruction">CALL <a href="68F4.html">enter_room</a></td>
<td class="comment-11" rowspan="1">enter_room();</td>
</tr>
<tr>
<td class="asm-label-1"></td>
<td class="address-1"><span id="b79a"></span>B79A</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">return;</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="B729.html">B729</a></span></td>
<td class="up">Up: <a href="../maps/all.html#b75a">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="B79B.html">B79B</a></span></td>
</tr>
</table>
<footer>
<div class="release">The incomplete The Great Escape disassembly 20180419</div>
<div class="copyright">&copy; 1986 Denton Designs &amp; Ocean Software Ltd. (The Great Escape). &copy; 2012-2018 David Thomas (this disassembly).</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 6.4.</div>
</footer>
</body>
</html>